<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: oversim::Nice Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classoversim_1_1Nice.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">oversim::Nice Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="oversim::Nice" --><!-- doxytag: inherits="BaseOverlay" -->
<p>NICE overlay module.  
 <a href="classoversim_1_1Nice.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="Nice_8h_source.html">Nice.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for oversim::Nice:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classoversim_1_1Nice.png" usemap="#oversim::Nice_map" alt=""/>
  <map id="oversim::Nice_map" name="oversim::Nice_map">
<area href="classBaseOverlay.html" title="Base class for overlays." alt="BaseOverlay" shape="rect" coords="115,112,220,136"/>
<area href="classBaseRpc.html" title="Base class for RPCs." alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classTopologyVis.html" alt="TopologyVis" shape="rect" coords="230,56,335,80"/>
<area href="classRpcListener.html" title="A Remote-Procedure-Call listener class." alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
 </div></div>

<p><a href="classoversim_1_1Nice-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::set<br class="typebreak"/>
&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::set<br class="typebreak"/>
&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt;::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a2f60a812cd1652cd6624511076dee718">TaSetIt</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a7ffce18253e937f405a232fd8555b60e">Nice</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a9788a3d4f0f81f204edaaa16a492cf50">~Nice</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a63977effde493b185fb9230ec5c2a608">initializeOverlay</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes derived-class-attributes.  <a href="#a63977effde493b185fb9230ec5c2a608"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aebd1289938fa0c32bceda56deafaf302">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aa7b0abef7e007a2a032614cd1e5be597">handleUDPMessage</a> (<a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes messages from underlay.  <a href="#aa7b0abef7e007a2a032614cd1e5be597"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#af750b796fbab34f8fc9c48cca7a26ddb">handleAppMessage</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes "timer" self-messages.  <a href="#af750b796fbab34f8fc9c48cca7a26ddb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a93acdc685e2e7ad1ada75063db007463">finishOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">collects statistical data in derived class  <a href="#a93acdc685e2e7ad1ada75063db007463"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ad1d32ea267badf0b9a482d7c415aa03c">changeState</a> (int toState)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">changes node state  <a href="#ad1d32ea267badf0b9a482d7c415aa03c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a642dd901f2f5b0561cde5a1c3e932d8e">joinOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Join the overlay with a given nodeID in thisNode.key.  <a href="#a642dd901f2f5b0561cde5a1c3e932d8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a9f2264e7a35474365104f15854108700">handleNodeLeaveNotification</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method gets call **.gracefulLeaveDelay seconds before it is killed.  <a href="#a9f2264e7a35474365104f15854108700"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a71a14940853660afb14b6c8f6b5d448c">updateVisualization</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ad3b7430e484451777e58ea163e4fc049">BasicJoinLayer</a> (short layer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aa0181f581e1a294a1a115ce68363a517">ClusterSplit</a> (int layer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a6acafcf8008939d12f8db7e002a2ebb5">Query</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;node, short layer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a133d3f2486a3d5a7c294d3e2d5fa8369">handleNiceClusterMergeRequest</a> (<a class="el" href="classNiceClusterMerge.html">NiceClusterMerge</a> *mergeMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a8a781cde350bdaed6e8db0d0f36d82c0">handleNiceForceMerge</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a9e789530fee17ed030b474ab2a7b1b18">handleNiceHeartbeat</a> (<a class="el" href="classNiceHeartbeat.html">NiceHeartbeat</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a2946a8a0d8f597e09e5d37659d1e30a1">handleNiceLeaderHeartbeat</a> (<a class="el" href="classNiceLeaderHeartbeat.html">NiceLeaderHeartbeat</a> *lhbMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a0d13c3965aafab68b912a6dc75c4e9a0">handleNiceLeaderTransfer</a> (<a class="el" href="classNiceLeaderHeartbeat.html">NiceLeaderHeartbeat</a> *transferMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a0757be556541e2d8efd235be889f2ab6">handleNiceJoinCluster</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *joinMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a32b8406978ad9ab46a7eba786ccf83a2">handleNiceJoineval</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a90140602613205803d08c25820b94063">handleNiceJoinevalResponse</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a34fcedb51cca4b510f3e5a9eebf28096">handleNiceLeaderHeartbeatOrTransfer</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a5ebd8516425fdcc5847e26ce3b08314f">handleNiceMulticast</a> (<a class="el" href="classNiceMulticastMessage.html">NiceMulticastMessage</a> *multicastMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ab6096a998d14db350a8c12780ca62e61">handleNicePeerTemporary</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a761b15b9d4124e34084250c79339da27">handleNicePeerTemporaryRelease</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a45f3d0f25ccf42b10be3717b1e59846b">handleNicePingProbe</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aa818a9dfa6027388de5281eae926c7c4">handleNicePingProbeResponse</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a10494e710344144e515c7e22b83e786c">handleNicePollRp</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a655a94f5f3da35838278419173dda60c">handleNicePollRpResponse</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#afeb7081be1f7f76b2108aad45c49abfe">handleNiceQuery</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *queryMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ab36bfc01b3cd042da92e1b27782ce7bd">handleNiceQueryResponse</a> (<a class="el" href="classNiceMemberMessage.html">NiceMemberMessage</a> *queryRspMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a66a02ca915d3e7182580217bde40ccb5">handleNiceRemove</a> (<a class="el" href="classNiceMessage.html">NiceMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#af4c42da9d6ab2d8e83a4056bf83dd8ab">JoinCluster</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;leader, short layer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a1ffd3a3b39866e51502fee0bf37480f7">sendHeartbeats</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ae1bc183e5411855a2026e884d2d2cee1">cleanPeers</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleans the tempPeers map from peers that have timed out, removes timed-out peers in peerInfos and also removes them from the clusters.  <a href="#ae1bc183e5411855a2026e884d2d2cee1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aed05e40d0f2c58971e6eff74009cbf82">splitNeeded</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Splits clusters if needed.  <a href="#aed05e40d0f2c58971e6eff74009cbf82"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a84af41f236c10b5398aa9d63aeab63b1">mergeNeeded</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Merges clusters if needed.  <a href="#a84af41f236c10b5398aa9d63aeab63b1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a66d414d9448c241ede5d2702cbec6578">checkLeaderHeartbeatsForCollisions</a> (<a class="el" href="classNiceLeaderHeartbeat.html">NiceLeaderHeartbeat</a> *hbMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if we have received conflicting leader heartbeats.  <a href="#a66d414d9448c241ede5d2702cbec6578"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a0a808dd35aedab035a7bb8ba1a5d6f9a">maintenance</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ad87e45d16986960bf34ce49f236e1d52">getMaxDistance</a> (<a class="el" href="classTransportAddress.html">TransportAddress</a> member, const std::set&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt; &amp;neighbors)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;class ConstIter &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#add21d13bfce3f97aa115be55dfe781c2">getMaxDistance</a> (<a class="el" href="classTransportAddress.html">TransportAddress</a> member, ConstIter neighborsBegin, ConstIter neighborsEnd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#af6e0621edd3122f917e428d133a0a732">getMeanDistance</a> (std::set&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt; neighbors)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a> (int layer, <a class="el" href="classTransportAddress.html">TransportAddress</a> leader, <a class="el" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a> cluster, <a class="el" href="classTransportAddress.html">TransportAddress</a> sc_leader, <a class="el" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a> superCluster)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a0202754f95c50b2891cfd0f6234c8f81">LeaderTransfer</a> (int layer, <a class="el" href="classTransportAddress.html">TransportAddress</a> leader)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a546c8b69ae759d24e9b809deb1d75398">Remove</a> (int layer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a677d8c691996974f3abb040578279669">sendHeartbeatTo</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;node, int layer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a70a802eb31e3c0047413fa08864986bf">sendRemoveTo</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;node, int layer)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">sendRemoveTo  <a href="#a70a802eb31e3c0047413fa08864986bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ad4f8cc3855e672b84d2a097bd60c0925">ClusterMerge</a> (int layer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a46eb256216745f2ae5db49585d8c7025">ClusterMergeRequest</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;node, int layer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#af48af4ac315203b552f1eecd1678689c">gracefulLeave</a> (short bottomLayer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, <br class="typebreak"/>
simtime_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a> (<a class="el" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a> cluster, bool allowRandom=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, <br class="typebreak"/>
simtime_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ac67e86de4b5b08c2388242783b0348fc">findCenter</a> (std::vector&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt; cluster, bool allowRandom=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, <br class="typebreak"/>
simtime_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a357ff0d2b5996b7ce8a2cb3f4637b8b6">findCenter</a> (const <a class="el" href="classNiceCluster.html">NiceCluster</a> &amp;cluster, bool allowRandom=false)</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;class ConstIter &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, <br class="typebreak"/>
simtime_t &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#acedb962da716062f124e85bcbced2cbd">findCenter</a> (ConstIter begin, ConstIter end, bool allowRandom=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a92c3a3c37c9c3101ac2e51ab609c4c64">sendDataToOverlay</a> (<a class="el" href="classNiceMulticastMessage.html">NiceMulticastMessage</a> *appMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ac1b9865b490cf352d83680020939c270">pollRP</a> (int layer)</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">heartbeatTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">heartbeatInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">maintenanceTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a6d14d42d813222d9ee8c5d395ba60365">maintenanceInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a4648efb65dd8c13990a571c275d3bd04">queryTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a6e3e4cdfa221e6f9980e3c51a5452570">queryInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a4a913c4be6eabc80fac48dffed005771">rpPollTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a417d95b2b0bdad377d0613f4dde77b66">rpPollTimerInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#abffc50a7507069a0d97997f269c2d130">peerTimeoutHeartbeats</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aa31f386f8403d2ba88f43a1a57fcba57">visualizationTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a7e846c8b782d0bc44fdafc58897d4d5d">first_HB</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a36ec304efa445340c9c1f72e950b076b">first_leader</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#acde4679b6655c0fbf9bdc6c35bc974b0">second_HB</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ad6115b6ca9ae33de7308570d8aaceaf7">second_leader</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::pair<br class="typebreak"/>
&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, simtime_t &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">clusterrefinement</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a1a3aaae38bf78dc32e177868afbde6c7">debug_visualization</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">debug_join</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a6af70b0196fd0d482286c0ff5a46f5ae">debug_peertimeouts</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a12a2bd46343643e35473ab74900db70a">debug_removes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classNiceCluster.html">NiceCluster</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a> [<a class="el" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a71935c17b8b4804bc6dd823d696dbf3e">evalLayer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a46807673c62fb160eaf202a0eac29058">joinLayer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ac00b0f8d11b8f3f7c3e5c2eb78511cc6">polledRendevouzPoint</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aa604bd27a4b737fd179c2b09debebc84">query_start</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a974f1212dc063af0d943b5fa350cc57a">tempResolver</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a3460e84226f3260196e99da210b74082">query_compare</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a327e50ef2c393ea0b929f3f27154ce96">targetLayer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, <br class="typebreak"/>
<a class="el" href="classoversim_1_1NicePeerInfo.html">NicePeerInfo</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, <br class="typebreak"/>
simtime_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">tempPeers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#abe5249e886cdb9e6d56efa40e6efe71e">isTempPeered</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a3469d510d59a1cc3577e5d24a6628275">CLUSTERLEADERBOUND</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ad83625b73a292aa04380837e7d6c3944">CLUSTERLEADERCOMPAREDIST</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a4368d509b0c5ac9950cf8fa52fa5f176">SC_PROC_DISTANCE</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a02292a0c465a7bbb80f66fbd7187cc9b">SC_MIN_OFFSET</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a50dd1e20f4c56dc45f9ffa1c52d2716f">numInconsistencies</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ac151ea0f3d5ac1d60b32d92c08d89e44">numQueryTimeouts</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a82e217903a688c47656a56dc4a593ebc">numPeerTimeouts</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a97964c134da4da5b58b3c7dff32a0800">numTempPeerTimeouts</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#acd1effc337560f6677e63608b3e53af8">numStructurePartitions</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ab0a8837fcffd376b822166d048a401fa">numOwnMessagesReceived</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a063a91a0c9cbd3bcfeca7ce10944eb70">totalSCMinCompare</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a765b5d96a57bf709b6a8ce28541d55a6">numJoins</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aa0d6fe84d8444d39caee3e2c67323550">numForward</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ade427df4fbd3edb53e04467984384927">totalForwardBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ab0165945cd4929e57f66e595ce76cc14">numReceived</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ab70712e9a475d6ab12690cf36a31ffe1">totalReceivedBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#aed41149eb142ad3c71d6a639b113a5f7">numHeartbeat</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#ad186e77457bdad45888594517319a02b">totalHeartbeatBytes</a></td></tr>
<tr><td colspan="2"><h2><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> = 10</td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>NICE overlay module. </p>
<p>Implementation of the NICE overlay as described in "Scalable Application Layer Multicast" by S. Banerjee and B. Bhattacharjee and C. Kommareddy, published at SIGCOMM'02, 2002.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Christian Huebsch </dd></dl>

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00059">59</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>
</div><hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="a60d75f363c7edb6f1fd349cac322d99a"></a><!-- doxytag: member="oversim::Nice::TaSet" ref="a60d75f363c7edb6f1fd349cac322d99a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::set&lt;<a class="el" href="classTransportAddress.html">TransportAddress</a>&gt; <a class="el" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">oversim::Nice::TaSet</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00070">70</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2f60a812cd1652cd6624511076dee718"></a><!-- doxytag: member="oversim::Nice::TaSetIt" ref="a2f60a812cd1652cd6624511076dee718" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::set&lt;<a class="el" href="classTransportAddress.html">TransportAddress</a>&gt;::iterator <a class="el" href="classoversim_1_1Nice.html#a2f60a812cd1652cd6624511076dee718">oversim::Nice::TaSetIt</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00071">71</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a7ffce18253e937f405a232fd8555b60e"></a><!-- doxytag: member="oversim::Nice::Nice" ref="a7ffce18253e937f405a232fd8555b60e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">oversim::Nice::Nice </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00072">72</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">           : <a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>(<span class="keyword">false</span>),
               <a class="code" href="classoversim_1_1Nice.html#abe5249e886cdb9e6d56efa40e6efe71e">isTempPeered</a>(<span class="keyword">false</span>),
               <a class="code" href="classoversim_1_1Nice.html#a50dd1e20f4c56dc45f9ffa1c52d2716f">numInconsistencies</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#ac151ea0f3d5ac1d60b32d92c08d89e44">numQueryTimeouts</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#a82e217903a688c47656a56dc4a593ebc">numPeerTimeouts</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#a97964c134da4da5b58b3c7dff32a0800">numTempPeerTimeouts</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#acd1effc337560f6677e63608b3e53af8">numStructurePartitions</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#ab0a8837fcffd376b822166d048a401fa">numOwnMessagesReceived</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#a063a91a0c9cbd3bcfeca7ce10944eb70">totalSCMinCompare</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#a765b5d96a57bf709b6a8ce28541d55a6">numJoins</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#ade427df4fbd3edb53e04467984384927">totalForwardBytes</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#ab0165945cd4929e57f66e595ce76cc14">numReceived</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#ab70712e9a475d6ab12690cf36a31ffe1">totalReceivedBytes</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#aed41149eb142ad3c71d6a639b113a5f7">numHeartbeat</a>(0),
               <a class="code" href="classoversim_1_1Nice.html#ad186e77457bdad45888594517319a02b">totalHeartbeatBytes</a>(0)
{

    <span class="comment">/* do nothing at this point of time, OverSim calls initializeOverlay */</span>

} <span class="comment">// Nice</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a9788a3d4f0f81f204edaaa16a492cf50"></a><!-- doxytag: member="oversim::Nice::~Nice" ref="a9788a3d4f0f81f204edaaa16a492cf50" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">oversim::Nice::~Nice </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00097">97</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="comment">// destroy self timer messages</span>
    cancelAndDelete(<a class="code" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">heartbeatTimer</a>);
    cancelAndDelete(<a class="code" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">maintenanceTimer</a>);
    cancelAndDelete(<a class="code" href="classoversim_1_1Nice.html#a4a913c4be6eabc80fac48dffed005771">rpPollTimer</a>);
    cancelAndDelete(<a class="code" href="classoversim_1_1Nice.html#a4648efb65dd8c13990a571c275d3bd04">queryTimer</a>);
    cancelAndDelete(<a class="code" href="classoversim_1_1Nice.html#aa31f386f8403d2ba88f43a1a57fcba57">visualizationTimer</a>);

    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.begin();

    <span class="keywordflow">for</span> (; it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end(); it++) {

        <span class="keyword">delete</span> it-&gt;second;

    }

} <span class="comment">// ~NICE</span>
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad3b7430e484451777e58ea163e4fc049"></a><!-- doxytag: member="oversim::Nice::BasicJoinLayer" ref="ad3b7430e484451777e58ea163e4fc049" args="(short layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::BasicJoinLayer </td>
          <td>(</td>
          <td class="paramtype">short&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00555">555</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="comment">// Cancel timers involved in structure refinement</span>
    <span class="comment">/*</span>
<span class="comment">    if (layer == -1 || layer == 0) {</span>
<span class="comment">        cancelEvent(maintenanceTimer);</span>
<span class="comment">        cancelEvent(heartbeatTimer);</span>
<span class="comment">    }</span>
<span class="comment">    */</span>

    <a class="code" href="classoversim_1_1Nice.html#a6acafcf8008939d12f8db7e002a2ebb5">Query</a>(<a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>, -1);

    <span class="keywordflow">if</span> (layer &gt; -1)
        <a class="code" href="classoversim_1_1Nice.html#a327e50ef2c393ea0b929f3f27154ce96">targetLayer</a> = layer;
    <span class="keywordflow">else</span>
        <a class="code" href="classoversim_1_1Nice.html#a327e50ef2c393ea0b929f3f27154ce96">targetLayer</a> = 0;

    <span class="comment">// Temporary peer with RP for faster data reception</span>
    <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_PEER_TEMPORARY&quot;</span>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7adfc4413e72fcd16c342192d3b4a14bcc">NICE_PEER_TEMPORARY</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(-1);
    msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(msg));

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>, msg);

    <a class="code" href="classoversim_1_1Nice.html#abe5249e886cdb9e6d56efa40e6efe71e">isTempPeered</a> = <span class="keyword">true</span>;

} <span class="comment">// BasicJoinLayer</span>
</pre></div>
</div>
</div>
<a class="anchor" id="ad1d32ea267badf0b9a482d7c415aa03c"></a><!-- doxytag: member="oversim::Nice::changeState" ref="ad1d32ea267badf0b9a482d7c415aa03c" args="(int toState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::changeState </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>toState</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>changes node state </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">toState</td><td>state to change to </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00248">248</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01506">handleNiceQueryResponse()</a>, and <a class="el" href="Nice_8cc_source.html#l00230">joinOverlay()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">switch</span> (toState) {

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>:

        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>;

        getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 1, <span class="stringliteral">&quot;red&quot;</span>);

        scheduleAt(simTime() + 1, <a class="code" href="classoversim_1_1Nice.html#aa31f386f8403d2ba88f43a1a57fcba57">visualizationTimer</a>);

        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>:

        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>;

        <span class="comment">/* get rendevouz point */</span>
        <a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a> = <a class="code" href="classBaseOverlay.html#abe4dea93564123116c97d5c4721f0504" title="pointer to the BootstrapList module">bootstrapList</a>-&gt;<a class="code" href="classBootstrapList.html#ac351433be1d43bbf8cbb871e9f9e1f69" title="Get a bootstrap node from the bootstrap list.">getBootstrapNode</a>();
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {

            <a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a> = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>;
            <a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a> = <span class="keyword">true</span>;

            <span class="comment">/* join cluster layer 0 as first node */</span>
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[0].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[0].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

            <a class="code" href="classoversim_1_1Nice.html#ad1d32ea267badf0b9a482d7c415aa03c" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);

            <span class="keywordflow">return</span>;

        }
        <span class="keywordflow">else</span> {

            <a class="code" href="classoversim_1_1Nice.html#ac1b9865b490cf352d83680020939c270">pollRP</a>(-1);

            <span class="comment">/* initiate NICE structure joining */</span>
            <a class="code" href="classoversim_1_1Nice.html#ad3b7430e484451777e58ea163e4fc049">BasicJoinLayer</a>(-1);

        }

        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>:

        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>;

        cancelEvent(<a class="code" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">heartbeatTimer</a>);
        scheduleAt(simTime() + <a class="code" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">heartbeatInterval</a>, <a class="code" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">heartbeatTimer</a>);
        cancelEvent(<a class="code" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">maintenanceTimer</a>);
        scheduleAt(simTime() + <a class="code" href="classoversim_1_1Nice.html#a6d14d42d813222d9ee8c5d395ba60365">maintenanceInterval</a>, <a class="code" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">maintenanceTimer</a>);

        getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg
        (<span class="stringliteral">&quot;i2&quot;</span>, 1, <a class="code" href="namespaceoversim.html#a068481bf2793ad703ca213dcca1e4a6f" title="Define colors for layers in visualization.">clustercolors</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()]);

        <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>(<span class="keyword">true</span>);
        <span class="comment">/* allow only rendevouz point to be bootstrap node */</span>
        <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) <a class="code" href="classBaseOverlay.html#abe4dea93564123116c97d5c4721f0504" title="pointer to the BootstrapList module">bootstrapList</a>-&gt;<a class="code" href="classBootstrapList.html#a918cbbc5c592fb9069abba47a50af7c0">removeBootstrapNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

        <span class="keywordflow">break</span>;

    }

} <span class="comment">// changeState</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a66d414d9448c241ede5d2702cbec6578"></a><!-- doxytag: member="oversim::Nice::checkLeaderHeartbeatsForCollisions" ref="a66d414d9448c241ede5d2702cbec6578" args="(NiceLeaderHeartbeat *hbMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool oversim::Nice::checkLeaderHeartbeatsForCollisions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceLeaderHeartbeat.html">NiceLeaderHeartbeat</a> *&#160;</td>
          <td class="paramname"><em>hbMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks if we have received conflicting leader heartbeats. </p>
<p>checkLeaderHeartbeatsForCollisions</p>
<p>Returns true if a collision was detected. </p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02263">2263</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordtype">bool</span> collisionDetected = <span class="keyword">false</span>;

    <span class="comment">//Alternative Detection</span>
    <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.push_back(std::make_pair(hbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), simTime()));

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size() &gt; 3) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
            EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot;leaderHeartbeats.size() &gt; 3 :  &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size() &lt;&lt; endl;

        simtime_t predecessor =  <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-2).second;

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
            EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot;predecessor :  &quot;</span> &lt;&lt; predecessor &lt;&lt; endl;


        <span class="keywordflow">if</span> (simTime() &lt; (predecessor + <a class="code" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">heartbeatInterval</a>)) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
                EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot;simTime() &lt; (predecessor + heartbeatInterval)&quot;</span> &lt;&lt; endl;

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-2).first != hbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>()) {

                <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>) {
                    EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot;(leaderHeartbeats.at(leaderHeartbeats.size()-2).first != hbMsg-&gt;getSrcNode())&quot;</span> &lt;&lt; endl;
                    EV &lt;&lt; <span class="stringliteral">&quot;leaderHeartbeats.at(leaderHeartbeats.size()-2).first: &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-2).first &lt;&lt; endl;
                }

                <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-3).first == hbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>()) {

                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>) {
                        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot;(leaderHeartbeats.at(leaderHeartbeats.size()-3).first == hbMsg-&gt;getSrcNode())&quot;</span> &lt;&lt; endl;
                        EV &lt;&lt; <span class="stringliteral">&quot;leaderHeartbeats.at(leaderHeartbeats.size()-3).first: &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-3).first &lt;&lt; endl;
                        EV &lt;&lt; <span class="stringliteral">&quot;timestamp: &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-3).second &lt;&lt; endl;
                    }

                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-4).first == <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-2).first) {

                        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>) {
                            EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot;(leaderHeartbeats.at(leaderHeartbeats.size()-4).first == leaderHeartbeats.at(leaderHeartbeats.size()-2).first&quot;</span> &lt;&lt; endl;
                            EV &lt;&lt; <span class="stringliteral">&quot;leaderHeartbeats.at(leaderHeartbeats.size()-4).first: &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-4).first &lt;&lt; endl;
                            EV &lt;&lt; <span class="stringliteral">&quot;timestamp: &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-4).second &lt;&lt; endl;

                        }

                        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
                            EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : CONFLICTING LEADERS!&quot;</span> &lt;&lt; endl;

                        <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* removeMsg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_REMOVE&quot;</span>);
                        removeMsg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
                        removeMsg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7adfb0b796750890c1d47678b130dff498">NICE_REMOVE</a>);
                        removeMsg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(hbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>());

                        removeMsg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(removeMsg));

                        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.at(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-2).first, removeMsg);

                        collisionDetected = <span class="keyword">true</span>;

                    }

                }

            }
        }

    }


    <span class="comment">/* Tidy up leaderheartbeats */</span>
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size() &gt; 4) {

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.size()-4); i++) {

            <a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.erase(<a class="code" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">leaderHeartbeats</a>.begin());

        }

    }

    <span class="keywordflow">return</span> collisionDetected;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae1bc183e5411855a2026e884d2d2cee1"></a><!-- doxytag: member="oversim::Nice::cleanPeers" ref="ae1bc183e5411855a2026e884d2d2cee1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::cleanPeers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cleans the tempPeers map from peers that have timed out, removes timed-out peers in peerInfos and also removes them from the clusters. </p>
<p>cleanPeers </p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02150">2150</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Clean tempPeers</span>
    std::vector&lt;TransportAddress&gt; deadTempPeers;

    std::map&lt;TransportAddress, simtime_t&gt;::iterator itTempPeer;
    <span class="keywordflow">for</span> (itTempPeer = <a class="code" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">tempPeers</a>.begin(); itTempPeer != <a class="code" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">tempPeers</a>.end(); ++itTempPeer) {
        <span class="keywordflow">if</span> (simTime() &gt; (itTempPeer-&gt;second + 3 * <a class="code" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">heartbeatInterval</a>)) {
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#a97964c134da4da5b58b3c7dff32a0800">numTempPeerTimeouts</a>);
            deadTempPeers.push_back(itTempPeer-&gt;first);
        }
    }

    std::vector&lt;TransportAddress&gt;::iterator itDead;
    <span class="keywordflow">for</span> (itDead = deadTempPeers.begin(); itDead != deadTempPeers.end(); ++itDead) {
        <a class="code" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">tempPeers</a>.erase(*itDead);
        <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itDead);
    }

    <span class="comment">/* Delete nodes that haven&#39;t been active for too long autonomously */</span>
    std::vector&lt;TransportAddress&gt; deadPeers;

    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator itPeer = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.begin();
    <span class="keywordflow">while</span> (itPeer != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

        <span class="keywordtype">double</span> offset = <a class="code" href="classoversim_1_1Nice.html#abffc50a7507069a0d97997f269c2d130">peerTimeoutHeartbeats</a> * <a class="code" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">heartbeatInterval</a>.dbl();
        <span class="keywordflow">if</span> (itPeer-&gt;first != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> &amp;&amp; simTime() &gt; (itPeer-&gt;second-&gt;getActivity() + offset)) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a6af70b0196fd0d482286c0ff5a46f5ae">debug_peertimeouts</a>) {
                EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : PEER TIMED OUT! : &quot;</span> &lt;&lt; itPeer-&gt;first &lt;&lt; endl;
                EV &lt;&lt; <span class="stringliteral">&quot;Activity : &quot;</span> &lt;&lt; itPeer-&gt;second-&gt;getActivity() &lt;&lt; endl;
            }

            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#a82e217903a688c47656a56dc4a593ebc">numPeerTimeouts</a>);

            deadPeers.push_back(itPeer-&gt;first);

        }

        ++itPeer;

    }

    <span class="keywordflow">for</span> (itDead = deadPeers.begin(); itDead != deadPeers.end(); ++itDead) {
        <span class="keyword">delete</span> <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>[*itDead];
        <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.erase(*itDead);

        <span class="comment">// Delete nodes from all layer clusters</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>; i++) {
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a9d03dd60f2ac8c6e64e159b8fd39982c" title="Removes address from cluster.">remove</a>(*itDead);
            <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itDead);
        }
    }
} <span class="comment">// cleanPeers</span>
</pre></div>
</div>
</div>
<a class="anchor" id="ad4f8cc3855e672b84d2a097bd60c0925"></a><!-- doxytag: member="oversim::Nice::ClusterMerge" ref="ad4f8cc3855e672b84d2a097bd60c0925" args="(int layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::ClusterMerge </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02868">2868</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02229">mergeNeeded()</a>.</p>
<div class="fragment"><pre class="fragment">{

    ASSERT(layer &lt; <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> - 1);
    ASSERT(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    simtime_t min_delay = 999;

    <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> min_node = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); i++) {

        <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> node = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(i);

        <span class="keywordflow">if</span> (node != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

            std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(node);

            <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {
                simtime_t delay = it-&gt;second-&gt;get_distance();

                <span class="keywordflow">if</span> ((delay &gt; 0) &amp;&amp; (delay &lt; min_delay)) {

                    min_delay = delay;
                    min_node = node;

                }
            }
        }

    }

    <span class="keywordflow">if</span> (!min_node.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {

        <span class="comment">// send merge request</span>
        <a class="code" href="classoversim_1_1Nice.html#a46eb256216745f2ae5db49585d8c7025">ClusterMergeRequest</a>(min_node, layer);

        <span class="comment">// leave above layer, we are no longer the leader of this cluster.</span>
        <a class="code" href="classoversim_1_1Nice.html#af48af4ac315203b552f1eecd1678689c">gracefulLeave</a>(layer + 1);

        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(min_node);
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(min_node);
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a33ebaaa6d22be0dbce87337ec52742b8" title="Confirm that we&#39;re sure that our leader information is correct.">confirmLeader</a>();

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

            <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<span class="keyword">get</span>(j));

        }

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, highest = <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>(); i &lt; highest; i++) {

            getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 1, <a class="code" href="namespaceoversim.html#a068481bf2793ad703ca213dcca1e4a6f" title="Define colors for layers in visualization.">clustercolors</a>[i]);

        }

    }
    <span class="keywordflow">else</span> {

        EV &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; no suitable cluster found&quot;</span>;

    }

} <span class="comment">// ClusterMerge</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a46eb256216745f2ae5db49585d8c7025"></a><!-- doxytag: member="oversim::Nice::ClusterMergeRequest" ref="a46eb256216745f2ae5db49585d8c7025" args="(const TransportAddress &amp;node, int layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::ClusterMergeRequest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02936">2936</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02868">ClusterMerge()</a>, and <a class="el" href="Nice_8cc_source.html#l00862">handleNiceForceMerge()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].contains(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>));
    ASSERT(!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].getLeader().isUnspecified());

    <a class="code" href="classNiceClusterMerge.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceClusterMerge</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceClusterMerge.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceClusterMerge</a>(<span class="stringliteral">&quot;NICE_CLUSTER_MERGE_REQUEST&quot;</span>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a84de84b9a5707c06e307870df2031ce3">NICE_CLUSTER_MERGE_REQUEST</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);

    msg-&gt;<a class="code" href="classNiceMemberMessage.html#aa7ae9d6e4a78b2c5493da57bd40748e9">setMembersArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getSize());

    <span class="comment">/* Fill in members */</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

        msg-&gt;<a class="code" href="classNiceMemberMessage.html#a5aec4bd795065c56c7f95f5075d061b4">setMembers</a>(j, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<span class="keyword">get</span>(j));

        <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<span class="keyword">get</span>(j));

    }

    msg-&gt;<a class="code" href="classNiceClusterMerge.html#adedc4a976f99fcd1a08b54172f6e4441">setNewClusterLeader</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].getLeader());

    msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#ab02fc9fb37858684e486f5750860e4ba">NICECLUSTERMERGE_L</a>(msg));

    getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 0, <span class="stringliteral">&quot;block/circle_vs&quot;</span>);

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(node, msg);

} <span class="comment">// ClusterMergeRequest</span>
</pre></div>
</div>
</div>
<a class="anchor" id="aa0181f581e1a294a1a115ce68363a517"></a><!-- doxytag: member="oversim::Nice::ClusterSplit" ref="aa0181f581e1a294a1a115ce68363a517" args="(int layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::ClusterSplit </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02621">2621</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02208">splitNeeded()</a>.</p>
<div class="fragment"><pre class="fragment">{

    EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : ClusterSplit in Layer &quot;</span> &lt;&lt; layer &lt;&lt; endl;

    <span class="comment">/* Get cluster to be splitted */</span>
    <a class="code" href="classNiceCluster.html">NiceCluster</a> cluster = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer];

    <span class="comment">/* Introduce some helper structures */</span>
    std::vector&lt;TransportAddress&gt; vec1;
    std::vector&lt;TransportAddress&gt; vec2;
    std::vector&lt;TransportAddress&gt; cl1;
    std::vector&lt;TransportAddress&gt; cl2;
    <a class="code" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a> cl1set, cl2set;
    <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> cl1_center = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;
    <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> cl2_center = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;
    simtime_t min_delay = 999;

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;cluster.<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); i++) {

        <span class="comment">/* Delete all arrows in visualization */</span>
        <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(cluster.<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(i));

        <span class="comment">/* Put all members to first vector */</span>
        vec1.push_back(cluster.<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(i));
        <span class="comment">//EV &lt;&lt; &quot;vec1.push_back(cluster.get(i)): &quot; &lt;&lt; cluster.get(i).getIp() &lt;&lt; endl;</span>

        <span class="comment">/* Put first half of members to second vector */</span>
        <span class="keywordflow">if</span> (i &lt; cluster.<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>()/2) {
            vec2.push_back(cluster.<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(i));
            <span class="comment">//EV &lt;&lt; &quot;vec2.push_back(cluster.get(i)): &quot; &lt;&lt; cluster.get(i).getIp() &lt;&lt; endl;</span>
        }

    }

    <span class="keywordtype">int</span> combinations = 0;

    TaSet::iterator sit;

    <span class="keywordflow">if</span> (cluster.<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>() &lt; 18) {

        <span class="comment">/* Go through all combinations of clusters */</span>
        <span class="keywordflow">do</span> {

            combinations++;

            <span class="comment">//EV &lt;&lt; &quot;combinations: &quot; &lt;&lt; combinations &lt;&lt; endl;</span>

            <span class="comment">/* Introduce some helper structures */</span>
            <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> q1_center;
            <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> q2_center;
            std::vector&lt;TransportAddress&gt; vec3;

            <span class="comment">/* Determine elements that are in first set but not in second */</span>
            std::set_difference(vec1.begin(), vec1.end(), vec2.begin(), vec2.end(), inserter(vec3, vec3.begin()));

            simtime_t min_q1_delay = 999;
            simtime_t min_q2_delay = 999;
            simtime_t max_delay = 0;

            q1_center = <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(vec2).first;

            <span class="comment">//EV &lt;&lt; &quot;q1_center: &quot; &lt;&lt; q1_center.getIp() &lt;&lt; endl;</span>

            std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(q1_center);

            <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                min_q1_delay = it-&gt;second-&gt;get_distance();

            }
            <span class="keywordflow">else</span> {

                min_q1_delay = 0;

            }

            q2_center = <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(vec3).first;

            <span class="comment">//EV &lt;&lt; &quot;q2_center: &quot; &lt;&lt; q2_center.getIp() &lt;&lt; endl;</span>

            it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(q2_center);

            <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                min_q2_delay = it-&gt;second-&gt;get_distance();

            }
            <span class="keywordflow">else</span> {

                min_q2_delay = 0;

            }

            max_delay = std::max(min_q1_delay, min_q2_delay);

            <span class="keywordflow">if</span> (min_delay == 0) min_delay = max_delay;

            <span class="keywordflow">if</span> ((max_delay &lt; min_delay) &amp;&amp; !q1_center.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp; !q2_center.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {

                min_delay = max_delay;
                cl1 = vec2;
                cl2 = vec3;
                cl1_center = q1_center;
                cl2_center = q2_center;
            }

        } <span class="keywordflow">while</span> (<a class="code" href="namespaceoversim.html#a9fccec5847240be8424dcc8703a6d49b">next_combination</a>(vec1.begin(), vec1.end(), vec2.begin(), vec2.end()));

        <span class="comment">//build sets</span>
        cl1set.insert(cl1.begin(), cl1.end());
        cl2set.insert(cl2.begin(), cl2.end());

    }
    <span class="keywordflow">else</span> {
        EV &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; RANDOM SPLIT&quot;</span> &lt;&lt; endl;
        cl1set.clear();
        cl2set.clear();
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;cluster.<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); i++) {
            <span class="keywordflow">if</span> (i &lt; cluster.<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>()/2) {
                cl1set.insert(cluster.<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(i));
            }
            <span class="keywordflow">else</span> {
                cl2set.insert(cluster.<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(i));
            }
        }
        cl1_center = <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(cl1set,<span class="keyword">true</span>).first;
        cl2_center = <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(cl2set,<span class="keyword">true</span>).first;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {
        <span class="comment">// Make certain that we remain leader</span>
        <span class="keywordflow">if</span> (cl1set.count(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) &gt; 0) {
            cl1_center = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>;
        }
        <span class="keywordflow">else</span> {
            cl2_center = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>;
        }
    }

    <span class="comment">// Cluster split accomplished, now handling consequences</span>

    <span class="comment">// CASE 1: We lost all cluster leaderships</span>
    <span class="comment">// repair all cluster layer, top down</span>
    <span class="keywordflow">if</span> ((cl1_center != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) &amp;&amp; (cl2_center != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {

        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(cl1_center);
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(cl2_center);
        <a class="code" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a> superCluster = <a class="code" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].begin(), <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].end());
        <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> scLeader;

        <span class="keywordflow">if</span> (layer &lt; <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()) {
            <a class="code" href="classoversim_1_1Nice.html#af48af4ac315203b552f1eecd1678689c">gracefulLeave</a>(layer+1);
            scLeader = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>();
        }
        <span class="keywordflow">else</span> {
            scLeader = cl1_center;
            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {
                opp_error(<span class="stringliteral">&quot;Something went wrong in Nice::ClusterSplit and the RendevouzPoint is trying to give up leadership. This is a bug in OverSim&#39;s implementation of Nice. Please fix it, or file a bug.&quot;</span>);
            }
        }

        <span class="comment">// Leaving the upper layer before sending LTs leads to wrong information in the packets.</span>
        <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(layer, cl1_center, cl1set, scLeader, superCluster);
        <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(layer, cl2_center, cl2set, scLeader, superCluster);

        <span class="keywordflow">if</span> (layer &lt; <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> - 1) {
            <span class="keywordflow">for</span> (TaSet::iterator itn = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].begin(); itn != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itn) {
                <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itn);
            }
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].<a class="code" href="classNiceCluster.html#ad66e5cfc867561bef65fcfd43dbc7d13" title="Removes all addresses from cluster, sets leader to unspecified address and sets last lt to 0...">clear</a>();
        }

        getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 0, <span class="stringliteral">&quot;block/circle_vs&quot;</span>);

    }

    <span class="comment">// CASE 2: We stay leader in one of the new clusters</span>
    <span class="keywordflow">if</span> ((cl1_center == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) || (cl2_center == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].getSize() == 0) {

            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(cl1_center);
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(cl2_center);

            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].<a class="code" href="classNiceCluster.html#a33ebaaa6d22be0dbce87337ec52742b8" title="Confirm that we&#39;re sure that our leader information is correct.">confirmLeader</a>();

        }

        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(cl2_center);
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(cl1_center);
        <a class="code" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a> superCluster = <a class="code" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].begin(), <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].end());
        <span class="keywordflow">if</span> (cl1_center == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

            <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(layer, cl2_center, cl2set, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].getLeader(), superCluster);

        }
        <span class="keywordflow">else</span> {

            <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(layer, cl1_center, cl1set, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].getLeader(), superCluster);

        }


    }

    <span class="comment">// Set local cluster info</span>
    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#ad66e5cfc867561bef65fcfd43dbc7d13" title="Removes all addresses from cluster, sets leader to unspecified address and sets last lt to 0...">clear</a>();

    <span class="comment">// Depends on in which of the two clusters this node is</span>
    <span class="keywordflow">if</span> (cl1set.count(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {

        TaSet::iterator cit = cl1set.begin();
        <span class="keywordflow">while</span> (cit != cl1set.end()) {
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(*cit);
            cit++;
        }

        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(cl1_center);

    }
    <span class="keywordflow">else</span> {

        TaSet::iterator cit = cl2set.begin();
        <span class="keywordflow">while</span> (cit != cl2set.end()) {
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(*cit);
            cit++;
        }

        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(cl2_center);

    }
    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a33ebaaa6d22be0dbce87337ec52742b8" title="Confirm that we&#39;re sure that our leader information is correct.">confirmLeader</a>();

    <span class="comment">//update arrows</span>
    <a class="code" href="classoversim_1_1Nice.html#a71a14940853660afb14b6c8f6b5d448c">updateVisualization</a>();

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a>)
        <a class="code" href="classoversim_1_1Nice.html#a1ffd3a3b39866e51502fee0bf37480f7">sendHeartbeats</a>();

} <span class="comment">// ClusterSplit</span>
</pre></div>
</div>
</div>
<a class="anchor" id="ab103d070590546c820b57f2a087955ed"></a><!-- doxytag: member="oversim::Nice::findCenter" ref="ab103d070590546c820b57f2a087955ed" args="(TaSet cluster, bool allowRandom=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, simtime_t &gt; oversim::Nice::findCenter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a>&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>allowRandom</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02971">2971</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l02980">findCenter()</a>, <a class="el" href="Nice_8cc_source.html#l03234">gracefulLeave()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(cluster.begin(), cluster.end(), allowRandom);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac67e86de4b5b08c2388242783b0348fc"></a><!-- doxytag: member="oversim::Nice::findCenter" ref="ac67e86de4b5b08c2388242783b0348fc" args="(std::vector&lt; TransportAddress &gt; cluster, bool allowRandom=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, simtime_t &gt; oversim::Nice::findCenter </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt;&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>allowRandom</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02980">2980</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(cluster.begin(), cluster.end(), allowRandom);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a357ff0d2b5996b7ce8a2cb3f4637b8b6"></a><!-- doxytag: member="oversim::Nice::findCenter" ref="a357ff0d2b5996b7ce8a2cb3f4637b8b6" args="(const NiceCluster &amp;cluster, bool allowRandom=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, simtime_t &gt; oversim::Nice::findCenter </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNiceCluster.html">NiceCluster</a> &amp;&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>allowRandom</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02989">2989</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(cluster.<a class="code" href="classNiceCluster.html#a3208511b96045dbd22ec18c9bd457737" title="Returns const iterator to first address.">begin</a>(), cluster.<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(), allowRandom);
}
</pre></div>
</div>
</div>
<a class="anchor" id="acedb962da716062f124e85bcbced2cbd"></a><!-- doxytag: member="oversim::Nice::findCenter" ref="acedb962da716062f124e85bcbced2cbd" args="(ConstIter begin, ConstIter end, bool allowRandom=false)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class ConstIter &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a>, simtime_t &gt; oversim::Nice::findCenter </td>
          <td>(</td>
          <td class="paramtype">ConstIter&#160;</td>
          <td class="paramname"><em>begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ConstIter&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>allowRandom</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02998">2998</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{

    <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> center = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;
    simtime_t min_delay = 1000;

    <span class="keywordflow">for</span> (ConstIter it = begin; it != end; ++it) {

        simtime_t delay = <a class="code" href="classoversim_1_1Nice.html#ad87e45d16986960bf34ce49f236e1d52">getMaxDistance</a>(*it, begin, end);

        <span class="keywordflow">if</span> ((delay &gt; 0) &amp;&amp; (delay &lt; min_delay)) {

            min_delay = delay;
            center = *it;

        }

    }

    <span class="keywordflow">if</span> (center.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        center = *begin;
    }

    <span class="comment">//EV &lt;&lt; &quot;center: &quot; &lt;&lt; center &lt;&lt; endl;</span>
    <span class="keywordflow">return</span> std::make_pair(center, min_delay);

} <span class="comment">// findCenter</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a93acdc685e2e7ad1ada75063db007463"></a><!-- doxytag: member="oversim::Nice::finishOverlay" ref="a93acdc685e2e7ad1ada75063db007463" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::finishOverlay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collects statistical data in derived class </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a8db85b9c706d04007154761d5a0cec16">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00521">521</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {
        <a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a> = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;
    }

    simtime_t time = <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a610799ebfbf64696c59b811870cc8300">calcMeasuredLifetime</a>(<a class="code" href="classBaseOverlay.html#af0eebaddea732ee4ab4d247c388e62bd" title="simtime when the node has been created">creationTime</a>);
    <span class="keywordflow">if</span> (time &lt; <a class="code" href="classGlobalStatistics.html#a169810c78519b271f7e32fdc7c9fc641" title="minimum useful measured lifetime in seconds">GlobalStatistics::MIN_MEASURED</a>) <span class="keywordflow">return</span>;

    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Inconsistencies/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#a50dd1e20f4c56dc45f9ffa1c52d2716f">numInconsistencies</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Query Timeouts/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#ac151ea0f3d5ac1d60b32d92c08d89e44">numQueryTimeouts</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Peer Timeouts/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#a82e217903a688c47656a56dc4a593ebc">numPeerTimeouts</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Temporary Peer Timeouts/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#a97964c134da4da5b58b3c7dff32a0800">numTempPeerTimeouts</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Structure Partitions/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#acd1effc337560f6677e63608b3e53af8">numStructurePartitions</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Own Messages Received/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#ab0a8837fcffd376b822166d048a401fa">numOwnMessagesReceived</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: SC Minimum Compare/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#a063a91a0c9cbd3bcfeca7ce10944eb70">totalSCMinCompare</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Received JOIN Messages/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#a765b5d96a57bf709b6a8ce28541d55a6">numJoins</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Forwarded Multicast Messages/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#aa0d6fe84d8444d39caee3e2c67323550">numForward</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Forwarded Multicast Bytes/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#ade427df4fbd3edb53e04467984384927">totalForwardBytes</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Received Multicast Messages/s (subscribed groups only)&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#ab0165945cd4929e57f66e595ce76cc14">numReceived</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Received Multicast Bytes/s (subscribed groups only)&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#ab70712e9a475d6ab12690cf36a31ffe1">totalReceivedBytes</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Send Heartbeat Messages/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#aed41149eb142ad3c71d6a639b113a5f7">numHeartbeat</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Nice: Send Heartbeat Bytes/s&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#ad186e77457bdad45888594517319a02b">totalHeartbeatBytes</a> / time);
    <span class="keywordflow">if</span>( <a class="code" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">debug_join</a> ) recordScalar(<span class="stringliteral">&quot;Nice: Total joins&quot;</span>, (<span class="keywordtype">double</span>)<a class="code" href="classoversim_1_1Nice.html#a765b5d96a57bf709b6a8ce28541d55a6">numJoins</a>);

} <span class="comment">// finishOverlay</span>
</pre></div>
</div>
</div>
<a class="anchor" id="ac29c7ecdf6590c8f7fd4ea9b546f72f8"></a><!-- doxytag: member="oversim::Nice::getHighestLayer" ref="ac29c7ecdf6590c8f7fd4ea9b546f72f8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int oversim::Nice::getHighestLayer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01642">1642</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l02868">ClusterMerge()</a>, <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l01628">getHighestLeaderLayer()</a>, <a class="el" href="Nice_8cc_source.html#l03234">gracefulLeave()</a>, <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l01457">handleNicePingProbeResponse()</a>, <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>, <a class="el" href="Nice_8cc_source.html#l03190">Remove()</a>, <a class="el" href="Nice_8cc_source.html#l03365">sendDataToOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01757">sendHeartbeats()</a>, and <a class="el" href="Nice_8cc_source.html#l03420">updateVisualization()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[0].getSize() == 0) {
        <span class="comment">// Not yet joined to overlay</span>
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordtype">int</span> highest = 0;

    <span class="keywordflow">while</span> (highest &lt; <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> &amp;&amp;
           !<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highest].getLeader().isUnspecified() &amp;&amp;
           <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highest].getLeader() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
        ++highest;
    }

    <span class="keywordflow">if</span> (highest == <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>) {
        <span class="comment">// we are top leader</span>
        <span class="keywordflow">return</span> <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> - 1;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highest].contains(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {
        <span class="comment">// we are top leader. highest is one plus our layer.</span>
        <span class="keywordflow">return</span> highest - 1;
    }
    <span class="keywordflow">else</span> {
        <span class="keywordflow">return</span> highest;
    }
} <span class="comment">// getHighestLayer</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a51eac39bb02905af0ea3a792bc23248a"></a><!-- doxytag: member="oversim::Nice::getHighestLeaderLayer" ref="a51eac39bb02905af0ea3a792bc23248a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int oversim::Nice::getHighestLeaderLayer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01628">1628</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l03234">gracefulLeave()</a>, <a class="el" href="Nice_8cc_source.html#l00755">handleNiceClusterMergeRequest()</a>, <a class="el" href="Nice_8cc_source.html#l01478">handleNicePollRp()</a>, <a class="el" href="Nice_8cc_source.html#l00623">handleNiceQuery()</a>, <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>, <a class="el" href="Nice_8cc_source.html#l02229">mergeNeeded()</a>, and <a class="el" href="Nice_8cc_source.html#l02208">splitNeeded()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">int</span> layer = <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>();
    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader().isUnspecified() &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
        <span class="keywordflow">return</span> layer;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (layer == -1) {
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">else</span> {
        <span class="keywordflow">return</span> layer - 1;
    }
} <span class="comment">// getHighestLeaderLayer</span>
</pre></div>
</div>
</div>
<a class="anchor" id="ad87e45d16986960bf34ce49f236e1d52"></a><!-- doxytag: member="oversim::Nice::getMaxDistance" ref="ad87e45d16986960bf34ce49f236e1d52" args="(TransportAddress member, const std::set&lt; TransportAddress &gt; &amp;neighbors)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t oversim::Nice::getMaxDistance </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td>
          <td class="paramname"><em>member</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::set&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>neighbors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03075">3075</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02998">findCenter()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classoversim_1_1Nice.html#ad87e45d16986960bf34ce49f236e1d52">getMaxDistance</a>(member, neighbors.begin(), neighbors.end());
} <span class="comment">// getMaxDistance</span>
</pre></div>
</div>
</div>
<a class="anchor" id="add21d13bfce3f97aa115be55dfe781c2"></a><!-- doxytag: member="oversim::Nice::getMaxDistance" ref="add21d13bfce3f97aa115be55dfe781c2" args="(TransportAddress member, ConstIter neighborsBegin, ConstIter neighborsEnd)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class ConstIter &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">simtime_t oversim::Nice::getMaxDistance </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td>
          <td class="paramname"><em>member</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ConstIter&#160;</td>
          <td class="paramname"><em>neighborsBegin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ConstIter&#160;</td>
          <td class="paramname"><em>neighborsEnd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03031">3031</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    simtime_t maxDelay = 0;
    simtime_t delay = 0;

    <span class="keywordflow">if</span> (member == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

        <span class="keywordflow">for</span> (ConstIter it = neighborsBegin; it != neighborsEnd; ++it) {

            std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator itInfo = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(*it);

            <span class="keywordflow">if</span> (itInfo != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                delay = itInfo-&gt;second-&gt;get_distance();
                maxDelay = std::max(delay, maxDelay);

            }

        }

    }
    <span class="keywordflow">else</span> {

        std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator itInfo = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(member);

        <span class="keywordflow">if</span> (itInfo != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

            <span class="keywordflow">for</span> (ConstIter it = neighborsBegin; it != neighborsEnd; ++it) {

                <span class="comment">//EV &lt;&lt; &quot;getDistanceTo &quot; &lt;&lt; *it2 &lt;&lt; endl;</span>
                delay = itInfo-&gt;second-&gt;getDistanceTo(*it);
                <span class="comment">//EV &lt;&lt; thisNode.getIp() &lt;&lt; &quot; : Distance to &quot; &lt;&lt; it2-&gt;getIp() &lt;&lt; &quot; : &quot; &lt;&lt; delay &lt;&lt; endl;</span>
                maxDelay = std::max(delay, maxDelay);

            }

        }

    }

    <span class="keywordflow">return</span> maxDelay;

} <span class="comment">// getMaxDistance</span>
</pre></div>
</div>
</div>
<a class="anchor" id="af6e0621edd3122f917e428d133a0a732"></a><!-- doxytag: member="oversim::Nice::getMeanDistance" ref="af6e0621edd3122f917e428d133a0a732" args="(std::set&lt; TransportAddress &gt; neighbors)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t oversim::Nice::getMeanDistance </td>
          <td>(</td>
          <td class="paramtype">std::set&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt;&#160;</td>
          <td class="paramname"><em>neighbors</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03083">3083</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{
    simtime_t meanDelay = 0;
    simtime_t delay = 0;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> number = 0;

    std::set&lt;TransportAddress&gt;::iterator it = neighbors.begin();

    <span class="keywordflow">while</span> (it != neighbors.end()) {

        <span class="keywordflow">if</span> (*it != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

            std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it2 = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(*it);

            <span class="keywordflow">if</span> (it2 != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                delay = it2-&gt;second-&gt;get_distance();
                <span class="comment">//EV &lt;&lt; &quot;delay to &quot; &lt;&lt; *it &lt;&lt; &quot; : &quot; &lt;&lt; delay &lt;&lt; endl;</span>

                <span class="keywordflow">if</span>  (delay &gt; 0.0) {

                    meanDelay += delay;
                    number++;

                }

            }

        }

        it++;

    }

    <span class="keywordflow">if</span> (number &gt; 0) {

        <span class="keywordflow">return</span> meanDelay/number;

    }
    <span class="keywordflow">else</span> {

        <span class="keywordflow">return</span> 0;

    }

} <span class="comment">// getMeanDistance</span>
</pre></div>
</div>
</div>
<a class="anchor" id="af48af4ac315203b552f1eecd1678689c"></a><!-- doxytag: member="oversim::Nice::gracefulLeave" ref="af48af4ac315203b552f1eecd1678689c" args="(short bottomLayer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::gracefulLeave </td>
          <td>(</td>
          <td class="paramtype">short&#160;</td>
          <td class="paramname"><em>bottomLayer</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03234">3234</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02868">ClusterMerge()</a>, <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : gracefulLeave()&quot;</span> &lt;&lt; endl;

    <span class="keywordtype">int</span> layer = <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>();

    ASSERT(layer &gt;= bottomLayer);

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {
        opp_error(<span class="stringliteral">&quot;The RendevouzPoint is trying to leave a layer and the simulation cannot continue. This is a bug in the Nice implementation in OverSim, please check the backtrace and fix it or submit a bug report.&quot;</span>);
    }

    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader().isUnspecified() &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
        <span class="comment">// simply leave cluster</span>
        EV &lt;&lt; <span class="stringliteral">&quot;removing &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; layer &lt;&lt; endl;
        <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader().isUnspecified()) {
            <a class="code" href="classoversim_1_1Nice.html#a546c8b69ae759d24e9b809deb1d75398">Remove</a>(layer);
        }
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a9d03dd60f2ac8c6e64e159b8fd39982c" title="Removes address from cluster.">remove</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    }

    <span class="keywordflow">for</span> (layer = <a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>(); layer &gt;= bottomLayer; layer--) {

        EV &lt;&lt; <span class="stringliteral">&quot;REPAIR: &quot;</span> &lt;&lt; layer &lt;&lt; endl;

        <span class="keywordflow">for</span> (TaSet::const_iterator itNode = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].begin(); itNode != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itNode) {

            EV &lt;&lt; <span class="stringliteral">&quot;rest: &quot;</span> &lt;&lt; itNode-&gt;getIp() &lt;&lt; endl;

            <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itNode);

        }

        EV &lt;&lt; <span class="stringliteral">&quot;remove from: &quot;</span> &lt;&lt; layer &lt;&lt; endl;
        <a class="code" href="classoversim_1_1Nice.html#a546c8b69ae759d24e9b809deb1d75398">Remove</a>(layer);

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getSize() &gt; 0) {
            <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> new_sc_center = <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer]).first;

            EV &lt;&lt; <span class="stringliteral">&quot;NEW LEADER (GL): &quot;</span> &lt;&lt; layer &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; new_sc_center.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; endl;

            <span class="keywordflow">if</span> (new_sc_center.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {

                new_sc_center = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(0);

                EV &lt;&lt; <span class="stringliteral">&quot;UNSPECIFIED! instead choose: &quot;</span> &lt;&lt; new_sc_center.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; endl;

            }

            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(new_sc_center);

            <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(layer, new_sc_center);

        }

    }

    EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : gracefulLeave() finished.&quot;</span> &lt;&lt; endl;


} <span class="comment">// gracefulLeave</span>
</pre></div>
</div>
</div>
<a class="anchor" id="af750b796fbab34f8fc9c48cca7a26ddb"></a><!-- doxytag: member="oversim::Nice::handleAppMessage" ref="af750b796fbab34f8fc9c48cca7a26ddb" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleAppMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes "timer" self-messages. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>A self-message Processes non-commonAPI messages</td></tr>
    <tr><td class="paramname">msg</td><td>non-commonAPIMessage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#aef92d042c22b47c123e59a831acb7033">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03300">3300</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ( <a class="code" href="classALMAnycastMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMAnycastMessage</a>* anycastMsg = dynamic_cast&lt;ALMAnycastMessage*&gt;(msg) ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Nice::handleAppMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Anycast message for group &quot;</span> &lt;&lt; anycastMsg-&gt;getGroupId() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    ignored: Not implemented yet!&quot;</span>
           &lt;&lt; endl;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classALMCreateMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMCreateMessage</a>* createMsg = dynamic_cast&lt;ALMCreateMessage*&gt;(msg) ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Nice::handleAppMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Create message for group &quot;</span> &lt;&lt; createMsg-&gt;getGroupId() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    ignored: Not implemented yet!&quot;</span>
           &lt;&lt; endl;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classALMDeleteMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMDeleteMessage</a>* deleteMsg = dynamic_cast&lt;ALMDeleteMessage*&gt;(msg) ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Nice::handleAppMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Delete message for group &quot;</span> &lt;&lt; deleteMsg-&gt;getGroupId() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    ignored: Not implemented yet!&quot;</span>
           &lt;&lt; endl;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classALMLeaveMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMLeaveMessage</a>* leaveMsg = dynamic_cast&lt;ALMLeaveMessage*&gt;(msg) ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Nice::handleAppMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Leave message for group &quot;</span> &lt;&lt; leaveMsg-&gt;getGroupId() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    ignored: Not implemented yet!&quot;</span>
           &lt;&lt; endl;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classALMMulticastMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMMulticastMessage</a>* multicastMsg = dynamic_cast&lt;ALMMulticastMessage*&gt;(msg) ) {
        <a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a> *niceMsg = <span class="keyword">new</span> <a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a>(<span class="stringliteral">&quot;NICE_MULTICAST&quot;</span>);
        niceMsg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a55f971433074db5a460d31159d73288c">NICE_MULTICAST</a>);
        niceMsg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(-1);
        niceMsg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        niceMsg-&gt;<a class="code" href="classNiceMulticastMessage.html#af18a67f43fa20742d1e1b5e3667ae704">setLastHop</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        niceMsg-&gt;<a class="code" href="classNiceMulticastMessage.html#a4444398854777b6d5ab5f24674c42054">setHopCount</a>(0);

        niceMsg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a856829decd30527694f7c44f24d11eb9">NICEMULTICAST_L</a>(niceMsg));

        niceMsg-&gt;encapsulate(multicastMsg);
        <a class="code" href="classoversim_1_1Nice.html#a92c3a3c37c9c3101ac2e51ab609c4c64">sendDataToOverlay</a>(niceMsg);

        <span class="comment">// otherwise msg gets deleted later</span>
        msg = NULL;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classALMSubscribeMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMSubscribeMessage</a>* subscribeMsg = dynamic_cast&lt;ALMSubscribeMessage*&gt;(msg) ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Nice::handleAppMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Subscribe message for group &quot;</span> &lt;&lt; subscribeMsg-&gt;getGroupId() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    ignored: Not implemented yet!&quot;</span>
           &lt;&lt; endl;
    }

    <span class="comment">// Delete msg if not already deleted</span>
    <span class="keywordflow">if</span> ( msg ) {
        <span class="keyword">delete</span> msg;
    }

} <span class="comment">// handleAppMessage</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a133d3f2486a3d5a7c294d3e2d5fa8369"></a><!-- doxytag: member="oversim::Nice::handleNiceClusterMergeRequest" ref="a133d3f2486a3d5a7c294d3e2d5fa8369" args="(NiceClusterMerge *mergeMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceClusterMergeRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceClusterMerge.html">NiceClusterMerge</a> *&#160;</td>
          <td class="paramname"><em>mergeMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00755">755</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : NICE_CLUSTER_MERGE_REQUEST&quot;</span> &lt;&lt; endl;

    <span class="keywordtype">short</span> layer = mergeMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>();

    <span class="comment">// Only react if I am a leader of this cluster layer</span>

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader().isUnspecified()) {

        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : NO LEADER! BREAK. NICE_CLUSTER_MERGE_REQUEST finished&quot;</span> &lt;&lt; endl;

        <span class="keyword">delete</span> mergeMsg;

        <span class="keywordflow">return</span>;

    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#a9d03dd60f2ac8c6e64e159b8fd39982c" title="Removes address from cluster.">remove</a>(mergeMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());
        <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(mergeMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

        <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> oldLeader = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>();
        <span class="keywordflow">if</span> (oldLeader.isUnspecified() || oldLeader != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(mergeMsg-&gt;<a class="code" href="classNiceClusterMerge.html#a2e7dcf8ad12383d51f7286ebaa50eb6e">getNewClusterLeader</a>());
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(mergeMsg-&gt;<a class="code" href="classNiceClusterMerge.html#a2e7dcf8ad12383d51f7286ebaa50eb6e">getNewClusterLeader</a>());
        }

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;mergeMsg-&gt;<a class="code" href="classNiceMemberMessage.html#a3a982e7732b06ff920e6d9235e99e43f">getMembersArraySize</a>(); i++) {

            <span class="comment">/* Add new node to cluster */</span>
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(mergeMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i));

            <span class="comment">/* Create peer context to joining node */</span>
            <span class="comment">/* Check if peer info already exists */</span>
            std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(mergeMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i));

            <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) { <span class="comment">/* We already know this node */</span>

            }
            <span class="keywordflow">else</span> { <span class="comment">/* Create PeerInfo object */</span>

                <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);

                pi-&gt;set_last_HB_arrival(simTime().dbl());

                <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(mergeMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i), pi));

            }

            <span class="comment">/* Draw arrow to new member */</span>
            <a class="code" href="classTopologyVis.html#a4fe67c060004c8ca76658c7b41514a4a" title="Draws an arrow from this node to neighbor.">showOverlayNeighborArrow</a>(mergeMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i), <span class="keyword">false</span>, <a class="code" href="namespaceoversim.html#aa3b63c2cc07d2571efe93e9004ca0172">clusterarrows</a>[layer]);

            EV &lt;&lt; <span class="stringliteral">&quot;getHighestLeaderLayer()].getSize(): &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>()].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>() &lt;&lt; endl;

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>()].getSize() &lt; 2) {

                <span class="comment">// cancel layer</span>
                <span class="keywordflow">for</span> (TaSet::iterator itn = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].begin(); itn != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itn) {
                    <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itn);
                }
                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>()].<a class="code" href="classNiceCluster.html#ad66e5cfc867561bef65fcfd43dbc7d13" title="Removes all addresses from cluster, sets leader to unspecified address and sets last lt to 0...">clear</a>();

                <span class="keywordflow">for</span> (<span class="keywordtype">short</span> i=0; i&lt;<a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>; i++) {

                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize() &gt; 0) {

                        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].contains(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {

                            getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg
                                (<span class="stringliteral">&quot;i2&quot;</span>, 1, <a class="code" href="namespaceoversim.html#a068481bf2793ad703ca213dcca1e4a6f" title="Define colors for layers in visualization.">clustercolors</a>[i]);

                        }

                    }

                }

            }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        }

    }
    <span class="keywordflow">else</span> { <span class="comment">// Forward to new cluster leader</span>

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a>) {

            <a class="code" href="classNiceMemberMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMemberMessage</a>* dup = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMemberMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMemberMessage</a>*<span class="keyword">&gt;</span>(mergeMsg-&gt;<a class="code" href="classNiceClusterMerge.html#a499d4ad8edf432a14410e4cc0bf5cfcd">dup</a>());
            <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader(), dup);
            <span class="keyword">delete</span> mergeMsg;
            <span class="keywordflow">return</span>;

        }

    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a>)
        <a class="code" href="classoversim_1_1Nice.html#a1ffd3a3b39866e51502fee0bf37480f7">sendHeartbeats</a>();

    <span class="keyword">delete</span> mergeMsg;

    EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : NICE_CLUSTER_MERGE_REQUEST finished&quot;</span> &lt;&lt; endl;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8a781cde350bdaed6e8db0d0f36d82c0"></a><!-- doxytag: member="oversim::Nice::handleNiceForceMerge" ref="a8a781cde350bdaed6e8db0d0f36d82c0" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceForceMerge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00862">862</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classoversim_1_1Nice.html#a46eb256216745f2ae5db49585d8c7025">ClusterMergeRequest</a>(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>());

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9e789530fee17ed030b474ab2a7b1b18"></a><!-- doxytag: member="oversim::Nice::handleNiceHeartbeat" ref="a9e789530fee17ed030b474ab2a7b1b18" args="(NiceHeartbeat *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceHeartbeat </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceHeartbeat.html">NiceHeartbeat</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00869">869</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : NICE_HEARTBEAT from  &quot;</span> &lt;&lt; hbMsg-&gt;getSrcNode() &lt;&lt; endl;

    <span class="comment">/* Update sequence number information and evaluate distance */</span>
    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(hbMsg-&gt;getSrcNode());

    <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

        <span class="comment">/* We already know this node */</span>
        <span class="comment">// Collect subcluster infos</span>
        it-&gt;second-&gt;setSubClusterMembers(hbMsg-&gt;getSublayermembers());

        it-&gt;second-&gt;set_last_HB_arrival(simTime().dbl());

        <span class="keywordflow">if</span> (it-&gt;second-&gt;get_backHB(hbMsg-&gt;getSeqRspNo()) &gt; 0) {

            <span class="comment">/* Valid distance measurement, get value */</span>
            <span class="keywordtype">double</span> oldDistance = it-&gt;second-&gt;get_distance();

            <span class="comment">/* Use Exponential Moving Average with factor 0.1 */</span>
            <span class="keywordtype">double</span> newDistance = (simTime().dbl() - it-&gt;second-&gt;get_backHB(hbMsg-&gt;getSeqRspNo()) - hbMsg-&gt;getHb_delay())/2.0;

            <span class="keywordflow">if</span> (oldDistance &gt; 0) {

                it-&gt;second-&gt;set_distance((0.1 * newDistance) + (0.9 * oldDistance));

            }
            <span class="keywordflow">else</span> {

                it-&gt;second-&gt;set_distance(newDistance);

            }

        }

        it-&gt;second-&gt;set_last_recv_HB(hbMsg-&gt;getSeqNo());

    }

    it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(hbMsg-&gt;getSrcNode());

    <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;hbMsg-&gt;getMembersArraySize(); i++) {

            it-&gt;second-&gt;updateDistance(hbMsg-&gt;getMembers(i), hbMsg-&gt;getDistances(i));

        }

    }

    <span class="keyword">delete</span> hbMsg;

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : handleHeartbeat() finished.  &quot;</span> &lt;&lt; endl;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0757be556541e2d8efd235be889f2ab6"></a><!-- doxytag: member="oversim::Nice::handleNiceJoinCluster" ref="a0757be556541e2d8efd235be889f2ab6" args="(NiceMessage *joinMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceJoinCluster </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>joinMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01282">1282</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">debug_join</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : handleNiceJoinCluster()&quot;</span> &lt;&lt; endl;

    <span class="keywordtype">short</span> layer = joinMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>();

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">debug_join</a>)
        std::cout &lt;&lt; <span class="stringliteral">&quot; From : &quot;</span> &lt;&lt; joinMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() &lt;&lt; <span class="stringliteral">&quot;, Layer:  &quot;</span> &lt;&lt; layer &lt;&lt; endl;

    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader().isUnspecified()) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a>) {

                <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* dup = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>*<span class="keyword">&gt;</span>(joinMsg-&gt;<a class="code" href="classNiceMessage.html#a68d57e786b6a43f8f18f6c899eebd50e">dup</a>());
                <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader(), dup);

            }

        }
        <span class="keywordflow">else</span> {

            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#a765b5d96a57bf709b6a8ce28541d55a6">numJoins</a>);

            <span class="comment">/* Add new node to cluster */</span>
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(joinMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

            <span class="comment">/* Create peer context to joining node */</span>
            <span class="comment">/* Check if peer info already exists */</span>
            std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(joinMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

            <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) { <span class="comment">/* We already know this node */</span>


            }
            <span class="keywordflow">else</span> { <span class="comment">/* Create PeerInfo object */</span>

                <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);

                <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(joinMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), pi));

            }

            <span class="comment">/* Draw arrow to new member */</span>
            <a class="code" href="classTopologyVis.html#a4fe67c060004c8ca76658c7b41514a4a" title="Draws an arrow from this node to neighbor.">showOverlayNeighborArrow</a>(joinMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), <span class="keyword">false</span>, <a class="code" href="namespaceoversim.html#aa3b63c2cc07d2571efe93e9004ca0172">clusterarrows</a>[layer]);

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a>)
                <a class="code" href="classoversim_1_1Nice.html#a677d8c691996974f3abb040578279669">sendHeartbeatTo</a>(joinMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), layer);
        }

    }
    <span class="keywordflow">else</span> {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">debug_join</a>)
            EV &lt;&lt; <span class="stringliteral">&quot;Leader unspecified. Ignoring request.&quot;</span> &lt;&lt; endl;

    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">debug_join</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : handleNiceJoinCluster() finished.&quot;</span> &lt;&lt; endl;

    <span class="keyword">delete</span> joinMsg;
} <span class="comment">// handleNiceJoinCluster</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a32b8406978ad9ab46a7eba786ccf83a2"></a><!-- doxytag: member="oversim::Nice::handleNiceJoineval" ref="a32b8406978ad9ab46a7eba786ccf83a2" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceJoineval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01348">1348</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* responseMsg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_JOINEVAL_RESPONSE&quot;</span>);
    responseMsg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    responseMsg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a8b3838507b87b8e45317b057acfc1893">NICE_JOINEVAL_RESPONSE</a>);
    responseMsg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>());

    responseMsg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(responseMsg));

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), responseMsg);

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a90140602613205803d08c25820b94063"></a><!-- doxytag: member="oversim::Nice::handleNiceJoinevalResponse" ref="a90140602613205803d08c25820b94063" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceJoinevalResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01362">1362</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a71935c17b8b4804bc6dd823d696dbf3e">evalLayer</a> &gt; 0 &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a71935c17b8b4804bc6dd823d696dbf3e">evalLayer</a> == msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()) {

        <a class="code" href="classoversim_1_1Nice.html#a3460e84226f3260196e99da210b74082">query_compare</a> = simTime() - <a class="code" href="classoversim_1_1Nice.html#a3460e84226f3260196e99da210b74082">query_compare</a>;

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a3460e84226f3260196e99da210b74082">query_compare</a> &lt; <a class="code" href="classoversim_1_1Nice.html#aa604bd27a4b737fd179c2b09debebc84">query_start</a>) {

            <a class="code" href="classoversim_1_1Nice.html#a6acafcf8008939d12f8db7e002a2ebb5">Query</a>(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()-1);

        }
        <span class="keywordflow">else</span> {

            <a class="code" href="classoversim_1_1Nice.html#a6acafcf8008939d12f8db7e002a2ebb5">Query</a>(<a class="code" href="classoversim_1_1Nice.html#a974f1212dc063af0d943b5fa350cc57a">tempResolver</a>, msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() - 1);

        }

        <a class="code" href="classoversim_1_1Nice.html#a71935c17b8b4804bc6dd823d696dbf3e">evalLayer</a> = -1;
    }

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2946a8a0d8f597e09e5d37659d1e30a1"></a><!-- doxytag: member="oversim::Nice::handleNiceLeaderHeartbeat" ref="a2946a8a0d8f597e09e5d37659d1e30a1" args="(NiceLeaderHeartbeat *lhbMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceLeaderHeartbeat </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceLeaderHeartbeat.html">NiceLeaderHeartbeat</a> *&#160;</td>
          <td class="paramname"><em>lhbMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00928">928</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : NICE_LEADERHEARTBEAT from  &quot;</span> &lt;&lt; lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() &lt;&lt; endl;

    ASSERT(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

    <span class="comment">/* Update sequence number information and evaluate distance */</span>
    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

    <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) { <span class="comment">/* We already know this node */</span>

        it-&gt;second-&gt;set_last_HB_arrival(simTime().dbl());

        <span class="keywordflow">if</span> (it-&gt;second-&gt;get_backHB(lhbMsg-&gt;<a class="code" href="classNiceHeartbeat.html#a1e1ce43834004fcf4719cf46a4413910">getSeqRspNo</a>()) &gt; 0) {

            <span class="comment">/* Valid distance measurement, get value */</span>
            it-&gt;second-&gt;set_distance((simTime().dbl() - it-&gt;second-&gt;get_backHB(lhbMsg-&gt;<a class="code" href="classNiceHeartbeat.html#a1e1ce43834004fcf4719cf46a4413910">getSeqRspNo</a>()) - lhbMsg-&gt;<a class="code" href="classNiceHeartbeat.html#a7f1d42e1b29d5df17fabf7ac057a7fff">getHb_delay</a>())/2);

        }

        it-&gt;second-&gt;set_last_recv_HB(lhbMsg-&gt;<a class="code" href="classNiceHeartbeat.html#a1ffed790cd05d6ece1a90fdf8667e4a2">getSeqNo</a>());

    }

    it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

    <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;lhbMsg-&gt;<a class="code" href="classNiceMemberMessage.html#a3a982e7732b06ff920e6d9235e99e43f">getMembersArraySize</a>(); i++) {

            it-&gt;second-&gt;updateDistance(lhbMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i), lhbMsg-&gt;<a class="code" href="classNiceHeartbeat.html#a46c68af3c70fcbe454bb1e8dc9f31cfd">getDistances</a>(i));

        }

    }

    <span class="comment">// Maintain cluster memberships</span>

    <span class="keywordflow">if</span> (lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() &gt; <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()) {

        <span class="comment">/* Node is not part of this cluster, remove it */</span>
        <a class="code" href="classoversim_1_1Nice.html#a70a802eb31e3c0047413fa08864986bf" title="sendRemoveTo">sendRemoveTo</a>(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>());

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
            EV &lt;&lt; <span class="stringliteral">&quot;Node is not part of this cluster (&quot;</span> &lt;&lt; lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() &lt;&lt; <span class="stringliteral">&quot;), removing it...&quot;</span> &lt;&lt; endl;

        <span class="keyword">delete</span> lhbMsg;
        <span class="keywordflow">return</span>;

    }

    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>().<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp;
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
            EV &lt;&lt; <span class="stringliteral">&quot;Leader collision...&quot;</span>;

        <span class="keywordflow">if</span> (lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() &lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
                EV &lt;&lt; <span class="stringliteral">&quot;...making other leader.&quot;</span> &lt;&lt; endl;

            <span class="keywordflow">if</span> (lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() + 1 &lt;= <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()) {
                <a class="code" href="classoversim_1_1Nice.html#af48af4ac315203b552f1eecd1678689c">gracefulLeave</a>(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() + 1);
            }

            <span class="comment">/* Fix visualisation - remove arrows */</span>
            <span class="keywordtype">int</span> hbLayer = lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>();
            <span class="keywordflow">for</span> (TaSet::iterator itn = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[hbLayer].begin(); itn != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[hbLayer].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itn) {
                <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itn);
            }

            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());
            <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>(), lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());
        }
        <span class="keywordflow">else</span> {
            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
                EV &lt;&lt; <span class="stringliteral">&quot;...remaining leader.&quot;</span> &lt;&lt; endl;
            <span class="keyword">delete</span> lhbMsg;
            <span class="keywordflow">return</span>;
        }
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>().<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp;
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>() != lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>()) {
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
            EV &lt;&lt; <span class="stringliteral">&quot;Possible multiple leaders detected... sending remove to &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>() &lt;&lt; <span class="stringliteral">&quot; leader.\n&quot;</span>;
        <a class="code" href="classoversim_1_1Nice.html#a70a802eb31e3c0047413fa08864986bf" title="sendRemoveTo">sendRemoveTo</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>(), lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>());

    }

    <span class="comment">/* Everything is in order. Process HB */</span>
    <span class="keywordtype">bool</span> leaderChanged = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>().<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() || <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>() != lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>();

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>(); m&lt;<a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>; m++) {
        <span class="keywordflow">for</span> (TaSet::iterator itn = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[m].begin(); itn != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[m].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itn) {
            <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itn);
        }
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[m].<a class="code" href="classNiceCluster.html#ad66e5cfc867561bef65fcfd43dbc7d13" title="Removes all addresses from cluster, sets leader to unspecified address and sets last lt to 0...">clear</a>();
    }

    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;lhbMsg-&gt;<a class="code" href="classNiceMemberMessage.html#a3a982e7732b06ff920e6d9235e99e43f">getMembersArraySize</a>(); i++) {

        <span class="comment">//Check if member is already part of cluster</span>

        <span class="comment">/* Check if peer info already exists */</span>
        std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(lhbMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i));

        <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) { <span class="comment">/* We already know this node */</span>

        }
        <span class="keywordflow">else</span> { <span class="comment">/* Create PeerInfo object */</span>

            <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);

            pi-&gt;set_last_HB_arrival(simTime().dbl());

            <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(lhbMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i), pi));

        }

        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(lhbMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i));

    }

    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());
    <span class="keywordflow">if</span> (!leaderChanged)
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a33ebaaa6d22be0dbce87337ec52742b8" title="Confirm that we&#39;re sure that our leader information is correct.">confirmLeader</a>();

    <span class="keywordflow">if</span> (lhbMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#acec737297fa8a4e7337c2e82ba52df74">getSupercluster_membersArraySize</a>() &gt; 0) {

        <span class="keywordflow">for</span> (TaSet::iterator itn = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() + 1].<a class="code" href="classNiceCluster.html#a3208511b96045dbd22ec18c9bd457737" title="Returns const iterator to first address.">begin</a>(); itn != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() + 1].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itn) {
            <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itn);
        }
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1].<a class="code" href="classNiceCluster.html#ad66e5cfc867561bef65fcfd43dbc7d13" title="Removes all addresses from cluster, sets leader to unspecified address and sets last lt to 0...">clear</a>();

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;lhbMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#acec737297fa8a4e7337c2e82ba52df74">getSupercluster_membersArraySize</a>(); i++) {

            <span class="comment">/* Check if peer info already exists */</span>
            std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(lhbMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a7a3b0d42a894a34f1947cb4ad0e0c27e">getSupercluster_members</a>(i));

            <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) { <span class="comment">/* We already know this node */</span>

            }
            <span class="keywordflow">else</span> { <span class="comment">/* Create PeerInfo object */</span>

                <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);

                pi-&gt;set_last_HB_arrival(simTime().dbl());

                <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(lhbMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a7a3b0d42a894a34f1947cb4ad0e0c27e">getSupercluster_members</a>(i), pi));

            }

            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(lhbMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a7a3b0d42a894a34f1947cb4ad0e0c27e">getSupercluster_members</a>(i));

        }

        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[lhbMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(lhbMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#ad4698d7c76d6d68b9c6999b9522f3fc3">getSupercluster_leader</a>());

        it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

        <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a>=0; <a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a>&lt;lhbMsg-&gt;<a class="code" href="classNiceMemberMessage.html#a3a982e7732b06ff920e6d9235e99e43f">getMembersArraySize</a>(); <a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a>++) {

                it-&gt;second-&gt;updateDistance(lhbMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(<a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a>), lhbMsg-&gt;<a class="code" href="classNiceHeartbeat.html#a46c68af3c70fcbe454bb1e8dc9f31cfd">getDistances</a>(<a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a>));

            }

        }
        <span class="keywordflow">else</span> {

            <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);

            pi-&gt;set_last_HB_arrival(simTime().dbl());

            <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(lhbMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), pi));

        }
    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : handleNiceLeaderHeartbeat() finished.  &quot;</span> &lt;&lt; endl;

    <span class="keyword">delete</span> lhbMsg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a34fcedb51cca4b510f3e5a9eebf28096"></a><!-- doxytag: member="oversim::Nice::handleNiceLeaderHeartbeatOrTransfer" ref="a34fcedb51cca4b510f3e5a9eebf28096" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceLeaderHeartbeatOrTransfer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a0d13c3965aafab68b912a6dc75c4e9a0"></a><!-- doxytag: member="oversim::Nice::handleNiceLeaderTransfer" ref="a0d13c3965aafab68b912a6dc75c4e9a0" args="(NiceLeaderHeartbeat *transferMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceLeaderTransfer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceLeaderHeartbeat.html">NiceLeaderHeartbeat</a> *&#160;</td>
          <td class="paramname"><em>transferMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01117">1117</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : NICE_LEADERTRANSFER from &quot;</span> &lt;&lt; transferMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() &lt;&lt; endl;

    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>().<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {

        <span class="comment">/* React only if I am not already leader */</span>
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
                EV &lt;&lt; <span class="stringliteral">&quot;I am not already leader of this cluster layer.&quot;</span> &lt;&lt; endl;

            <span class="keywordflow">for</span> (TaSet::iterator itn = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a3208511b96045dbd22ec18c9bd457737" title="Returns const iterator to first address.">begin</a>(); itn != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itn) {
                <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itn);
            }
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#ad66e5cfc867561bef65fcfd43dbc7d13" title="Removes all addresses from cluster, sets leader to unspecified address and sets last lt to 0...">clear</a>();
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#a3a982e7732b06ff920e6d9235e99e43f">getMembersArraySize</a>(); i++) {

                <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
                    EV &lt;&lt; <span class="stringliteral">&quot;Adding: &quot;</span> &lt;&lt; transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i) &lt;&lt; endl;

                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i));
                <a class="code" href="classTopologyVis.html#a4fe67c060004c8ca76658c7b41514a4a" title="Draws an arrow from this node to neighbor.">showOverlayNeighborArrow</a>(transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i), <span class="keyword">false</span>, <a class="code" href="namespaceoversim.html#aa3b63c2cc07d2571efe93e9004ca0172">clusterarrows</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()]);

                std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i));

                <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                    <span class="comment">/* We already know this node */</span>
                    it-&gt;second-&gt;touch();

                }
                <span class="keywordflow">else</span> {

                    <span class="comment">//We don&#39;t know him yet</span>
                    <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);

                    pi-&gt;set_last_HB_arrival(simTime().dbl());

                    <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i), pi));

                }

            }

            <span class="keywordflow">if</span> (transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#acec737297fa8a4e7337c2e82ba52df74">getSupercluster_membersArraySize</a>() &gt; 0) {

                <span class="keywordflow">for</span> (TaSet::iterator itn = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() + 1].<a class="code" href="classNiceCluster.html#a3208511b96045dbd22ec18c9bd457737" title="Returns const iterator to first address.">begin</a>(); itn != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() + 1].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itn) {
                    <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itn);
                }
                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1].<a class="code" href="classNiceCluster.html#ad66e5cfc867561bef65fcfd43dbc7d13" title="Removes all addresses from cluster, sets leader to unspecified address and sets last lt to 0...">clear</a>();

                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#acec737297fa8a4e7337c2e82ba52df74">getSupercluster_membersArraySize</a>(); i++) {

                    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a7a3b0d42a894a34f1947cb4ad0e0c27e">getSupercluster_members</a>(i));

                    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a7a3b0d42a894a34f1947cb4ad0e0c27e">getSupercluster_members</a>(i));

                    <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                        <span class="comment">/* We already know this node */</span>
                        it-&gt;second-&gt;touch();

                    }
                    <span class="keywordflow">else</span> {

                        <span class="comment">//We don&#39;t know him yet</span>
                        <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);

                        pi-&gt;set_last_HB_arrival(simTime().dbl());

                        <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a7a3b0d42a894a34f1947cb4ad0e0c27e">getSupercluster_members</a>(i), pi));

                    }

                }

                <span class="comment">// experimental</span>
                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

                <span class="keywordflow">if</span> (!transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#ad4698d7c76d6d68b9c6999b9522f3fc3">getSupercluster_leader</a>().<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {

                    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#ad4698d7c76d6d68b9c6999b9522f3fc3">getSupercluster_leader</a>());

                    <span class="keywordflow">if</span> ((<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) &amp;&amp;
                            (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+2].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>() == 0)) {

                        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#acec737297fa8a4e7337c2e82ba52df74">getSupercluster_membersArraySize</a>(); i++) {

                            <a class="code" href="classTopologyVis.html#a4fe67c060004c8ca76658c7b41514a4a" title="Draws an arrow from this node to neighbor.">showOverlayNeighborArrow</a>(transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a7a3b0d42a894a34f1947cb4ad0e0c27e">getSupercluster_members</a>(i), <span class="keyword">false</span>, <a class="code" href="namespaceoversim.html#aa3b63c2cc07d2571efe93e9004ca0172">clusterarrows</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1]);

                        }

                    }
                    <span class="keywordflow">else</span> {

                        <a class="code" href="classoversim_1_1Nice.html#af4c42da9d6ab2d8e83a4056bf83dd8ab">JoinCluster</a>(transferMsg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#ad4698d7c76d6d68b9c6999b9522f3fc3">getSupercluster_leader</a>(), transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()+1);

                    }

                }

            }
            <span class="keywordflow">else</span> {

                <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a> &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a> != transferMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>()) {
                    <a class="code" href="classoversim_1_1Nice.html#ad3b7430e484451777e58ea163e4fc049">BasicJoinLayer</a>(transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() + 1);
                }

            }

            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>; i++) {

                <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].contains(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>))
                    getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 1, <a class="code" href="namespaceoversim.html#a068481bf2793ad703ca213dcca1e4a6f" title="Define colors for layers in visualization.">clustercolors</a>[i]);

            }

            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a504cfb2783119f7291efe806522b0568">setLastLT</a>();


        }
        <span class="keywordflow">else</span> {

            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#a3a982e7732b06ff920e6d9235e99e43f">getMembersArraySize</a>(); i++) {

                <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
                    EV &lt;&lt; <span class="stringliteral">&quot;Adding: &quot;</span> &lt;&lt; transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i) &lt;&lt; endl;

                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i));
                <a class="code" href="classTopologyVis.html#a4fe67c060004c8ca76658c7b41514a4a" title="Draws an arrow from this node to neighbor.">showOverlayNeighborArrow</a>(transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i), <span class="keyword">false</span>, <a class="code" href="namespaceoversim.html#aa3b63c2cc07d2571efe93e9004ca0172">clusterarrows</a>[transferMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()]);

                std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i));

                <span class="keywordflow">if</span> (it == <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                    <span class="comment">//We don&#39;t know him yet</span>
                    <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);

                    pi-&gt;set_last_HB_arrival(simTime().dbl());

                    <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(transferMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i), pi));

                }

            }

        }

    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a>)
        <a class="code" href="classoversim_1_1Nice.html#a1ffd3a3b39866e51502fee0bf37480f7">sendHeartbeats</a>();

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : handleNiceLeaderTransfer() finished.  &quot;</span> &lt;&lt; endl;

    <span class="keyword">delete</span> transferMsg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5ebd8516425fdcc5847e26ce3b08314f"></a><!-- doxytag: member="oversim::Nice::handleNiceMulticast" ref="a5ebd8516425fdcc5847e26ce3b08314f" args="(NiceMulticastMessage *multicastMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceMulticast </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMulticastMessage.html">NiceMulticastMessage</a> *&#160;</td>
          <td class="paramname"><em>multicastMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01385">1385</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#ab0165945cd4929e57f66e595ce76cc14">numReceived</a>; <a class="code" href="classoversim_1_1Nice.html#ab70712e9a475d6ab12690cf36a31ffe1">totalReceivedBytes</a> += multicastMsg-&gt;getByteLength());

    <span class="comment">/* If it is mine, count */</span>
    <span class="keywordflow">if</span> (multicastMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#ab0a8837fcffd376b822166d048a401fa">numOwnMessagesReceived</a>);

    }
    <span class="keywordflow">else</span> {

        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hopCount = multicastMsg-&gt;<a class="code" href="classNiceMulticastMessage.html#a117259826a5d1d444b8fa6c94e37c686">getHopCount</a>();
        hopCount++;

        <span class="keywordflow">if</span> (hopCount &lt; 8) {

            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#aa0d6fe84d8444d39caee3e2c67323550">numForward</a>; <a class="code" href="classoversim_1_1Nice.html#ade427df4fbd3edb53e04467984384927">totalForwardBytes</a> += multicastMsg-&gt;getByteLength());

            <a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a>* forOverlay = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a>*<span class="keyword">&gt;</span>(multicastMsg-&gt;<a class="code" href="classNiceMulticastMessage.html#aaba4eefdbfdf69697d76240b5c918470">dup</a>());
            forOverlay-&gt;<a class="code" href="classNiceMulticastMessage.html#a4444398854777b6d5ab5f24674c42054">setHopCount</a>(hopCount);
            <a class="code" href="classoversim_1_1Nice.html#a92c3a3c37c9c3101ac2e51ab609c4c64">sendDataToOverlay</a>(forOverlay);

            send(multicastMsg-&gt;decapsulate(), <span class="stringliteral">&quot;appOut&quot;</span>);

        }
    }

    <span class="keyword">delete</span> multicastMsg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab6096a998d14db350a8c12780ca62e61"></a><!-- doxytag: member="oversim::Nice::handleNicePeerTemporary" ref="ab6096a998d14db350a8c12780ca62e61" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNicePeerTemporary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01416">1416</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Add node to tempPeers</span>
    <a class="code" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">tempPeers</a>.insert(std::make_pair(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), simTime()));

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a761b15b9d4124e34084250c79339da27"></a><!-- doxytag: member="oversim::Nice::handleNicePeerTemporaryRelease" ref="a761b15b9d4124e34084250c79339da27" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNicePeerTemporaryRelease </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01424">1424</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Remove node from tempPeers</span>
    <a class="code" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">tempPeers</a>.erase(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());
    <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a45f3d0f25ccf42b10be3717b1e59846b"></a><!-- doxytag: member="oversim::Nice::handleNicePingProbe" ref="a45f3d0f25ccf42b10be3717b1e59846b" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNicePingProbe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01433">1433</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Only answer if I am part of requested layer</span>
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#aedcd9705997d3f701d2a47a5ca7bdb65" title="Tests if given address is in cluster.">contains</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {

        <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* probe = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_PING_PROBE&quot;</span>);
        probe-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        probe-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7af507f86ba86f0aea580335c0965b26de">NICE_PING_PROBE_RESPONSE</a>);
        probe-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>());

        probe-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(probe));

        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), probe);

    }
    <span class="keywordflow">else</span> {

        <span class="comment">//Do nothing</span>

    }

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa818a9dfa6027388de5281eae926c7c4"></a><!-- doxytag: member="oversim::Nice::handleNicePingProbeResponse" ref="aa818a9dfa6027388de5281eae926c7c4" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNicePingProbeResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01457">1457</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">//Only react if still in same cluster as when asked</span>
    <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() == <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()+1) {

        std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

        <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

            <span class="keywordtype">double</span> <a class="code" href="classBaseOverlay.html#aa12314947ef42726ec6c7066dde8d0f9" title="This method should implement the distance between two keys.">distance</a> = simTime().dbl() - it-&gt;second-&gt;getDES();

            it-&gt;second-&gt;set_distance(distance);
            it-&gt;second-&gt;touch();

        }

    }

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a10494e710344144e515c7e22b83e786c"></a><!-- doxytag: member="oversim::Nice::handleNicePollRp" ref="a10494e710344144e515c7e22b83e786c" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNicePollRp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01478">1478</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {

        <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* response = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_POLL_RP_RESPONSE&quot;</span>);
        response-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        response-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7ad1cdc4389204852a40ae4afd7eead55d">NICE_POLL_RP_RESPONSE</a>);
        response-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(<a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>());
        response-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(response));

        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), response);

    }
    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a655a94f5f3da35838278419173dda60c"></a><!-- doxytag: member="oversim::Nice::handleNicePollRpResponse" ref="a655a94f5f3da35838278419173dda60c" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNicePollRpResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01494">1494</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#ac00b0f8d11b8f3f7c3e5c2eb78511cc6">polledRendevouzPoint</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#ac00b0f8d11b8f3f7c3e5c2eb78511cc6">polledRendevouzPoint</a> == <a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>) {

        <a class="code" href="classoversim_1_1Nice.html#ac00b0f8d11b8f3f7c3e5c2eb78511cc6">polledRendevouzPoint</a> = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;
        cancelEvent(<a class="code" href="classoversim_1_1Nice.html#a4a913c4be6eabc80fac48dffed005771">rpPollTimer</a>);

    }

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afeb7081be1f7f76b2108aad45c49abfe"></a><!-- doxytag: member="oversim::Nice::handleNiceQuery" ref="afeb7081be1f7f76b2108aad45c49abfe" args="(NiceMessage *queryMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceQuery </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>queryMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00623">623</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : handleNiceQuery()&quot;</span> &lt;&lt; endl;

    <span class="keywordtype">short</span> layer = queryMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>();
    <span class="keywordflow">if</span> (layer &gt;= <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>) {
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
            EV &lt;&lt; <span class="stringliteral">&quot;Layer &quot;</span> &lt;&lt; layer &lt;&lt; <span class="stringliteral">&quot; &gt;=  max layer &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> &lt;&lt; <span class="stringliteral">&quot; ! Returning.&quot;</span> &lt;&lt; endl;
        <span class="keyword">delete</span> queryMsg;
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
        EV &lt;&lt; <span class="stringliteral">&quot; layer before: &quot;</span> &lt;&lt; layer &lt;&lt; endl;

    <span class="keywordflow">if</span> (layer &gt; <a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>()) {
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {
            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
                EV &lt;&lt; <span class="stringliteral">&quot; getHighestLeaderLayer(): &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>() &lt;&lt; <span class="stringliteral">&quot; ! RP self-promoting.&quot;</span> &lt;&lt; endl;

            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = <a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>() + 1; i &lt;= layer; ++i) {
                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
            }
        }
        <span class="keywordflow">else</span> {
            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
                EV &lt;&lt; <span class="stringliteral">&quot; getHighestLeaderLayer(): &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>() &lt;&lt; <span class="stringliteral">&quot; ! Returning.&quot;</span> &lt;&lt; endl;

            <span class="keyword">delete</span> queryMsg;
            <span class="keywordflow">return</span>;
        }
    }

    <span class="keywordflow">if</span> (layer &lt; 0) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {

            <span class="comment">/* If layer is &lt; 0, response with highest layer I am leader of */</span>
            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
                EV &lt;&lt; <span class="stringliteral">&quot; I am RP.&quot;</span> &lt;&lt; endl;
            layer = <a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>();

        }
        <span class="keywordflow">else</span> {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
                EV &lt;&lt; <span class="stringliteral">&quot; I am not RP. Return.&quot;</span> &lt;&lt; endl;

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a>) {

                <span class="comment">/* forward to Rendevouz Point */</span>
                <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* dup = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>*<span class="keyword">&gt;</span>(queryMsg-&gt;<a class="code" href="classNiceMessage.html#a68d57e786b6a43f8f18f6c899eebd50e">dup</a>());
                <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>, dup);

            }

            <span class="keyword">delete</span> queryMsg;
            <span class="keywordflow">return</span>;

        }

    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
        EV &lt;&lt; <span class="stringliteral">&quot; layer after: &quot;</span> &lt;&lt; layer &lt;&lt; endl;

    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader().isUnspecified()) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a>) {

                <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* dup = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>*<span class="keyword">&gt;</span>(queryMsg-&gt;<a class="code" href="classNiceMessage.html#a68d57e786b6a43f8f18f6c899eebd50e">dup</a>());
                <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader(), dup);

            }

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
                EV &lt;&lt; <span class="stringliteral">&quot; I am not leader of this cluster. return.&quot;</span> &lt;&lt; endl;

            <span class="keyword">delete</span> queryMsg;
            <span class="keywordflow">return</span>;

        }

    }
    <span class="keywordflow">else</span> {

        <span class="keyword">delete</span> queryMsg;
        <span class="keywordflow">return</span>;

    }

    <a class="code" href="classNiceMemberMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMemberMessage</a>* response = <span class="keyword">new</span> <a class="code" href="classNiceMemberMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMemberMessage</a>(<span class="stringliteral">&quot;NICE_QUERY_RESPONSE&quot;</span>);
    response-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    response-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a0ee562452c946bccf6069ac9e42b066e">NICE_QUERY_RESPONSE</a>);
    response-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);

    <span class="comment">/* Fill in current cluster members except me */</span>
    response-&gt;<a class="code" href="classNiceMemberMessage.html#aa7ae9d6e4a78b2c5493da57bd40748e9">setMembersArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getSize()-1);

    <span class="keywordtype">int</span> j=0;

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); i++) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<span class="keyword">get</span>(i) != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

            response-&gt;<a class="code" href="classNiceMemberMessage.html#a5aec4bd795065c56c7f95f5075d061b4">setMembers</a>(j, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<span class="keyword">get</span>(i));
            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
                EV &lt;&lt; <span class="stringliteral">&quot; Response: &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(i) &lt;&lt; endl;
            j++;

        }

    }

    response-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a094947aff89f3e4af2a30ec071040f4c">NICEMEMBERMESSAGE_L</a>(response));

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(queryMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), response);

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
        EV &lt;&lt; <span class="stringliteral">&quot; Sent response to: &quot;</span> &lt;&lt; queryMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() &lt;&lt; endl;

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : handleNiceQuery() finished.&quot;</span> &lt;&lt; endl;

    <span class="keyword">delete</span> queryMsg;
} <span class="comment">// handleNiceQuery</span>
</pre></div>
</div>
</div>
<a class="anchor" id="ab36bfc01b3cd042da92e1b27782ce7bd"></a><!-- doxytag: member="oversim::Nice::handleNiceQueryResponse" ref="ab36bfc01b3cd042da92e1b27782ce7bd" args="(NiceMemberMessage *queryRspMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceQueryResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMemberMessage.html">NiceMemberMessage</a> *&#160;</td>
          <td class="paramname"><em>queryRspMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01506">1506</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{

    cancelEvent(<a class="code" href="classoversim_1_1Nice.html#a4648efb65dd8c13990a571c275d3bd04">queryTimer</a>);

    <span class="keywordtype">short</span> layer = queryRspMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>();

    <span class="comment">/* Check layer response */</span>
    <span class="keywordflow">if</span> (layer == <a class="code" href="classoversim_1_1Nice.html#a327e50ef2c393ea0b929f3f27154ce96">targetLayer</a>) {

        <span class="comment">/* Use member information for own cluster update */</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; queryRspMsg-&gt;<a class="code" href="classNiceMemberMessage.html#a3a982e7732b06ff920e6d9235e99e43f">getMembersArraySize</a>(); i++) {

            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(queryRspMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i));

        }

        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(queryRspMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

        <span class="comment">/* Initiate joining of lowest layer */</span>
        <a class="code" href="classoversim_1_1Nice.html#af4c42da9d6ab2d8e83a4056bf83dd8ab">JoinCluster</a>(queryRspMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), layer);

        <a class="code" href="classoversim_1_1Nice.html#ad1d32ea267badf0b9a482d7c415aa03c" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);

    }
    <span class="keywordflow">else</span> {

        <span class="comment">/* Evaluate RTT to queried node */</span>
        <a class="code" href="classoversim_1_1Nice.html#aa604bd27a4b737fd179c2b09debebc84">query_start</a> = simTime() - <a class="code" href="classoversim_1_1Nice.html#aa604bd27a4b737fd179c2b09debebc84">query_start</a>;

        <span class="comment">/* Find out who is nearest cluster member in response, if nodes are given */</span>
        <span class="keywordflow">if</span> (queryRspMsg-&gt;<a class="code" href="classNiceMemberMessage.html#a3a982e7732b06ff920e6d9235e99e43f">getMembersArraySize</a>() &gt; 0) {

            <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* joineval = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_JOINEVAL&quot;</span>);
            joineval-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
            joineval-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7ad017b8270a2ffd62d28c6b40373dd44d">NICE_JOINEVAL</a>);
            joineval-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);

            joineval-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(joineval));

            <span class="comment">/* Initiate evaluation with all cluster members */</span>
            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; queryRspMsg-&gt;<a class="code" href="classNiceMemberMessage.html#a3a982e7732b06ff920e6d9235e99e43f">getMembersArraySize</a>(); i++) {

                <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* dup = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>*<span class="keyword">&gt;</span>(joineval-&gt;<a class="code" href="classNiceMessage.html#a68d57e786b6a43f8f18f6c899eebd50e">dup</a>());

                <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(queryRspMsg-&gt;<a class="code" href="classNiceMemberMessage.html#ae8308ac72b5f07bf3920615387cc4376">getMembers</a>(i), dup);

            }

            <span class="keyword">delete</span> joineval;

        }
        <span class="keywordflow">else</span> { <span class="comment">// Directly query same node again for lower layer</span>

            <a class="code" href="classoversim_1_1Nice.html#a6acafcf8008939d12f8db7e002a2ebb5">Query</a>(queryRspMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>(), queryRspMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()-1);

        }

        <a class="code" href="classoversim_1_1Nice.html#a71935c17b8b4804bc6dd823d696dbf3e">evalLayer</a> = layer;
        <a class="code" href="classoversim_1_1Nice.html#a3460e84226f3260196e99da210b74082">query_compare</a> = simTime();

    }

    <span class="keyword">delete</span> queryRspMsg;
} <span class="comment">// handleNiceQueryResponse</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a66a02ca915d3e7182580217bde40ccb5"></a><!-- doxytag: member="oversim::Nice::handleNiceRemove" ref="a66a02ca915d3e7182580217bde40ccb5" args="(NiceMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNiceRemove </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMessage.html">NiceMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01572">1572</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a12a2bd46343643e35473ab74900db70a">debug_removes</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : NICE_REMOVE&quot;</span> &lt;&lt; endl;

    <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a12a2bd46343643e35473ab74900db70a">debug_removes</a>)
            EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : received remove from self. Disregard.&quot;</span>;
        <span class="keyword">delete</span> msg;
        <span class="keywordflow">return</span>;
    }

    <span class="keywordtype">short</span> layer = msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>();

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a>) {
        <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader().isUnspecified()) {
            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> &amp;&amp; (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader() != msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>())) {

                <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* dup = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>*<span class="keyword">&gt;</span>(msg-&gt;<a class="code" href="classNiceMessage.html#a68d57e786b6a43f8f18f6c899eebd50e">dup</a>());
                <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader(), dup);
                <span class="keyword">delete</span> msg;
                <span class="keywordflow">return</span>;
            }
        }
    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a12a2bd46343643e35473ab74900db70a">debug_removes</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : removing &quot;</span> &lt;&lt; msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() &lt;&lt; <span class="stringliteral">&quot; from layer &quot;</span> &lt;&lt; layer &lt;&lt; endl;

    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>().<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

            <span class="comment">// check prevents visualization arrows to be deleted by error</span>
            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#aedcd9705997d3f701d2a47a5ca7bdb65" title="Tests if given address is in cluster.">contains</a>(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>())) {

                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[msg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>()].<a class="code" href="classNiceCluster.html#a9d03dd60f2ac8c6e64e159b8fd39982c" title="Removes address from cluster.">remove</a>(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());
                <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(msg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());
                <a class="code" href="classoversim_1_1Nice.html#a71a14940853660afb14b6c8f6b5d448c">updateVisualization</a>();

            }

        }
    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a12a2bd46343643e35473ab74900db70a">debug_removes</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : NICE_REMOVE finished.&quot;</span> &lt;&lt; endl;

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9f2264e7a35474365104f15854108700"></a><!-- doxytag: member="oversim::Nice::handleNodeLeaveNotification" ref="a9f2264e7a35474365104f15854108700" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleNodeLeaveNotification </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method gets call **.gracefulLeaveDelay seconds before it is killed. </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#af9ea0a59c26b70c50c63c2c1dc4c2ec3">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00236">236</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                       {
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {
        opp_error(<span class="stringliteral">&quot;The NICE Rendevouz Point is being churned out and the simulation cannot continue. &quot;</span>
                <span class="stringliteral">&quot;Please, check your config and make sure that the Chrun Generator&#39;s configuration is correct. &quot;</span>
                <span class="stringliteral">&quot;Specifically, the Rendevouz Point must not get churned out during the simulation.&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aebd1289938fa0c32bceda56deafaf302"></a><!-- doxytag: member="oversim::Nice::handleTimerEvent" ref="aebd1289938fa0c32bceda56deafaf302" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ab893c156412e38caa62fe058b229899b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00320">320</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordflow">if</span> (msg-&gt;isName(<span class="stringliteral">&quot;visualizationTimer&quot;</span>)) {

        <a class="code" href="classoversim_1_1Nice.html#a71a14940853660afb14b6c8f6b5d448c">updateVisualization</a>();
        scheduleAt(simTime() + 1, <a class="code" href="classoversim_1_1Nice.html#aa31f386f8403d2ba88f43a1a57fcba57">visualizationTimer</a>);

    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;isName(<span class="stringliteral">&quot;heartbeatTimer&quot;</span>)) {

        <a class="code" href="classoversim_1_1Nice.html#a1ffd3a3b39866e51502fee0bf37480f7">sendHeartbeats</a>();
        scheduleAt(simTime() + <a class="code" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">heartbeatInterval</a>, <a class="code" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">heartbeatTimer</a>);

    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;isName(<span class="stringliteral">&quot;maintenanceTimer&quot;</span>)) {

        <a class="code" href="classoversim_1_1Nice.html#a0a808dd35aedab035a7bb8ba1a5d6f9a">maintenance</a>();
        cancelEvent(<a class="code" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">maintenanceTimer</a>);
        scheduleAt(simTime() + <a class="code" href="classoversim_1_1Nice.html#a6d14d42d813222d9ee8c5d395ba60365">maintenanceInterval</a>, <a class="code" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">maintenanceTimer</a>);

    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;isName(<span class="stringliteral">&quot;queryTimer&quot;</span>)) {

        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#a50dd1e20f4c56dc45f9ffa1c52d2716f">numInconsistencies</a>; ++<a class="code" href="classoversim_1_1Nice.html#ac151ea0f3d5ac1d60b32d92c08d89e44">numQueryTimeouts</a>);
        <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a974f1212dc063af0d943b5fa350cc57a">tempResolver</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp;
                (<a class="code" href="classoversim_1_1Nice.html#a974f1212dc063af0d943b5fa350cc57a">tempResolver</a> == <a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a> ||
                 (!<a class="code" href="classoversim_1_1Nice.html#ac00b0f8d11b8f3f7c3e5c2eb78511cc6">polledRendevouzPoint</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a974f1212dc063af0d943b5fa350cc57a">tempResolver</a> == <a class="code" href="classoversim_1_1Nice.html#ac00b0f8d11b8f3f7c3e5c2eb78511cc6">polledRendevouzPoint</a>))) {
            <a class="code" href="classoversim_1_1Nice.html#a6acafcf8008939d12f8db7e002a2ebb5">Query</a>(<a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>, <a class="code" href="classoversim_1_1Nice.html#a46807673c62fb160eaf202a0eac29058">joinLayer</a>);
        }
        <span class="keywordflow">else</span> {
            <a class="code" href="classoversim_1_1Nice.html#a6acafcf8008939d12f8db7e002a2ebb5">Query</a>(<a class="code" href="classoversim_1_1Nice.html#a974f1212dc063af0d943b5fa350cc57a">tempResolver</a>, <a class="code" href="classoversim_1_1Nice.html#a46807673c62fb160eaf202a0eac29058">joinLayer</a>);
        }

    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;isName(<span class="stringliteral">&quot;rpPollTimer&quot;</span>)) {

        <a class="code" href="classoversim_1_1Nice.html#ac1b9865b490cf352d83680020939c270">pollRP</a>(-1);

    }

} <span class="comment">// handleTimerEvent</span>
</pre></div>
</div>
</div>
<a class="anchor" id="aa7b0abef7e007a2a032614cd1e5be597"></a><!-- doxytag: member="oversim::Nice::handleUDPMessage" ref="aa7b0abef7e007a2a032614cd1e5be597" args="(BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::handleUDPMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes messages from underlay. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Message from UDP </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a31d7dd39ddc9e62ad92f69f6d7210344">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00368">368</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="comment">// try message cast to NICE base message</span>
    <span class="keywordflow">if</span> (dynamic_cast&lt;NiceMessage*&gt;(msg) != NULL) {

        <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* niceMsg = check_and_cast&lt;<a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>*&gt;(msg);

        <span class="comment">// First of all, update activity information for sourcenode</span>
        std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(niceMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>());

        <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

            it-&gt;second-&gt;touch();

        }

        <span class="comment">/* Dispatch message, possibly downcasting to a more concrete type */</span>
        <span class="keywordflow">switch</span> (niceMsg-&gt;<a class="code" href="classNiceMessage.html#a3569492f722da94c494a21014e51240f">getCommand</a>()) {

            <span class="comment">/* More concrete types, to which the message is cast if needed */</span>
            <a class="code" href="classNiceMemberMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMemberMessage</a>* queryRspMsg;
            <a class="code" href="classNiceClusterMerge.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceClusterMerge</a>* mergeMsg;
            <a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a>* multicastMsg;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a8d5e84b5d60df22479df8355d6347834">NICE_QUERY</a>:

                <a class="code" href="classoversim_1_1Nice.html#afeb7081be1f7f76b2108aad45c49abfe">handleNiceQuery</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a0ee562452c946bccf6069ac9e42b066e">NICE_QUERY_RESPONSE</a>:

                queryRspMsg = check_and_cast&lt;<a class="code" href="classNiceMemberMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMemberMessage</a>*&gt;(niceMsg);
                <a class="code" href="classoversim_1_1Nice.html#ab36bfc01b3cd042da92e1b27782ce7bd">handleNiceQueryResponse</a>(queryRspMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a6fd9bbfeec6702e13ecfa8ddf57fa018">NICE_JOIN_CLUSTER</a>:

                <a class="code" href="classoversim_1_1Nice.html#a0757be556541e2d8efd235be889f2ab6">handleNiceJoinCluster</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a8bf3ffec79cbd15ef9c801ec8fdcc1db">NICE_POLL_RP</a>:

                <a class="code" href="classoversim_1_1Nice.html#a10494e710344144e515c7e22b83e786c">handleNicePollRp</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7ad1cdc4389204852a40ae4afd7eead55d">NICE_POLL_RP_RESPONSE</a>:

                <a class="code" href="classoversim_1_1Nice.html#a655a94f5f3da35838278419173dda60c">handleNicePollRpResponse</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a47181a7ac5dfe7bb6857323f381abcbe">NICE_HEARTBEAT</a>:

                <a class="code" href="classoversim_1_1Nice.html#a9e789530fee17ed030b474ab2a7b1b18">handleNiceHeartbeat</a>(check_and_cast&lt;NiceHeartbeat*&gt;(niceMsg));

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7acb65ea3a2078e57268ac2cf992483b5c">NICE_LEADERHEARTBEAT</a>:

                <a class="code" href="classoversim_1_1Nice.html#a2946a8a0d8f597e09e5d37659d1e30a1">handleNiceLeaderHeartbeat</a>(check_and_cast&lt;NiceLeaderHeartbeat*&gt;(niceMsg));

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a47c7b847cabda16ec1bb6322d21205ae">NICE_LEADERTRANSFER</a>:

                <a class="code" href="classoversim_1_1Nice.html#a0d13c3965aafab68b912a6dc75c4e9a0">handleNiceLeaderTransfer</a>(check_and_cast&lt;NiceLeaderHeartbeat*&gt;(niceMsg));

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7ad017b8270a2ffd62d28c6b40373dd44d">NICE_JOINEVAL</a>:

                <a class="code" href="classoversim_1_1Nice.html#a32b8406978ad9ab46a7eba786ccf83a2">handleNiceJoineval</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a8b3838507b87b8e45317b057acfc1893">NICE_JOINEVAL_RESPONSE</a>:

                <a class="code" href="classoversim_1_1Nice.html#a90140602613205803d08c25820b94063">handleNiceJoinevalResponse</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7adfb0b796750890c1d47678b130dff498">NICE_REMOVE</a>:

                <a class="code" href="classoversim_1_1Nice.html#a66a02ca915d3e7182580217bde40ccb5">handleNiceRemove</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7adfc4413e72fcd16c342192d3b4a14bcc">NICE_PEER_TEMPORARY</a>:

                <a class="code" href="classoversim_1_1Nice.html#ab6096a998d14db350a8c12780ca62e61">handleNicePeerTemporary</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a2fff14479fab6fd82da4db0029123e0f">NICE_PEER_TEMPORARY_RELEASE</a>:

                <a class="code" href="classoversim_1_1Nice.html#a761b15b9d4124e34084250c79339da27">handleNicePeerTemporaryRelease</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a60eff1ca2a24fa6a5ed193396b3611e9">NICE_PING_PROBE</a>:

                <a class="code" href="classoversim_1_1Nice.html#a45f3d0f25ccf42b10be3717b1e59846b">handleNicePingProbe</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7af507f86ba86f0aea580335c0965b26de">NICE_PING_PROBE_RESPONSE</a>:

                <a class="code" href="classoversim_1_1Nice.html#aa818a9dfa6027388de5281eae926c7c4">handleNicePingProbeResponse</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a90982eabb998b1ee8a19ea9d467a0b8d">NICE_FORCE_MERGE</a>:

                <a class="code" href="classoversim_1_1Nice.html#a8a781cde350bdaed6e8db0d0f36d82c0">handleNiceForceMerge</a>(niceMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a84de84b9a5707c06e307870df2031ce3">NICE_CLUSTER_MERGE_REQUEST</a>:

                mergeMsg = check_and_cast&lt;<a class="code" href="classNiceClusterMerge.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceClusterMerge</a>*&gt;(niceMsg);

                <a class="code" href="classoversim_1_1Nice.html#a133d3f2486a3d5a7c294d3e2d5fa8369">handleNiceClusterMergeRequest</a>(mergeMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">case</span> <a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a55f971433074db5a460d31159d73288c">NICE_MULTICAST</a>:

                multicastMsg = check_and_cast&lt;<a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a>*&gt;(msg);

                <a class="code" href="classoversim_1_1Nice.html#a5ebd8516425fdcc5847e26ce3b08314f">handleNiceMulticast</a>(multicastMsg);

                <span class="keywordflow">break</span>;

            <span class="keywordflow">default</span>:

                <span class="keyword">delete</span> niceMsg;
        }
    }
    <span class="keywordflow">else</span> {
        <span class="keyword">delete</span> msg;
    }
} <span class="comment">// handleUDPMessage</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a63977effde493b185fb9230ec5c2a608"></a><!-- doxytag: member="oversim::Nice::initializeOverlay" ref="a63977effde493b185fb9230ec5c2a608" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::initializeOverlay </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes derived-class-attributes. </p>
<p><br/>
</p>
<p>Initializes derived-class-attributes, called by <a class="el" href="classBaseOverlay.html#a9738ba6065b0f699f1921bbe82ab97be" title="initializes base-class-attributes">BaseOverlay::initialize()</a>. By default this method is called once. If more stages are needed one can overload <a class="el" href="classBaseOverlay.html#a3234dfcf81463984e88a42432734a615" title="Sets init stage.">numInitStages()</a> and add more stages.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a41f88dfbea856a2b38319ff52c758c96">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00122">122</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="comment">/* Because of IPAddressResolver, we need to wait until interfaces</span>
<span class="comment">     * are registered, address auto-assignment takes place etc. */</span>
    <span class="keywordflow">if</span> (stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a58e83c497c7c8495e9c592ff3148b6b9" title="first stage for overlay modules (Tier 0 / KBR)">MIN_STAGE_OVERLAY</a>)
        <span class="keywordflow">return</span>;

    <span class="comment">/* Set appearance of node in visualization */</span>
    getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i&quot;</span>, 0, <span class="stringliteral">&quot;device/pc_vs&quot;</span>);
    getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 0, <span class="stringliteral">&quot;block/circle_vs&quot;</span>);

    <span class="comment">/* Initially clear all clusters */</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>; i++) {

        <span class="keywordflow">for</span> (TaSet::iterator itn = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].begin(); itn != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itn) {
            <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itn);
        }
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#ad66e5cfc867561bef65fcfd43dbc7d13" title="Removes all addresses from cluster, sets leader to unspecified address and sets last lt to 0...">clear</a>();

    }

    <span class="comment">/* Initialize Self-Messages */</span>

    <span class="comment">// Periodic Heartbeat Messages</span>
    <a class="code" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">heartbeatInterval</a> = par(<span class="stringliteral">&quot;heartbeatInterval&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">heartbeatTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;heartbeatTimer&quot;</span>);

    <span class="comment">// Periodic Protocol Maintenance</span>
    <a class="code" href="classoversim_1_1Nice.html#a6d14d42d813222d9ee8c5d395ba60365">maintenanceInterval</a> = par(<span class="stringliteral">&quot;maintenanceInterval&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">maintenanceTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;maintenanceTimer&quot;</span>);

    <a class="code" href="classoversim_1_1Nice.html#a6e3e4cdfa221e6f9980e3c51a5452570">queryInterval</a> = par(<span class="stringliteral">&quot;queryInterval&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#a4648efb65dd8c13990a571c275d3bd04">queryTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;queryTimer&quot;</span>);

    <a class="code" href="classoversim_1_1Nice.html#a4a913c4be6eabc80fac48dffed005771">rpPollTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;rpPollTimer&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#a417d95b2b0bdad377d0613f4dde77b66">rpPollTimerInterval</a> = par(<span class="stringliteral">&quot;rpPollTimerInterval&quot;</span>);

    <a class="code" href="classoversim_1_1Nice.html#abffc50a7507069a0d97997f269c2d130">peerTimeoutHeartbeats</a> = par(<span class="stringliteral">&quot;peerTimeoutHeartbeats&quot;</span>);

    <a class="code" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">pimp</a> = par(<span class="stringliteral">&quot;enhancedMode&quot;</span>);

    <a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a> = <span class="keyword">false</span>;

    <a class="code" href="classoversim_1_1Nice.html#ac00b0f8d11b8f3f7c3e5c2eb78511cc6">polledRendevouzPoint</a> = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;

    <span class="comment">/* DEBUG */</span>
    <a class="code" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">clusterrefinement</a> = par(<span class="stringliteral">&quot;debug_clusterrefinement&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">debug_heartbeats</a> = par(<span class="stringliteral">&quot;debug_heartbeats&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#a1a3aaae38bf78dc32e177868afbde6c7">debug_visualization</a> = par(<span class="stringliteral">&quot;debug_visualization&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">debug_join</a> = par(<span class="stringliteral">&quot;debug_join&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#a6af70b0196fd0d482286c0ff5a46f5ae">debug_peertimeouts</a> = par(<span class="stringliteral">&quot;debug_peertimeouts&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#a12a2bd46343643e35473ab74900db70a">debug_removes</a> = par(<span class="stringliteral">&quot;debug_removes&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a> = par(<span class="stringliteral">&quot;debug_queries&quot;</span>);

    <a class="code" href="classoversim_1_1Nice.html#aa31f386f8403d2ba88f43a1a57fcba57">visualizationTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;visualizationTimer&quot;</span>);

    <span class="comment">/* Read cluster parameter k */</span>
    <a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a> = par(<span class="stringliteral">&quot;k&quot;</span>);

    <a class="code" href="classoversim_1_1Nice.html#a3469d510d59a1cc3577e5d24a6628275">CLUSTERLEADERBOUND</a> = par(<span class="stringliteral">&quot;clusterLeaderBound&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#ad83625b73a292aa04380837e7d6c3944">CLUSTERLEADERCOMPAREDIST</a> = par(<span class="stringliteral">&quot;clusterLeaderCompareDist&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#a4368d509b0c5ac9950cf8fa52fa5f176">SC_PROC_DISTANCE</a> = par(<span class="stringliteral">&quot;scProcDistance&quot;</span>);
    <a class="code" href="classoversim_1_1Nice.html#a02292a0c465a7bbb80f66fbd7187cc9b">SC_MIN_OFFSET</a> = par(<span class="stringliteral">&quot;scMinOffset&quot;</span>);

    <span class="comment">/* Add own node to peerInfos */</span>
    <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);
    pi-&gt;set_distance(0);
    <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>, pi));

    <span class="comment">/* Set evaluation layer to not specified */</span>
    <a class="code" href="classoversim_1_1Nice.html#a71935c17b8b4804bc6dd823d696dbf3e">evalLayer</a> = -1;
    <a class="code" href="classoversim_1_1Nice.html#a46807673c62fb160eaf202a0eac29058">joinLayer</a> = -1;

    <a class="code" href="classoversim_1_1Nice.html#a36ec304efa445340c9c1f72e950b076b">first_leader</a> = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;
    <a class="code" href="classoversim_1_1Nice.html#ad6115b6ca9ae33de7308570d8aaceaf7">second_leader</a> = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;

    <span class="comment">// add some watches</span>
    WATCH(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    <a class="code" href="hashWatch_8h.html#ae5678c8f482eb1afddaea5022e654865" title="Makes pointer_maps inspectable in Tkenv.">WATCH_POINTER_MAP</a>(<a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#a71935c17b8b4804bc6dd823d696dbf3e">evalLayer</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#aa604bd27a4b737fd179c2b09debebc84">query_start</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">heartbeatTimer</a>);
    WATCH_MAP(<a class="code" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">tempPeers</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>);

    WATCH(<a class="code" href="classoversim_1_1Nice.html#a50dd1e20f4c56dc45f9ffa1c52d2716f">numInconsistencies</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#ac151ea0f3d5ac1d60b32d92c08d89e44">numQueryTimeouts</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#a82e217903a688c47656a56dc4a593ebc">numPeerTimeouts</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#a97964c134da4da5b58b3c7dff32a0800">numTempPeerTimeouts</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#acd1effc337560f6677e63608b3e53af8">numStructurePartitions</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#ab0a8837fcffd376b822166d048a401fa">numOwnMessagesReceived</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#a063a91a0c9cbd3bcfeca7ce10944eb70">totalSCMinCompare</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#a765b5d96a57bf709b6a8ce28541d55a6">numJoins</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#ade427df4fbd3edb53e04467984384927">totalForwardBytes</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#ab0165945cd4929e57f66e595ce76cc14">numReceived</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#ab70712e9a475d6ab12690cf36a31ffe1">totalReceivedBytes</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#aed41149eb142ad3c71d6a639b113a5f7">numHeartbeat</a>);
    WATCH(<a class="code" href="classoversim_1_1Nice.html#ad186e77457bdad45888594517319a02b">totalHeartbeatBytes</a>);

} <span class="comment">// initializeOverlay</span>
</pre></div>
</div>
</div>
<a class="anchor" id="af4c42da9d6ab2d8e83a4056bf83dd8ab"></a><!-- doxytag: member="oversim::Nice::JoinCluster" ref="af4c42da9d6ab2d8e83a4056bf83dd8ab" args="(const TransportAddress &amp;leader, short layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::JoinCluster </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>leader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&#160;</td>
          <td class="paramname"><em>layer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01670">1670</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l01506">handleNiceQueryResponse()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">debug_join</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : JoinCluster()&quot;</span> &lt;&lt; endl;

    <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_JOIN_CLUSTER&quot;</span>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a6fd9bbfeec6702e13ecfa8ddf57fa018">NICE_JOIN_CLUSTER</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);
    msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(msg));

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(leader, msg);

    <span class="comment">/* Create peer context to leader */</span>
    <span class="comment">/* Check if peer info already exists */</span>
    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(leader);

    <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) { <span class="comment">/* We already know this node */</span>

    }
    <span class="keywordflow">else</span> { <span class="comment">/* Create PeerInfo object */</span>

        <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>* pi = <span class="keyword">new</span> <a class="code" href="classoversim_1_1Nice.html#a6b71884e13dc73c1a1c81351b031cb64">NicePeerInfo</a>(<span class="keyword">this</span>);

        <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.insert(std::make_pair(leader, pi));

    }

    <span class="comment">/* Locally add thisNode, too */</span>
    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

    <span class="comment">/* Set leader for cluster */</span>
    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(leader);
    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(leader);

    <span class="keywordflow">for</span> (<span class="keywordtype">short</span> i=0; i&lt;<a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>; i++) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize() &gt; 0) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].contains(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {

                getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg
                (<span class="stringliteral">&quot;i2&quot;</span>, 1, <a class="code" href="namespaceoversim.html#a068481bf2793ad703ca213dcca1e4a6f" title="Define colors for layers in visualization.">clustercolors</a>[i]);

            }

        }

    }

    <span class="comment">// If not already running, schedule some timers</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">heartbeatTimer</a>-&gt;isScheduled()) {

        scheduleAt(simTime() + <a class="code" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">heartbeatInterval</a>, <a class="code" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">heartbeatTimer</a>);

    }
    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">maintenanceTimer</a>-&gt;isScheduled()) {

        scheduleAt(simTime() + <a class="code" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">heartbeatInterval</a>, <a class="code" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">maintenanceTimer</a>);

    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#abe5249e886cdb9e6d56efa40e6efe71e">isTempPeered</a>) {

        <span class="comment">// Release temporary peering</span>
        <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_PEER_TEMPORARY_RELEASE&quot;</span>);
        msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a2fff14479fab6fd82da4db0029123e0f">NICE_PEER_TEMPORARY_RELEASE</a>);
        msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(-1);
        msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(msg));

        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>, msg);

        <a class="code" href="classoversim_1_1Nice.html#abe5249e886cdb9e6d56efa40e6efe71e">isTempPeered</a> = <span class="keyword">false</span>;

    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">debug_join</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : JoinCluster() finished.&quot;</span> &lt;&lt; endl;

} <span class="comment">// JoinCluster</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a642dd901f2f5b0561cde5a1c3e932d8e"></a><!-- doxytag: member="oversim::Nice::joinOverlay" ref="a642dd901f2f5b0561cde5a1c3e932d8e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::joinOverlay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Join the overlay with a given nodeID in thisNode.key. </p>
<p>Join the overlay with a given nodeID in thisNode.key. This method may be called by an application to join the overlay with a specific nodeID. It is also called if the node's IP address changes. </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a3eefb56c2396601373c89d21b5b58110">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00230">230</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classoversim_1_1Nice.html#ad1d32ea267badf0b9a482d7c415aa03c" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>);
    <a class="code" href="classoversim_1_1Nice.html#ad1d32ea267badf0b9a482d7c415aa03c" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>);
} <span class="comment">// joinOverlay</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a4b8cc16894616bbe008940eb98775c0d"></a><!-- doxytag: member="oversim::Nice::LeaderTransfer" ref="a4b8cc16894616bbe008940eb98775c0d" args="(int layer, TransportAddress leader, TaSet cluster, TransportAddress sc_leader, TaSet superCluster)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::LeaderTransfer </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td>
          <td class="paramname"><em>leader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a>&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td>
          <td class="paramname"><em>sc_leader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a>&#160;</td>
          <td class="paramname"><em>superCluster</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03135">3135</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l03234">gracefulLeave()</a>, <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l03171">LeaderTransfer()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <a class="code" href="classNiceLeaderHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceLeaderHeartbeat</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceLeaderHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceLeaderHeartbeat</a>(<span class="stringliteral">&quot;NICE_LEADERTRANSFER&quot;</span>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a47c7b847cabda16ec1bb6322d21205ae">NICE_LEADERTRANSFER</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);

    msg-&gt;<a class="code" href="classNiceMemberMessage.html#aa7ae9d6e4a78b2c5493da57bd40748e9">setMembersArraySize</a>(cluster.size());

    <span class="comment">// fill in members</span>
    TaSet::iterator it = cluster.begin();
    <span class="keywordtype">int</span> i = 0;
    <span class="keywordflow">while</span> (it != cluster.end()) {
        msg-&gt;<a class="code" href="classNiceMemberMessage.html#a5aec4bd795065c56c7f95f5075d061b4">setMembers</a>(i++, *it);
        it++;
    }

    <span class="comment">// fill in supercluster members, if existent</span>
    msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a42d0f56c57dd4d37b257e923e27838ce">setSupercluster_leader</a>(sc_leader);

    msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a0709257e24c8dce4f9c23d3874c9ea1b">setSupercluster_membersArraySize</a>(superCluster.size());

    it = superCluster.begin();
    i = 0;
    <span class="keywordflow">while</span> (it != superCluster.end()) {
        msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#ad698e549d637b1489ffbf0b5fb840d4a">setSupercluster_members</a>(i++, *it);
        ++it;
    }

    msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a68ba46ab65eb1c5d2a31572894946444">NICELEADERHEARTBEAT_L</a>(msg));

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(leader, msg);

} <span class="comment">// LeaderTransfer</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a0202754f95c50b2891cfd0f6234c8f81"></a><!-- doxytag: member="oversim::Nice::LeaderTransfer" ref="a0202754f95c50b2891cfd0f6234c8f81" args="(int layer, TransportAddress leader)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::LeaderTransfer </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td>
          <td class="paramname"><em>leader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03171">3171</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].contains(leader));

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {
        opp_error(<span class="stringliteral">&quot;The RendevouzPoint is handing off leadership and the simulation cannot continue. This is a bug in the Nice implementation in OverSim, please check the backtrace and fix it or submit a bug report.&quot;</span>);
    }

    <a class="code" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a> cluster(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].begin(), <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].end());

    <span class="keywordflow">if</span> (layer == <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> - 1)
        <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(layer, leader, cluster, <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>, <a class="code" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a>());
    <span class="keywordflow">else</span>
        <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(layer, leader, cluster, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].getLeader(), <a class="code" href="classoversim_1_1Nice.html#a60d75f363c7edb6f1fd349cac322d99a">TaSet</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer + 1].begin(), <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].end()));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0a808dd35aedab035a7bb8ba1a5d6f9a"></a><!-- doxytag: member="oversim::Nice::maintenance" ref="a0a808dd35aedab035a7bb8ba1a5d6f9a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::maintenance </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02352">2352</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// care for structure connection timer</span>
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {

        EV &lt;&lt; <span class="stringliteral">&quot;No RendevouzPoint! &quot;</span> &lt;&lt; endl;

    }

    <span class="keywordtype">int</span> highestLayer = <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>();
    <span class="keywordtype">bool</span> leaderDied = <span class="keyword">false</span>;
    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer].<a class="code" href="classNiceCluster.html#a6aaac2ce8b950758447e5b11424612fa" title="The leader is &quot;confirmed&quot;, when we can say reasonably sure that all the nodes in the cluster think of...">isLeaderConfirmed</a>();
    <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> newLeader;
    <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> oldLeader = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>();
    <a class="code" href="classoversim_1_1Nice.html#ae1bc183e5411855a2026e884d2d2cee1" title="Cleans the tempPeers map from peers that have timed out, removes timed-out peers in peerInfos and als...">cleanPeers</a>();
    <span class="comment">// Cluster Leader died. Select new. If the old leader is unspecified, then we&#39;re</span>
    <span class="comment">// probably waiting to join the layer.</span>
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer].getLeader().isUnspecified() &amp;&amp; !oldLeader.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        leaderDied = <span class="keyword">true</span>;
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#acd1effc337560f6677e63608b3e53af8">numStructurePartitions</a>; ++<a class="code" href="classoversim_1_1Nice.html#a50dd1e20f4c56dc45f9ffa1c52d2716f">numInconsistencies</a>);
        newLeader = <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer]).first;
    }

    <a class="code" href="classoversim_1_1Nice.html#aed05e40d0f2c58971e6eff74009cbf82" title="Splits clusters if needed.">splitNeeded</a>();
    <a class="code" href="classoversim_1_1Nice.html#a84af41f236c10b5398aa9d63aeab63b1" title="Merges clusters if needed.">mergeNeeded</a>();

    <span class="keywordflow">if</span> (leaderDied &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a> != oldLeader) {
        <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(newLeader);
        <span class="keywordflow">if</span> (newLeader == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer + 1].<a class="code" href="classNiceCluster.html#abf66af103a6767b2c7fbce63bc18ce19" title="Adds address to cluster.">add</a>(newLeader);
            <a class="code" href="classoversim_1_1Nice.html#ad3b7430e484451777e58ea163e4fc049">BasicJoinLayer</a>(highestLayer + 1);
        }
        <span class="keywordflow">else</span> {
            <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(highestLayer, newLeader);
        }
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>() == <a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>()) {
        <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {
            <a class="code" href="classoversim_1_1Nice.html#ac1b9865b490cf352d83680020939c270">pollRP</a>(-1);
            <a class="code" href="classoversim_1_1Nice.html#ad3b7430e484451777e58ea163e4fc049">BasicJoinLayer</a>(<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>() + 1);
        }
    }

    highestLayer = <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>();
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = highestLayer + 1; i &lt; <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>; ++i) {
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize() != 0) {
            EV &lt;&lt; <span class="stringliteral">&quot;Stale data for cluster &quot;</span> &lt;&lt; i &lt;&lt; endl;
            <span class="keywordflow">for</span> (TaSet::iterator itn = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].begin(); itn != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#aed386323e43a572eb51c3e2a97790a6c" title="Returns const iterator to end of cluster.">end</a>(); ++itn) {
                <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(*itn);
            }
            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#ad66e5cfc867561bef65fcfd43dbc7d13" title="Removes all addresses from cluster, sets leader to unspecified address and sets last lt to 0...">clear</a>();
        }
    }

    <span class="comment">// if highest super cluster has more than one member, try to find a closer leader.</span>
    <span class="comment">// However, the Rendevouz Point must can&#39;t move between clusters.</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a> &amp;&amp; highestLayer &lt; maxLayers - 1 &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer + 1].getSize() &gt; 1) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">clusterrefinement</a>)
            EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : Look for better parent node in cluster : &quot;</span> &lt;&lt; highestLayer + 1 &lt;&lt; <span class="stringliteral">&quot; ...&quot;</span>&lt;&lt; endl;

        <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> highestLeader = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>();
        std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it;
        <span class="keywordflow">if</span> (!highestLeader.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
            it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(highestLeader);
        }
        <span class="keywordflow">else</span> {
            it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end();
        }

        <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end() &amp;&amp; it-&gt;second-&gt;get_distance() &gt; 0) {

            <span class="keywordtype">double</span> <a class="code" href="classBaseOverlay.html#aa12314947ef42726ec6c7066dde8d0f9" title="This method should implement the distance between two keys.">distance</a> = it-&gt;second-&gt;get_distance() - ((it-&gt;second-&gt;get_distance()/100.0) * <a class="code" href="classoversim_1_1Nice.html#a4368d509b0c5ac9950cf8fa52fa5f176">SC_PROC_DISTANCE</a>);

            <span class="keywordtype">double</span> smallest = 10000.0;
            <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> candidate = <a class="code" href="classTransportAddress.html#ac1709545db722cbbce1367034142d31f" title="TransportAddress without specified ip and port.">TransportAddress::UNSPECIFIED_NODE</a>;

            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer+1].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); i++) {

                <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer+1].<span class="keyword">get</span>(i) != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>()) {

                    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it2 = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[highestLayer+1].<span class="keyword">get</span>(i));

                    <span class="keywordflow">if</span> (it2 != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                        <span class="keywordflow">if</span> ((it2-&gt;second-&gt;get_distance() &lt; smallest) &amp;&amp; (it2-&gt;second-&gt;get_distance() &gt; 0)) {
                            smallest = it2-&gt;second-&gt;get_distance();
                            candidate = it2-&gt;first;
                        }

                    }

                }

            }

            std::set&lt;TransportAddress&gt; clusterset;

            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()+1].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); m++) {

                clusterset.insert(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()+1].<span class="keyword">get</span>(m));

            }

            simtime_t meanDistance = <a class="code" href="classoversim_1_1Nice.html#af6e0621edd3122f917e428d133a0a732">getMeanDistance</a>(clusterset);

            simtime_t minCompare = (meanDistance/100.0)*<a class="code" href="classoversim_1_1Nice.html#a02292a0c465a7bbb80f66fbd7187cc9b">SC_MIN_OFFSET</a>;

            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classoversim_1_1Nice.html#a063a91a0c9cbd3bcfeca7ce10944eb70">totalSCMinCompare</a> += minCompare.dbl());

            <span class="keywordflow">if</span> (minCompare &lt; 0.005)
                minCompare = 0.005;

            <span class="keywordflow">if</span> ((smallest &lt; distance) &amp;&amp; ((distance - smallest) &gt; minCompare.dbl())) { <span class="comment">// change supercluster</span>


                <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">clusterrefinement</a>) {
                    EV &lt;&lt; simTime() &lt;&lt;<span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot;: Change SuperCluster! to &quot;</span> &lt;&lt; candidate.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; endl;
                    EV &lt;&lt; <span class="stringliteral">&quot;Old distance ():  &quot;</span> &lt;&lt; it-&gt;second-&gt;get_distance() &lt;&lt; endl;
                    EV &lt;&lt; <span class="stringliteral">&quot;SC_PROC_DISTANCE:  &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a4368d509b0c5ac9950cf8fa52fa5f176">SC_PROC_DISTANCE</a> &lt;&lt; endl;
                    EV &lt;&lt; <span class="stringliteral">&quot;Compare distance:  &quot;</span> &lt;&lt; distance &lt;&lt; endl;
                    EV &lt;&lt; <span class="stringliteral">&quot;New distance:  &quot;</span> &lt;&lt; smallest &lt;&lt; endl;
                    EV &lt;&lt; <span class="stringliteral">&quot;New SC_MIN_OFFSET:  &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a02292a0c465a7bbb80f66fbd7187cc9b">SC_MIN_OFFSET</a> &lt;&lt; endl;
                }

                <span class="comment">// leave old</span>
                <a class="code" href="classoversim_1_1Nice.html#a546c8b69ae759d24e9b809deb1d75398">Remove</a>(highestLayer);

                <span class="comment">// join new</span>
                <a class="code" href="classoversim_1_1Nice.html#af4c42da9d6ab2d8e83a4056bf83dd8ab">JoinCluster</a>(candidate, highestLayer);

                <span class="keywordflow">return</span>;

            }
        }
        <span class="keywordflow">else</span> {

            <span class="comment">//Do nothing</span>

        }

    }

    <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {

        <span class="comment">// Try to find better leader.</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = <a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>(); i &gt;= 0; i--) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize() &gt; 1 &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].isLeaderConfirmed()) {

                <span class="keywordtype">bool</span> allDistancesKnown = <span class="keyword">true</span>;

                <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">clusterrefinement</a>)
                    EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : Find better cluster leader in ...&quot;</span> &lt;&lt; i &lt;&lt; endl;

                <span class="comment">/* Only make decisions if node has total distance knowledge in this cluster */</span>
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>() &amp;&amp; allDistancesKnown; j++) {

                    <span class="comment">/* Check if peer info already exists */</span>
                    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j));

                    <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                        simtime_t distance = it-&gt;second-&gt;get_distance();

                        <span class="comment">//EV &lt;&lt; &quot;My distance to &quot; &lt;&lt; it-&gt;first &lt;&lt; &quot; : &quot; &lt;&lt; distance &lt;&lt; endl;</span>

                        <span class="keywordflow">if</span> (distance &lt; 0) {
                            allDistancesKnown = <span class="keyword">false</span>;
                            <span class="keywordflow">continue</span>;
                        }

                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a> = 0; <a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a> &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); <a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a>++) {

                            <span class="keywordflow">if</span> ((it-&gt;first != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) &amp;&amp; (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(<a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a>) != it-&gt;first)) {

                                <span class="keywordflow">if</span> (it-&gt;second-&gt;getDistanceTo(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(<a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a>)) &lt; 0) {
                                    allDistancesKnown = <span class="keyword">false</span>;
                                    <span class="keywordflow">break</span>;
                                }
                            }

                        }

                    }
                    <span class="keywordflow">else</span> {

                        allDistancesKnown = <span class="keyword">false</span>;

                    }

                }

                <span class="keywordflow">if</span> (allDistancesKnown) {

                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">clusterrefinement</a>)
                        EV &lt;&lt; <span class="stringliteral">&quot;Complete distance knowledge available.&quot;</span> &lt;&lt; endl;

                    <span class="comment">// Perform check for better cluster leader</span>
                    <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> new_leader = <a class="code" href="classoversim_1_1Nice.html#ab103d070590546c820b57f2a087955ed">findCenter</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i]).first;

                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">clusterrefinement</a>)
                        EV &lt;&lt; <span class="stringliteral">&quot;NEW LEADER laut &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; new_leader.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; endl;

                    std::set&lt;TransportAddress&gt; clusterset;

                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); m++) {

                        clusterset.insert(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(m));

                    }


                    simtime_t meanDistance = <a class="code" href="classoversim_1_1Nice.html#af6e0621edd3122f917e428d133a0a732">getMeanDistance</a>(clusterset);
                    simtime_t oldDistance = <a class="code" href="classoversim_1_1Nice.html#ad87e45d16986960bf34ce49f236e1d52">getMaxDistance</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getLeader(), clusterset);
                    simtime_t newDistance = <a class="code" href="classoversim_1_1Nice.html#ad87e45d16986960bf34ce49f236e1d52">getMaxDistance</a>(new_leader, clusterset);
                    simtime_t compareDistance = (oldDistance - ((oldDistance/100.0)*<a class="code" href="classoversim_1_1Nice.html#ad83625b73a292aa04380837e7d6c3944">CLUSTERLEADERCOMPAREDIST</a>));

                    simtime_t minCompare = (meanDistance/100.0)*<a class="code" href="classoversim_1_1Nice.html#a3469d510d59a1cc3577e5d24a6628275">CLUSTERLEADERBOUND</a>;

                    <span class="keywordflow">if</span> (minCompare &lt; 0.005)
                        minCompare = 0.005;

                    <span class="keywordflow">if</span> ((newDistance.dbl() &lt; compareDistance.dbl()) &amp;&amp; ((compareDistance.dbl() - newDistance.dbl()) &gt; minCompare.dbl())) {

                        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">clusterrefinement</a>)
                            EV &lt;&lt; <span class="stringliteral">&quot;CHANGE &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#ad83625b73a292aa04380837e7d6c3944">CLUSTERLEADERCOMPAREDIST</a> &lt;&lt; endl;

                        <span class="keywordflow">if</span> (new_leader != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

                            <span class="comment">// Set new leader for this cluster</span>
                            <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a1e05f1adaf751ab276de29c3eb8fbe56" title="Set leader to given address.">setLeader</a>(new_leader);

                            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                                <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j));

                            }

                            <a class="code" href="classoversim_1_1Nice.html#af48af4ac315203b552f1eecd1678689c">gracefulLeave</a>(i);
                            <a class="code" href="classoversim_1_1Nice.html#a4b8cc16894616bbe008940eb98775c0d">LeaderTransfer</a>(i, new_leader);

                            getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 0, <span class="stringliteral">&quot;block/circle_vs&quot;</span>);

                        }

                    }

                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">clusterrefinement</a>) {
                        EV &lt;&lt; <span class="stringliteral">&quot;MaxDistance &quot;</span> &lt;&lt; new_leader.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#ad87e45d16986960bf34ce49f236e1d52">getMaxDistance</a>(new_leader, clusterset) &lt;&lt; endl;
                        EV &lt;&lt; <span class="stringliteral">&quot;MaxDistance &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#ad87e45d16986960bf34ce49f236e1d52">getMaxDistance</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getLeader(), clusterset) &lt;&lt; endl;
                        EV &lt;&lt; <span class="stringliteral">&quot;MaxDistance &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#ad87e45d16986960bf34ce49f236e1d52">getMaxDistance</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>, clusterset) &lt;&lt; endl;
                    }


                }

            } <span class="comment">// if cluster i has other members</span>

        } <span class="comment">// for i from highest leader layer to 0</span>

    } <span class="comment">// if this is not the rendevouz point</span>

} <span class="comment">// maintenance</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a84af41f236c10b5398aa9d63aeab63b1"></a><!-- doxytag: member="oversim::Nice::mergeNeeded" ref="a84af41f236c10b5398aa9d63aeab63b1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool oversim::Nice::mergeNeeded </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Merges clusters if needed. </p>
<p>mergeNeeded</p>
<p>Returns true if a merge was made, false otherwise. </p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02229">2229</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {
        <span class="comment">// The Rendevouz Point can&#39;t initiate a merge, since that would</span>
        <span class="comment">// compromise its status as a Rendevouz Point.</span>
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// The layer at which we must merge</span>
    <span class="keywordtype">int</span> mergeLayer;
    <span class="keywordtype">int</span> highestLeaderLayer = <a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>();

    <span class="comment">// Find lowest layer that needs merging.</span>
    <span class="comment">// The node will disappear from all higher layers.</span>
    <span class="keywordflow">for</span> (mergeLayer= 0; mergeLayer &lt;= highestLeaderLayer &amp;&amp; mergeLayer &lt; <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> - 1; ++mergeLayer) {
        <span class="comment">/* Do not attempt merging if we&#39;re not sure we belong as leader */</span>
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[mergeLayer].getSize() &lt; <a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a> &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[mergeLayer].isLeaderConfirmed() &amp;&amp;
                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[mergeLayer + 1].isLeaderConfirmed()) {
            <a class="code" href="classoversim_1_1Nice.html#ad4f8cc3855e672b84d2a097bd60c0925">ClusterMerge</a>(mergeLayer);

            <span class="comment">// The merge may fail, check if it did.</span>
            <span class="comment">// If it really did, we should try to see if there&#39;s some other layer that we may merge.</span>
            <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[mergeLayer + 1].contains(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }
        }
    }

    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac1b9865b490cf352d83680020939c270"></a><!-- doxytag: member="oversim::Nice::pollRP" ref="ac1b9865b490cf352d83680020939c270" args="(int layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::pollRP </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03467">3467</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : pollRP()&quot;</span> &lt;&lt; endl;

    <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_POLL_RP&quot;</span>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a8bf3ffec79cbd15ef9c801ec8fdcc1db">NICE_POLL_RP</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);
    msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(msg));

    cancelEvent(<a class="code" href="classoversim_1_1Nice.html#a4a913c4be6eabc80fac48dffed005771">rpPollTimer</a>);
    scheduleAt(simTime() + <a class="code" href="classoversim_1_1Nice.html#a417d95b2b0bdad377d0613f4dde77b66">rpPollTimerInterval</a>, <a class="code" href="classoversim_1_1Nice.html#a4a913c4be6eabc80fac48dffed005771">rpPollTimer</a>);

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>, msg);

    <a class="code" href="classoversim_1_1Nice.html#ac00b0f8d11b8f3f7c3e5c2eb78511cc6">polledRendevouzPoint</a> = <a class="code" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">RendevouzPoint</a>;

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : pollRP() finished.&quot;</span> &lt;&lt; endl;

} <span class="comment">// pollRP</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a6acafcf8008939d12f8db7e002a2ebb5"></a><!-- doxytag: member="oversim::Nice::Query" ref="a6acafcf8008939d12f8db7e002a2ebb5" args="(const TransportAddress &amp;node, short layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::Query </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short&#160;</td>
          <td class="paramname"><em>layer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l00594">594</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00555">BasicJoinLayer()</a>, <a class="el" href="Nice_8cc_source.html#l01362">handleNiceJoinevalResponse()</a>, <a class="el" href="Nice_8cc_source.html#l01506">handleNiceQueryResponse()</a>, and <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : Query()&quot;</span> &lt;&lt; endl;


    <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_QUERY&quot;</span>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a8d5e84b5d60df22479df8355d6347834">NICE_QUERY</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);
    msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(msg));

    <a class="code" href="classoversim_1_1Nice.html#aa604bd27a4b737fd179c2b09debebc84">query_start</a> = simTime();
    <a class="code" href="classoversim_1_1Nice.html#a974f1212dc063af0d943b5fa350cc57a">tempResolver</a> = destination;

    cancelEvent(<a class="code" href="classoversim_1_1Nice.html#a4648efb65dd8c13990a571c275d3bd04">queryTimer</a>);
    scheduleAt(simTime() + <a class="code" href="classoversim_1_1Nice.html#a6e3e4cdfa221e6f9980e3c51a5452570">queryInterval</a>, <a class="code" href="classoversim_1_1Nice.html#a4648efb65dd8c13990a571c275d3bd04">queryTimer</a>);

    <a class="code" href="classoversim_1_1Nice.html#a46807673c62fb160eaf202a0eac29058">joinLayer</a> = layer;

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(destination, msg);

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">debug_queries</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : Query() finished.&quot;</span> &lt;&lt; endl;

} <span class="comment">// Query</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a546c8b69ae759d24e9b809deb1d75398"></a><!-- doxytag: member="oversim::Nice::Remove" ref="a546c8b69ae759d24e9b809deb1d75398" args="(int layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::Remove </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03190">3190</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l03234">gracefulLeave()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a12a2bd46343643e35473ab74900db70a">debug_removes</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : Remove()&quot;</span> &lt;&lt; endl;

    <span class="keywordtype">int</span> highestLayer = <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>();
    ASSERT(layer &lt;= highestLayer);

    <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_REMOVE&quot;</span>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7adfb0b796750890c1d47678b130dff498">NICE_REMOVE</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);

    msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(msg));

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader(), msg);

    <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a9d03dd60f2ac8c6e64e159b8fd39982c" title="Removes address from cluster.">remove</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

    <span class="keywordflow">for</span> (<span class="keywordtype">short</span> i=0; i&lt;<a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>; i++) {

        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize() &gt; 0) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].contains(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {

                getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg
                (<span class="stringliteral">&quot;i2&quot;</span>, 1, <a class="code" href="namespaceoversim.html#a068481bf2793ad703ca213dcca1e4a6f" title="Define colors for layers in visualization.">clustercolors</a>[i]);

            }

        }

    }

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a12a2bd46343643e35473ab74900db70a">debug_removes</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : Remove() finished.&quot;</span> &lt;&lt; endl;


} <span class="comment">// Remove</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a92c3a3c37c9c3101ac2e51ab609c4c64"></a><!-- doxytag: member="oversim::Nice::sendDataToOverlay" ref="a92c3a3c37c9c3101ac2e51ab609c4c64" args="(NiceMulticastMessage *appMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::sendDataToOverlay </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNiceMulticastMessage.html">NiceMulticastMessage</a> *&#160;</td>
          <td class="paramname"><em>appMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03365">3365</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l03300">handleAppMessage()</a>, and <a class="el" href="Nice_8cc_source.html#l01385">handleNiceMulticast()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> layer=0; layer &lt;= <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>(); layer++) {

        <span class="keywordflow">if</span> ( appMsg-&gt;<a class="code" href="classNiceMessage.html#abad7afc5c784b3d48193da8b7e9c11eb">getLayer</a>() != layer ) {

            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                <span class="keywordflow">if</span> (!(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].contains(appMsg-&gt;<a class="code" href="classNiceMulticastMessage.html#a24f21e29d178a8691398b184c87efcb3">getLastHop</a>())) || appMsg-&gt;<a class="code" href="classNiceMessage.html#aecd3c064af0f390ca24b0364f8490e36">getSrcNode</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

                    <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; member = <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(j);

                    <span class="keywordflow">if</span> (!(member == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {

                        <a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a>* dup = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a>*<span class="keyword">&gt;</span>(appMsg-&gt;<a class="code" href="classNiceMulticastMessage.html#aaba4eefdbfdf69697d76240b5c918470">dup</a>());

                        dup-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>( layer );
                        dup-&gt;<a class="code" href="classNiceMulticastMessage.html#af18a67f43fa20742d1e1b5e3667ae704">setLastHop</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

                        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(member, dup);

                    }

                }

            } <span class="comment">// for</span>

        }

    }

    <span class="comment">// Also forward data to temporary peers</span>
    std::map&lt;TransportAddress, simtime_t&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">tempPeers</a>.begin();

    <span class="keywordflow">while</span> (it != <a class="code" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">tempPeers</a>.end()) {

        <a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a>* dup = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMulticastMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMulticastMessage</a>*<span class="keyword">&gt;</span>(appMsg-&gt;<a class="code" href="classNiceMulticastMessage.html#aaba4eefdbfdf69697d76240b5c918470">dup</a>());

        dup-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(it-&gt;first, dup);

        it++;

    }

    <span class="keyword">delete</span> appMsg;

} <span class="comment">// sendDataToOverlay</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a1ffd3a3b39866e51502fee0bf37480f7"></a><!-- doxytag: member="oversim::Nice::sendHeartbeats" ref="a1ffd3a3b39866e51502fee0bf37480f7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::sendHeartbeats </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01757">1757</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l00755">handleNiceClusterMergeRequest()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, and <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="comment">/* Go through all cluster layers from top to bottom */</span>

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>(); i &gt;= 0; i--) {

        <span class="comment">/* Determine if node is cluster leader in this layer */</span>
        <span class="keywordflow">if</span> (!<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getLeader().isUnspecified()) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getLeader() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a33ebaaa6d22be0dbce87337ec52742b8" title="Confirm that we&#39;re sure that our leader information is correct.">confirmLeader</a>();

                <span class="comment">/* Build heartbeat message with info on all current members */</span>
                <a class="code" href="classNiceLeaderHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceLeaderHeartbeat</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceLeaderHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceLeaderHeartbeat</a>(<span class="stringliteral">&quot;NICE_LEADERHEARTBEAT&quot;</span>);
                msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
                msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7acb65ea3a2078e57268ac2cf992483b5c">NICE_LEADERHEARTBEAT</a>);
                msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(i);
                msg-&gt;<a class="code" href="classNiceHeartbeat.html#ad94dec2e5e4c00a4cd443ae6cdc6c515">setOne_hop_distance</a>(simTime().dbl());
                msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a941b94806e831ab9f9cb5144f9a85eb0">setK</a>(<a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a>);
                msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a94b4e15347aca0e4af0ce23fb7021ec6">setSc_tolerance</a>(<a class="code" href="classoversim_1_1Nice.html#a4368d509b0c5ac9950cf8fa52fa5f176">SC_PROC_DISTANCE</a>);

                msg-&gt;<a class="code" href="classNiceMemberMessage.html#aa7ae9d6e4a78b2c5493da57bd40748e9">setMembersArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize());

                <span class="comment">/* Fill in members */</span>
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                    msg-&gt;<a class="code" href="classNiceMemberMessage.html#a5aec4bd795065c56c7f95f5075d061b4">setMembers</a>(j, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j));

                }

                <span class="comment">/* Fill in distances to members */</span>
                msg-&gt;<a class="code" href="classNiceHeartbeat.html#aad6d2b8cff33bee09f5872e0d5424d6d">setDistancesArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize());

                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j));

                    <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                        msg-&gt;<a class="code" href="classNiceHeartbeat.html#a05173657a49d444dbd5596cbbe4c079e">setDistances</a>(j, it-&gt;second-&gt;get_distance());

                    }
                    <span class="keywordflow">else</span> {

                        msg-&gt;<a class="code" href="classNiceHeartbeat.html#a05173657a49d444dbd5596cbbe4c079e">setDistances</a>(j, -1);

                    }

                }

                <span class="comment">/* Fill in Supercluster members, if existent */</span>
                <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i+1].getSize() &gt; 0) {

                    msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a42d0f56c57dd4d37b257e923e27838ce">setSupercluster_leader</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i+1].getLeader());

                    msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a0709257e24c8dce4f9c23d3874c9ea1b">setSupercluster_membersArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i+1].getSize());

                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i+1].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                        msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#ad698e549d637b1489ffbf0b5fb840d4a">setSupercluster_members</a>(j, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i+1].<span class="keyword">get</span>(j));

                    }

                }

                <span class="comment">/* Send Heartbeat to all members in cluster, except me */</span>
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j) != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

                        <a class="code" href="classNiceLeaderHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceLeaderHeartbeat</a> *copy = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceLeaderHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceLeaderHeartbeat</a>*<span class="keyword">&gt;</span>(msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a755aef8896ea6ad905e156cd43fa46eb">dup</a>());

                        <span class="comment">/* Get corresponding sequence numbers out of peerInfo */</span>
                        std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j));

                        <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seqNo = it-&gt;second-&gt;get_last_sent_HB();

                            copy-&gt;<a class="code" href="classNiceHeartbeat.html#a643a493c5206dbc97ac26366251fee57">setSeqNo</a>(++seqNo);

                            it-&gt;second-&gt;set_backHB(it-&gt;second-&gt;get_backHBPointer(), seqNo, simTime().dbl());
                            it-&gt;second-&gt;set_last_sent_HB(seqNo);
                            it-&gt;second-&gt;set_backHBPointer(!it-&gt;second-&gt;get_backHBPointer());

                            copy-&gt;<a class="code" href="classNiceHeartbeat.html#a3913805b1742726111c1818f4a5924ee">setSeqRspNo</a>(it-&gt;second-&gt;get_last_recv_HB());

                            <span class="keywordflow">if</span> (it-&gt;second-&gt;get_last_HB_arrival() &gt; 0) {

                                copy-&gt;<a class="code" href="classNiceHeartbeat.html#ae087f2c105db3e2d5648cfe2298e105c">setHb_delay</a>(simTime().dbl() - it-&gt;second-&gt;get_last_HB_arrival());

                            }
                            <span class="keywordflow">else</span> {

                                copy-&gt;<a class="code" href="classNiceHeartbeat.html#ae087f2c105db3e2d5648cfe2298e105c">setHb_delay</a>(0.0);

                            }

                        }

                        copy-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a68ba46ab65eb1c5d2a31572894946444">NICELEADERHEARTBEAT_L</a>(msg));

                        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#aed41149eb142ad3c71d6a639b113a5f7">numHeartbeat</a>; <a class="code" href="classoversim_1_1Nice.html#ad186e77457bdad45888594517319a02b">totalHeartbeatBytes</a> += copy-&gt;getByteLength());

                        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j), copy);

                    }

                }

                <span class="keyword">delete</span> msg;

            }
            <span class="keywordflow">else</span> { <span class="comment">// I am normal cluster member</span>

                <span class="comment">/* Build heartbeat message with info on all current members */</span>
                <a class="code" href="classNiceHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceHeartbeat</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceHeartbeat</a>(<span class="stringliteral">&quot;NICE_HEARTBEAT&quot;</span>);
                msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
                msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a47181a7ac5dfe7bb6857323f381abcbe">NICE_HEARTBEAT</a>);
                msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(i);
                msg-&gt;<a class="code" href="classNiceHeartbeat.html#ad94dec2e5e4c00a4cd443ae6cdc6c515">setOne_hop_distance</a>(simTime().dbl());

                msg-&gt;<a class="code" href="classNiceHeartbeat.html#a3ad3c123ec3441b8f01059158057c366">setSublayermembers</a>(0);
                <span class="keywordflow">if</span> (i&gt;0) {
                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i-1].getLeader() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)
                        msg-&gt;<a class="code" href="classNiceHeartbeat.html#a3ad3c123ec3441b8f01059158057c366">setSublayermembers</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i-1].getSize());

                }

                msg-&gt;<a class="code" href="classNiceMemberMessage.html#aa7ae9d6e4a78b2c5493da57bd40748e9">setMembersArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize());

                <span class="comment">/* Fill in members */</span>
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                    msg-&gt;<a class="code" href="classNiceMemberMessage.html#a5aec4bd795065c56c7f95f5075d061b4">setMembers</a>(j, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j));

                }

                <span class="comment">/* Fill in distances to members */</span>
                msg-&gt;<a class="code" href="classNiceHeartbeat.html#aad6d2b8cff33bee09f5872e0d5424d6d">setDistancesArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize());

                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                    std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j));

                    <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                        msg-&gt;<a class="code" href="classNiceHeartbeat.html#a05173657a49d444dbd5596cbbe4c079e">setDistances</a>(j, it-&gt;second-&gt;get_distance());

                    }
                    <span class="keywordflow">else</span> {

                        msg-&gt;<a class="code" href="classNiceHeartbeat.html#a05173657a49d444dbd5596cbbe4c079e">setDistances</a>(j, -1);

                    }

                }

                <span class="comment">/* Send Heartbeat to all members in cluster, except me */</span>
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j) != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

                        <a class="code" href="classNiceHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceHeartbeat</a> *copy = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceHeartbeat</a>*<span class="keyword">&gt;</span>(msg-&gt;<a class="code" href="classNiceHeartbeat.html#a4e40700a0c15a866ad68dd0fb26b957e">dup</a>());

                        <span class="comment">/* Get corresponding sequence number out of peerInfo */</span>
                        std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j));

                        <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seqNo = it-&gt;second-&gt;get_last_sent_HB();

                            copy-&gt;<a class="code" href="classNiceHeartbeat.html#a643a493c5206dbc97ac26366251fee57">setSeqNo</a>(++seqNo);

                            it-&gt;second-&gt;set_backHB(it-&gt;second-&gt;get_backHBPointer(), seqNo, simTime().dbl());
                            it-&gt;second-&gt;set_backHBPointer(!it-&gt;second-&gt;get_backHBPointer());
                            it-&gt;second-&gt;set_last_sent_HB(seqNo);

                            copy-&gt;<a class="code" href="classNiceHeartbeat.html#a3913805b1742726111c1818f4a5924ee">setSeqRspNo</a>(it-&gt;second-&gt;get_last_recv_HB());

                            copy-&gt;<a class="code" href="classNiceHeartbeat.html#ae087f2c105db3e2d5648cfe2298e105c">setHb_delay</a>(simTime().dbl() - it-&gt;second-&gt;get_last_HB_arrival());

                        }

                        copy-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#ac9e73e65df01f2d7440ba59ff847f831">NICEHEARTBEAT_L</a>(msg));

                        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#aed41149eb142ad3c71d6a639b113a5f7">numHeartbeat</a>; <a class="code" href="classoversim_1_1Nice.html#ad186e77457bdad45888594517319a02b">totalHeartbeatBytes</a> += copy-&gt;getByteLength());

                        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j), copy);

                    }

                }

                <span class="keyword">delete</span> msg;

            }
        }

    }

    <span class="comment">// Additionally, ping all supercluster members, if existent</span>
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()+1].getSize() &gt; 0 &amp;&amp; !<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()].getLeader().isUnspecified()) {

        <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_PING_PROBE&quot;</span>);
        msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a60eff1ca2a24fa6a5ed193396b3611e9">NICE_PING_PROBE</a>);
        msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()+1);

        msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(msg));

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()+1].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); i++) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()+1].<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(i) != <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>()) {

                <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* dup = <span class="keyword">static_cast&lt;</span><a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>*<span class="keyword">&gt;</span>(msg-&gt;<a class="code" href="classNiceMessage.html#a68d57e786b6a43f8f18f6c899eebd50e">dup</a>());

                <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()+1].<span class="keyword">get</span>(i), dup);

                std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()+1].<span class="keyword">get</span>(i));

                <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                    it-&gt;second-&gt;set_distance_estimation_start(simTime().dbl());

                }

            }

        }

        <span class="keyword">delete</span> msg;

    }

} <span class="comment">// sendHeartbeats</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a677d8c691996974f3abb040578279669"></a><!-- doxytag: member="oversim::Nice::sendHeartbeatTo" ref="a677d8c691996974f3abb040578279669" args="(const TransportAddress &amp;node, int layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::sendHeartbeatTo </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l01999">1999</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01282">handleNiceJoinCluster()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getLeader() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

        <span class="comment">/* Build heartbeat message with info on all current members */</span>
        <a class="code" href="classNiceLeaderHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceLeaderHeartbeat</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceLeaderHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceLeaderHeartbeat</a>(<span class="stringliteral">&quot;NICE_LEADERHEARTBEAT&quot;</span>);
        msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7acb65ea3a2078e57268ac2cf992483b5c">NICE_LEADERHEARTBEAT</a>);
        msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);

        msg-&gt;<a class="code" href="classNiceMemberMessage.html#aa7ae9d6e4a78b2c5493da57bd40748e9">setMembersArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getSize());

        <span class="comment">/* Fill in members */</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

            msg-&gt;<a class="code" href="classNiceMemberMessage.html#a5aec4bd795065c56c7f95f5075d061b4">setMembers</a>(j, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<span class="keyword">get</span>(j));

        }

        <span class="comment">/* Fill in distances to members */</span>
        msg-&gt;<a class="code" href="classNiceHeartbeat.html#aad6d2b8cff33bee09f5872e0d5424d6d">setDistancesArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getSize());

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

            std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<span class="keyword">get</span>(j));

            <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                msg-&gt;<a class="code" href="classNiceHeartbeat.html#a05173657a49d444dbd5596cbbe4c079e">setDistances</a>(j, it-&gt;second-&gt;get_distance());

            }
            <span class="keywordflow">else</span> {

                msg-&gt;<a class="code" href="classNiceHeartbeat.html#a05173657a49d444dbd5596cbbe4c079e">setDistances</a>(j, -1);

            }

        }

        <span class="comment">/* Fill in Supercluster members, if existent */</span>
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].getSize() &gt; 0) {

            msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a42d0f56c57dd4d37b257e923e27838ce">setSupercluster_leader</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].getLeader());

            msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#a0709257e24c8dce4f9c23d3874c9ea1b">setSupercluster_membersArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].getSize());

            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

                msg-&gt;<a class="code" href="classNiceLeaderHeartbeat.html#ad698e549d637b1489ffbf0b5fb840d4a">setSupercluster_members</a>(j, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer+1].<span class="keyword">get</span>(j));

            }

        }

        <span class="comment">/* Get corresponding sequence numbers out of peerInfo */</span>
        std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(node);

        <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seqNo = it-&gt;second-&gt;get_last_sent_HB();

            msg-&gt;<a class="code" href="classNiceHeartbeat.html#a643a493c5206dbc97ac26366251fee57">setSeqNo</a>(++seqNo);

            it-&gt;second-&gt;set_backHB(it-&gt;second-&gt;get_backHBPointer(), seqNo, simTime().dbl());
            it-&gt;second-&gt;set_last_sent_HB(seqNo);
            it-&gt;second-&gt;set_backHBPointer(!it-&gt;second-&gt;get_backHBPointer());

            msg-&gt;<a class="code" href="classNiceHeartbeat.html#a3913805b1742726111c1818f4a5924ee">setSeqRspNo</a>(it-&gt;second-&gt;get_last_recv_HB());

            msg-&gt;<a class="code" href="classNiceHeartbeat.html#ae087f2c105db3e2d5648cfe2298e105c">setHb_delay</a>(simTime().dbl() - it-&gt;second-&gt;get_last_HB_arrival());

        }

        msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a68ba46ab65eb1c5d2a31572894946444">NICELEADERHEARTBEAT_L</a>(msg));

        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#aed41149eb142ad3c71d6a639b113a5f7">numHeartbeat</a>; <a class="code" href="classoversim_1_1Nice.html#ad186e77457bdad45888594517319a02b">totalHeartbeatBytes</a> += msg-&gt;getByteLength());

        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(node, msg);

    }
    <span class="keywordflow">else</span> {

        <span class="comment">// build heartbeat message with info on all current members</span>
        <a class="code" href="classNiceHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceHeartbeat</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceHeartbeat.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceHeartbeat</a>(<span class="stringliteral">&quot;NICE_HEARTBEAT&quot;</span>);
        msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7a47181a7ac5dfe7bb6857323f381abcbe">NICE_HEARTBEAT</a>);
        msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);

        msg-&gt;<a class="code" href="classNiceMemberMessage.html#aa7ae9d6e4a78b2c5493da57bd40748e9">setMembersArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getSize());

        <span class="comment">// fill in members</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

            msg-&gt;<a class="code" href="classNiceMemberMessage.html#a5aec4bd795065c56c7f95f5075d061b4">setMembers</a>(j, <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<span class="keyword">get</span>(j));

        }

        <span class="comment">// fill in distances to members</span>
        msg-&gt;<a class="code" href="classNiceHeartbeat.html#aad6d2b8cff33bee09f5872e0d5424d6d">setDistancesArraySize</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].getSize());

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>(); j++) {

            std::map&lt;TransportAddress, NicePeerInfo*&gt;::iterator it = <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.find(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<span class="keyword">get</span>(j));

            <span class="keywordflow">if</span> (it != <a class="code" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">peerInfos</a>.end()) {

                msg-&gt;<a class="code" href="classNiceHeartbeat.html#a05173657a49d444dbd5596cbbe4c079e">setDistances</a>(j, it-&gt;second-&gt;get_distance());

            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[layer].<span class="keyword">get</span>(j) == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

                msg-&gt;<a class="code" href="classNiceHeartbeat.html#a05173657a49d444dbd5596cbbe4c079e">setDistances</a>(j, 0);

            }
            <span class="keywordflow">else</span> {

                msg-&gt;<a class="code" href="classNiceHeartbeat.html#a05173657a49d444dbd5596cbbe4c079e">setDistances</a>(j, -1);

            }

        }

        msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#ac9e73e65df01f2d7440ba59ff847f831">NICEHEARTBEAT_L</a>(msg));

        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classoversim_1_1Nice.html#aed41149eb142ad3c71d6a639b113a5f7">numHeartbeat</a>; totalHeartbeatBytes += msg-&gt;getByteLength());

        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(node, msg);

    }

} <span class="comment">// sendHeartbeatTo</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a70a802eb31e3c0047413fa08864986bf"></a><!-- doxytag: member="oversim::Nice::sendRemoveTo" ref="a70a802eb31e3c0047413fa08864986bf" args="(const TransportAddress &amp;node, int layer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::sendRemoveTo </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>sendRemoveTo </p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02135">2135</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classNiceMessage.html" title="Class generated from overlay/nice/NiceMessage.msg by opp_msgc.">NiceMessage</a>(<span class="stringliteral">&quot;NICE_REMOVE&quot;</span>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6dc4817975b9b4f821387f46e7a128cc">setSrcNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#ae0e08dc071897363e475e720c614af8d">setCommand</a>(<a class="code" href="NiceMessage__m_8h.html#a53eb6ab4c3521dbc1b971f43f68001e7adfb0b796750890c1d47678b130dff498">NICE_REMOVE</a>);
    msg-&gt;<a class="code" href="classNiceMessage.html#a6623c95d09425cd401f15a26899ab038">setLayer</a>(layer);

    msg-&gt;setBitLength(<a class="code" href="NiceMessage__m_8h.html#a3a8186642559e55a97c3a6cd1d0ea1dd">NICEMESSAGE_L</a>(msg));

    <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(node, msg);
} <span class="comment">// sendRemoveTo</span>
</pre></div>
</div>
</div>
<a class="anchor" id="aed05e40d0f2c58971e6eff74009cbf82"></a><!-- doxytag: member="oversim::Nice::splitNeeded" ref="aed05e40d0f2c58971e6eff74009cbf82" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool oversim::Nice::splitNeeded </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Splits clusters if needed. </p>
<p>splitNeeded</p>
<p>Returns true if a split was made, false otherwise. </p>

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l02208">2208</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> splitMade = <span class="keyword">false</span>;
    <span class="comment">// Check if cluster split is necessary</span>
    <span class="comment">// Find lowest layer that needs splitting and split it. If we&#39;re still cluster leader, continue up.</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, highest = std::min(<a class="code" href="classoversim_1_1Nice.html#a51eac39bb02905af0ea3a792bc23248a">getHighestLeaderLayer</a>(), <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> - 2);
            i &lt;= highest &amp;&amp; !<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>().<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a048e67d14f1e98002ffc304b5fbc3f2b" title="Returns leader address.">getLeader</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>;
            ++i) {
        <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getSize() &gt; 3 * <a class="code" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">k</a> + 1 &amp;&amp;
                <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a6aaac2ce8b950758447e5b11424612fa" title="The leader is &quot;confirmed&quot;, when we can say reasonably sure that all the nodes in the cluster think of...">isLeaderConfirmed</a>() &amp;&amp;
                (i == <a class="code" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a> - 1 || <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i + 1].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>() == 0 || <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i + 1].<a class="code" href="classNiceCluster.html#a6aaac2ce8b950758447e5b11424612fa" title="The leader is &quot;confirmed&quot;, when we can say reasonably sure that all the nodes in the cluster think of...">isLeaderConfirmed</a>())) {
            splitMade = <span class="keyword">true</span>;
            <a class="code" href="classoversim_1_1Nice.html#aa0181f581e1a294a1a115ce68363a517">ClusterSplit</a>(i);
        }
    }
    <span class="keywordflow">return</span> splitMade;
} <span class="comment">// splitNeeded</span>
</pre></div>
</div>
</div>
<a class="anchor" id="a71a14940853660afb14b6c8f6b5d448c"></a><!-- doxytag: member="oversim::Nice::updateVisualization" ref="a71a14940853660afb14b6c8f6b5d448c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void oversim::Nice::updateVisualization </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8cc_source.html#l03420">3420</a> of file <a class="el" href="Nice_8cc_source.html">Nice.cc</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l01572">handleNiceRemove()</a>, and <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a1a3aaae38bf78dc32e177868afbde6c7">debug_visualization</a>)
        EV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; : updateVisualization&quot;</span> &lt;&lt; endl;

    <span class="comment">/* Update node symbol */</span>
    getParentModule()-&gt;getParentModule()
    -&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 0, <span class="stringliteral">&quot;block/circle_vs&quot;</span>);

    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">isRendevouzPoint</a>) {

        getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 0, <span class="stringliteral">&quot;block/star_vs&quot;</span>);

    }

    <span class="comment">/* Update node color */</span>
    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a1a3aaae38bf78dc32e177868afbde6c7">debug_visualization</a>)
        EV &lt;&lt; <span class="stringliteral">&quot;getHighestLayer(): &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>() &lt;&lt; endl;

    getParentModule()-&gt;getParentModule()
    -&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 1, <a class="code" href="namespaceoversim.html#a068481bf2793ad703ca213dcca1e4a6f" title="Define colors for layers in visualization.">clustercolors</a>[<a class="code" href="classoversim_1_1Nice.html#ac29c7ecdf6590c8f7fd4ea9b546f72f8">getHighestLayer</a>()]);

    <span class="comment">//redraw</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#aedcd9705997d3f701d2a47a5ca7bdb65" title="Tests if given address is in cluster.">contains</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>); i++) {

        <span class="keywordflow">if</span> (!(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getLeader().isUnspecified())) {

            <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].getLeader() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {

                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#a297262ed253d2e90815e6ce5d22d8653" title="Returns number of addresses in cluster.">getSize</a>();j++) {

                    <span class="keywordflow">if</span> (<a class="code" href="classoversim_1_1Nice.html#a1a3aaae38bf78dc32e177868afbde6c7">debug_visualization</a>)
                        EV &lt;&lt; <span class="stringliteral">&quot;draw to: &quot;</span> &lt;&lt; <a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<a class="code" href="classNiceCluster.html#afd9bfdb9d012120a93d45b85c486916c" title="Returns i-th address in cluster, counting by order.">get</a>(j) &lt;&lt; endl;

                    <a class="code" href="classTopologyVis.html#a4fe67c060004c8ca76658c7b41514a4a" title="Draws an arrow from this node to neighbor.">showOverlayNeighborArrow</a>(<a class="code" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">clusters</a>[i].<span class="keyword">get</span>(j), <span class="keyword">false</span>, <a class="code" href="namespaceoversim.html#aa3b63c2cc07d2571efe93e9004ca0172">clusterarrows</a>[i]);

                }

            }

        }
    }


} <span class="comment">// updateVisualization</span>
</pre></div>
</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="a6b71884e13dc73c1a1c81351b031cb64"></a><!-- doxytag: member="oversim::Nice::NicePeerInfo" ref="a6b71884e13dc73c1a1c81351b031cb64" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classoversim_1_1NicePeerInfo.html">NicePeerInfo</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00065">65</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00755">handleNiceClusterMergeRequest()</a>, <a class="el" href="Nice_8cc_source.html#l01282">handleNiceJoinCluster()</a>, <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a3469d510d59a1cc3577e5d24a6628275"></a><!-- doxytag: member="oversim::Nice::CLUSTERLEADERBOUND" ref="a3469d510d59a1cc3577e5d24a6628275" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classoversim_1_1Nice.html#a3469d510d59a1cc3577e5d24a6628275">oversim::Nice::CLUSTERLEADERBOUND</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00186">186</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>

</div>
</div>
<a class="anchor" id="ad83625b73a292aa04380837e7d6c3944"></a><!-- doxytag: member="oversim::Nice::CLUSTERLEADERCOMPAREDIST" ref="ad83625b73a292aa04380837e7d6c3944" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classoversim_1_1Nice.html#ad83625b73a292aa04380837e7d6c3944">oversim::Nice::CLUSTERLEADERCOMPAREDIST</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00187">187</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>

</div>
</div>
<a class="anchor" id="aebff401d083e6f6b20fb9253181465ff"></a><!-- doxytag: member="oversim::Nice::clusterrefinement" ref="aebff401d083e6f6b20fb9253181465ff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#aebff401d083e6f6b20fb9253181465ff">oversim::Nice::clusterrefinement</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00146">146</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>

</div>
</div>
<a class="anchor" id="a644c991f567da9990713bba00e3dacac"></a><!-- doxytag: member="oversim::Nice::clusters" ref="a644c991f567da9990713bba00e3dacac" args="[maxLayers]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classNiceCluster.html">NiceCluster</a> <a class="el" href="classoversim_1_1Nice.html#a644c991f567da9990713bba00e3dacac">oversim::Nice::clusters</a>[<a class="el" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">maxLayers</a>]<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00158">158</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l02150">cleanPeers()</a>, <a class="el" href="Nice_8cc_source.html#l02868">ClusterMerge()</a>, <a class="el" href="Nice_8cc_source.html#l02936">ClusterMergeRequest()</a>, <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l01642">getHighestLayer()</a>, <a class="el" href="Nice_8cc_source.html#l01628">getHighestLeaderLayer()</a>, <a class="el" href="Nice_8cc_source.html#l03234">gracefulLeave()</a>, <a class="el" href="Nice_8cc_source.html#l00755">handleNiceClusterMergeRequest()</a>, <a class="el" href="Nice_8cc_source.html#l01282">handleNiceJoinCluster()</a>, <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l01433">handleNicePingProbe()</a>, <a class="el" href="Nice_8cc_source.html#l00623">handleNiceQuery()</a>, <a class="el" href="Nice_8cc_source.html#l01506">handleNiceQueryResponse()</a>, <a class="el" href="Nice_8cc_source.html#l01572">handleNiceRemove()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>, <a class="el" href="Nice_8cc_source.html#l03171">LeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>, <a class="el" href="Nice_8cc_source.html#l02229">mergeNeeded()</a>, <a class="el" href="Nice_8cc_source.html#l03190">Remove()</a>, <a class="el" href="Nice_8cc_source.html#l03365">sendDataToOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01757">sendHeartbeats()</a>, <a class="el" href="Nice_8cc_source.html#l01999">sendHeartbeatTo()</a>, <a class="el" href="Nice_8cc_source.html#l02208">splitNeeded()</a>, and <a class="el" href="Nice_8cc_source.html#l03420">updateVisualization()</a>.</p>

</div>
</div>
<a class="anchor" id="ae8b24bedc06f07fe2c03ec7b135c63a5"></a><!-- doxytag: member="oversim::Nice::debug_heartbeats" ref="ae8b24bedc06f07fe2c03ec7b135c63a5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#ae8b24bedc06f07fe2c03ec7b135c63a5">oversim::Nice::debug_heartbeats</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00147">147</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02263">checkLeaderHeartbeatsForCollisions()</a>, <a class="el" href="Nice_8cc_source.html#l00869">handleNiceHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="afa26359a3e0160724c4f36bbb02df6f4"></a><!-- doxytag: member="oversim::Nice::debug_join" ref="afa26359a3e0160724c4f36bbb02df6f4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#afa26359a3e0160724c4f36bbb02df6f4">oversim::Nice::debug_join</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00149">149</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01282">handleNiceJoinCluster()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>.</p>

</div>
</div>
<a class="anchor" id="a6af70b0196fd0d482286c0ff5a46f5ae"></a><!-- doxytag: member="oversim::Nice::debug_peertimeouts" ref="a6af70b0196fd0d482286c0ff5a46f5ae" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a6af70b0196fd0d482286c0ff5a46f5ae">oversim::Nice::debug_peertimeouts</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00150">150</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02150">cleanPeers()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a65ded61488d36484e3529f3e23b6e713"></a><!-- doxytag: member="oversim::Nice::debug_queries" ref="a65ded61488d36484e3529f3e23b6e713" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a65ded61488d36484e3529f3e23b6e713">oversim::Nice::debug_queries</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00152">152</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00623">handleNiceQuery()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l03467">pollRP()</a>, and <a class="el" href="Nice_8cc_source.html#l00594">Query()</a>.</p>

</div>
</div>
<a class="anchor" id="a12a2bd46343643e35473ab74900db70a"></a><!-- doxytag: member="oversim::Nice::debug_removes" ref="a12a2bd46343643e35473ab74900db70a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a12a2bd46343643e35473ab74900db70a">oversim::Nice::debug_removes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00151">151</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01572">handleNiceRemove()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l03190">Remove()</a>.</p>

</div>
</div>
<a class="anchor" id="a1a3aaae38bf78dc32e177868afbde6c7"></a><!-- doxytag: member="oversim::Nice::debug_visualization" ref="a1a3aaae38bf78dc32e177868afbde6c7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a1a3aaae38bf78dc32e177868afbde6c7">oversim::Nice::debug_visualization</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00148">148</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l03420">updateVisualization()</a>.</p>

</div>
</div>
<a class="anchor" id="a71935c17b8b4804bc6dd823d696dbf3e"></a><!-- doxytag: member="oversim::Nice::evalLayer" ref="a71935c17b8b4804bc6dd823d696dbf3e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a71935c17b8b4804bc6dd823d696dbf3e">oversim::Nice::evalLayer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00161">161</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01362">handleNiceJoinevalResponse()</a>, <a class="el" href="Nice_8cc_source.html#l01506">handleNiceQueryResponse()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a7e846c8b782d0bc44fdafc58897d4d5d"></a><!-- doxytag: member="oversim::Nice::first_HB" ref="a7e846c8b782d0bc44fdafc58897d4d5d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classoversim_1_1Nice.html#a7e846c8b782d0bc44fdafc58897d4d5d">oversim::Nice::first_HB</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00138">138</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

</div>
</div>
<a class="anchor" id="a36ec304efa445340c9c1f72e950b076b"></a><!-- doxytag: member="oversim::Nice::first_leader" ref="a36ec304efa445340c9c1f72e950b076b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTransportAddress.html">TransportAddress</a> <a class="el" href="classoversim_1_1Nice.html#a36ec304efa445340c9c1f72e950b076b">oversim::Nice::first_leader</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00139">139</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a58d3d6285e2a84acb277e220d1a35807"></a><!-- doxytag: member="oversim::Nice::heartbeatInterval" ref="a58d3d6285e2a84acb277e220d1a35807" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classoversim_1_1Nice.html#a58d3d6285e2a84acb277e220d1a35807">oversim::Nice::heartbeatInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00116">116</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l02263">checkLeaderHeartbeatsForCollisions()</a>, <a class="el" href="Nice_8cc_source.html#l02150">cleanPeers()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>.</p>

</div>
</div>
<a class="anchor" id="a687c425a685e47b47d989b24a1fe6165"></a><!-- doxytag: member="oversim::Nice::heartbeatTimer" ref="a687c425a685e47b47d989b24a1fe6165" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classoversim_1_1Nice.html#a687c425a685e47b47d989b24a1fe6165">oversim::Nice::heartbeatTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00115">115</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>, and <a class="el" href="Nice_8cc_source.html#l00097">~Nice()</a>.</p>

</div>
</div>
<a class="anchor" id="aaad03fa2518f9122314129e4afd433d8"></a><!-- doxytag: member="oversim::Nice::isRendevouzPoint" ref="aaad03fa2518f9122314129e4afd433d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classoversim_1_1Nice.html#aaad03fa2518f9122314129e4afd433d8">oversim::Nice::isRendevouzPoint</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00110">110</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l03234">gracefulLeave()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l01478">handleNicePollRp()</a>, <a class="el" href="Nice_8cc_source.html#l00623">handleNiceQuery()</a>, <a class="el" href="Nice_8cc_source.html#l00236">handleNodeLeaveNotification()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l03171">LeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>, <a class="el" href="Nice_8cc_source.html#l02229">mergeNeeded()</a>, and <a class="el" href="Nice_8cc_source.html#l03420">updateVisualization()</a>.</p>

</div>
</div>
<a class="anchor" id="abe5249e886cdb9e6d56efa40e6efe71e"></a><!-- doxytag: member="oversim::Nice::isTempPeered" ref="abe5249e886cdb9e6d56efa40e6efe71e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classoversim_1_1Nice.html#abe5249e886cdb9e6d56efa40e6efe71e">oversim::Nice::isTempPeered</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00184">184</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00555">BasicJoinLayer()</a>, and <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>.</p>

</div>
</div>
<a class="anchor" id="a46807673c62fb160eaf202a0eac29058"></a><!-- doxytag: member="oversim::Nice::joinLayer" ref="a46807673c62fb160eaf202a0eac29058" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a46807673c62fb160eaf202a0eac29058">oversim::Nice::joinLayer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00162">162</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l00594">Query()</a>.</p>

</div>
</div>
<a class="anchor" id="a29f5e69b521aa1eb0047e64272b84562"></a><!-- doxytag: member="oversim::Nice::k" ref="a29f5e69b521aa1eb0047e64272b84562" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short <a class="el" href="classoversim_1_1Nice.html#a29f5e69b521aa1eb0047e64272b84562">oversim::Nice::k</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00155">155</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>, <a class="el" href="Nice_8cc_source.html#l02229">mergeNeeded()</a>, <a class="el" href="Nice_8cc_source.html#l01757">sendHeartbeats()</a>, and <a class="el" href="Nice_8cc_source.html#l02208">splitNeeded()</a>.</p>

</div>
</div>
<a class="anchor" id="a1cdcbcd2cf361d641fb76ee38d552599"></a><!-- doxytag: member="oversim::Nice::leaderHeartbeats" ref="a1cdcbcd2cf361d641fb76ee38d552599" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::pair&lt;<a class="el" href="classTransportAddress.html">TransportAddress</a>, simtime_t&gt; &gt; <a class="el" href="classoversim_1_1Nice.html#a1cdcbcd2cf361d641fb76ee38d552599">oversim::Nice::leaderHeartbeats</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00143">143</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02263">checkLeaderHeartbeatsForCollisions()</a>.</p>

</div>
</div>
<a class="anchor" id="a6d14d42d813222d9ee8c5d395ba60365"></a><!-- doxytag: member="oversim::Nice::maintenanceInterval" ref="a6d14d42d813222d9ee8c5d395ba60365" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classoversim_1_1Nice.html#a6d14d42d813222d9ee8c5d395ba60365">oversim::Nice::maintenanceInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00120">120</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="ace2ed47b84cbee1c7cc71cbc44a4fea8"></a><!-- doxytag: member="oversim::Nice::maintenanceTimer" ref="ace2ed47b84cbee1c7cc71cbc44a4fea8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classoversim_1_1Nice.html#ace2ed47b84cbee1c7cc71cbc44a4fea8">oversim::Nice::maintenanceTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00119">119</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>, and <a class="el" href="Nice_8cc_source.html#l00097">~Nice()</a>.</p>

</div>
</div>
<a class="anchor" id="a960f2035d499686a97fe7163542b8647"></a><!-- doxytag: member="oversim::Nice::maxLayers" ref="a960f2035d499686a97fe7163542b8647" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const short <a class="el" href="classoversim_1_1Nice.html#a960f2035d499686a97fe7163542b8647">oversim::Nice::maxLayers</a> = 10<code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00063">63</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02150">cleanPeers()</a>, <a class="el" href="Nice_8cc_source.html#l02868">ClusterMerge()</a>, <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l01642">getHighestLayer()</a>, <a class="el" href="Nice_8cc_source.html#l00755">handleNiceClusterMergeRequest()</a>, <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l00623">handleNiceQuery()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>, <a class="el" href="Nice_8cc_source.html#l03171">LeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>, <a class="el" href="Nice_8cc_source.html#l02229">mergeNeeded()</a>, <a class="el" href="Nice_8cc_source.html#l03190">Remove()</a>, and <a class="el" href="Nice_8cc_source.html#l02208">splitNeeded()</a>.</p>

</div>
</div>
<a class="anchor" id="aa0d6fe84d8444d39caee3e2c67323550"></a><!-- doxytag: member="oversim::Nice::numForward" ref="aa0d6fe84d8444d39caee3e2c67323550" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#aa0d6fe84d8444d39caee3e2c67323550">oversim::Nice::numForward</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00208">208</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l01385">handleNiceMulticast()</a>.</p>

</div>
</div>
<a class="anchor" id="aed41149eb142ad3c71d6a639b113a5f7"></a><!-- doxytag: member="oversim::Nice::numHeartbeat" ref="aed41149eb142ad3c71d6a639b113a5f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#aed41149eb142ad3c71d6a639b113a5f7">oversim::Nice::numHeartbeat</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00216">216</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01757">sendHeartbeats()</a>, and <a class="el" href="Nice_8cc_source.html#l01999">sendHeartbeatTo()</a>.</p>

</div>
</div>
<a class="anchor" id="a50dd1e20f4c56dc45f9ffa1c52d2716f"></a><!-- doxytag: member="oversim::Nice::numInconsistencies" ref="a50dd1e20f4c56dc45f9ffa1c52d2716f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a50dd1e20f4c56dc45f9ffa1c52d2716f">oversim::Nice::numInconsistencies</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00192">192</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>

</div>
</div>
<a class="anchor" id="a765b5d96a57bf709b6a8ce28541d55a6"></a><!-- doxytag: member="oversim::Nice::numJoins" ref="a765b5d96a57bf709b6a8ce28541d55a6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a765b5d96a57bf709b6a8ce28541d55a6">oversim::Nice::numJoins</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00206">206</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01282">handleNiceJoinCluster()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="ab0a8837fcffd376b822166d048a401fa"></a><!-- doxytag: member="oversim::Nice::numOwnMessagesReceived" ref="ab0a8837fcffd376b822166d048a401fa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#ab0a8837fcffd376b822166d048a401fa">oversim::Nice::numOwnMessagesReceived</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00202">202</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01385">handleNiceMulticast()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a82e217903a688c47656a56dc4a593ebc"></a><!-- doxytag: member="oversim::Nice::numPeerTimeouts" ref="a82e217903a688c47656a56dc4a593ebc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a82e217903a688c47656a56dc4a593ebc">oversim::Nice::numPeerTimeouts</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00196">196</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02150">cleanPeers()</a>, <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="ac151ea0f3d5ac1d60b32d92c08d89e44"></a><!-- doxytag: member="oversim::Nice::numQueryTimeouts" ref="ac151ea0f3d5ac1d60b32d92c08d89e44" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#ac151ea0f3d5ac1d60b32d92c08d89e44">oversim::Nice::numQueryTimeouts</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00194">194</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="ab0165945cd4929e57f66e595ce76cc14"></a><!-- doxytag: member="oversim::Nice::numReceived" ref="ab0165945cd4929e57f66e595ce76cc14" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#ab0165945cd4929e57f66e595ce76cc14">oversim::Nice::numReceived</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00212">212</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01385">handleNiceMulticast()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="acd1effc337560f6677e63608b3e53af8"></a><!-- doxytag: member="oversim::Nice::numStructurePartitions" ref="acd1effc337560f6677e63608b3e53af8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#acd1effc337560f6677e63608b3e53af8">oversim::Nice::numStructurePartitions</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00200">200</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>

</div>
</div>
<a class="anchor" id="a97964c134da4da5b58b3c7dff32a0800"></a><!-- doxytag: member="oversim::Nice::numTempPeerTimeouts" ref="a97964c134da4da5b58b3c7dff32a0800" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a97964c134da4da5b58b3c7dff32a0800">oversim::Nice::numTempPeerTimeouts</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00198">198</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02150">cleanPeers()</a>, <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="abfd784a7eb10c0af88d835308cf66ff6"></a><!-- doxytag: member="oversim::Nice::peerInfos" ref="abfd784a7eb10c0af88d835308cf66ff6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classTransportAddress.html">TransportAddress</a>, <a class="el" href="classoversim_1_1NicePeerInfo.html">NicePeerInfo</a>*&gt; <a class="el" href="classoversim_1_1Nice.html#abfd784a7eb10c0af88d835308cf66ff6">oversim::Nice::peerInfos</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00180">180</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02150">cleanPeers()</a>, <a class="el" href="Nice_8cc_source.html#l02868">ClusterMerge()</a>, <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l03031">getMaxDistance()</a>, <a class="el" href="Nice_8cc_source.html#l03083">getMeanDistance()</a>, <a class="el" href="Nice_8cc_source.html#l00755">handleNiceClusterMergeRequest()</a>, <a class="el" href="Nice_8cc_source.html#l00869">handleNiceHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l01282">handleNiceJoinCluster()</a>, <a class="el" href="Nice_8cc_source.html#l00928">handleNiceLeaderHeartbeat()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l01457">handleNicePingProbeResponse()</a>, <a class="el" href="Nice_8cc_source.html#l00368">handleUDPMessage()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>, <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>, <a class="el" href="Nice_8cc_source.html#l01757">sendHeartbeats()</a>, <a class="el" href="Nice_8cc_source.html#l01999">sendHeartbeatTo()</a>, and <a class="el" href="Nice_8cc_source.html#l00097">~Nice()</a>.</p>

</div>
</div>
<a class="anchor" id="abffc50a7507069a0d97997f269c2d130"></a><!-- doxytag: member="oversim::Nice::peerTimeoutHeartbeats" ref="abffc50a7507069a0d97997f269c2d130" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classoversim_1_1Nice.html#abffc50a7507069a0d97997f269c2d130">oversim::Nice::peerTimeoutHeartbeats</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00130">130</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02150">cleanPeers()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a8603dc65c59516ee5dc237ce651659c6"></a><!-- doxytag: member="oversim::Nice::pimp" ref="a8603dc65c59516ee5dc237ce651659c6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#a8603dc65c59516ee5dc237ce651659c6">oversim::Nice::pimp</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00106">106</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02621">ClusterSplit()</a>, <a class="el" href="Nice_8cc_source.html#l00755">handleNiceClusterMergeRequest()</a>, <a class="el" href="Nice_8cc_source.html#l01282">handleNiceJoinCluster()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l00623">handleNiceQuery()</a>, <a class="el" href="Nice_8cc_source.html#l01572">handleNiceRemove()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="ac00b0f8d11b8f3f7c3e5c2eb78511cc6"></a><!-- doxytag: member="oversim::Nice::polledRendevouzPoint" ref="ac00b0f8d11b8f3f7c3e5c2eb78511cc6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTransportAddress.html">TransportAddress</a> <a class="el" href="classoversim_1_1Nice.html#ac00b0f8d11b8f3f7c3e5c2eb78511cc6">oversim::Nice::polledRendevouzPoint</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00165">165</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01494">handleNicePollRpResponse()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l03467">pollRP()</a>.</p>

</div>
</div>
<a class="anchor" id="a3460e84226f3260196e99da210b74082"></a><!-- doxytag: member="oversim::Nice::query_compare" ref="a3460e84226f3260196e99da210b74082" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classoversim_1_1Nice.html#a3460e84226f3260196e99da210b74082">oversim::Nice::query_compare</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00174">174</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01362">handleNiceJoinevalResponse()</a>, and <a class="el" href="Nice_8cc_source.html#l01506">handleNiceQueryResponse()</a>.</p>

</div>
</div>
<a class="anchor" id="aa604bd27a4b737fd179c2b09debebc84"></a><!-- doxytag: member="oversim::Nice::query_start" ref="aa604bd27a4b737fd179c2b09debebc84" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classoversim_1_1Nice.html#aa604bd27a4b737fd179c2b09debebc84">oversim::Nice::query_start</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00168">168</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01362">handleNiceJoinevalResponse()</a>, <a class="el" href="Nice_8cc_source.html#l01506">handleNiceQueryResponse()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l00594">Query()</a>.</p>

</div>
</div>
<a class="anchor" id="a6e3e4cdfa221e6f9980e3c51a5452570"></a><!-- doxytag: member="oversim::Nice::queryInterval" ref="a6e3e4cdfa221e6f9980e3c51a5452570" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classoversim_1_1Nice.html#a6e3e4cdfa221e6f9980e3c51a5452570">oversim::Nice::queryInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00124">124</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l00594">Query()</a>.</p>

</div>
</div>
<a class="anchor" id="a4648efb65dd8c13990a571c275d3bd04"></a><!-- doxytag: member="oversim::Nice::queryTimer" ref="a4648efb65dd8c13990a571c275d3bd04" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classoversim_1_1Nice.html#a4648efb65dd8c13990a571c275d3bd04">oversim::Nice::queryTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00123">123</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01506">handleNiceQueryResponse()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l00594">Query()</a>, and <a class="el" href="Nice_8cc_source.html#l00097">~Nice()</a>.</p>

</div>
</div>
<a class="anchor" id="a28c155327e18edb17d6ab2a4c67cf0a8"></a><!-- doxytag: member="oversim::Nice::RendevouzPoint" ref="a28c155327e18edb17d6ab2a4c67cf0a8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTransportAddress.html">TransportAddress</a> <a class="el" href="classoversim_1_1Nice.html#a28c155327e18edb17d6ab2a4c67cf0a8">oversim::Nice::RendevouzPoint</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00108">108</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00555">BasicJoinLayer()</a>, <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01117">handleNiceLeaderTransfer()</a>, <a class="el" href="Nice_8cc_source.html#l01494">handleNicePollRpResponse()</a>, <a class="el" href="Nice_8cc_source.html#l00623">handleNiceQuery()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01670">JoinCluster()</a>, <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>, and <a class="el" href="Nice_8cc_source.html#l03467">pollRP()</a>.</p>

</div>
</div>
<a class="anchor" id="a4a913c4be6eabc80fac48dffed005771"></a><!-- doxytag: member="oversim::Nice::rpPollTimer" ref="a4a913c4be6eabc80fac48dffed005771" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classoversim_1_1Nice.html#a4a913c4be6eabc80fac48dffed005771">oversim::Nice::rpPollTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00127">127</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01494">handleNicePollRpResponse()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l03467">pollRP()</a>, and <a class="el" href="Nice_8cc_source.html#l00097">~Nice()</a>.</p>

</div>
</div>
<a class="anchor" id="a417d95b2b0bdad377d0613f4dde77b66"></a><!-- doxytag: member="oversim::Nice::rpPollTimerInterval" ref="a417d95b2b0bdad377d0613f4dde77b66" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classoversim_1_1Nice.html#a417d95b2b0bdad377d0613f4dde77b66">oversim::Nice::rpPollTimerInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00128">128</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l03467">pollRP()</a>.</p>

</div>
</div>
<a class="anchor" id="a02292a0c465a7bbb80f66fbd7187cc9b"></a><!-- doxytag: member="oversim::Nice::SC_MIN_OFFSET" ref="a02292a0c465a7bbb80f66fbd7187cc9b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classoversim_1_1Nice.html#a02292a0c465a7bbb80f66fbd7187cc9b">oversim::Nice::SC_MIN_OFFSET</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00189">189</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>

</div>
</div>
<a class="anchor" id="a4368d509b0c5ac9950cf8fa52fa5f176"></a><!-- doxytag: member="oversim::Nice::SC_PROC_DISTANCE" ref="a4368d509b0c5ac9950cf8fa52fa5f176" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classoversim_1_1Nice.html#a4368d509b0c5ac9950cf8fa52fa5f176">oversim::Nice::SC_PROC_DISTANCE</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00188">188</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>, and <a class="el" href="Nice_8cc_source.html#l01757">sendHeartbeats()</a>.</p>

</div>
</div>
<a class="anchor" id="acde4679b6655c0fbf9bdc6c35bc974b0"></a><!-- doxytag: member="oversim::Nice::second_HB" ref="acde4679b6655c0fbf9bdc6c35bc974b0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classoversim_1_1Nice.html#acde4679b6655c0fbf9bdc6c35bc974b0">oversim::Nice::second_HB</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00140">140</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad6115b6ca9ae33de7308570d8aaceaf7"></a><!-- doxytag: member="oversim::Nice::second_leader" ref="ad6115b6ca9ae33de7308570d8aaceaf7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTransportAddress.html">TransportAddress</a> <a class="el" href="classoversim_1_1Nice.html#ad6115b6ca9ae33de7308570d8aaceaf7">oversim::Nice::second_leader</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00141">141</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a327e50ef2c393ea0b929f3f27154ce96"></a><!-- doxytag: member="oversim::Nice::targetLayer" ref="a327e50ef2c393ea0b929f3f27154ce96" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">short <a class="el" href="classoversim_1_1Nice.html#a327e50ef2c393ea0b929f3f27154ce96">oversim::Nice::targetLayer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00177">177</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00555">BasicJoinLayer()</a>, and <a class="el" href="Nice_8cc_source.html#l01506">handleNiceQueryResponse()</a>.</p>

</div>
</div>
<a class="anchor" id="ab4e95531a9f00a8c4ed022749d263238"></a><!-- doxytag: member="oversim::Nice::tempPeers" ref="ab4e95531a9f00a8c4ed022749d263238" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classTransportAddress.html">TransportAddress</a>, simtime_t&gt; <a class="el" href="classoversim_1_1Nice.html#ab4e95531a9f00a8c4ed022749d263238">oversim::Nice::tempPeers</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00183">183</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l02150">cleanPeers()</a>, <a class="el" href="Nice_8cc_source.html#l01416">handleNicePeerTemporary()</a>, <a class="el" href="Nice_8cc_source.html#l01424">handleNicePeerTemporaryRelease()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l03365">sendDataToOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a974f1212dc063af0d943b5fa350cc57a"></a><!-- doxytag: member="oversim::Nice::tempResolver" ref="a974f1212dc063af0d943b5fa350cc57a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTransportAddress.html">TransportAddress</a> <a class="el" href="classoversim_1_1Nice.html#a974f1212dc063af0d943b5fa350cc57a">oversim::Nice::tempResolver</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00171">171</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l01362">handleNiceJoinevalResponse()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, and <a class="el" href="Nice_8cc_source.html#l00594">Query()</a>.</p>

</div>
</div>
<a class="anchor" id="ade427df4fbd3edb53e04467984384927"></a><!-- doxytag: member="oversim::Nice::totalForwardBytes" ref="ade427df4fbd3edb53e04467984384927" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#ade427df4fbd3edb53e04467984384927">oversim::Nice::totalForwardBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00210">210</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01385">handleNiceMulticast()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="ad186e77457bdad45888594517319a02b"></a><!-- doxytag: member="oversim::Nice::totalHeartbeatBytes" ref="ad186e77457bdad45888594517319a02b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#ad186e77457bdad45888594517319a02b">oversim::Nice::totalHeartbeatBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00218">218</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01757">sendHeartbeats()</a>, and <a class="el" href="Nice_8cc_source.html#l01999">sendHeartbeatTo()</a>.</p>

</div>
</div>
<a class="anchor" id="ab70712e9a475d6ab12690cf36a31ffe1"></a><!-- doxytag: member="oversim::Nice::totalReceivedBytes" ref="ab70712e9a475d6ab12690cf36a31ffe1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classoversim_1_1Nice.html#ab70712e9a475d6ab12690cf36a31ffe1">oversim::Nice::totalReceivedBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00214">214</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l01385">handleNiceMulticast()</a>, and <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a063a91a0c9cbd3bcfeca7ce10944eb70"></a><!-- doxytag: member="oversim::Nice::totalSCMinCompare" ref="a063a91a0c9cbd3bcfeca7ce10944eb70" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classoversim_1_1Nice.html#a063a91a0c9cbd3bcfeca7ce10944eb70">oversim::Nice::totalSCMinCompare</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00204">204</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00521">finishOverlay()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l02352">maintenance()</a>.</p>

</div>
</div>
<a class="anchor" id="aa31f386f8403d2ba88f43a1a57fcba57"></a><!-- doxytag: member="oversim::Nice::visualizationTimer" ref="aa31f386f8403d2ba88f43a1a57fcba57" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classoversim_1_1Nice.html#aa31f386f8403d2ba88f43a1a57fcba57">oversim::Nice::visualizationTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Nice_8h_source.html#l00133">133</a> of file <a class="el" href="Nice_8h_source.html">Nice.h</a>.</p>

<p>Referenced by <a class="el" href="Nice_8cc_source.html#l00248">changeState()</a>, <a class="el" href="Nice_8cc_source.html#l00320">handleTimerEvent()</a>, <a class="el" href="Nice_8cc_source.html#l00122">initializeOverlay()</a>, and <a class="el" href="Nice_8cc_source.html#l00097">~Nice()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Nice_8h_source.html">Nice.h</a></li>
<li><a class="el" href="Nice_8cc_source.html">Nice.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespaceoversim.html">oversim</a>      </li>
      <li class="navelem"><a class="el" href="classoversim_1_1Nice.html">Nice</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:07:06 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
