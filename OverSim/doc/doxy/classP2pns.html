<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: P2pns Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classP2pns.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<div class="title">P2pns Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="P2pns" --><!-- doxytag: inherits="BaseApp" -->
<p>Implementation of "P2PNS: A distributed name service for P2PSIP".  
 <a href="classP2pns.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="P2pns_8h_source.html">P2pns.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for P2pns:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classP2pns.png" usemap="#P2pns_map" alt=""/>
  <map id="P2pns_map" name="P2pns_map">
<area href="classBaseApp.html" title="Base class for applications." alt="BaseApp" shape="rect" coords="57,112,162,136"/>
<area href="classBaseRpc.html" title="Base class for RPCs." alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classRpcListener.html" title="A Remote-Procedure-Call listener class." alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
 </div></div>

<p><a href="classP2pns-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns_1_1OverlayKeyObject.html">OverlayKeyObject</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#aded7e5099688de2ab925f5c0e59a6529">P2pns</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#ab5ede910664056674f2c88d157519d63">~P2pns</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a7c80c9643bc1a0c79c0ea8d24c10b30d">tunnel</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;destKey, const <a class="el" href="classBinaryValue.html">BinaryValue</a> &amp;payload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a723375787fcd5202859a1f88e47f0553">registerId</a> (const std::string &amp;addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a644ec7524da06d35b4366f8fe660fa74">handleReadyMessage</a> (<a class="el" href="classCompReadyMessage.html">CompReadyMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">method to handle ready messages from the overlay  <a href="#a644ec7524da06d35b4366f8fe660fa74"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398">LookupRpcId</a> { <a class="el" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a119ba3c5f8e7b1a3f8973e24be379b47">RESOLVE_LOOKUP</a> =  0, 
<a class="el" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a5f4a7bab6bf703ef0d6e6a9840e2aeb1">TUNNEL_LOOKUP</a> =  1, 
<a class="el" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a778f51a4e8fd787ada8913a5c8e80b1a">REFRESH_LOOKUP</a> =  2
 }</td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a2694979aaf8b7c30b068f66df40a22a8">initializeApp</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">initializes derived class-attributes  <a href="#a2694979aaf8b7c30b068f66df40a22a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a91d5ba846c164e1b9ba8163f95061da1">finishApp</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">collects statistical data of derived app  <a href="#a91d5ba846c164e1b9ba8163f95061da1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a0df65171d255c1ccc29b7f012e9898f2">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#ad87597d1ed51dbff009c276ae2c5a736">deliver</a> (<a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Common API function: handles delivered messages from overlay.  <a href="#ad87597d1ed51dbff009c276ae2c5a736"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a86ed8cc1ec7c9a4d0220f47f0c3aac7e">sendTunnelMessage</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;addr, const <a class="el" href="classBinaryValue.html">BinaryValue</a> &amp;payload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#acabbd0fa061b0442402afd4086ed6c3a">updateIdCacheWithNewTransport</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a47d4142f595d5d6008dc3ff765e3e9d5">handleTunnelLookupResponse</a> (<a class="el" href="classLookupResponse.html">LookupResponse</a> *lookupResponse)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#af003aadc765265213568a560bc7a504d">handleRpcCall</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes Remote-Procedure-Call invocation messages.  <a href="#af003aadc765265213568a560bc7a504d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a29b7e2609cd1a3141bda0012e6f1d1e6">handleRpcResponse</a> (<a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *msg, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC response has been received.  <a href="#a29b7e2609cd1a3141bda0012e6f1d1e6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#ad99741575de9f1681597bdda146f1744">pingRpcResponse</a> (<a class="el" href="classPingResponse.html">PingResponse</a> *response, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a4102f396c4053f34b4c5edd9fa915c12">pingTimeout</a> (<a class="el" href="classPingCall.html">PingCall</a> *call, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, cPolymorphic *context, int rpcId)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a297f365b6c15b9ee82e50f52079fd67d">p2pnsRegisterRpc</a> (<a class="el" href="classP2pnsRegisterCall.html">P2pnsRegisterCall</a> *registerCall)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a9a06b5a3cd69be0782a001a348048b08">p2pnsResolveRpc</a> (<a class="el" href="classP2pnsResolveCall.html">P2pnsResolveCall</a> *registerCall)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#acb0a36114e54c349a6d55f5251204c66">handleDHTputCAPIResponse</a> (<a class="el" href="classDHTputCAPIResponse.html">DHTputCAPIResponse</a> *putResponse, <a class="el" href="classP2pnsRegisterCall.html">P2pnsRegisterCall</a> *registerCall)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a38b0fc5faeb8337536b749d985e2be14">handleDHTgetCAPIResponse</a> (<a class="el" href="classDHTgetCAPIResponse.html">DHTgetCAPIResponse</a> *gettResponse, <a class="el" href="classP2pnsResolveCall.html">P2pnsResolveCall</a> *resolveCall)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#ac6169e8f09c6505c2ace9e4acd29031e">handleLookupResponse</a> (<a class="el" href="classLookupResponse.html">LookupResponse</a> *lookupResponse, cObject *context, int rpcId)</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classP2pnsCache.html">P2pnsCache</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718">p2pnsCache</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pointer to the name cache module  <a href="#ab802747954a7a9a71871d5ab0a47e718"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classXmlRpcInterface.html">XmlRpcInterface</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a37b805810a616968c058e5ba96732f35">xmlRpcInterface</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pointer to the <a class="el" href="classXmlRpcInterface.html" title="Applicaton that communicates with a realword application via a socket.">XmlRpcInterface</a> module  <a href="#a37b805810a616968c058e5ba96732f35"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a1da3e8eba6fdd35862876536c141ab3b">twoStageResolution</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Use the two stage name resolution (KBR/DHt)  <a href="#a1da3e8eba6fdd35862876536c141ab3b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a7f9c34a27ae524ed3fe8f6acac36d0a7">keepaliveInterval</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">interval between two keeaplive pings for active connections  <a href="#a7f9c34a27ae524ed3fe8f6acac36d0a7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a11dbac35c2b0999d08de770cfb476e62">idCacheLifetime</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">idle connections in the idCache get deleted after this time  <a href="#a11dbac35c2b0999d08de770cfb476e62"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classOverlayKey.html">OverlayKey</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classP2pns.html#a53769bfb6bbd03974b5c14027ac8cb84">thisId</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">the 100 most significant bit of this node's nodeId  <a href="#a53769bfb6bbd03974b5c14027ac8cb84"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Implementation of "P2PNS: A distributed name service for P2PSIP". </p>
<p>Implementation of "P2PNS: A distributed name service for P2PSIP" </p>

<p>Definition at line <a class="el" href="P2pns_8h_source.html#l00045">45</a> of file <a class="el" href="P2pns_8h_source.html">P2pns.h</a>.</p>
</div><hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="a714b455d93dafef3ee9731389c1e2398"></a><!-- doxytag: member="P2pns::LookupRpcId" ref="a714b455d93dafef3ee9731389c1e2398" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398">P2pns::LookupRpcId</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a714b455d93dafef3ee9731389c1e2398a119ba3c5f8e7b1a3f8973e24be379b47"></a><!-- doxytag: member="RESOLVE_LOOKUP" ref="a714b455d93dafef3ee9731389c1e2398a119ba3c5f8e7b1a3f8973e24be379b47" args="" -->RESOLVE_LOOKUP</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a714b455d93dafef3ee9731389c1e2398a5f4a7bab6bf703ef0d6e6a9840e2aeb1"></a><!-- doxytag: member="TUNNEL_LOOKUP" ref="a714b455d93dafef3ee9731389c1e2398a5f4a7bab6bf703ef0d6e6a9840e2aeb1" args="" -->TUNNEL_LOOKUP</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a714b455d93dafef3ee9731389c1e2398a778f51a4e8fd787ada8913a5c8e80b1a"></a><!-- doxytag: member="REFRESH_LOOKUP" ref="a714b455d93dafef3ee9731389c1e2398a778f51a4e8fd787ada8913a5c8e80b1a" args="" -->REFRESH_LOOKUP</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="P2pns_8h_source.html#l00057">57</a> of file <a class="el" href="P2pns_8h_source.html">P2pns.h</a>.</p>
<div class="fragment"><pre class="fragment">                     {
        <a class="code" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a119ba3c5f8e7b1a3f8973e24be379b47">RESOLVE_LOOKUP</a> = 0,
        <a class="code" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a5f4a7bab6bf703ef0d6e6a9840e2aeb1">TUNNEL_LOOKUP</a> = 1,
        <a class="code" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a778f51a4e8fd787ada8913a5c8e80b1a">REFRESH_LOOKUP</a> = 2
    };
</pre></div>
</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aded7e5099688de2ab925f5c0e59a6529"></a><!-- doxytag: member="P2pns::P2pns" ref="aded7e5099688de2ab925f5c0e59a6529" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">P2pns::P2pns </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00034">34</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a> = NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab5ede910664056674f2c88d157519d63"></a><!-- doxytag: member="P2pns::~P2pns" ref="ab5ede910664056674f2c88d157519d63" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">P2pns::~P2pns </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00039">39</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad87597d1ed51dbff009c276ae2c5a736"></a><!-- doxytag: member="P2pns::deliver" ref="ad87597d1ed51dbff009c276ae2c5a736" args="(OverlayKey &amp;key, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::deliver </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Common API function: handles delivered messages from overlay. </p>
<p>method to handle decapsulated <a class="el" href="classKBRdeliver.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">KBRdeliver</a> messages from overlay module, should be overwritten in derived application </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>destination key </td></tr>
    <tr><td class="paramname">msg</td><td>delivered message </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#ad9bfd86cefb67c31a2bcc082df3aa04c">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00186">186</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classP2pnsTunnelMessage.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsTunnelMessage</a>* tunnelMsg = check_and_cast&lt;<a class="code" href="classP2pnsTunnelMessage.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsTunnelMessage</a>*&gt;(msg);

    <span class="keywordflow">if</span> (<a class="code" href="classP2pns.html#a37b805810a616968c058e5ba96732f35" title="pointer to the XmlRpcInterface module">xmlRpcInterface</a>) {
        <a class="code" href="classP2pns.html#a37b805810a616968c058e5ba96732f35" title="pointer to the XmlRpcInterface module">xmlRpcInterface</a>-&gt;<a class="code" href="classXmlRpcInterface.html#a9d0752632bc0eddb33d2b95e13f47dc0">deliverTunneledMessage</a>(tunnelMsg-&gt;<a class="code" href="classP2pnsTunnelMessage.html#aa8c83b0a42d4ca35cb6edbee04dc4b14">getPayload</a>());
    }

    <a class="code" href="classP2pns.html#acabbd0fa061b0442402afd4086ed6c3a">updateIdCacheWithNewTransport</a>(msg);

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a91d5ba846c164e1b9ba8163f95061da1"></a><!-- doxytag: member="P2pns::finishApp" ref="a91d5ba846c164e1b9ba8163f95061da1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::finishApp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collects statistical data of derived app </p>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a9702f80de642a3e090aaf5bedea8e4a6">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00536">536</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<a class="anchor" id="a38b0fc5faeb8337536b749d985e2be14"></a><!-- doxytag: member="P2pns::handleDHTgetCAPIResponse" ref="a38b0fc5faeb8337536b749d985e2be14" args="(DHTgetCAPIResponse *gettResponse, P2pnsResolveCall *resolveCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::handleDHTgetCAPIResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTgetCAPIResponse.html">DHTgetCAPIResponse</a> *&#160;</td>
          <td class="paramname"><em>gettResponse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classP2pnsResolveCall.html">P2pnsResolveCall</a> *&#160;</td>
          <td class="paramname"><em>resolveCall</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00436">436</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ((!getResponse-&gt;getIsSuccess())
            || (getResponse-&gt;getResultArraySize() == 0)) { <span class="comment">// || (valueStream.str().size() == 0)) {</span>
        <a class="code" href="classP2pnsResolveResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsResolveResponse</a>* resolveResponse = <span class="keyword">new</span> <a class="code" href="classP2pnsResolveResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsResolveResponse</a>();
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#abc7320d9b6eb15d1262fdb013684b5bb">setAddressArraySize</a>(1);
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#ac166fdc5e0a7c222c09b3fb224120700">setKindArraySize</a>(1);
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a284270e3e2ac672e42b5780c019c7078">setIdArraySize</a>(1);
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#ae66c36b9b4b41eb064e9e414e13142aa">setP2pName</a>(resolveCall-&gt;<a class="code" href="classP2pnsResolveCall.html#a5a7ce2712e7ac2e3a022062c35535a5c">getP2pName</a>());
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a3d3e1cf90e8cbe18b353502a88e33644">setAddress</a>(0, <a class="code" href="classBinaryValue.html">BinaryValue</a>(<span class="stringliteral">&quot;&quot;</span>));
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a48a500025aa20423bc649da7d537eb26">setKind</a>(0, 0);
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a9e14c78aba9532adf73be689042471e1">setId</a>(0, 0);
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a94f6fec34ef4d922e0dd19ab1642ff4b">setIsSuccess</a>(<span class="keyword">false</span>);
        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(resolveCall, resolveResponse);
        <span class="keywordflow">return</span>;
    }

<span class="comment">//    TODO: fix cache to support kind and id of data records</span>
<span class="comment">//    p2pnsCache-&gt;addData(resolveCall-&gt;getP2pName(),</span>
<span class="comment">//                        getResponse-&gt;getValue());</span>

    <span class="keywordflow">if</span> (<a class="code" href="classP2pns.html#a1da3e8eba6fdd35862876536c141ab3b" title="Use the two stage name resolution (KBR/DHt)">twoStageResolution</a>) {
        <span class="keywordflow">if</span> (getResponse-&gt;getResultArraySize() != 1) {
            <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;P2pns::handleDHTgetCAPIResponse: &quot;</span>
                                <span class="stringliteral">&quot;Two-stage name resolution currently only &quot;</span>
                                <span class="stringliteral">&quot;works with unique keys!&quot;</span>);
        }
        std::stringstream valueStream;
        valueStream &lt;&lt; getResponse-&gt;getResult(0).getValue();
        <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> key(valueStream.str(), 16);

        <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>* lookupCall = <span class="keyword">new</span> <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>();

        lookupCall-&gt;setKey(key);
        lookupCall-&gt;setNumSiblings(1);

        <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, lookupCall, resolveCall, -1, 0,
                            <a class="code" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a119ba3c5f8e7b1a3f8973e24be379b47">RESOLVE_LOOKUP</a>);

        <span class="keywordflow">return</span>;
    }

    EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::handleDHTgetCAPIResponse()]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;   ResolveRpcResponse: name: &quot;</span> &lt;&lt; resolveCall-&gt;<a class="code" href="classP2pnsResolveCall.html#a5a7ce2712e7ac2e3a022062c35535a5c">getP2pName</a>();

    <a class="code" href="classP2pnsResolveResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsResolveResponse</a>* resolveResponse = <span class="keyword">new</span> <a class="code" href="classP2pnsResolveResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsResolveResponse</a>();
    resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#ae66c36b9b4b41eb064e9e414e13142aa">setP2pName</a>(resolveCall-&gt;<a class="code" href="classP2pnsResolveCall.html#a5a7ce2712e7ac2e3a022062c35535a5c">getP2pName</a>());
    resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a94f6fec34ef4d922e0dd19ab1642ff4b">setIsSuccess</a>(getResponse-&gt;getIsSuccess());
    resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#abc7320d9b6eb15d1262fdb013684b5bb">setAddressArraySize</a>(getResponse-&gt;getResultArraySize());
    resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#ac166fdc5e0a7c222c09b3fb224120700">setKindArraySize</a>(getResponse-&gt;getResultArraySize());
    resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a284270e3e2ac672e42b5780c019c7078">setIdArraySize</a>(getResponse-&gt;getResultArraySize());

    <span class="keywordflow">for</span> (uint i = 0; i &lt; getResponse-&gt;getResultArraySize(); i++) {
        EV &lt;&lt; <span class="stringliteral">&quot; addr: &quot;</span> &lt;&lt; getResponse-&gt;getResult(i).getValue();
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a3d3e1cf90e8cbe18b353502a88e33644">setAddress</a>(i, getResponse-&gt;getResult(i).getValue());
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a48a500025aa20423bc649da7d537eb26">setKind</a>(i, getResponse-&gt;getResult(i).getKind());
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a9e14c78aba9532adf73be689042471e1">setId</a>(i, getResponse-&gt;getResult(i).getId());
    }

    EV &lt;&lt; endl;
    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(resolveCall, resolveResponse);
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb0a36114e54c349a6d55f5251204c66"></a><!-- doxytag: member="P2pns::handleDHTputCAPIResponse" ref="acb0a36114e54c349a6d55f5251204c66" args="(DHTputCAPIResponse *putResponse, P2pnsRegisterCall *registerCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::handleDHTputCAPIResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTputCAPIResponse.html">DHTputCAPIResponse</a> *&#160;</td>
          <td class="paramname"><em>putResponse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classP2pnsRegisterCall.html">P2pnsRegisterCall</a> *&#160;</td>
          <td class="paramname"><em>registerCall</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00426">426</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classP2pnsRegisterResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsRegisterResponse</a>* registerResponse = <span class="keyword">new</span> <a class="code" href="classP2pnsRegisterResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsRegisterResponse</a>();
    registerResponse-&gt;<a class="code" href="classP2pnsRegisterResponse.html#a050cd70271500388001428c3065b39ba">setP2pName</a>(registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#a4a010b0d9bbaaa76314e0643c9ce8393">getP2pName</a>());
    registerResponse-&gt;<a class="code" href="classP2pnsRegisterResponse.html#a3a65ff1242fc028d2148a7bff7c39d6b">setAddress</a>(registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#a7fbdcce08c6bc33a3adefd5db069fe1e">getAddress</a>());
    registerResponse-&gt;<a class="code" href="classP2pnsRegisterResponse.html#a62e3663cca7477660cc9b417fa4c7341">setIsSuccess</a>(putResponse-&gt;<a class="code" href="classDHTputCAPIResponse.html#a261123059043e9d69a9b71e41e217a51">getIsSuccess</a>());
    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(registerCall, registerResponse);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac6169e8f09c6505c2ace9e4acd29031e"></a><!-- doxytag: member="P2pns::handleLookupResponse" ref="ac6169e8f09c6505c2ace9e4acd29031e" args="(LookupResponse *lookupResponse, cObject *context, int rpcId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::handleLookupResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classLookupResponse.html">LookupResponse</a> *&#160;</td>
          <td class="paramname"><em>lookupResponse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cObject *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00500">500</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">switch</span> (rpcId) {
    <span class="keywordflow">case</span> <a class="code" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a119ba3c5f8e7b1a3f8973e24be379b47">RESOLVE_LOOKUP</a>: {
        <a class="code" href="classP2pnsResolveCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsResolveCall</a>* resolveCall =
            check_and_cast&lt;<a class="code" href="classP2pnsResolveCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsResolveCall</a>*&gt;(context);

        stringstream sstream;
        sstream &lt;&lt; lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(0);

        <a class="code" href="classP2pnsResolveResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsResolveResponse</a>* resolveResponse = <span class="keyword">new</span> <a class="code" href="classP2pnsResolveResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">P2pnsResolveResponse</a>();
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#ae66c36b9b4b41eb064e9e414e13142aa">setP2pName</a>(resolveCall-&gt;<a class="code" href="classP2pnsResolveCall.html#a5a7ce2712e7ac2e3a022062c35535a5c">getP2pName</a>());
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#abc7320d9b6eb15d1262fdb013684b5bb">setAddressArraySize</a>(1);
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#ac166fdc5e0a7c222c09b3fb224120700">setKindArraySize</a>(1);
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a284270e3e2ac672e42b5780c019c7078">setIdArraySize</a>(1);

        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a3d3e1cf90e8cbe18b353502a88e33644">setAddress</a>(0, sstream.str());
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a48a500025aa20423bc649da7d537eb26">setKind</a>(0, 0);
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a9e14c78aba9532adf73be689042471e1">setId</a>(0, 0);
        resolveResponse-&gt;<a class="code" href="classP2pnsResolveResponse.html#a94f6fec34ef4d922e0dd19ab1642ff4b">setIsSuccess</a>(lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a86a9d5fd7849c18b989f2e5260cfbf12">getIsValid</a>());
        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(resolveCall, resolveResponse);
        <span class="keywordflow">break</span>;
    }
    <span class="keywordflow">case</span> <a class="code" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a5f4a7bab6bf703ef0d6e6a9840e2aeb1">TUNNEL_LOOKUP</a>:
        <a class="code" href="classP2pns.html#a47d4142f595d5d6008dc3ff765e3e9d5">handleTunnelLookupResponse</a>(lookupResponse);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> <a class="code" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a778f51a4e8fd787ada8913a5c8e80b1a">REFRESH_LOOKUP</a>:
        <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;P2pns::handleLookupResponse(): invalid rpcId!&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a644ec7524da06d35b4366f8fe660fa74"></a><!-- doxytag: member="P2pns::handleReadyMessage" ref="a644ec7524da06d35b4366f8fe660fa74" args="(CompReadyMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::handleReadyMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCompReadyMessage.html">CompReadyMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>method to handle ready messages from the overlay </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>message to handle </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a4f1c969fd41786127717f15e8a357130">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00059">59</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ((msg-&gt;<a class="code" href="classCompReadyMessage.html#adbc73cb3852f357191584e7a9684838f">getReady</a>() == <span class="keyword">false</span>) || (msg-&gt;<a class="code" href="classCompReadyMessage.html#a3804fb9b24445b1af5484da00634d075">getComp</a>() != <a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>)) {
        <span class="keyword">delete</span> msg;
        <span class="keywordflow">return</span>;
    }

    <a class="code" href="classP2pns.html#a53769bfb6bbd03974b5c14027ac8cb84" title="the 100 most significant bit of this node&#39;s nodeId">thisId</a> = (<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() &gt;&gt; (<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - 100))
             &lt;&lt; (<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - 100);
    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af003aadc765265213568a560bc7a504d"></a><!-- doxytag: member="P2pns::handleRpcCall" ref="af003aadc765265213568a560bc7a504d" args="(BaseCallMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool P2pns::handleRpcCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes Remote-Procedure-Call invocation messages. </p>
<p><br/>
</p>
<p>This method should be overloaded when the overlay provides RPC functionality.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if rpc has been handled </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseRpc.html#a20e77c3e0c203762a5b582ffebe3ba4b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00333">333</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// delegate messages</span>
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(Ping) {
        <a class="code" href="classP2pns.html#acabbd0fa061b0442402afd4086ed6c3a">updateIdCacheWithNewTransport</a>(msg);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( <a class="code" href="classP2pnsRegister.html">P2pnsRegister</a>, <a class="code" href="classP2pns.html#a297f365b6c15b9ee82e50f52079fd67d">p2pnsRegisterRpc</a> );
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( <a class="code" href="classP2pnsResolve.html">P2pnsResolve</a>, <a class="code" href="classP2pns.html#a9a06b5a3cd69be0782a001a348048b08">p2pnsResolveRpc</a> );
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()

    return <a class="code" href="RpcMacros_8h.html#aa5e964b7c7129c0943237a786e455e9a">RPC_HANDLED</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a29b7e2609cd1a3141bda0012e6f1d1e6"></a><!-- doxytag: member="P2pns::handleRpcResponse" ref="a29b7e2609cd1a3141bda0012e6f1d1e6" args="(BaseResponseMessage *msg, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::handleRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC response has been received. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The response message. </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classP2pns.html#a29b7e2609cd1a3141bda0012e6f1d1e6" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">rtt</td><td>The Round-Trip-Time of this RPC </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#a6229090a446fb649cfec3c1fb61e7167">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00349">349</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( DHTputCAPI ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHTputCAPI RPC Response received: id=&quot;</span> &lt;&lt; rpcId
           &lt;&lt; <span class="stringliteral">&quot; msg=&quot;</span> &lt;&lt; *_DHTputCAPIResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <span class="keywordflow">if</span> (dynamic_cast&lt;P2pnsRegisterCall*&gt;(context)) {
            <a class="code" href="classP2pns.html#acb0a36114e54c349a6d55f5251204c66">handleDHTputCAPIResponse</a>(_DHTputCAPIResponse,
                                 check_and_cast&lt;P2pnsRegisterCall*&gt;(context));
        }
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( DHTgetCAPI ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHTgetCAPI RPC Response received: id=&quot;</span> &lt;&lt; rpcId
           &lt;&lt; <span class="stringliteral">&quot; msg=&quot;</span> &lt;&lt; *_DHTgetCAPIResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <a class="code" href="classP2pns.html#a38b0fc5faeb8337536b749d985e2be14">handleDHTgetCAPIResponse</a>(_DHTgetCAPIResponse,
                                 check_and_cast&lt;P2pnsResolveCall*&gt;(context));
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( <a class="code" href="classLookup.html">Lookup</a> ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Lookup RPC Response received: id=&quot;</span> &lt;&lt; rpcId
           &lt;&lt; <span class="stringliteral">&quot; msg=&quot;</span> &lt;&lt; *_LookupResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <a class="code" href="classP2pns.html#ac6169e8f09c6505c2ace9e4acd29031e">handleLookupResponse</a>(_LookupResponse, context, rpcId);
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0df65171d255c1ccc29b7f012e9898f2"></a><!-- doxytag: member="P2pns::handleTimerEvent" ref="a0df65171d255c1ccc29b7f012e9898f2" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ab893c156412e38caa62fe058b229899b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00227">227</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classP2pnsKeepaliveTimer.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsKeepaliveTimer</a>* timer = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classP2pnsKeepaliveTimer.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsKeepaliveTimer</a>*<span class="keyword">&gt;</span>(msg);

    <span class="keywordflow">if</span> (timer) {
        <a class="code" href="classP2pnsIdCacheEntry.html">P2pnsIdCacheEntry</a>* entry = <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#aa9cdc445c8cf1d85665f6d60efe2fc0d">getIdCacheEntry</a>(timer-&gt;<a class="code" href="classP2pnsKeepaliveTimer.html#a965231a57011b5bafab6cb90cf6afa61">getKey</a>());

        <span class="keywordflow">if</span> (entry == NULL) {
            <span class="comment">// no valid cache entry found</span>
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
        }

        <span class="keywordflow">if</span> ((entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a82ae01c4df2ffb5d198c18f60522d593">lastUsage</a> + <a class="code" href="classP2pns.html#a11dbac35c2b0999d08de770cfb476e62" title="idle connections in the idCache get deleted after this time">idCacheLifetime</a>) &lt; simTime()) {
            <span class="comment">// remove idle connections</span>
            EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::handleTimerEvent()]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Removing id &quot;</span> &lt;&lt; timer-&gt;<a class="code" href="classP2pnsKeepaliveTimer.html#a965231a57011b5bafab6cb90cf6afa61">getKey</a>()
               &lt;&lt; <span class="stringliteral">&quot; from idCache (connection idle)&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#a8e835fe8385e0d6412045d0e401e1905">removeIdCacheEntry</a>(timer-&gt;<a class="code" href="classP2pnsKeepaliveTimer.html#a965231a57011b5bafab6cb90cf6afa61">getKey</a>());
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
        }

        <span class="keywordflow">if</span> (!entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
            <span class="comment">// ping 3 times with default timeout</span>
            <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a>, -1, 2, <span class="keyword">new</span> OverlayKeyObject(timer-&gt;<a class="code" href="classP2pnsKeepaliveTimer.html#a965231a57011b5bafab6cb90cf6afa61">getKey</a>()));
        }

        <span class="comment">// reschedule periodic keepalive timer</span>
        scheduleAt(simTime() + <a class="code" href="classP2pns.html#a7f9c34a27ae524ed3fe8f6acac36d0a7" title="interval between two keeaplive pings for active connections">keepaliveInterval</a>, msg);

        <span class="comment">// exhaustive-iterative lookup to refresh siblings, if our ip has changed</span>
        <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>* lookupCall = <span class="keyword">new</span> <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>();
        lookupCall-&gt;<a class="code" href="classLookupCall.html#ac9cfcf7fe5298270b6b3898b65541a4b">setKey</a>(<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>());
        lookupCall-&gt;<a class="code" href="classLookupCall.html#a1a365b8c947e000203e7fdc144715c2b">setNumSiblings</a>(1);
        lookupCall-&gt;<a class="code" href="classLookupCall.html#a3e24128a42dc4b729ed8aa3a7811d56a">setRoutingType</a>(<a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ad60cf756d6bb24af372d7fe7c279f44d">EXHAUSTIVE_ITERATIVE_ROUTING</a>);
        <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, lookupCall, NULL, -1, 0,
                            <a class="code" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a5f4a7bab6bf703ef0d6e6a9840e2aeb1">TUNNEL_LOOKUP</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a47d4142f595d5d6008dc3ff765e3e9d5"></a><!-- doxytag: member="P2pns::handleTunnelLookupResponse" ref="a47d4142f595d5d6008dc3ff765e3e9d5" args="(LookupResponse *lookupResponse)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::handleTunnelLookupResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classLookupResponse.html">LookupResponse</a> *&#160;</td>
          <td class="paramname"><em>lookupResponse</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00104">104</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classP2pnsIdCacheEntry.html">P2pnsIdCacheEntry</a>* entry =
        <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#aa9cdc445c8cf1d85665f6d60efe2fc0d">getIdCacheEntry</a>(lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>());

    <span class="keywordflow">if</span> ((entry == NULL) || (entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#aae0d04d6168f716e4c4c0cf4601a5b8a">state</a> == <a class="code" href="P2pnsCache_8h.html#a74f0e0c8c7e8c4f97d1ae81e96aad2b0a2dee7fdb974fb3a008e70d5261fe105a">CONNECTION_ACTIVE</a>)) {
        <span class="comment">// no matching entry in idCache or connection is already active</span>
        <span class="comment">// =&gt; lookup result not needed anymore</span>
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a86a9d5fd7849c18b989f2e5260cfbf12">getIsValid</a>()) {
        <span class="comment">// verify if nodeId of lookup&#39;s closest node matches requested id</span>
        <span class="keywordflow">if</span> (lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>().<a class="code" href="classOverlayKey.html#a0a44da45d3d52ce2ad76dad4e06a2888" title="Calculates the number of equal bits (digits) from the left with another Key (shared prefix length)...">sharedPrefixLength</a>(lookupResponse-&gt;
                      getSiblings(0).getKey()) &lt; (<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - 100)) {
            EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::handleTunnelLookupResponse()]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Lookup response &quot;</span> &lt;&lt; lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(0)
                   &lt;&lt; <span class="stringliteral">&quot; doesn&#39;t match requested id &quot;</span> &lt;&lt; lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>()
                   &lt;&lt; endl;
            <span class="comment">// lookup failed =&gt; drop cache entry and all queued packets</span>
            <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#a8e835fe8385e0d6412045d0e401e1905">removeIdCacheEntry</a>(lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>());

            <span class="keywordflow">return</span>;
        }

        <span class="comment">// add transport address to cache entry</span>
        entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a> = lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(0);
        entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#aae0d04d6168f716e4c4c0cf4601a5b8a">state</a> = <a class="code" href="P2pnsCache_8h.html#a74f0e0c8c7e8c4f97d1ae81e96aad2b0a2dee7fdb974fb3a008e70d5261fe105a">CONNECTION_ACTIVE</a>;

        <span class="comment">// start periodic ping timer</span>
        <a class="code" href="classP2pnsKeepaliveTimer.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsKeepaliveTimer</a>* msg =
            <span class="keyword">new</span> <a class="code" href="classP2pnsKeepaliveTimer.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsKeepaliveTimer</a>(<span class="stringliteral">&quot;P2pnsKeepaliveTimer&quot;</span>);
        msg-&gt;<a class="code" href="classP2pnsKeepaliveTimer.html#af638f3124f0d34a80eb2de16bbbe9fa9">setKey</a>(lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>());
        scheduleAt(simTime() + <a class="code" href="classP2pns.html#a7f9c34a27ae524ed3fe8f6acac36d0a7" title="interval between two keeaplive pings for active connections">keepaliveInterval</a>, msg);

        <span class="comment">// send all pending tunnel messages</span>
        <span class="keywordflow">while</span> (!entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#af7786bb5c54271247111befa732575d4">payloadQueue</a>.empty()) {
            <a class="code" href="classP2pns.html#a86ed8cc1ec7c9a4d0220f47f0c3aac7e">sendTunnelMessage</a>(entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a>, entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#af7786bb5c54271247111befa732575d4">payloadQueue</a>.front());
            entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#af7786bb5c54271247111befa732575d4">payloadQueue</a>.pop_front();
        }
    } <span class="keywordflow">else</span> {
        <span class="comment">// lookup failed =&gt; drop cache entry and all queued packets</span>
        <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#a8e835fe8385e0d6412045d0e401e1905">removeIdCacheEntry</a>(lookupResponse-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2694979aaf8b7c30b068f66df40a22a8"></a><!-- doxytag: member="P2pns::initializeApp" ref="a2694979aaf8b7c30b068f66df40a22a8" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::initializeApp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initializes derived class-attributes </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#ac9a059a2cfb67f4c38f462bb1383e795">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00043">43</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532ad9afa81d0184c5f0649fa111f7a821bc" title="deprecated">MIN_STAGE_APP</a>)
        <span class="keywordflow">return</span>;

    <a class="code" href="classP2pns.html#a1da3e8eba6fdd35862876536c141ab3b" title="Use the two stage name resolution (KBR/DHt)">twoStageResolution</a> = par(<span class="stringliteral">&quot;twoStageResolution&quot;</span>);
    <a class="code" href="classP2pns.html#a7f9c34a27ae524ed3fe8f6acac36d0a7" title="interval between two keeaplive pings for active connections">keepaliveInterval</a> = par(<span class="stringliteral">&quot;keepaliveInterval&quot;</span>);
    <a class="code" href="classP2pns.html#a11dbac35c2b0999d08de770cfb476e62" title="idle connections in the idCache get deleted after this time">idCacheLifetime</a> = par(<span class="stringliteral">&quot;idCacheLifetime&quot;</span>);

    <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a> = check_and_cast&lt;<a class="code" href="classP2pnsCache.html" title="P2PNS name cache module.">P2pnsCache</a>*&gt; (getParentModule()-&gt;
            getSubmodule(<span class="stringliteral">&quot;p2pnsCache&quot;</span>));

    <a class="code" href="classP2pns.html#a37b805810a616968c058e5ba96732f35" title="pointer to the XmlRpcInterface module">xmlRpcInterface</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classXmlRpcInterface.html" title="Applicaton that communicates with a realword application via a socket.">XmlRpcInterface</a>*<span class="keyword">&gt;</span>(<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;
            getCompModule(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea802527fa5e49f1389e1bb1c84f0191be">TIER3_COMP</a>));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a297f365b6c15b9ee82e50f52079fd67d"></a><!-- doxytag: member="P2pns::p2pnsRegisterRpc" ref="a297f365b6c15b9ee82e50f52079fd67d" args="(P2pnsRegisterCall *registerCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::p2pnsRegisterRpc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classP2pnsRegisterCall.html">P2pnsRegisterCall</a> *&#160;</td>
          <td class="paramname"><em>registerCall</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00384">384</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#a7f9e267a7050a16de64d623d22143224" title="Store a new data item in the map.">addData</a>(registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#a4a010b0d9bbaaa76314e0643c9ce8393">getP2pName</a>(),
                        registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#a7fbdcce08c6bc33a3adefd5db069fe1e">getAddress</a>());

    <a class="code" href="classDHTputCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPICall</a>* dhtPutMsg = <span class="keyword">new</span> <a class="code" href="classDHTputCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPICall</a>();

    EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::p2pnsRegisterRpc()]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    RegisterRpc: name: &quot;</span> &lt;&lt; registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#a4a010b0d9bbaaa76314e0643c9ce8393">getP2pName</a>()
       &lt;&lt; <span class="stringliteral">&quot; addr: &quot;</span> &lt;&lt; registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#a7fbdcce08c6bc33a3adefd5db069fe1e">getAddress</a>()
       &lt;&lt; endl;

    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a37024f06e1df68c15537308c93398a76">setKey</a>(<a class="code" href="classOverlayKey.html#abbd73571f97d27468c417c9b3f91f175" title="Returns a key with the SHA1 cryptographic hash of a BinaryValue.">OverlayKey::sha1</a>(registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#a4a010b0d9bbaaa76314e0643c9ce8393">getP2pName</a>()));
    <span class="keywordflow">if</span> (<a class="code" href="classP2pns.html#a1da3e8eba6fdd35862876536c141ab3b" title="Use the two stage name resolution (KBR/DHt)">twoStageResolution</a>) {
        dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#acd4367f2102a4cde3a54239b34634523">setValue</a>(<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>());
    } <span class="keywordflow">else</span> {
        dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#acd4367f2102a4cde3a54239b34634523">setValue</a>(registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#a7fbdcce08c6bc33a3adefd5db069fe1e">getAddress</a>());
    }

    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a6e80de42a8267671d66e654a7091a06d">setKind</a>(registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#ad8cc26d321aef3a6e12d0257d3bb0d88">getKind</a>());
    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#acb7f80d0fc3d6e9a73709c0fe21a86fd">setId</a>(registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#ad0515c0aeb8ccd41702c44d88d79ff2c">getId</a>());
    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a70353eafa652b90bd29623d9034c7f2e">setTtl</a>(registerCall-&gt;<a class="code" href="classP2pnsRegisterCall.html#a7c6e6e4f46bf2ab79a3550c3a07e3215">getTtl</a>());
    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a66ed93f6ded5bb51323ee98690da7b5e">setIsModifiable</a>(<span class="keyword">true</span>);

    <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, dhtPutMsg, registerCall);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9a06b5a3cd69be0782a001a348048b08"></a><!-- doxytag: member="P2pns::p2pnsResolveRpc" ref="a9a06b5a3cd69be0782a001a348048b08" args="(P2pnsResolveCall *registerCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::p2pnsResolveRpc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classP2pnsResolveCall.html">P2pnsResolveCall</a> *&#160;</td>
          <td class="paramname"><em>registerCall</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00411">411</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classDHTgetCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPICall</a>* dhtGetMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPICall</a>();

    EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::p2pnsResolveRpc()]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;   ResolveRpc: name: &quot;</span> &lt;&lt; resolveCall-&gt;getP2pName()
       &lt;&lt; endl;

    dhtGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#aa501c5e88e9698d13ad58eddc73fe239">setKey</a>(<a class="code" href="classOverlayKey.html#abbd73571f97d27468c417c9b3f91f175" title="Returns a key with the SHA1 cryptographic hash of a BinaryValue.">OverlayKey::sha1</a>(resolveCall-&gt;getP2pName()));
    dhtGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#a37289ef60b174833099e9ab25045b2be">setKind</a>(resolveCall-&gt;getKind());
    dhtGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#a88c424adb55684b47e58d11ee36f4821">setId</a>(resolveCall-&gt;getId());

    <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, dhtGetMsg, resolveCall);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad99741575de9f1681597bdda146f1744"></a><!-- doxytag: member="P2pns::pingRpcResponse" ref="ad99741575de9f1681597bdda146f1744" args="(PingResponse *response, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::pingRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPingResponse.html">PingResponse</a> *&#160;</td>
          <td class="paramname"><em>response</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#a2042b62345b9f494d01b55ab946eaf48">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00199">199</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">delete</span> context;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4102f396c4053f34b4c5edd9fa915c12"></a><!-- doxytag: member="P2pns::pingTimeout" ref="a4102f396c4053f34b4c5edd9fa915c12" args="(PingCall *call, const TransportAddress &amp;dest, cPolymorphic *context, int rpcId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::pingTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPingCall.html">PingCall</a> *&#160;</td>
          <td class="paramname"><em>call</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#afd90e156e9aa1dff7e4e99f50b2c9b51">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00205">205</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    OverlayKeyObject* key = <span class="keyword">dynamic_cast&lt;</span>OverlayKeyObject*<span class="keyword">&gt;</span>(context);
    <a class="code" href="classP2pnsIdCacheEntry.html">P2pnsIdCacheEntry</a>* entry = NULL;

    <span class="comment">// lookup entry in id cache</span>
    <span class="keywordflow">if</span> ((key != NULL) &amp;&amp;
            (entry = <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#aa9cdc445c8cf1d85665f6d60efe2fc0d">getIdCacheEntry</a>(*key))) {

        <span class="comment">// remove entry if TransportAddress hasn&#39;t been updated in the meantime</span>
        <span class="keywordflow">if</span> (!entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp; (entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a> != dest)) {
            EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::pingTimeout()]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Removing id &quot;</span> &lt;&lt; key &lt;&lt; <span class="stringliteral">&quot; from idCache (ping timeout)&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#a8e835fe8385e0d6412045d0e401e1905">removeIdCacheEntry</a>(*key);
        }
    }

    <span class="keyword">delete</span> context;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a723375787fcd5202859a1f88e47f0553"></a><!-- doxytag: member="P2pns::registerId" ref="a723375787fcd5202859a1f88e47f0553" args="(const std::string &amp;addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::registerId </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00164">164</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    Enter_Method_Silent();

    std::string name = par(<span class="stringliteral">&quot;registerName&quot;</span>).stdstringValue();
    <a class="code" href="classDHTputCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPICall</a>* dhtPutMsg = <span class="keyword">new</span> <a class="code" href="classDHTputCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPICall</a>();

    EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::p2pnsRegisterRpc()]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    registerId(): name: &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot; addr: &quot;</span> &lt;&lt; addr
       &lt;&lt; endl;

    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a37024f06e1df68c15537308c93398a76">setKey</a>(<a class="code" href="classOverlayKey.html#abbd73571f97d27468c417c9b3f91f175" title="Returns a key with the SHA1 cryptographic hash of a BinaryValue.">OverlayKey::sha1</a>(<a class="code" href="classBinaryValue.html">BinaryValue</a>(name)));

    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#acd4367f2102a4cde3a54239b34634523">setValue</a>(<a class="code" href="classBinaryValue.html">BinaryValue</a>(addr));
    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a6e80de42a8267671d66e654a7091a06d">setKind</a>(28);
    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#acb7f80d0fc3d6e9a73709c0fe21a86fd">setId</a>(1);
    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a70353eafa652b90bd29623d9034c7f2e">setTtl</a>(60*60*24*7);
    dhtPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a66ed93f6ded5bb51323ee98690da7b5e">setIsModifiable</a>(<span class="keyword">true</span>);

    <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, dhtPutMsg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a86ed8cc1ec7c9a4d0220f47f0c3aac7e"></a><!-- doxytag: member="P2pns::sendTunnelMessage" ref="a86ed8cc1ec7c9a4d0220f47f0c3aac7e" args="(const TransportAddress &amp;addr, const BinaryValue &amp;payload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::sendTunnelMessage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classBinaryValue.html">BinaryValue</a> &amp;&#160;</td>
          <td class="paramname"><em>payload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00150">150</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::sendTunnelMessage()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Sending TUNNEL message to &quot;</span> &lt;&lt; addr &lt;&lt; endl;

    <a class="code" href="classP2pnsTunnelMessage.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsTunnelMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classP2pnsTunnelMessage.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsTunnelMessage</a>(<span class="stringliteral">&quot;P2pnsTunnelMsg&quot;</span>);
    msg-&gt;<a class="code" href="classP2pnsTunnelMessage.html#ae99ee373e1f37b59de76206c8ab1cbdb">setPayload</a>(payload);
    msg-&gt;<a class="code" href="classP2pnsTunnelMessage.html#afc97259c1fd90a0ce57a44e198ea41b7">setSrcId</a>(<a class="code" href="classP2pns.html#a53769bfb6bbd03974b5c14027ac8cb84" title="the 100 most significant bit of this node&#39;s nodeId">thisId</a>);
    msg-&gt;setBitLength(<a class="code" href="P2pnsMessage__m_8h.html#a483b39dc595d0cedacfee6659a109db7">P2PNSTUNNELMESSAGE_L</a>(msg));

    <a class="code" href="classBaseApp.html#a629659835cf4ccd86a995fd00e5f4794" title="Common API function: calls route-method in overlay.">callRoute</a>(<a class="code" href="classOverlayKey.html#ac0d4135dff2985e3582fdbed2a37eb75" title="OverlayKey without defined key.">OverlayKey::UNSPECIFIED_KEY</a>, msg, addr);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7c80c9643bc1a0c79c0ea8d24c10b30d"></a><!-- doxytag: member="P2pns::tunnel" ref="a7c80c9643bc1a0c79c0ea8d24c10b30d" args="(const OverlayKey &amp;destKey, const BinaryValue &amp;payload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::tunnel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>destKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classBinaryValue.html">BinaryValue</a> &amp;&#160;</td>
          <td class="paramname"><em>payload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00071">71</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    Enter_Method_Silent();

    <a class="code" href="classP2pnsIdCacheEntry.html">P2pnsIdCacheEntry</a>* entry = <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#aa9cdc445c8cf1d85665f6d60efe2fc0d">getIdCacheEntry</a>(destKey);

    <span class="keywordflow">if</span> (entry == NULL) {
        <span class="comment">// lookup destKey and create new entry</span>

        EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::tunnel()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Establishing new cache entry for key: &quot;</span> &lt;&lt; destKey
           &lt;&lt; endl;

        <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>* lookupCall = <span class="keyword">new</span> <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>();
        lookupCall-&gt;<a class="code" href="classLookupCall.html#ac9cfcf7fe5298270b6b3898b65541a4b">setKey</a>(destKey);
        lookupCall-&gt;<a class="code" href="classLookupCall.html#a1a365b8c947e000203e7fdc144715c2b">setNumSiblings</a>(1);
        <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, lookupCall, NULL, -1, 0,
                            <a class="code" href="classP2pns.html#a714b455d93dafef3ee9731389c1e2398a5f4a7bab6bf703ef0d6e6a9840e2aeb1">TUNNEL_LOOKUP</a>);
        <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#a2cfb11e6db76b3caee1f5e8467184b33">addIdCacheEntry</a>(destKey, &amp;payload);
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#aae0d04d6168f716e4c4c0cf4601a5b8a">state</a> == <a class="code" href="P2pnsCache_8h.html#a74f0e0c8c7e8c4f97d1ae81e96aad2b0aeeb127c34e59506f568c5baeb4335c7b">CONNECTION_PENDING</a>) {
        <span class="comment">// lookup not finished yet =&gt; append packet to queue</span>
        EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::tunnel()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Queuing packet since lookup is still pending for key: &quot;</span>
           &lt;&lt; destKey &lt;&lt; endl;

        entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a82ae01c4df2ffb5d198c18f60522d593">lastUsage</a> = simTime();
        entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#af7786bb5c54271247111befa732575d4">payloadQueue</a>.push_back(payload);
    } <span class="keywordflow">else</span> {
        entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a82ae01c4df2ffb5d198c18f60522d593">lastUsage</a> = simTime();
        <a class="code" href="classP2pns.html#a86ed8cc1ec7c9a4d0220f47f0c3aac7e">sendTunnelMessage</a>(entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a>, payload);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="acabbd0fa061b0442402afd4086ed6c3a"></a><!-- doxytag: member="P2pns::updateIdCacheWithNewTransport" ref="acabbd0fa061b0442402afd4086ed6c3a" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void P2pns::updateIdCacheWithNewTransport </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="P2pns_8cc_source.html#l00269">269</a> of file <a class="el" href="P2pns_8cc_source.html">P2pns.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// update idCache with new TransportAddress of the ping originator</span>
    <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>* ctrlInfo =
        <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*<span class="keyword">&gt;</span>(msg-&gt;getControlInfo());

    <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> srcId;

    <span class="keywordflow">if</span> (!ctrlInfo) {
        <span class="comment">// can&#39;t update cache without knowing the originator id</span>
        EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::updateCacheWithNewTransport()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Can&#39;t update cache without knowing the originator id&quot;</span>
           &lt;&lt; endl;
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>().<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>()) {
        <a class="code" href="classP2pnsTunnelMessage.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsTunnelMessage</a>* tunnelMsg = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classP2pnsTunnelMessage.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsTunnelMessage</a>*<span class="keyword">&gt;</span>(msg);
        <span class="keywordflow">if</span> (tunnelMsg) {
            srcId = tunnelMsg-&gt;<a class="code" href="classP2pnsTunnelMessage.html#ae2b0caad41bec85556d1e697733c0962">getSrcId</a>();
        } <span class="keywordflow">else</span> {
            <span class="comment">// can&#39;t update cache without knowing the originator id</span>
            EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::updateCacheWithNewTransport()]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Can&#39;t update cache without knowing the originator id&quot;</span>
               &lt;&lt; endl;
            <span class="keywordflow">return</span>;
        }
    } <span class="keywordflow">else</span> {
        srcId = (ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() &gt;&gt; (<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - 100))
                &lt;&lt; (<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - 100);
    }

    <a class="code" href="classP2pnsIdCacheEntry.html">P2pnsIdCacheEntry</a>* entry = <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#aa9cdc445c8cf1d85665f6d60efe2fc0d">getIdCacheEntry</a>(srcId);

    <span class="keywordflow">if</span> (entry == NULL) {
        EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::updateCacheWithNewTransport()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Adding new cache entry for id &quot;</span> &lt;&lt; srcId
           &lt;&lt; <span class="stringliteral">&quot; with addr &quot;</span> &lt;&lt; (<span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp;)ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>()
           &lt;&lt; endl;
        entry = <a class="code" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718" title="pointer to the name cache module">p2pnsCache</a>-&gt;<a class="code" href="classP2pnsCache.html#a2cfb11e6db76b3caee1f5e8467184b33">addIdCacheEntry</a>(srcId);
        entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a> = ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>();

        <span class="comment">// start periodic ping timer</span>
        <a class="code" href="classP2pnsKeepaliveTimer.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsKeepaliveTimer</a>* msg =
            <span class="keyword">new</span> <a class="code" href="classP2pnsKeepaliveTimer.html" title="Class generated from tier2/p2pns/P2pnsMessage.msg by opp_msgc.">P2pnsKeepaliveTimer</a>(<span class="stringliteral">&quot;P2pnsKeepaliveTimer&quot;</span>);
        msg-&gt;<a class="code" href="classP2pnsKeepaliveTimer.html#af638f3124f0d34a80eb2de16bbbe9fa9">setKey</a>(srcId);
        scheduleAt(simTime() + <a class="code" href="classP2pns.html#a7f9c34a27ae524ed3fe8f6acac36d0a7" title="interval between two keeaplive pings for active connections">keepaliveInterval</a>, msg);
    }

    <span class="comment">// update transport address in idCache (node may have a new</span>
    <span class="comment">// TransportAddress due to mobility)</span>
    <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() ||
            (entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a> != ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>())) {
        EV &lt;&lt; <span class="stringliteral">&quot;[P2pns::handleRpcCall()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Ping with new transport address received: &quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Changing from &quot;</span> &lt;&lt; entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span>
           &lt;&lt; <span class="keyword">static_cast&lt;</span><a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a><span class="keyword">&gt;</span>(ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>())
           &lt;&lt; <span class="stringliteral">&quot; for id &quot;</span> &lt;&lt; srcId &lt;&lt; endl;
        entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#a3666e9dcb642e8c8da095848e8f6417c">addr</a> = ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>();
    }

    entry-&gt;<a class="code" href="classP2pnsIdCacheEntry.html#aae0d04d6168f716e4c4c0cf4601a5b8a">state</a> = <a class="code" href="P2pnsCache_8h.html#a74f0e0c8c7e8c4f97d1ae81e96aad2b0a2dee7fdb974fb3a008e70d5261fe105a">CONNECTION_ACTIVE</a>;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a11dbac35c2b0999d08de770cfb476e62"></a><!-- doxytag: member="P2pns::idCacheLifetime" ref="a11dbac35c2b0999d08de770cfb476e62" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classP2pns.html#a11dbac35c2b0999d08de770cfb476e62">P2pns::idCacheLifetime</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>idle connections in the idCache get deleted after this time </p>

<p>Definition at line <a class="el" href="P2pns_8h_source.html#l00103">103</a> of file <a class="el" href="P2pns_8h_source.html">P2pns.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7f9c34a27ae524ed3fe8f6acac36d0a7"></a><!-- doxytag: member="P2pns::keepaliveInterval" ref="a7f9c34a27ae524ed3fe8f6acac36d0a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classP2pns.html#a7f9c34a27ae524ed3fe8f6acac36d0a7">P2pns::keepaliveInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>interval between two keeaplive pings for active connections </p>

<p>Definition at line <a class="el" href="P2pns_8h_source.html#l00102">102</a> of file <a class="el" href="P2pns_8h_source.html">P2pns.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab802747954a7a9a71871d5ab0a47e718"></a><!-- doxytag: member="P2pns::p2pnsCache" ref="ab802747954a7a9a71871d5ab0a47e718" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classP2pnsCache.html">P2pnsCache</a>* <a class="el" href="classP2pns.html#ab802747954a7a9a71871d5ab0a47e718">P2pns::p2pnsCache</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>pointer to the name cache module </p>

<p>Definition at line <a class="el" href="P2pns_8h_source.html#l00099">99</a> of file <a class="el" href="P2pns_8h_source.html">P2pns.h</a>.</p>

</div>
</div>
<a class="anchor" id="a53769bfb6bbd03974b5c14027ac8cb84"></a><!-- doxytag: member="P2pns::thisId" ref="a53769bfb6bbd03974b5c14027ac8cb84" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classOverlayKey.html">OverlayKey</a> <a class="el" href="classP2pns.html#a53769bfb6bbd03974b5c14027ac8cb84">P2pns::thisId</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>the 100 most significant bit of this node's nodeId </p>

<p>Definition at line <a class="el" href="P2pns_8h_source.html#l00104">104</a> of file <a class="el" href="P2pns_8h_source.html">P2pns.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1da3e8eba6fdd35862876536c141ab3b"></a><!-- doxytag: member="P2pns::twoStageResolution" ref="a1da3e8eba6fdd35862876536c141ab3b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classP2pns.html#a1da3e8eba6fdd35862876536c141ab3b">P2pns::twoStageResolution</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Use the two stage name resolution (KBR/DHt) </p>

<p>Definition at line <a class="el" href="P2pns_8h_source.html#l00101">101</a> of file <a class="el" href="P2pns_8h_source.html">P2pns.h</a>.</p>

</div>
</div>
<a class="anchor" id="a37b805810a616968c058e5ba96732f35"></a><!-- doxytag: member="P2pns::xmlRpcInterface" ref="a37b805810a616968c058e5ba96732f35" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classXmlRpcInterface.html">XmlRpcInterface</a>* <a class="el" href="classP2pns.html#a37b805810a616968c058e5ba96732f35">P2pns::xmlRpcInterface</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>pointer to the <a class="el" href="classXmlRpcInterface.html" title="Applicaton that communicates with a realword application via a socket.">XmlRpcInterface</a> module </p>

<p>Definition at line <a class="el" href="P2pns_8h_source.html#l00100">100</a> of file <a class="el" href="P2pns_8h_source.html">P2pns.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="P2pns_8h_source.html">P2pns.h</a></li>
<li><a class="el" href="P2pns_8cc_source.html">P2pns.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classP2pns.html">P2pns</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:56 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
