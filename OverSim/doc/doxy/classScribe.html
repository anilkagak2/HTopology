<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: Scribe Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classScribe.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<div class="title">Scribe Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="Scribe" --><!-- doxytag: inherits="BaseApp" -->
<p><code>#include &lt;<a class="el" href="Scribe_8h_source.html">Scribe.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Scribe:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classScribe.png" usemap="#Scribe_map" alt=""/>
  <map id="Scribe_map" name="Scribe_map">
<area href="classBaseApp.html" title="Base class for applications." alt="BaseApp" shape="rect" coords="57,112,162,136"/>
<area href="classBaseRpc.html" title="Base class for RPCs." alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classRpcListener.html" title="A Remote-Procedure-Call listener class." alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
 </div></div>

<p><a href="classScribe-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#af93f576093380f05171e240387a38d24">Scribe</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#ac54ec0175b9f080aa15cb545f5fa261a">~Scribe</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#acb519fa75d1b5f83c6f5f9d2864ec460">initializeApp</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">initializes derived class-attributes  <a href="#acb519fa75d1b5f83c6f5f9d2864ec460"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#acb546ca959dd268286522017b5d4b0e5">handleUpperMessage</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handleUpperMessage gets called of <a class="el" href="classBaseApp.html#a98800700e14545cd84636ca4413f605a" title="checks for message type and calls corresponding method">handleMessage(cMessage* msg)</a> if msg arrivedOn from_upperTier (currently msg gets deleted in this function)  <a href="#acb546ca959dd268286522017b5d4b0e5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a3bae5cab5c4c0bb2f60829f769f13d1a">handleReadyMessage</a> (<a class="el" href="classCompReadyMessage.html">CompReadyMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">method to handle ready messages from the overlay  <a href="#a3bae5cab5c4c0bb2f60829f769f13d1a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a874c4fa77fa27d84de72532ee427918b">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a4ca0219335485804bb7b1edd76bbcc11">handleRpcCall</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes Remote-Procedure-Call invocation messages.  <a href="#a4ca0219335485804bb7b1edd76bbcc11"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a381b199c83cc750822ac93133c5d5e23">handleRpcResponse</a> (<a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *msg, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC response has been received.  <a href="#a381b199c83cc750822ac93133c5d5e23"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#ac7093212bbf13d769eefc217ed5f2625">forward</a> (<a class="el" href="classOverlayKey.html">OverlayKey</a> *key, cPacket **msg, <a class="el" href="classNodeHandle.html">NodeHandle</a> *nextHopNode)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Common API function: handles messages from overlay to be forwarded.  <a href="#ac7093212bbf13d769eefc217ed5f2625"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a93a15732b140e5f4ce723e02fb83893a">deliver</a> (<a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Common API function: handles delivered messages from overlay.  <a href="#a93a15732b140e5f4ce723e02fb83893a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a0696c333a0c17c97b8dad1360fc90ee4">update</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node, bool joined)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Common API function: informs application about neighbors and own nodeID.  <a href="#a0696c333a0c17c97b8dad1360fc90ee4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a007ecbca4eabdb469234d64b6f2f56ef">finishApp</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">collects statistical data of derived app  <a href="#a007ecbca4eabdb469234d64b6f2f56ef"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a434f7553db4a0f8a98632ca3d350a6dd">handleJoinResponse</a> (<a class="el" href="classScribeJoinResponse.html">ScribeJoinResponse</a> *joinResponse)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a response to a join call send by this node.  <a href="#a434f7553db4a0f8a98632ca3d350a6dd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#ae3f4999bca7b2f69aaf38a6ca8d54904">handleJoinCall</a> (<a class="el" href="classScribeJoinCall.html">ScribeJoinCall</a> *joinMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a join request from another node.  <a href="#ae3f4999bca7b2f69aaf38a6ca8d54904"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a1a9f1feb588f1d514d949c7c05cb378f">handlePublishCall</a> (<a class="el" href="classScribePublishCall.html">ScribePublishCall</a> *publishCall)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a publish call from another node.  <a href="#a1a9f1feb588f1d514d949c7c05cb378f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#ab97aa8f1d8de189fb0cea5326174fd1f">handlePublishResponse</a> (<a class="el" href="classScribePublishResponse.html">ScribePublishResponse</a> *publishResponse)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a response to a publish call send b this node.  <a href="#ab97aa8f1d8de189fb0cea5326174fd1f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a09618765c5b261ce819cf18ca259135d">handleJoinMessage</a> (<a class="el" href="classScribeJoinCall.html">ScribeJoinCall</a> *joinMsg, bool amIRoot)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles join requests from other nodes.  <a href="#a09618765c5b261ce819cf18ca259135d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a9c232db1f3a01e38a332b46a065616e8">handleLeaveMessage</a> (<a class="el" href="classScribeLeaveMessage.html">ScribeLeaveMessage</a> *leaveMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles leave requests from other nodes.  <a href="#a9c232db1f3a01e38a332b46a065616e8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a97402386c94198d596b5aeb63f9051be">subscribeToGroup</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;groupId)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets called if the local node wants to subscribe to a multicast group.  <a href="#a97402386c94198d596b5aeb63f9051be"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#aa74f5da64546fe7af83a77b126dcb96e">leaveGroup</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;group)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets called if the local node wants to leave a multicast group.  <a href="#aa74f5da64546fe7af83a77b126dcb96e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a98c02498a4dc4e07711a44d85b0c218f">startTimer</a> (<a class="el" href="classScribeTimer.html">ScribeTimer</a> *timer)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts a local timer.  <a href="#a98c02498a4dc4e07711a44d85b0c218f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a3c604ead1b8032d308ab08fdf04c0ff9">addChildToGroup</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;child, <a class="el" href="classScribeGroup.html">ScribeGroup</a> &amp;group)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a child to a multicast group.  <a href="#a3c604ead1b8032d308ab08fdf04c0ff9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a4e3cc6abe9e3c0ce6ae46b835daf9988">removeChildFromGroup</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;child, <a class="el" href="classScribeGroup.html">ScribeGroup</a> &amp;group)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes a child from a multicast group.  <a href="#a4e3cc6abe9e3c0ce6ae46b835daf9988"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a847d778656eb02ebe1d65b6e667f9b5b">removeChildFromGroup</a> (<a class="el" href="classScribeTimer.html">ScribeTimer</a> *timer)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes a child from a multicast group.  <a href="#a847d778656eb02ebe1d65b6e667f9b5b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a0f31427608b0f871a42ba99e65a698f2">checkGroupEmpty</a> (<a class="el" href="classScribeGroup.html">ScribeGroup</a> &amp;group)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Chechs wheter there are any subscibers left to a given root.  <a href="#a0f31427608b0f871a42ba99e65a698f2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#ab7d3e5d54b88e3fd88937fd35e1c2a7f">refreshChildTimer</a> (<a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;child, <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;groupId)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Refreshes a child timer.  <a href="#ab7d3e5d54b88e3fd88937fd35e1c2a7f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a4315fa84af1137d27edaaf801f77d798">deliverALMDataToGroup</a> (<a class="el" href="classScribeDataMessage.html">ScribeDataMessage</a> *dataMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Delivers a multicast message to all children in the multicast group.  <a href="#a4315fa84af1137d27edaaf801f77d798"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a2581ddfa533c2d99f56c24acbe38f992">deliverALMDataToRoot</a> (<a class="el" href="classALMMulticastMessage.html">ALMMulticastMessage</a> *mcastMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Delivers a multicast message to the tree's root.  <a href="#a2581ddfa533c2d99f56c24acbe38f992"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::map&lt; <a class="el" href="classOverlayKey.html">OverlayKey</a>, <br class="typebreak"/>
<a class="el" href="classScribeGroup.html">ScribeGroup</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a0ac5867b8c55ca9b6d551a40be14cab8">GroupList</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::multimap<br class="typebreak"/>
&lt; <a class="el" href="classNodeHandle.html">NodeHandle</a>, <a class="el" href="classScribeTimer.html">ScribeTimer</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#acc99c38af11034ffea0b04b71289c7f3">ChildTimeoutList</a></td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classScribe.html#a0ac5867b8c55ca9b6d551a40be14cab8">GroupList</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classScribe.html#acc99c38af11034ffea0b04b71289c7f3">ChildTimeoutList</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a0b5d9a0106edf407743961d22b42af6e">childTimeout</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a48fccdb07cfed523618216f559b3756e">parentTimeout</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classScribeTimer.html">ScribeTimer</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a5e762e21cb4902f509b5f53f5da8bf0c">subscriptionTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#ab90f3a57279a1ebda0c4d8121e8509e0">numJoins</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#aba94851bce00769ef6cdfb06e017fca5">numChildTimeout</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a0f5e7eb1fd7f35fddc5ba5cc8f8b59a2">numParentTimeout</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#affdaebbe2ca6bb7a9e3eb88182960d2d">numForward</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a641212fa4a572ae54587949740ab8d3d">forwardBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a853d8728022636a788b202a2b1e1e7d1">numReceived</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a37c505fccd0aadeaf302552e8a2af2fb">receivedBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#a03285a1d06823f70b1731de133341e9e">numHeartbeat</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#acae5ae71ce72591c9ba807facf5e4a3d">heartbeatBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#ac7a1946a873e3515d13cc88a71bf0e71">numSubscriptionRefresh</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classScribe.html#ac6627bf966dbe532a7d6bd2e4309dd9b">subscriptionRefreshBytes</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00057">57</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>
</div><hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="acc99c38af11034ffea0b04b71289c7f3"></a><!-- doxytag: member="Scribe::ChildTimeoutList" ref="acc99c38af11034ffea0b04b71289c7f3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::multimap&lt;<a class="el" href="classNodeHandle.html">NodeHandle</a>, <a class="el" href="classScribeTimer.html">ScribeTimer</a>*&gt; <a class="el" href="classScribe.html#acc99c38af11034ffea0b04b71289c7f3">Scribe::ChildTimeoutList</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00062">62</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0ac5867b8c55ca9b6d551a40be14cab8"></a><!-- doxytag: member="Scribe::GroupList" ref="a0ac5867b8c55ca9b6d551a40be14cab8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::map&lt;<a class="el" href="classOverlayKey.html">OverlayKey</a>, <a class="el" href="classScribeGroup.html">ScribeGroup</a>&gt; <a class="el" href="classScribe.html#a0ac5867b8c55ca9b6d551a40be14cab8">Scribe::GroupList</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00060">60</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="af93f576093380f05171e240387a38d24"></a><!-- doxytag: member="Scribe::Scribe" ref="af93f576093380f05171e240387a38d24" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Scribe::Scribe </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00036">36</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classScribe.html#a5e762e21cb4902f509b5f53f5da8bf0c">subscriptionTimer</a> = <span class="keyword">new</span> <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>(<span class="stringliteral">&quot;Subscription timer&quot;</span>);
    <a class="code" href="classScribe.html#a5e762e21cb4902f509b5f53f5da8bf0c">subscriptionTimer</a>-&gt;<a class="code" href="classScribeTimer.html#a63b7a89ca3aed5eaf7d93a8b32c9f54b">setTimerType</a>( <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389ab677cae3fe6259b2a4dbd926fa2af2d5">SCRIBE_SUBSCRIPTION_REFRESH</a> );
    <a class="code" href="classScribe.html#ab90f3a57279a1ebda0c4d8121e8509e0">numJoins</a> = 0;
    <a class="code" href="classScribe.html#aba94851bce00769ef6cdfb06e017fca5">numChildTimeout</a> = 0;
    <a class="code" href="classScribe.html#a0f5e7eb1fd7f35fddc5ba5cc8f8b59a2">numParentTimeout</a> = 0;
    <a class="code" href="classScribe.html#affdaebbe2ca6bb7a9e3eb88182960d2d">numForward</a> = 0;
    <a class="code" href="classScribe.html#a641212fa4a572ae54587949740ab8d3d">forwardBytes</a> = 0;
    <a class="code" href="classScribe.html#a853d8728022636a788b202a2b1e1e7d1">numReceived</a> = 0;
    <a class="code" href="classScribe.html#a37c505fccd0aadeaf302552e8a2af2fb">receivedBytes</a> = 0;
    <a class="code" href="classScribe.html#a03285a1d06823f70b1731de133341e9e">numHeartbeat</a> = 0;
    <a class="code" href="classScribe.html#acae5ae71ce72591c9ba807facf5e4a3d">heartbeatBytes</a> = 0;
    <a class="code" href="classScribe.html#ac7a1946a873e3515d13cc88a71bf0e71">numSubscriptionRefresh</a> = 0;
    <a class="code" href="classScribe.html#ac6627bf966dbe532a7d6bd2e4309dd9b">subscriptionRefreshBytes</a> = 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac54ec0175b9f080aa15cb545f5fa261a"></a><!-- doxytag: member="Scribe::~Scribe" ref="ac54ec0175b9f080aa15cb545f5fa261a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Scribe::~Scribe </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00053">53</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.clear();
    cancelAndDelete(<a class="code" href="classScribe.html#a5e762e21cb4902f509b5f53f5da8bf0c">subscriptionTimer</a>);
    <span class="comment">// TODO: clear childTimeoutList</span>
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a3c604ead1b8032d308ab08fdf04c0ff9"></a><!-- doxytag: member="Scribe::addChildToGroup" ref="a3c604ead1b8032d308ab08fdf04c0ff9" args="(const NodeHandle &amp;child, ScribeGroup &amp;group)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::addChildToGroup </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classScribeGroup.html">ScribeGroup</a> &amp;&#160;</td>
          <td class="paramname"><em>group</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a child to a multicast group. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00490">490</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( child == <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>() ) {
        <span class="comment">// Join from ourself, ignore</span>
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// add child to group&#39;s children list</span>
    pair&lt;set&lt;NodeHandle&gt;::iterator, <span class="keywordtype">bool</span>&gt; inserter =
        group.<a class="code" href="classScribeGroup.html#a8a65883d7757c5c5bdb136fe2da531db" title="Adds a new child to the multicast tree.">addChild</a>( child );

    <span class="keywordflow">if</span>( inserter.second ) {
        <span class="comment">// if child has not been in the list, create new timeout msg</span>
        <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>* timeoutMsg = <span class="keyword">new</span> <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>;
        timeoutMsg-&gt;<a class="code" href="classScribeTimer.html#a63b7a89ca3aed5eaf7d93a8b32c9f54b">setTimerType</a>( <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389abe20d4b0bc80643bf8bf177921b1c998">SCRIBE_CHILD_TIMEOUT</a> );

        <span class="comment">// Remember child and group</span>
        timeoutMsg-&gt;<a class="code" href="classScribeTimer.html#a5714d1cfea82d2ca096d5cc4c9322abb">setChild</a>( *inserter.first );
        timeoutMsg-&gt;<a class="code" href="classScribeTimer.html#ac5671ca797c2cec50a540590df12f22e">setGroup</a>( group.<a class="code" href="classScribeGroup.html#abf30b2089e89ac132dff5e7cd7c31fa4" title="Returns the groupId of the group.">getGroupId</a>() );

        <a class="code" href="classScribe.html#a98c02498a4dc4e07711a44d85b0c218f" title="Starts a local timer.">startTimer</a>( timeoutMsg );
        <a class="code" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a>.insert( make_pair(child, timeoutMsg) );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0f31427608b0f871a42ba99e65a698f2"></a><!-- doxytag: member="Scribe::checkGroupEmpty" ref="a0f31427608b0f871a42ba99e65a698f2" args="(ScribeGroup &amp;group)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::checkGroupEmpty </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribeGroup.html">ScribeGroup</a> &amp;&#160;</td>
          <td class="paramname"><em>group</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Chechs wheter there are any subscibers left to a given root. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00565">565</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( !group.<a class="code" href="classScribeGroup.html#a60d023cff707b9d6e3ffc8eb8ea7669f" title="Return whether the node is forwarder for a group.">isForwarder</a>() &amp;&amp; !group.<a class="code" href="classScribeGroup.html#a0ac96866366bc55027c6d432e26830c2" title="Returns whether the local node is subscriber of the group.">getSubscription</a>() &amp;&amp; !group.<a class="code" href="classScribeGroup.html#acb291f85dca34d85cd3d7fbd7ae41944" title="Returns the amISource status.">getAmISource</a>()){

        <span class="keywordflow">if</span>( !group.<a class="code" href="classScribeGroup.html#a2238de914efb5b7a88d826bdfcf064a8" title="Return the parent in the multicast tree.">getParent</a>().<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>() &amp;&amp; group.<a class="code" href="classScribeGroup.html#a2238de914efb5b7a88d826bdfcf064a8" title="Return the parent in the multicast tree.">getParent</a>() != <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>() ) {

            <a class="code" href="classScribeLeaveMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeLeaveMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classScribeLeaveMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeLeaveMessage</a>(<span class="stringliteral">&quot;Leave&quot;</span>);
            msg-&gt;<a class="code" href="classScribeLeaveMessage.html#aae2e77b526226c0c89d253eb23443885">setGroupId</a>( group.<a class="code" href="classScribeGroup.html#abf30b2089e89ac132dff5e7cd7c31fa4" title="Returns the groupId of the group.">getGroupId</a>() );
            msg-&gt;<a class="code" href="classScribeLeaveMessage.html#a372f3bd30fc6fab7a8e908b5fc424946">setSrc</a>( <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>() );
            msg-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#aea2679a6865b1d2fe2423685d050eb10">SCRIBE_LEAVE_L</a>(msg) );
            <a class="code" href="classBaseApp.html#a629659835cf4ccd86a995fd00e5f4794" title="Common API function: calls route-method in overlay.">callRoute</a>( <a class="code" href="classOverlayKey.html#ac0d4135dff2985e3582fdbed2a37eb75" title="OverlayKey without defined key.">OverlayKey::UNSPECIFIED_KEY</a>, msg, group.<a class="code" href="classScribeGroup.html#a2238de914efb5b7a88d826bdfcf064a8" title="Return the parent in the multicast tree.">getParent</a>() );
        }

        <span class="keywordflow">if</span>( group.<a class="code" href="classScribeGroup.html#a04476dbe22bfc93ebb25289be4dffa02" title="Returns the parent timer.">getParentTimer</a>() ) cancelAndDelete( group.<a class="code" href="classScribeGroup.html#a04476dbe22bfc93ebb25289be4dffa02" title="Returns the parent timer.">getParentTimer</a>() );
        <span class="keywordflow">if</span>( group.<a class="code" href="classScribeGroup.html#ae92a2929c194a024412821cc9280a6a3" title="Returns the heartbeat timer.">getHeartbeatTimer</a>() ) cancelAndDelete( group.<a class="code" href="classScribeGroup.html#ae92a2929c194a024412821cc9280a6a3" title="Returns the heartbeat timer.">getHeartbeatTimer</a>() );
        <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.erase( group.<a class="code" href="classScribeGroup.html#abf30b2089e89ac132dff5e7cd7c31fa4" title="Returns the groupId of the group.">getGroupId</a>() );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a93a15732b140e5f4ce723e02fb83893a"></a><!-- doxytag: member="Scribe::deliver" ref="a93a15732b140e5f4ce723e02fb83893a" args="(OverlayKey &amp;key, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::deliver </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Common API function: handles delivered messages from overlay. </p>
<p>method to handle decapsulated <a class="el" href="classKBRdeliver.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">KBRdeliver</a> messages from overlay module, should be overwritten in derived application </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>destination key </td></tr>
    <tr><td class="paramname">msg</td><td>delivered message </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#ad9bfd86cefb67c31a2bcc082df3aa04c">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00178">178</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classScribeSubscriptionRefreshMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeSubscriptionRefreshMessage</a>* refreshMsg =
            dynamic_cast&lt;ScribeSubscriptionRefreshMessage*&gt;(msg) ){
        <span class="comment">// reset child timeout</span>
        <a class="code" href="classScribe.html#ab7d3e5d54b88e3fd88937fd35e1c2a7f" title="Refreshes a child timer.">refreshChildTimer</a>( refreshMsg-&gt;getSrc(), refreshMsg-&gt;getGroupId() );
        <span class="keyword">delete</span> refreshMsg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classScribeDataMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeDataMessage</a>* data = dynamic_cast&lt;ScribeDataMessage*&gt;(msg) ){
        <a class="code" href="classScribe.html#a4315fa84af1137d27edaaf801f77d798" title="Delivers a multicast message to all children in the multicast group.">deliverALMDataToGroup</a>( data );
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classScribeLeaveMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeLeaveMessage</a>* leaveMsg = dynamic_cast&lt;ScribeLeaveMessage*&gt;(msg) ){
        <a class="code" href="classScribe.html#a9c232db1f3a01e38a332b46a065616e8" title="Handles leave requests from other nodes.">handleLeaveMessage</a>( leaveMsg );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4315fa84af1137d27edaaf801f77d798"></a><!-- doxytag: member="Scribe::deliverALMDataToGroup" ref="a4315fa84af1137d27edaaf801f77d798" args="(ScribeDataMessage *dataMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::deliverALMDataToGroup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribeDataMessage.html">ScribeDataMessage</a> *&#160;</td>
          <td class="paramname"><em>dataMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delivers a multicast message to all children in the multicast group. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00664">664</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// find group</span>
    GroupList::iterator it = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.find( dataMsg-&gt;<a class="code" href="classScribeDataMessage.html#a4476f8c814ebaa27a7c0ff3a8f274448">getGroupId</a>() );
    <span class="keywordflow">if</span>( it == <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end() ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::deliverALMDataToGroup() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot;Getting ALM data message response for an unknown group!\n&quot;</span>;
        <span class="keyword">delete</span> dataMsg;
        <span class="keywordflow">return</span>;
    }
    <span class="comment">// FIXME: ignore message if not from designated parent to avoid duplicates</span>

    <span class="comment">// reset parent heartbeat Timer</span>
    <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a> *timer = it-&gt;second.getParentTimer();
    <span class="keywordflow">if</span>( timer ) <a class="code" href="classScribe.html#a98c02498a4dc4e07711a44d85b0c218f" title="Starts a local timer.">startTimer</a>( timer );

    <span class="comment">// Only empty heartbeat?</span>
    <span class="keywordflow">if</span>( dataMsg-&gt;<a class="code" href="classScribeDataMessage.html#a28b50ce06bc62cfe4be1c75099d05641">getEmpty</a>() ) {
        <span class="keyword">delete</span> dataMsg;
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// deliver data to children</span>
    <span class="keywordflow">for</span>( set&lt;NodeHandle&gt;::iterator cit = it-&gt;second.getChildrenBegin();
            cit != it-&gt;second.getChildrenEnd(); ++cit ) {
        <a class="code" href="classScribeDataMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeDataMessage</a>* newMsg = <span class="keyword">new</span> <a class="code" href="classScribeDataMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeDataMessage</a>( *dataMsg );
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classScribe.html#affdaebbe2ca6bb7a9e3eb88182960d2d">numForward</a>; <a class="code" href="classScribe.html#a641212fa4a572ae54587949740ab8d3d">forwardBytes</a> += newMsg-&gt;getByteLength());
        <a class="code" href="classBaseApp.html#a629659835cf4ccd86a995fd00e5f4794" title="Common API function: calls route-method in overlay.">callRoute</a>( <a class="code" href="classOverlayKey.html#ac0d4135dff2985e3582fdbed2a37eb75" title="OverlayKey without defined key.">OverlayKey::UNSPECIFIED_KEY</a>, newMsg, *cit );
    }

    <span class="comment">// deliver to myself if I&#39;m subscribed to that group</span>
    <span class="keywordflow">if</span>( it-&gt;second.getSubscription() ) {
        <a class="code" href="classALMMulticastMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMMulticastMessage</a>* mcastMsg = <span class="keyword">new</span> <a class="code" href="classALMMulticastMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMMulticastMessage</a>( dataMsg-&gt;getName() );
        mcastMsg-&gt;<a class="code" href="classALMMessage.html#a5503734daf581e6b27b2e545c0aeb5ea">setGroupId</a>( dataMsg-&gt;<a class="code" href="classScribeDataMessage.html#a4476f8c814ebaa27a7c0ff3a8f274448">getGroupId</a>() );
        mcastMsg-&gt;encapsulate( dataMsg-&gt;decapsulate() );
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classScribe.html#a853d8728022636a788b202a2b1e1e7d1">numReceived</a>; <a class="code" href="classScribe.html#a37c505fccd0aadeaf302552e8a2af2fb">receivedBytes</a> += dataMsg-&gt;getByteLength());
        send( mcastMsg, <span class="stringliteral">&quot;to_upperTier&quot;</span> );
    }

    <span class="keyword">delete</span> dataMsg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2581ddfa533c2d99f56c24acbe38f992"></a><!-- doxytag: member="Scribe::deliverALMDataToRoot" ref="a2581ddfa533c2d99f56c24acbe38f992" args="(ALMMulticastMessage *mcastMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::deliverALMDataToRoot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classALMMulticastMessage.html">ALMMulticastMessage</a> *&#160;</td>
          <td class="paramname"><em>mcastMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delivers a multicast message to the tree's root. </p>
<p>This method gets called when the local app wants to publish some data to the multiacst group. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00624">624</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// find group</span>
    pair&lt;GroupList::iterator, bool&gt; groupInserter;
    groupInserter = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.insert( make_pair(mcastMsg-&gt;<a class="code" href="classALMMessage.html#a57eefb2d1d941d8457779395909fa089">getGroupId</a>(), <a class="code" href="classScribeGroup.html" title="Capsulates the informations of a scribe multicast group.">ScribeGroup</a>(mcastMsg-&gt;<a class="code" href="classALMMessage.html#a57eefb2d1d941d8457779395909fa089">getGroupId</a>())) );

    <span class="comment">// Group is not known yet</span>
    <span class="keywordflow">if</span>( groupInserter.second ) {
        groupInserter.first-&gt;second.setAmISource( <span class="keyword">true</span> );
        <span class="comment">// TODO: Start/Restart timer to clean up cached groups</span>
        <span class="comment">// If the timer expires, the flag should be cleared and checkGroupEmpty should be called</span>
        <span class="comment">//</span>
        <span class="comment">// FIXME: amISource should be set allways if app publishes messages to the group</span>
        <span class="comment">// As the timer is not implemented yet, we only set the flag in &quot;sender, but not receiver&quot; mode</span>
        <span class="comment">// to reduce the amount of unneccessary cached groups</span>
    }

    <a class="code" href="classScribeDataMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeDataMessage</a>* dataMsg = <span class="keyword">new</span> <a class="code" href="classScribeDataMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeDataMessage</a>( mcastMsg-&gt;getName() );
    dataMsg-&gt;<a class="code" href="classScribeDataMessage.html#a56febbc6329864068fefb3d259a87f56">setGroupId</a>( mcastMsg-&gt;<a class="code" href="classALMMessage.html#a57eefb2d1d941d8457779395909fa089">getGroupId</a>() );
    dataMsg-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#af9e5676d8bbb383b6ae2615a990d9998">SCRIBE_DATA_L</a>( dataMsg ));
    dataMsg-&gt;encapsulate( mcastMsg-&gt;decapsulate() );

    <span class="comment">// Send publish ...</span>
    <a class="code" href="classScribePublishCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribePublishCall</a>* msg = <span class="keyword">new</span> <a class="code" href="classScribePublishCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribePublishCall</a>( <span class="stringliteral">&quot;ScribePublish&quot;</span> );
    msg-&gt;<a class="code" href="classScribePublishCall.html#a71394ae6c1904523d6245ce417072254">setGroupId</a>( dataMsg-&gt;<a class="code" href="classScribeDataMessage.html#a4476f8c814ebaa27a7c0ff3a8f274448">getGroupId</a>() );
    msg-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#a90ad1e0f896bfe781ae37ded820a407b">SCRIBE_PUBLISHCALL_L</a>(msg) );
    msg-&gt;encapsulate( dataMsg );

    <span class="keywordflow">if</span>( !groupInserter.first-&gt;second.getRendezvousPoint().isUnspecified() ) {
        <span class="comment">// ... directly to the rendevouz point, if known ...</span>
        <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, groupInserter.first-&gt;second.getRendezvousPoint(), msg);
    } <span class="keywordflow">else</span> {
        <span class="comment">// ... else route it via KBR</span>
        <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, msg-&gt;<a class="code" href="classScribePublishCall.html#a6c6335f38d0d391798e2e4deda89170b">getGroupId</a>(), msg);
    }

    <span class="keyword">delete</span> mcastMsg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a007ecbca4eabdb469234d64b6f2f56ef"></a><!-- doxytag: member="Scribe::finishApp" ref="a007ecbca4eabdb469234d64b6f2f56ef" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::finishApp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collects statistical data of derived app </p>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a9702f80de642a3e090aaf5bedea8e4a6">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00084">84</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    simtime_t time = <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a610799ebfbf64696c59b811870cc8300">calcMeasuredLifetime</a>(<a class="code" href="classBaseApp.html#ac365b8c1cb45fb1e37f95535936a0f31" title="simTime when the App has been created">creationTime</a>);
    <span class="keywordflow">if</span> (time &lt; <a class="code" href="classGlobalStatistics.html#a169810c78519b271f7e32fdc7c9fc641" title="minimum useful measured lifetime in seconds">GlobalStatistics::MIN_MEASURED</a>) <span class="keywordflow">return</span>;

    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Received JOIN Messages/s&quot;</span>,
            <a class="code" href="classScribe.html#ab90f3a57279a1ebda0c4d8121e8509e0">numJoins</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Forwarded Multicast Messages/s&quot;</span>,
            <a class="code" href="classScribe.html#affdaebbe2ca6bb7a9e3eb88182960d2d">numForward</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Forwarded Multicast Bytes/s&quot;</span>,
            <a class="code" href="classScribe.html#a641212fa4a572ae54587949740ab8d3d">forwardBytes</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Received Multicast Messages/s (subscribed groups only)&quot;</span>,
            <a class="code" href="classScribe.html#a853d8728022636a788b202a2b1e1e7d1">numReceived</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Received Multicast Bytes/s (subscribed groups only)&quot;</span>,
            <a class="code" href="classScribe.html#a37c505fccd0aadeaf302552e8a2af2fb">receivedBytes</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Send Heartbeat Messages/s&quot;</span>,
            <a class="code" href="classScribe.html#a03285a1d06823f70b1731de133341e9e">numHeartbeat</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Send Heartbeat Bytes/s&quot;</span>,
            <a class="code" href="classScribe.html#acae5ae71ce72591c9ba807facf5e4a3d">heartbeatBytes</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Send Subscription Refresh Messages/s&quot;</span>,
            <a class="code" href="classScribe.html#ac7a1946a873e3515d13cc88a71bf0e71">numSubscriptionRefresh</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Send Subscription Refresh Bytes/s&quot;</span>,
            <a class="code" href="classScribe.html#ac6627bf966dbe532a7d6bd2e4309dd9b">subscriptionRefreshBytes</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Number of Child Timeouts/s&quot;</span>,
            <a class="code" href="classScribe.html#aba94851bce00769ef6cdfb06e017fca5">numChildTimeout</a> / time);
    <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Scribe: Number of Parent Timeouts/s&quot;</span>,
            <a class="code" href="classScribe.html#a0f5e7eb1fd7f35fddc5ba5cc8f8b59a2">numParentTimeout</a> / time);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac7093212bbf13d769eefc217ed5f2625"></a><!-- doxytag: member="Scribe::forward" ref="ac7093212bbf13d769eefc217ed5f2625" args="(OverlayKey *key, cPacket **msg, NodeHandle *nextHopNode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::forward </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classOverlayKey.html">OverlayKey</a> *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPacket **&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classNodeHandle.html">NodeHandle</a> *&#160;</td>
          <td class="paramname"><em>nextHopNode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Common API function: handles messages from overlay to be forwarded. </p>
<p>method to handle decapsulated <a class="el" href="classKBRdeliver.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">KBRdeliver</a> messages from overlay module, should be overwritten in derived application if needed </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>destination key </td></tr>
    <tr><td class="paramname">msg</td><td>message to forward </td></tr>
    <tr><td class="paramname">nextHopNode</td><td>next hop </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#ad9ad1b23f2fe54f2355d6faad2ef7c9f">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00113">113</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>* joinMsg = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>*<span class="keyword">&gt;</span> (*msg);
    <span class="keywordflow">if</span>( joinMsg == NULL ) {
        <span class="comment">// nothing to be done</span>
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span>( joinMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>() == <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>() ) <span class="keywordflow">return</span>;

    <a class="code" href="classScribe.html#a09618765c5b261ce819cf18ca259135d" title="Handles join requests from other nodes.">handleJoinMessage</a>( joinMsg, <span class="keyword">false</span> );

    *msg = NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae3f4999bca7b2f69aaf38a6ca8d54904"></a><!-- doxytag: member="Scribe::handleJoinCall" ref="ae3f4999bca7b2f69aaf38a6ca8d54904" args="(ScribeJoinCall *joinMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handleJoinCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribeJoinCall.html">ScribeJoinCall</a> *&#160;</td>
          <td class="paramname"><em>joinMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a join request from another node. </p>
<p>This method only gets called if the local node is the root of the multicast group. It only calls handlePublishCall with amIRoot parameter set to "true" </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00324">324</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classScribe.html#a09618765c5b261ce819cf18ca259135d" title="Handles join requests from other nodes.">handleJoinMessage</a>( joinMsg, <span class="keyword">true</span> );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a09618765c5b261ce819cf18ca259135d"></a><!-- doxytag: member="Scribe::handleJoinMessage" ref="a09618765c5b261ce819cf18ca259135d" args="(ScribeJoinCall *joinMsg, bool amIRoot)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handleJoinMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribeJoinCall.html">ScribeJoinCall</a> *&#160;</td>
          <td class="paramname"><em>joinMsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>amIRoot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles join requests from other nodes. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00329">329</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classScribe.html#ab90f3a57279a1ebda0c4d8121e8509e0">numJoins</a>);
    <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> key = joinMsg-&gt;<a class="code" href="classScribeJoinCall.html#aa83d04e89928c519627679b8a3dda128">getGroupId</a>();

    EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::handleJoinMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Received a ScribeJoin for group &quot;</span> &lt;&lt; key &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; joinMsg
        &lt;&lt; endl;

    <span class="comment">// Insert group into grouplist, if not already there</span>
    pair&lt;GroupList::iterator, bool&gt; groupInserter;
    groupInserter = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.insert( make_pair(key, <a class="code" href="classScribeGroup.html" title="Capsulates the informations of a scribe multicast group.">ScribeGroup</a>(key)) );

    <span class="comment">// If group is new or no parent is known, send join to parent (unless I am root, so there is no parent)</span>
    <span class="keywordflow">if</span> ( !amIRoot &amp;&amp; ( groupInserter.second || groupInserter.first-&gt;second.getParent().isUnspecified()) ) {
        <a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>* newJoin = <span class="keyword">new</span> <a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>;
        newJoin-&gt;<a class="code" href="classScribeJoinCall.html#af2cc3c15979329066c08d5ef38753e7d">setGroupId</a>( key );
        newJoin-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#a75df75d7a8ab9a7a3f981aa4cd778a53">SCRIBE_JOINCALL_L</a>(newJoin) );
        <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, key, newJoin);
    }

    <span class="comment">// If group had no children, start heartbeat timer for group</span>
    <span class="keywordflow">if</span>( groupInserter.first-&gt;second.numChildren() == 0 ) {
        <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>* heartbeat = <span class="keyword">new</span> <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>(<span class="stringliteral">&quot;HeartbeatTimer&quot;</span>);
        heartbeat-&gt;<a class="code" href="classScribeTimer.html#a63b7a89ca3aed5eaf7d93a8b32c9f54b">setTimerType</a>( <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389a067db7d950ca6ed16fa6dbfc41effaf1">SCRIBE_HEARTBEAT</a> );
        heartbeat-&gt;<a class="code" href="classScribeTimer.html#ac5671ca797c2cec50a540590df12f22e">setGroup</a>( groupInserter.first-&gt;second.getGroupId() );
        <a class="code" href="classScribe.html#a98c02498a4dc4e07711a44d85b0c218f" title="Starts a local timer.">startTimer</a>( heartbeat );
        <span class="keywordflow">if</span>( <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>* t = groupInserter.first-&gt;second.getHeartbeatTimer() ){
            <span class="comment">// delete old timer, if any</span>
            <span class="keywordflow">if</span>( t ) cancelAndDelete( t );
        }
        groupInserter.first-&gt;second.setHeartbeatTimer( heartbeat );
    }

    <span class="comment">// Add child to group</span>
    <a class="code" href="classScribe.html#a3c604ead1b8032d308ab08fdf04c0ff9" title="Adds a child to a multicast group.">addChildToGroup</a>( joinMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(), groupInserter.first-&gt;second );

    <span class="comment">// Send joinResponse</span>
    <a class="code" href="classScribeJoinResponse.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinResponse</a>* joinResponse = <span class="keyword">new</span> <a class="code" href="classScribeJoinResponse.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinResponse</a>;
    joinResponse-&gt;<a class="code" href="classScribeJoinResponse.html#acfd63ffd346e653145d51334839ecfa4">setGroupId</a>( key );
    joinResponse-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#a9b1ecae0f0871c74921ba63c9bfae22e">SCRIBE_JOINRESPONSE_L</a>(joinResponse) );
    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>( joinMsg, joinResponse );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a434f7553db4a0f8a98632ca3d350a6dd"></a><!-- doxytag: member="Scribe::handleJoinResponse" ref="a434f7553db4a0f8a98632ca3d350a6dd" args="(ScribeJoinResponse *joinResponse)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handleJoinResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribeJoinResponse.html">ScribeJoinResponse</a> *&#160;</td>
          <td class="paramname"><em>joinResponse</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a response to a join call send by this node. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00410">410</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    GroupList::iterator it = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.find( joinResponse-&gt;<a class="code" href="classScribeJoinResponse.html#acda9a1b862bb8672e080d6bfaac4ae66">getGroupId</a>() );
    <span class="keywordflow">if</span>( it == <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end() ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::handleJoinResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;Getting join response for an unknown group!\n&quot;</span>;
        <span class="keywordflow">return</span>;
    }
    it-&gt;second.setParent( joinResponse-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>() );

    <span class="comment">// Create new heartbeat timer</span>
    <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>* <a class="code" href="classScribe.html#a48fccdb07cfed523618216f559b3756e">parentTimeout</a> = <span class="keyword">new</span> <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>(<span class="stringliteral">&quot;ParentTimeoutTimer&quot;</span>);
    parentTimeout-&gt;<a class="code" href="classScribeTimer.html#a63b7a89ca3aed5eaf7d93a8b32c9f54b">setTimerType</a>( <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389aeeb9b182a51758e2b1a4c5c495f3bab0">SCRIBE_PARENT_TIMEOUT</a> );
    parentTimeout-&gt;<a class="code" href="classScribeTimer.html#ac5671ca797c2cec50a540590df12f22e">setGroup</a>( it-&gt;second.getGroupId() );
    <a class="code" href="classScribe.html#a98c02498a4dc4e07711a44d85b0c218f" title="Starts a local timer.">startTimer</a>( parentTimeout );
    <span class="keywordflow">if</span>( <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>* t = it-&gt;second.getParentTimer() ){
        <span class="comment">// delete old timer, if any</span>
        <span class="keywordflow">if</span>( t ) cancelAndDelete( t );
    }
    it-&gt;second.setParentTimer( parentTimeout );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9c232db1f3a01e38a332b46a065616e8"></a><!-- doxytag: member="Scribe::handleLeaveMessage" ref="a9c232db1f3a01e38a332b46a065616e8" args="(ScribeLeaveMessage *leaveMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handleLeaveMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribeLeaveMessage.html">ScribeLeaveMessage</a> *&#160;</td>
          <td class="paramname"><em>leaveMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles leave requests from other nodes. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00450">450</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    GroupList::iterator it = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.find( leaveMsg-&gt;<a class="code" href="classScribeLeaveMessage.html#a7392c7292c621fa6c2f3560794d0c881">getGroupId</a>() );
    <span class="keywordflow">if</span>( it != <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end() ){
        <a class="code" href="classScribe.html#a4e3cc6abe9e3c0ce6ae46b835daf9988" title="Removes a child from a multicast group.">removeChildFromGroup</a>( leaveMsg-&gt;<a class="code" href="classScribeLeaveMessage.html#acfe44d266704e5559090ca19b1b054ba">getSrc</a>(), it-&gt;second );
    }
    <span class="keyword">delete</span> leaveMsg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1a9f1feb588f1d514d949c7c05cb378f"></a><!-- doxytag: member="Scribe::handlePublishCall" ref="a1a9f1feb588f1d514d949c7c05cb378f" args="(ScribePublishCall *publishCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handlePublishCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribePublishCall.html">ScribePublishCall</a> *&#160;</td>
          <td class="paramname"><em>publishCall</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a publish call from another node. </p>
<p>Publish calls are used to send multicast messages to the root of the multicast tree. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00375">375</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// find group</span>
    GroupList::iterator it = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.find( publishCall-&gt;<a class="code" href="classScribePublishCall.html#a6c6335f38d0d391798e2e4deda89170b">getGroupId</a>() );
    <span class="keywordflow">if</span>( it == <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end() ||
            it-&gt;second.getParent().isUnspecified() ||
            it-&gt;second.getParent() != <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>() ){
        <span class="comment">// if I don&#39;t know the group or I am not root, inform sender</span>
        <span class="comment">// TODO: forward message when I&#39;m not root but know the rendevous point?</span>
        <a class="code" href="classScribePublishResponse.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribePublishResponse</a>* msg = <span class="keyword">new</span> <a class="code" href="classScribePublishResponse.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribePublishResponse</a>(<span class="stringliteral">&quot;Wrong Root&quot;</span>);
        msg-&gt;<a class="code" href="classScribePublishResponse.html#a5bceee863447cc88f95af43b40cbba74">setGroupId</a>( publishCall-&gt;<a class="code" href="classScribePublishCall.html#a6c6335f38d0d391798e2e4deda89170b">getGroupId</a>() );
        msg-&gt;<a class="code" href="classScribePublishResponse.html#afea5394da65143761862ccd128efefe0">setWrongRoot</a>( <span class="keyword">true</span> );
        msg-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#abefb9b89c1c104d30e7851d4a3f3f8b0">SCRIBE_PUBLISHRESPONSE_L</a>(msg) );
        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>( publishCall, msg );
    } <span class="keywordflow">else</span> {
        <a class="code" href="classScribeDataMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeDataMessage</a>* data = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classScribeDataMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeDataMessage</a>*<span class="keyword">&gt;</span>(publishCall-&gt;decapsulate());

        <a class="code" href="classScribePublishResponse.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribePublishResponse</a>* msg = <span class="keyword">new</span> <a class="code" href="classScribePublishResponse.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribePublishResponse</a>(<span class="stringliteral">&quot;Publish Successful&quot;</span>);
        msg-&gt;<a class="code" href="classScribePublishResponse.html#a5bceee863447cc88f95af43b40cbba74">setGroupId</a>( publishCall-&gt;<a class="code" href="classScribePublishCall.html#a6c6335f38d0d391798e2e4deda89170b">getGroupId</a>() );
        msg-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#abefb9b89c1c104d30e7851d4a3f3f8b0">SCRIBE_PUBLISHRESPONSE_L</a>(msg) );
        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>( publishCall, msg );

        <span class="keywordflow">if</span>( !data ) {
            <span class="comment">// TODO: throw exception? this should never happen</span>
            EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::handlePublishCall() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;    PublishCall for group &quot;</span> &lt;&lt; msg-&gt;<a class="code" href="classScribePublishResponse.html#a496cb8a740e31fbacb287b146caa27ba">getGroupId</a>()
                &lt;&lt; <span class="stringliteral">&quot;    does not contain a calid ALM data message!\n&quot;</span>
                &lt;&lt; endl;
            <span class="keywordflow">return</span>;
        }
        <a class="code" href="classScribe.html#a4315fa84af1137d27edaaf801f77d798" title="Delivers a multicast message to all children in the multicast group.">deliverALMDataToGroup</a>( data );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab97aa8f1d8de189fb0cea5326174fd1f"></a><!-- doxytag: member="Scribe::handlePublishResponse" ref="ab97aa8f1d8de189fb0cea5326174fd1f" args="(ScribePublishResponse *publishResponse)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handlePublishResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribePublishResponse.html">ScribePublishResponse</a> *&#160;</td>
          <td class="paramname"><em>publishResponse</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a response to a publish call send b this node. </p>
<p>Publish calls are used to send multicast messages to the root of the multicast tree. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00433">433</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    GroupList::iterator it = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.find( publishResponse-&gt;<a class="code" href="classScribePublishResponse.html#a496cb8a740e31fbacb287b146caa27ba">getGroupId</a>() );
    <span class="keywordflow">if</span>( it == <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end() ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::handlePublishResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;Getting publish response for an unknown group!\n&quot;</span>;
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span>( publishResponse-&gt;<a class="code" href="classScribePublishResponse.html#a4eacf7db9ab2f1ef34bbc81e68ccdd5c">getWrongRoot</a>() ) {
        it-&gt;second.setRendezvousPoint( <a class="code" href="classNodeHandle.html#a79bf2c5e29c969cbd0b2581cb188d8a6" title="the unspecified NodeHandle">NodeHandle::UNSPECIFIED_NODE</a> );
    } <span class="keywordflow">else</span> {
        it-&gt;second.setRendezvousPoint( publishResponse-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>() );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3bae5cab5c4c0bb2f60829f769f13d1a"></a><!-- doxytag: member="Scribe::handleReadyMessage" ref="a3bae5cab5c4c0bb2f60829f769f13d1a" args="(CompReadyMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handleReadyMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCompReadyMessage.html">CompReadyMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>method to handle ready messages from the overlay </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>message to handle </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a4f1c969fd41786127717f15e8a357130">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00227">227</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// process only ready messages from the tier below</span>
    <span class="keywordflow">if</span>( (<a class="code" href="classBaseApp.html#a5125ad4468014966598aeb9630242a45" title="Return the component type of this module.">getThisCompType</a>() - msg-&gt;<a class="code" href="classCompReadyMessage.html#a3804fb9b24445b1af5484da00634d075">getComp</a>() == 1) &amp;&amp; msg-&gt;<a class="code" href="classCompReadyMessage.html#adbc73cb3852f357191584e7a9684838f">getReady</a>() ) {

        <span class="comment">// Send a ready message to the tier above</span>
        <a class="code" href="classCompReadyMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">CompReadyMessage</a>* readyMsg = <span class="keyword">new</span> <a class="code" href="classCompReadyMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">CompReadyMessage</a>;
        readyMsg-&gt;<a class="code" href="classCompReadyMessage.html#a07d2b2a15889728c23ed4d80730de2cf">setReady</a>( <span class="keyword">true</span> );
        readyMsg-&gt;<a class="code" href="classCompReadyMessage.html#a77640d7f3566804064921b2520ed51b6">setComp</a>( <a class="code" href="classBaseApp.html#a5125ad4468014966598aeb9630242a45" title="Return the component type of this module.">getThisCompType</a>() );

        send( readyMsg, <span class="stringliteral">&quot;to_upperTier&quot;</span> );
        
        <a class="code" href="classScribe.html#a98c02498a4dc4e07711a44d85b0c218f" title="Starts a local timer.">startTimer</a>( <a class="code" href="classScribe.html#a5e762e21cb4902f509b5f53f5da8bf0c">subscriptionTimer</a> );
    }
    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4ca0219335485804bb7b1edd76bbcc11"></a><!-- doxytag: member="Scribe::handleRpcCall" ref="a4ca0219335485804bb7b1edd76bbcc11" args="(BaseCallMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Scribe::handleRpcCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes Remote-Procedure-Call invocation messages. </p>
<p><br/>
</p>
<p>This method should be overloaded when the overlay provides RPC functionality.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if rpc has been handled </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseRpc.html#a20e77c3e0c203762a5b582ffebe3ba4b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00149">149</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg);
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>(ScribeJoin, <a class="code" href="classScribe.html#ae3f4999bca7b2f69aaf38a6ca8d54904" title="Handles a join request from another node.">handleJoinCall</a>);
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>(ScribePublish, <a class="code" href="classScribe.html#a1a9f1feb588f1d514d949c7c05cb378f" title="Handles a publish call from another node.">handlePublishCall</a>);
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>();
    <span class="keywordflow">return</span> <a class="code" href="RpcMacros_8h.html#aa5e964b7c7129c0943237a786e455e9a">RPC_HANDLED</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a381b199c83cc750822ac93133c5d5e23"></a><!-- doxytag: member="Scribe::handleRpcResponse" ref="a381b199c83cc750822ac93133c5d5e23" args="(BaseResponseMessage *msg, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handleRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC response has been received. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The response message. </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classScribe.html#a381b199c83cc750822ac93133c5d5e23" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">rtt</td><td>The Round-Trip-Time of this RPC </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#a6229090a446fb649cfec3c1fb61e7167">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00158">158</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg);
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( ScribeJoin ) {
        <a class="code" href="classScribe.html#a434f7553db4a0f8a98632ca3d350a6dd" title="Handles a response to a join call send by this node.">handleJoinResponse</a>( _ScribeJoinResponse );
        EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    Received a ScribeJoin RPC Response: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_ScribeJoinResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
            &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( ScribePublish ) {
        <a class="code" href="classScribe.html#ab97aa8f1d8de189fb0cea5326174fd1f" title="Handles a response to a publish call send b this node.">handlePublishResponse</a>( _ScribePublishResponse );
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a874c4fa77fa27d84de72532ee427918b"></a><!-- doxytag: member="Scribe::handleTimerEvent" ref="a874c4fa77fa27d84de72532ee427918b" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ab893c156412e38caa62fe058b229899b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00244">244</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>* timer = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>*<span class="keyword">&gt;</span>(msg);
    assert( timer );
    <span class="keywordflow">switch</span>( timer-&gt;<a class="code" href="classScribeTimer.html#acf4f5d5f48103ce67f882ae37fea3cb6">getTimerType</a>() ) {
        <span class="keywordflow">case</span> <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389ab677cae3fe6259b2a4dbd926fa2af2d5">SCRIBE_SUBSCRIPTION_REFRESH</a>:
            <span class="comment">// renew subscriptions for all groups</span>
            <span class="keywordflow">for</span>( GroupList::iterator it = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.begin(); it != <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end(); ++it ) {
                <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> parent = it-&gt;second.getParent();
                <span class="keywordflow">if</span>( !parent.<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>() ){
                    <a class="code" href="classScribeSubscriptionRefreshMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeSubscriptionRefreshMessage</a>* refreshMsg = <span class="keyword">new</span> <a class="code" href="classScribeSubscriptionRefreshMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeSubscriptionRefreshMessage</a>;
                    refreshMsg-&gt;<a class="code" href="classScribeSubscriptionRefreshMessage.html#accb8df96ebc5e149a70a7a5b4fc8039a">setGroupId</a>( it-&gt;second.getGroupId() );
                    refreshMsg-&gt;<a class="code" href="classScribeSubscriptionRefreshMessage.html#aff947d69f711d733e784db482d9384ef">setSrc</a>( <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>() );

                    refreshMsg-&gt;setBitLength(<a class="code" href="ScribeMessage__m_8h.html#a57716d77449a29aed70dc50ad73906a3">SCRIBE_SUBSCRIPTIONREFRESH_L</a>(refreshMsg));
                    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classScribe.html#ac7a1946a873e3515d13cc88a71bf0e71">numSubscriptionRefresh</a>;
                            <a class="code" href="classScribe.html#ac6627bf966dbe532a7d6bd2e4309dd9b">subscriptionRefreshBytes</a> += refreshMsg-&gt;getByteLength()
                    );
                    <a class="code" href="classBaseApp.html#a629659835cf4ccd86a995fd00e5f4794" title="Common API function: calls route-method in overlay.">callRoute</a>( <a class="code" href="classOverlayKey.html#ac0d4135dff2985e3582fdbed2a37eb75" title="OverlayKey without defined key.">OverlayKey::UNSPECIFIED_KEY</a>, refreshMsg, parent );
                }
            }
            <a class="code" href="classScribe.html#a98c02498a4dc4e07711a44d85b0c218f" title="Starts a local timer.">startTimer</a>( <a class="code" href="classScribe.html#a5e762e21cb4902f509b5f53f5da8bf0c">subscriptionTimer</a> );
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389a067db7d950ca6ed16fa6dbfc41effaf1">SCRIBE_HEARTBEAT</a>:
        {
            <span class="comment">// Send heartbeat messages to all children in the group</span>
            GroupList::iterator groupIt = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.find( timer-&gt;<a class="code" href="classScribeTimer.html#ac959953fd841d859b3321040be8194cb">getGroup</a>() );
            <span class="keywordflow">if</span>( groupIt == <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end() ) {
                <span class="comment">// FIXME: should not happen</span>
                <span class="keyword">delete</span> timer;
                <span class="keywordflow">return</span>;
            }
            <span class="keywordflow">for</span>( set&lt;NodeHandle&gt;::iterator it = groupIt-&gt;second.getChildrenBegin();
                    it != groupIt-&gt;second.getChildrenEnd(); ++it ) {
                <a class="code" href="classScribeDataMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeDataMessage</a>* heartbeatMsg = <span class="keyword">new</span> <a class="code" href="classScribeDataMessage.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeDataMessage</a>(<span class="stringliteral">&quot;Heartbeat&quot;</span>);
                heartbeatMsg-&gt;<a class="code" href="classScribeDataMessage.html#ae82129d3087dded3acb36ee8b3820a9a">setEmpty</a>( <span class="keyword">true</span> );
                heartbeatMsg-&gt;<a class="code" href="classScribeDataMessage.html#a56febbc6329864068fefb3d259a87f56">setGroupId</a>( timer-&gt;<a class="code" href="classScribeTimer.html#ac959953fd841d859b3321040be8194cb">getGroup</a>() );

                heartbeatMsg-&gt;setBitLength(<a class="code" href="ScribeMessage__m_8h.html#af9e5676d8bbb383b6ae2615a990d9998">SCRIBE_DATA_L</a>(heartbeatMsg));
                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classScribe.html#a03285a1d06823f70b1731de133341e9e">numHeartbeat</a>; <a class="code" href="classScribe.html#acae5ae71ce72591c9ba807facf5e4a3d">heartbeatBytes</a> += heartbeatMsg-&gt;getByteLength());
                <a class="code" href="classBaseApp.html#a629659835cf4ccd86a995fd00e5f4794" title="Common API function: calls route-method in overlay.">callRoute</a>( <a class="code" href="classOverlayKey.html#ac0d4135dff2985e3582fdbed2a37eb75" title="OverlayKey without defined key.">OverlayKey::UNSPECIFIED_KEY</a>, heartbeatMsg, *it );
            }
            <a class="code" href="classScribe.html#a98c02498a4dc4e07711a44d85b0c218f" title="Starts a local timer.">startTimer</a>( timer );
            <span class="keywordflow">break</span>;
        }
        <span class="keywordflow">case</span> <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389abe20d4b0bc80643bf8bf177921b1c998">SCRIBE_CHILD_TIMEOUT</a>:
            <span class="comment">// Child failed, remove it from group</span>
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classScribe.html#aba94851bce00769ef6cdfb06e017fca5">numChildTimeout</a>);
            <a class="code" href="classScribe.html#a4e3cc6abe9e3c0ce6ae46b835daf9988" title="Removes a child from a multicast group.">removeChildFromGroup</a>( timer );
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389aeeb9b182a51758e2b1a4c5c495f3bab0">SCRIBE_PARENT_TIMEOUT</a>:
            <span class="comment">// Parent failed, send new join to rejoin group</span>
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(++<a class="code" href="classScribe.html#a0f5e7eb1fd7f35fddc5ba5cc8f8b59a2">numParentTimeout</a>);
            <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> key = timer-&gt;<a class="code" href="classScribeTimer.html#ac959953fd841d859b3321040be8194cb">getGroup</a>();
            EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;    Parent of group &quot;</span> &lt;&lt; key &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;    failed to send heartbeat, trying to rejoin&quot;</span>
                &lt;&lt; endl;

            <a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>* newJoin = <span class="keyword">new</span> <a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>;
            newJoin-&gt;<a class="code" href="classScribeJoinCall.html#af2cc3c15979329066c08d5ef38753e7d">setGroupId</a>( key );
            newJoin-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#a75df75d7a8ab9a7a3f981aa4cd778a53">SCRIBE_JOINCALL_L</a>(newJoin) );
            <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, key, newJoin);

            GroupList::iterator groupIt = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.find( timer-&gt;<a class="code" href="classScribeTimer.html#ac959953fd841d859b3321040be8194cb">getGroup</a>() );
            <span class="keywordflow">if</span>( groupIt == <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end() ) {
                <span class="comment">// FIXME: should not happen</span>
                <span class="keyword">delete</span> timer;
                <span class="keywordflow">return</span>;
            }
            groupIt-&gt;second.setParentTimer( NULL );
            cancelAndDelete( timer );
            <span class="keywordflow">break</span>;
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="acb546ca959dd268286522017b5d4b0e5"></a><!-- doxytag: member="Scribe::handleUpperMessage" ref="acb546ca959dd268286522017b5d4b0e5" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::handleUpperMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handleUpperMessage gets called of <a class="el" href="classBaseApp.html#a98800700e14545cd84636ca4413f605a" title="checks for message type and calls corresponding method">handleMessage(cMessage* msg)</a> if msg arrivedOn from_upperTier (currently msg gets deleted in this function) </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>the message to handle </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a621d25b1cb1f6aac033860fe8c1dcc80">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00192">192</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classALMSubscribeMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMSubscribeMessage</a>* subscribeMsg = dynamic_cast&lt;ALMSubscribeMessage*&gt;(msg)){
        <a class="code" href="classScribe.html#a97402386c94198d596b5aeb63f9051be" title="Gets called if the local node wants to subscribe to a multicast group.">subscribeToGroup</a>( subscribeMsg-&gt;getGroupId() );
        <span class="keyword">delete</span> msg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classALMLeaveMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMLeaveMessage</a>* leaveMsg = dynamic_cast&lt;ALMLeaveMessage*&gt;(msg)){
        <a class="code" href="classScribe.html#aa74f5da64546fe7af83a77b126dcb96e" title="Gets called if the local node wants to leave a multicast group.">leaveGroup</a>( leaveMsg-&gt;getGroupId() );
        <span class="keyword">delete</span> msg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classALMMulticastMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMMulticastMessage</a>* mcastMsg = dynamic_cast&lt;ALMMulticastMessage*&gt;(msg) ){
        <a class="code" href="classScribe.html#a2581ddfa533c2d99f56c24acbe38f992" title="Delivers a multicast message to the tree&#39;s root.">deliverALMDataToRoot</a>( mcastMsg );
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classALMAnycastMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMAnycastMessage</a>* acastMsg = dynamic_cast&lt;ALMAnycastMessage*&gt;(msg) ){
        <span class="comment">// FIXME: anycast not implemented yet</span>
        EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::handleUpperMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    Anycast message for group &quot;</span> &lt;&lt; acastMsg-&gt;getGroupId() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    ignored: Not implemented yet!&quot;</span>
            &lt;&lt; endl;
        <span class="keyword">delete</span> msg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classALMCreateMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMCreateMessage</a>* createMsg = dynamic_cast&lt;ALMCreateMessage*&gt;(msg) ){
        EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::handleUpperMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    Create message for group &quot;</span> &lt;&lt; createMsg-&gt;getGroupId() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    ignored: Scribe has implicit create on SUBSCRIBE&quot;</span>
            &lt;&lt; endl;
        <span class="keyword">delete</span> msg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classALMDeleteMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">ALMDeleteMessage</a>* deleteMsg = dynamic_cast&lt;ALMDeleteMessage*&gt;(msg) ){
        EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::handleUpperMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    Delete message for group &quot;</span> &lt;&lt; deleteMsg-&gt;getGroupId() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    ignored: Scribe has implicit delete on LEAVE&quot;</span>
            &lt;&lt; endl;
        <span class="keyword">delete</span> msg;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb519fa75d1b5f83c6f5f9d2864ec460"></a><!-- doxytag: member="Scribe::initializeApp" ref="acb519fa75d1b5f83c6f5f9d2864ec460" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::initializeApp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initializes derived class-attributes </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#ac9a059a2cfb67f4c38f462bb1383e795">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00060">60</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( stage != (<a class="code" href="classBaseApp.html#a89836f3b6ddff37e3f101ef463938fd4" title="method to set InitStage">numInitStages</a>()-1))
    {
        <span class="keywordflow">return</span>;
    }
    WATCH(<a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>);
    WATCH(<a class="code" href="classScribe.html#ab90f3a57279a1ebda0c4d8121e8509e0">numJoins</a>);
    WATCH(<a class="code" href="classScribe.html#affdaebbe2ca6bb7a9e3eb88182960d2d">numForward</a>);
    WATCH(<a class="code" href="classScribe.html#a641212fa4a572ae54587949740ab8d3d">forwardBytes</a>);
    WATCH(<a class="code" href="classScribe.html#a853d8728022636a788b202a2b1e1e7d1">numReceived</a>);
    WATCH(<a class="code" href="classScribe.html#a37c505fccd0aadeaf302552e8a2af2fb">receivedBytes</a>);
    WATCH(<a class="code" href="classScribe.html#a03285a1d06823f70b1731de133341e9e">numHeartbeat</a>);
    WATCH(<a class="code" href="classScribe.html#acae5ae71ce72591c9ba807facf5e4a3d">heartbeatBytes</a>);
    WATCH(<a class="code" href="classScribe.html#ac7a1946a873e3515d13cc88a71bf0e71">numSubscriptionRefresh</a>);
    WATCH(<a class="code" href="classScribe.html#ac6627bf966dbe532a7d6bd2e4309dd9b">subscriptionRefreshBytes</a>);
    WATCH(<a class="code" href="classScribe.html#aba94851bce00769ef6cdfb06e017fca5">numChildTimeout</a>);
    WATCH(<a class="code" href="classScribe.html#a0f5e7eb1fd7f35fddc5ba5cc8f8b59a2">numParentTimeout</a>);

    <a class="code" href="classScribe.html#a0b5d9a0106edf407743961d22b42af6e">childTimeout</a> = par(<span class="stringliteral">&quot;childTimeout&quot;</span>);
    <a class="code" href="classScribe.html#a48fccdb07cfed523618216f559b3756e">parentTimeout</a> = par(<span class="stringliteral">&quot;parentTimeout&quot;</span>);

}
</pre></div>
</div>
</div>
<a class="anchor" id="aa74f5da64546fe7af83a77b126dcb96e"></a><!-- doxytag: member="Scribe::leaveGroup" ref="aa74f5da64546fe7af83a77b126dcb96e" args="(const OverlayKey &amp;group)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::leaveGroup </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>group</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gets called if the local node wants to leave a multicast group. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">group</td><td>the ID of the group to leave </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00481">481</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    GroupList::iterator it = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.find( group );
    <span class="keywordflow">if</span>( it != <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end() ){
        it-&gt;second.setSubscription( <span class="keyword">false</span> );
        <a class="code" href="classScribe.html#a0f31427608b0f871a42ba99e65a698f2" title="Chechs wheter there are any subscibers left to a given root.">checkGroupEmpty</a>( it-&gt;second );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab7d3e5d54b88e3fd88937fd35e1c2a7f"></a><!-- doxytag: member="Scribe::refreshChildTimer" ref="ab7d3e5d54b88e3fd88937fd35e1c2a7f" args="(NodeHandle &amp;child, OverlayKey &amp;groupId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::refreshChildTimer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>groupId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Refreshes a child timer. </p>
<p>If a child sends a subscribtion refresh, this method gets called. It finds the subscriptionTimeout timer for the group and reschedules it. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00584">584</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// find timer</span>
    pair&lt;ChildTimeoutList::iterator, ChildTimeoutList::iterator&gt; ret =
        <a class="code" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a>.equal_range( child );
    <span class="comment">// no timer yet?</span>
    <span class="keywordflow">if</span>( ret.first == <a class="code" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a>.end() ) <span class="keywordflow">return</span>;

    <span class="comment">// restart timer</span>
    <span class="keywordflow">for</span>( ChildTimeoutList::iterator it = ret.first; it!=ret.second; ++it) {
        <span class="keywordflow">if</span>( it-&gt;first == child &amp;&amp; it-&gt;second-&gt;getGroup() == groupId ) {
            <a class="code" href="classScribe.html#a98c02498a4dc4e07711a44d85b0c218f" title="Starts a local timer.">startTimer</a>( it-&gt;second );
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4e3cc6abe9e3c0ce6ae46b835daf9988"></a><!-- doxytag: member="Scribe::removeChildFromGroup" ref="a4e3cc6abe9e3c0ce6ae46b835daf9988" args="(const NodeHandle &amp;child, ScribeGroup &amp;group)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::removeChildFromGroup </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classScribeGroup.html">ScribeGroup</a> &amp;&#160;</td>
          <td class="paramname"><em>group</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Removes a child from a multicast group. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00515">515</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// find timer</span>
    <a class="code" href="classScribeTimer.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeTimer</a>* timer = NULL;
    pair&lt;ChildTimeoutList::iterator, ChildTimeoutList::iterator&gt; ret =
        <a class="code" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a>.equal_range( child );
    <span class="keywordflow">if</span>( ret.first != <a class="code" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a>.end() ){
        <span class="keywordflow">for</span>( ChildTimeoutList::iterator it = ret.first; it!=ret.second; ++it) {
            <span class="keywordflow">if</span>( group == it-&gt;second-&gt;getGroup() ) {
                timer = it-&gt;second;
                <a class="code" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a>.erase( it );
                cancelAndDelete( timer );
                <span class="keywordflow">break</span>;
            }
        }
    }

    <span class="comment">// remove child from group&#39;s childrenlist</span>
    group.<a class="code" href="classScribeGroup.html#a6e806f360bd021aa50e47a2e6f38ab28" title="Removes a child from the multicast tree.">removeChild</a>( child );

    <a class="code" href="classScribe.html#a0f31427608b0f871a42ba99e65a698f2" title="Chechs wheter there are any subscibers left to a given root.">checkGroupEmpty</a>( group );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a847d778656eb02ebe1d65b6e667f9b5b"></a><!-- doxytag: member="Scribe::removeChildFromGroup" ref="a847d778656eb02ebe1d65b6e667f9b5b" args="(ScribeTimer *timer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::removeChildFromGroup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribeTimer.html">ScribeTimer</a> *&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Removes a child from a multicast group. </p>
<p>Both the child and the group are determined from the timer message This method gets calld if a subscription timer of a child expires. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00538">538</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp; child = timer-&gt;<a class="code" href="classScribeTimer.html#ac9ef4b88d509ceef5e2ac6f74eef004e">getChild</a>();

    GroupList::iterator groupIt = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.find( timer-&gt;<a class="code" href="classScribeTimer.html#ac959953fd841d859b3321040be8194cb">getGroup</a>() );
    <span class="keywordflow">if</span>( groupIt != <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end() ) {
        <a class="code" href="classScribeGroup.html" title="Capsulates the informations of a scribe multicast group.">ScribeGroup</a>&amp; group = groupIt-&gt;second;
        <span class="comment">// remove child from group&#39;s childrenlist</span>
        group.<a class="code" href="classScribeGroup.html#a6e806f360bd021aa50e47a2e6f38ab28" title="Removes a child from the multicast tree.">removeChild</a>( child );

        <a class="code" href="classScribe.html#a0f31427608b0f871a42ba99e65a698f2" title="Chechs wheter there are any subscibers left to a given root.">checkGroupEmpty</a>( group );
    }

    <span class="comment">// remove timer from timeoutlist</span>
    pair&lt;ChildTimeoutList::iterator, ChildTimeoutList::iterator&gt; ret =
        <a class="code" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a>.equal_range( child );
    <span class="keywordflow">if</span>( ret.first != <a class="code" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a>.end() ) {
        <span class="keywordflow">for</span>( ChildTimeoutList::iterator it = ret.first; it!=ret.second; ++it) {
            <span class="keywordflow">if</span>( it-&gt;second == timer ) {
                <a class="code" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">childTimeoutList</a>.erase( it );
                cancelAndDelete( timer );
                <span class="keywordflow">break</span>;
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a98c02498a4dc4e07711a44d85b0c218f"></a><!-- doxytag: member="Scribe::startTimer" ref="a98c02498a4dc4e07711a44d85b0c218f" args="(ScribeTimer *timer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::startTimer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classScribeTimer.html">ScribeTimer</a> *&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts a local timer. </p>
<p>This method automaticly determines the type of the timer and schedules it accordingly. If the timer is already scheduled, it gets canceled before getting rescheduled. </p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00600">600</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( timer-&gt;isScheduled() ) {
        cancelEvent( timer );
    }

    <span class="keywordtype">int</span> duration = 0;
    <span class="keywordflow">switch</span>( timer-&gt;<a class="code" href="classScribeTimer.html#acf4f5d5f48103ce67f882ae37fea3cb6">getTimerType</a>() ) {
        <span class="keywordflow">case</span> <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389a067db7d950ca6ed16fa6dbfc41effaf1">SCRIBE_HEARTBEAT</a>:
            duration = <a class="code" href="classScribe.html#a48fccdb07cfed523618216f559b3756e">parentTimeout</a>/2;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389ab677cae3fe6259b2a4dbd926fa2af2d5">SCRIBE_SUBSCRIPTION_REFRESH</a>:
            duration = <a class="code" href="classScribe.html#a0b5d9a0106edf407743961d22b42af6e">childTimeout</a>/2;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389aeeb9b182a51758e2b1a4c5c495f3bab0">SCRIBE_PARENT_TIMEOUT</a>:
            duration = <a class="code" href="classScribe.html#a48fccdb07cfed523618216f559b3756e">parentTimeout</a>;
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="ScribeMessage__m_8h.html#a7ea659fc2e855bf8098cb295505d1389abe20d4b0bc80643bf8bf177921b1c998">SCRIBE_CHILD_TIMEOUT</a>:
            duration = <a class="code" href="classScribe.html#a0b5d9a0106edf407743961d22b42af6e">childTimeout</a>;
            <span class="keywordflow">break</span>;
    }
    scheduleAt(simTime() + duration, timer );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a97402386c94198d596b5aeb63f9051be"></a><!-- doxytag: member="Scribe::subscribeToGroup" ref="a97402386c94198d596b5aeb63f9051be" args="(const OverlayKey &amp;groupId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::subscribeToGroup </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>groupId</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gets called if the local node wants to subscribe to a multicast group. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">groupId</td><td>the ID of the group to join </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00459">459</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Scribe::subscribeToGroup() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;   Trying to join group &quot;</span> &lt;&lt; groupId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <span class="comment">// Insert group into grouplist, if not known yet</span>
    pair&lt;GroupList::iterator, bool&gt; groupInserter;
    groupInserter = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.insert( make_pair(groupId, <a class="code" href="classScribeGroup.html" title="Capsulates the informations of a scribe multicast group.">ScribeGroup</a>(groupId)) );

    <span class="comment">// Set subscription status</span>
    groupInserter.first-&gt;second.setSubscription(<span class="keyword">true</span>);

    <span class="comment">// Send join call if I&#39;m not already a forwarder of this group</span>
    <span class="keywordflow">if</span>( groupInserter.second || groupInserter.first-&gt;second.getParent().isUnspecified()) {
        <a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>* m = <span class="keyword">new</span> <a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>;
        m-&gt;<a class="code" href="classScribeJoinCall.html#af2cc3c15979329066c08d5ef38753e7d">setGroupId</a>( groupId );
        m-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#a75df75d7a8ab9a7a3f981aa4cd778a53">SCRIBE_JOINCALL_L</a>(m) );
        <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, m-&gt;<a class="code" href="classScribeJoinCall.html#aa83d04e89928c519627679b8a3dda128">getGroupId</a>(), m);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0696c333a0c17c97b8dad1360fc90ee4"></a><!-- doxytag: member="Scribe::update" ref="a0696c333a0c17c97b8dad1360fc90ee4" args="(const NodeHandle &amp;node, bool joined)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Scribe::update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>joined</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Common API function: informs application about neighbors and own nodeID. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>new or lost neighbor </td></tr>
    <tr><td class="paramname">joined</td><td>new or lost? </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a129d228137df46b04c8b3272b6a32fcc">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="Scribe_8cc_source.html#l00129">129</a> of file <a class="el" href="Scribe_8cc_source.html">Scribe.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// if node is closer to any group i&#39;m root of, subscribe</span>
    <span class="keywordflow">for</span>( GroupList::iterator it = <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.begin(); it != <a class="code" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">groupList</a>.end(); ++it ){
        <span class="comment">// if I&#39;m root ...</span>
        <span class="keywordflow">if</span>( !it-&gt;second.getParent().isUnspecified()
                &amp;&amp; it-&gt;second.getParent() == <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>() ) {
            <a class="code" href="classKeyDistanceComparator.html" title="OverlayKey distance comparator.">KeyDistanceComparator&lt;KeyRingMetric&gt;</a> comp( it-&gt;second.getGroupId() );
            <span class="comment">// ... and new node is closer to groupId</span>
            <span class="keywordflow">if</span>( comp.compare(node.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(), <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>()) &lt; 0){
                <span class="comment">// then the new node is new group root, so send him a subscribe</span>
                <a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>* m = <span class="keyword">new</span> <a class="code" href="classScribeJoinCall.html" title="Class generated from applications/scribe/ScribeMessage.msg by opp_msgc.">ScribeJoinCall</a>;
                m-&gt;<a class="code" href="classScribeJoinCall.html#af2cc3c15979329066c08d5ef38753e7d">setGroupId</a>( it-&gt;second.getGroupId() );
                m-&gt;setBitLength( <a class="code" href="ScribeMessage__m_8h.html#a75df75d7a8ab9a7a3f981aa4cd778a53">SCRIBE_JOINCALL_L</a>(m) );
                <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, node, m);
            }
        }
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a0b5d9a0106edf407743961d22b42af6e"></a><!-- doxytag: member="Scribe::childTimeout" ref="a0b5d9a0106edf407743961d22b42af6e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#a0b5d9a0106edf407743961d22b42af6e">Scribe::childTimeout</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00065">65</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a52fbce24148d781c051c87cd58892a4d"></a><!-- doxytag: member="Scribe::childTimeoutList" ref="a52fbce24148d781c051c87cd58892a4d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classScribe.html#acc99c38af11034ffea0b04b71289c7f3">ChildTimeoutList</a> <a class="el" href="classScribe.html#a52fbce24148d781c051c87cd58892a4d">Scribe::childTimeoutList</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00063">63</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a641212fa4a572ae54587949740ab8d3d"></a><!-- doxytag: member="Scribe::forwardBytes" ref="a641212fa4a572ae54587949740ab8d3d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#a641212fa4a572ae54587949740ab8d3d">Scribe::forwardBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00075">75</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a61f843f850ba4c62962fae26af71348b"></a><!-- doxytag: member="Scribe::groupList" ref="a61f843f850ba4c62962fae26af71348b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classScribe.html#a0ac5867b8c55ca9b6d551a40be14cab8">GroupList</a> <a class="el" href="classScribe.html#a61f843f850ba4c62962fae26af71348b">Scribe::groupList</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00061">61</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="acae5ae71ce72591c9ba807facf5e4a3d"></a><!-- doxytag: member="Scribe::heartbeatBytes" ref="acae5ae71ce72591c9ba807facf5e4a3d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#acae5ae71ce72591c9ba807facf5e4a3d">Scribe::heartbeatBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00079">79</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="aba94851bce00769ef6cdfb06e017fca5"></a><!-- doxytag: member="Scribe::numChildTimeout" ref="aba94851bce00769ef6cdfb06e017fca5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#aba94851bce00769ef6cdfb06e017fca5">Scribe::numChildTimeout</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00072">72</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="affdaebbe2ca6bb7a9e3eb88182960d2d"></a><!-- doxytag: member="Scribe::numForward" ref="affdaebbe2ca6bb7a9e3eb88182960d2d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#affdaebbe2ca6bb7a9e3eb88182960d2d">Scribe::numForward</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00074">74</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a03285a1d06823f70b1731de133341e9e"></a><!-- doxytag: member="Scribe::numHeartbeat" ref="a03285a1d06823f70b1731de133341e9e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#a03285a1d06823f70b1731de133341e9e">Scribe::numHeartbeat</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00078">78</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab90f3a57279a1ebda0c4d8121e8509e0"></a><!-- doxytag: member="Scribe::numJoins" ref="ab90f3a57279a1ebda0c4d8121e8509e0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#ab90f3a57279a1ebda0c4d8121e8509e0">Scribe::numJoins</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00071">71</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0f5e7eb1fd7f35fddc5ba5cc8f8b59a2"></a><!-- doxytag: member="Scribe::numParentTimeout" ref="a0f5e7eb1fd7f35fddc5ba5cc8f8b59a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#a0f5e7eb1fd7f35fddc5ba5cc8f8b59a2">Scribe::numParentTimeout</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00073">73</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a853d8728022636a788b202a2b1e1e7d1"></a><!-- doxytag: member="Scribe::numReceived" ref="a853d8728022636a788b202a2b1e1e7d1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#a853d8728022636a788b202a2b1e1e7d1">Scribe::numReceived</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00076">76</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac7a1946a873e3515d13cc88a71bf0e71"></a><!-- doxytag: member="Scribe::numSubscriptionRefresh" ref="ac7a1946a873e3515d13cc88a71bf0e71" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#ac7a1946a873e3515d13cc88a71bf0e71">Scribe::numSubscriptionRefresh</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00080">80</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a48fccdb07cfed523618216f559b3756e"></a><!-- doxytag: member="Scribe::parentTimeout" ref="a48fccdb07cfed523618216f559b3756e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#a48fccdb07cfed523618216f559b3756e">Scribe::parentTimeout</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00066">66</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a37c505fccd0aadeaf302552e8a2af2fb"></a><!-- doxytag: member="Scribe::receivedBytes" ref="a37c505fccd0aadeaf302552e8a2af2fb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#a37c505fccd0aadeaf302552e8a2af2fb">Scribe::receivedBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00077">77</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac6627bf966dbe532a7d6bd2e4309dd9b"></a><!-- doxytag: member="Scribe::subscriptionRefreshBytes" ref="ac6627bf966dbe532a7d6bd2e4309dd9b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classScribe.html#ac6627bf966dbe532a7d6bd2e4309dd9b">Scribe::subscriptionRefreshBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00081">81</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5e762e21cb4902f509b5f53f5da8bf0c"></a><!-- doxytag: member="Scribe::subscriptionTimer" ref="a5e762e21cb4902f509b5f53f5da8bf0c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classScribeTimer.html">ScribeTimer</a>* <a class="el" href="classScribe.html#a5e762e21cb4902f509b5f53f5da8bf0c">Scribe::subscriptionTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Scribe_8h_source.html#l00068">68</a> of file <a class="el" href="Scribe_8h_source.html">Scribe.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Scribe_8h_source.html">Scribe.h</a></li>
<li><a class="el" href="Scribe_8cc_source.html">Scribe.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classScribe.html">Scribe</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:07:01 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
