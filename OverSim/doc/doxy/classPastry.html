<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: Pastry Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classPastry.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<div class="title">Pastry Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="Pastry" --><!-- doxytag: inherits="BasePastry" -->
<p><a class="el" href="classPastry.html" title="Pastry overlay module.">Pastry</a> overlay module.  
 <a href="classPastry.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="Pastry_8h_source.html">Pastry.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Pastry:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classPastry.png" usemap="#Pastry_map" alt=""/>
  <map id="Pastry_map" name="Pastry_map">
<area href="classBasePastry.html" alt="BasePastry" shape="rect" coords="172,168,277,192"/>
<area href="classBaseOverlay.html" title="Base class for overlays." alt="BaseOverlay" shape="rect" coords="115,112,220,136"/>
<area href="classProxListener.html" alt="ProxListener" shape="rect" coords="230,112,335,136"/>
<area href="classBaseRpc.html" title="Base class for RPCs." alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classTopologyVis.html" alt="TopologyVis" shape="rect" coords="230,56,335,80"/>
<area href="classRpcListener.html" title="A Remote-Procedure-Call listener class." alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
 </div></div>

<p><a href="classPastry-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ad850c987f39b8fe66f9d2da8e351ef7a">~Pastry</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#afe58f82e796e3f1ad6cc736fed856e3c">initializeOverlay</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes derived-class-attributes.  <a href="#afe58f82e796e3f1ad6cc736fed856e3c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#aabc1a8eaab8eea9ec5e4830ee60499f8">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a47fc606cfbb1977305f97c60c3c21481">handleUDPMessage</a> (<a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes messages from underlay.  <a href="#a47fc606cfbb1977305f97c60c3c21481"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a1dece33e7864cc0f823374daa28da6c9">handleStateMessage</a> (<a class="el" href="classPastryStateMessage.html">PastryStateMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">processes state messages, merging with own state tables  <a href="#a1dece33e7864cc0f823374daa28da6c9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a5d3a97713d0a9653e64d252297d41c15">pingResponse</a> (<a class="el" href="classPingResponse.html">PingResponse</a> *pingResponse, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a8899e17ebdaf922877b308b6e6408feb">purgeVectors</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">delete all information/messages caching vectors, used for restarting overlay or <a class="el" href="classBaseOverlay.html#aed7e3f36b2c70cbdb0e6daa32925917c" title="collects statistical data">finish()</a>  <a href="#a8899e17ebdaf922877b308b6e6408feb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a14a0a29c8c62c586425b174b9a1504d8">handleRpcCall</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes Remote-Procedure-Call invocation messages.  <a href="#a14a0a29c8c62c586425b174b9a1504d8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a2781a35f40c1531a1df46fe7231ca7cc">handlePastryJoinCall</a> (<a class="el" href="classPastryJoinCall.html">PastryJoinCall</a> *call)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#adf9cf5b5ca0fc054102179df5174c2ad">handleRequestStateCall</a> (<a class="el" href="classRequestStateCall.html">RequestStateCall</a> *call)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a906a430e629f4aeb2bb5e38e767d4a78">handleRequestRepairCall</a> (<a class="el" href="classRequestRepairCall.html">RequestRepairCall</a> *call)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ae51a0a4846c1e44f2b383bcc1bda5640">handleRpcResponse</a> (<a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *msg, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC response has been received.  <a href="#ae51a0a4846c1e44f2b383bcc1bda5640"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a2017b9e580134416db45159f9585c6bf">handlePastryJoinResponse</a> (<a class="el" href="classPastryJoinResponse.html">PastryJoinResponse</a> *response)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#acf0d306c315c3745fb5b63a2158db286">handleRequestStateResponse</a> (<a class="el" href="classRequestStateResponse.html">RequestStateResponse</a> *response)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a6ef8b8e0067f81f2579bfbb1d789fbe3">handleRequestRepairResponse</a> (<a class="el" href="classRequestRepairResponse.html">RequestRepairResponse</a> *response)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a11e13b36752da53944e090d845588075">handleRequestLeafSetResponse</a> (<a class="el" href="classRequestLeafSetResponse.html">RequestLeafSetResponse</a> *response)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a3723e844ab5f2be793b4cd7bf6b03318">handleRequestRoutingRowResponse</a> (<a class="el" href="classRequestRoutingRowResponse.html">RequestRoutingRowResponse</a> *response)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#aa8cb76965e9144823d6525b724668807">handleRpcTimeout</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *call, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, cPolymorphic *context, int rpcId, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC timeout has been reached.  <a href="#aa8cb76965e9144823d6525b724668807"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a2b363b914b911dcbc411da940efec08f">changeState</a> (int toState)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">changes node state  <a href="#a2b363b914b911dcbc411da940efec08f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ab467d712a7a56dece193bce66bd635d6">recursiveRoutingHook</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, <a class="el" href="classBaseRouteMessage.html">BaseRouteMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Hook for forwarded message in recursive lookup mode.  <a href="#ab467d712a7a56dece193bce66bd635d6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ac202a93b3945381918d13b92060ff1da">iterativeJoinHook</a> (<a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg, bool incrHopCount)</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structPastryStateMsgHandle.html">PastryStateMsgHandle</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a124da5018df353375c1b1b3af057c646">stReceived</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">State messages to process during join.  <a href="#a124da5018df353375c1b1b3af057c646"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector<br class="typebreak"/>
&lt; <a class="el" href="structPastryStateMsgHandle.html">PastryStateMsgHandle</a> &gt;<br class="typebreak"/>
::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classTransportAddress.html">TransportAddress</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3">notifyList</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">List of nodes to notify after join.  <a href="#abaf6ee84a60273e509e713fabe4b25e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classPastrySendState.html">PastrySendState</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ace3cd9ad6803c901a4de28d17f960d86">clearVectors</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a13e50eccbed545c79aed4d1f2d9ac9ae">doSecondStage</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">do the second stage of initialization as described in the paper  <a href="#a13e50eccbed545c79aed4d1f2d9ac9ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a08e9157d1221cded34f870c3abc934f7">doRoutingTableMaintenance</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">periodic routing table maintenance requests the corresponding routing table row from one node in each row  <a href="#a08e9157d1221cded34f870c3abc934f7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ad94a0f122fe78b1b0002735ce19fea84">handleFailedNode</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;failed)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">notifies leafset and routingtable of a failed node and sends out a repair request if possible  <a href="#ad94a0f122fe78b1b0002735ce19fea84"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a851bb0830162f5db79ef515f32c78465">checkProxCache</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">checks whether proxCache is complete, takes appropriate actions depending on the protocol state  <a href="#a851bb0830162f5db79ef515f32c78465"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a38e3a1a5d04f570e8361b64ea59f1915">mergeState</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a4a681c9a40631e27cdb8a174ce8e2618">endProcessingState</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#aa8358704c2a16e2723f048c4bcbe2922">doJoinUpdate</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">send updated state to all nodes when entering ready state  <a href="#aa8358704c2a16e2723f048c4bcbe2922"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a06fbfdc4446ac0cfe149eadbb6e59962">joinOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Join the overlay with a given nodeID in thisNode.key.  <a href="#a06fbfdc4446ac0cfe149eadbb6e59962"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a8bfd42826bb62ca0be9bcdd0ee2fc52d">sendStateDelayed</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;destination)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">send a standard state message with a small delay  <a href="#a8bfd42826bb62ca0be9bcdd0ee2fc52d"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">secondStageInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a6531029cc05c41c94976078bf0abd93a">partialJoinPath</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a662c8e13ab30edeeb36c591bcffed4c0">discoveryModeProbedNodes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ab6abf133583dc4f91ae74fcb7ad2d188">updateCounter</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a76def04af940e240a50c48e6040cee2b">useSecondStage</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#ad2cab4f64253005e4cc67e1e116b8d77">useRoutingTableMaintenance</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#af80b068d6f88b70026caa7e5b2637b62">overrideOldPastry</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a5a7acb21ccf23165142efa88bae71e52">overrideNewPastry</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#aca67080bf2f219f3c1cd2eca39188aba">ringCheck</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classPastry.html" title="Pastry overlay module.">Pastry</a> overlay module. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Felix Palmen </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="classBaseOverlay.html" title="Base class for overlays.">BaseOverlay</a> </dd></dl>

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00053">53</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ad850c987f39b8fe66f9d2da8e351ef7a"></a><!-- doxytag: member="Pastry::~Pastry" ref="ad850c987f39b8fe66f9d2da8e351ef7a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Pastry::~Pastry </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00039">39</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// destroy self timer messages</span>
    cancelAndDelete(<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
    cancelAndDelete(<a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a>);
    cancelAndDelete(<a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a>);
    <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a>) cancelAndDelete(<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
    <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a> &gt; 0) cancelAndDelete(<a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>);

    <a class="code" href="classPastry.html#ace3cd9ad6803c901a4de28d17f960d86">clearVectors</a>();
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a2b363b914b911dcbc411da940efec08f"></a><!-- doxytag: member="Pastry::changeState" ref="a2b363b914b911dcbc411da940efec08f" args="(int toState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::changeState </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>toState</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>changes node state </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">toState</td><td>state to change to </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBasePastry.html#ab9eeefa3a6a0dc3d56860a7d45bc585c">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00161">161</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00939">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l01193">handleStateMessage()</a>, <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>, and <a class="el" href="Pastry_8cc_source.html#l00145">joinOverlay()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>-&gt;isScheduled()) cancelEvent(<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
    <a class="code" href="classBasePastry.html#a1f99c5e7da561015851b206abb4d0f59" title="changes node state, but leaves specific behavour, scheduling tasks in particular, to the inheriting p...">baseChangeState</a>(toState);

    <span class="keywordflow">switch</span> (toState) {
    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>:
        <a class="code" href="classBaseRpc.html#a77fe0a21bb12ab2fb8e27eb719b2d2fe" title="Cancels all RPCs.">cancelAllRpcs</a>();
        <a class="code" href="classPastry.html#a8899e17ebdaf922877b308b6e6408feb" title="delete all information/messages caching vectors, used for restarting overlay or finish()">purgeVectors</a>();
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa6f9e50300f12679850ddc29f15cdf37b">DISCOVERY</a>: {
        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa6f9e50300f12679850ddc29f15cdf37b">DISCOVERY</a>;
        <a class="code" href="classBasePastry.html#a715b166d2b3b397e047908f52f354be7">nearNodeRtt</a> = MAXTIME;
        <a class="code" href="classPastry.html#a662c8e13ab30edeeb36c591bcffed4c0">discoveryModeProbedNodes</a> = 0;
        <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(<a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>, <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, 0,
                 NULL, <span class="stringliteral">&quot;PING bootstrapNode in discovery mode&quot;</span>,
                 NULL, <a class="code" href="classBasePastry.html#a26eda810c876c5062a849e9e0fb7e2b8a6232e475e9da2c6b20ef4cacd1246601">PING_DISCOVERY</a>, <a class="code" href="CommonMessages__m_8h.html#aca1e72535e7f260e54ed8bbf984dade9a01580b2e886cd821bd7f3f2bcd7c690c">UDP_TRANSPORT</a>); <span class="comment">//TODO</span>

        <a class="code" href="classRequestLeafSetCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestLeafSetCall</a>* call =
            <span class="keyword">new</span> <a class="code" href="classRequestLeafSetCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestLeafSetCall</a>(<span class="stringliteral">&quot;REQUEST LEAFSET Call&quot;</span>);
        call-&gt;<a class="code" href="classBaseOverlayMessage.html#a07301be10c346b328a0a9cc4cae48777">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
        call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#ae4a17bae7faeed6a6c46cac07ad68d8d">PASTRYREQUESTLEAFSETCALL_L</a>(call));
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a26cf01f1f60f7c76ec071d551d2bc77e">leafsetReqSent</a>++;
                     <a class="code" href="classBasePastry.html#ab200043644da860d9d8c260fb6735053">leafsetReqBytesSent</a> += call-&gt;getByteLength());
        <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(<a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>, call);

        <a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> = -1;
    }
    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>: {
        <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> = 0;

        <a class="code" href="classPastryJoinCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinCall</a>* call = <span class="keyword">new</span> <a class="code" href="classPastryJoinCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinCall</a>(<span class="stringliteral">&quot;JOIN Call&quot;</span>);
        call-&gt;<a class="code" href="classBaseOverlayMessage.html#a07301be10c346b328a0a9cc4cae48777">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
        call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#aab42401451c980d6e53e28cb4fbdcd1c">PASTRYJOINCALL_L</a>(msg));
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#ae75ddd4630ea3004166c0283436af0e9">joinSent</a>++; <a class="code" href="classBasePastry.html#a8bf579a017df30ccb1cf458a78a78f79">joinBytesSent</a> += call-&gt;getByteLength());
        <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, <a class="code" href="classBasePastry.html#af28427241a54155e6f9bf8539286ec9a">nearNode</a>, <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(), call);
    }
    <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>:
        <span class="comment">// determine list of all known nodes as notifyList</span>
        <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();
        <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#a529939c1a02749c1b18300404172c6ad" title="appends all leaf set entries to a given vector of TransportAddresses, needed to find all Nodes to be ...">dumpToVector</a>(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>);
        <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#aed1ca355690a9e0354a420bf7c96e3a4" title="appends all routing table entries to a given vector of TransportAddresses, needed to find all Nodes t...">dumpToVector</a>(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>);
        sort(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end());
        <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.erase(unique(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end()),
                         <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end());

        <span class="comment">// schedule update</span>
        cancelEvent(<a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a>);
        scheduleAt(simTime() + 0.0001, <a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a>);

        <span class="comment">// schedule second stage</span>
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a76def04af940e240a50c48e6040cee2b">useSecondStage</a>) {
            cancelEvent(<a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a>);
            scheduleAt(simTime() + <a class="code" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">secondStageInterval</a>, <a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a>);
        }

        <span class="comment">// schedule routing table maintenance task</span>
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#ad2cab4f64253005e4cc67e1e116b8d77">useRoutingTableMaintenance</a>) {
            cancelEvent(<a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>);
            scheduleAt(simTime() + <a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a>, <a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>);
        }
        <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a851bb0830162f5db79ef515f32c78465"></a><!-- doxytag: member="Pastry::checkProxCache" ref="a851bb0830162f5db79ef515f32c78465" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::checkProxCache </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>checks whether proxCache is complete, takes appropriate actions depending on the protocol state </p>

<p>Implements <a class="el" href="classBasePastry.html#a1062cac20a1fd1c5368157fe2da8b8fb">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00939">939</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
       &lt;&lt; endl;

    <span class="comment">// no cached STATE message?</span>
    assert(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> || !<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>);
    <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>) {
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// no entries in stateCache.prox?</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.empty() &amp;&amp;
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.empty() &amp;&amp;
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.empty())
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;ERROR in Pastry: stateCache.prox empty!&quot;</span>);

    <span class="comment">// some entries not yet determined?</span>
    <span class="keywordflow">if</span> ((find(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.begin(), <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.end(),
        <a class="code" href="PastryTypes_8h.html#a095206927871324515b53a7e3417f4ea" title="value for not yet determined proximity value:">PASTRY_PROX_PENDING</a>) != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#afc10e12f0e7f2806255ce8277ece0a62">pr_rt</a>.end()) ||
        (find(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.begin(), <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.end(),
         <a class="code" href="PastryTypes_8h.html#a095206927871324515b53a7e3417f4ea" title="value for not yet determined proximity value:">PASTRY_PROX_PENDING</a>) != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#adbadfcad7fd962f6b3a12c003f873dfb">pr_ls</a>.end()) ||
        (find(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.begin(), <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.end(),
         <a class="code" href="PastryTypes_8h.html#a095206927871324515b53a7e3417f4ea" title="value for not yet determined proximity value:">PASTRY_PROX_PENDING</a>) != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>-&gt;<a class="code" href="structPastryStateMsgProximity.html#a564d4bd5da4adead22fc4ef02d9c1c91">pr_ns</a>.end())) {

        <span class="keywordflow">return</span>;
    }

    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    all proximities for current STATE message from &quot;</span>
       &lt;&lt; <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; collected!&quot;</span>
       &lt;&lt; endl;

    simtime_t now = simTime();

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>) {
        <span class="comment">// save pointer to proximity vectors (it is NULL until now):</span>
        <a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a>-&gt;prox = <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>;

        <span class="comment">// collected proximities for all STATE messages?</span>
        <span class="keywordflow">if</span> (++<a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a> == <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end()) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    proximities for all STATE messages collected!&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> = NULL;
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a> = NULL;
            <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    [JOIN] starting to build own state from &quot;</span>
                   &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt;&lt; <span class="stringliteral">&quot; received state messages...&quot;</span>
                   &lt;&lt; endl;
            }
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a38e3a1a5d04f570e8361b64ea59f1915">mergeState</a>()) {
                <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    changeState(READY) called&quot;</span>
                   &lt;&lt; endl;
            } <span class="keywordflow">else</span> {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Error initializing while joining! Restarting ...&quot;</span>
                   &lt;&lt; endl;
                <a class="code" href="classPastry.html#a06fbfdc4446ac0cfe149eadbb6e59962" title="Join the overlay with a given nodeID in thisNode.key.">joinOverlay</a>();
            }

        } <span class="keywordflow">else</span> {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    NOT all proximities for all STATE messages collected!&quot;</span>
               &lt;&lt; endl;

            <span class="comment">// process next state message in vector:</span>
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a>-&gt;msg == NULL)
                <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;stReceivedPos-&gt;msg = NULL&quot;</span>);
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = *<a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a>;
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> == NULL)
                <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;msg = NULL&quot;</span>);
            <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
        }
    } <span class="keywordflow">else</span> {
        <span class="comment">// state == READY</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a51f4659797b81e09bc35edfded346b7b">PASTRY_STATE_REPAIR</a>) {
            <span class="comment">// try to repair routingtable based on repair message:</span>
            <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; askRt =
                <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a632d81ee59ded7bc2249b64555b3bb78" title="attempt to repair the routing using a received REPAIR message">repair</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>);
            <span class="keywordflow">if</span> (! askRt.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
                <a class="code" href="classRequestRepairCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairCall</a>* call =
                    <span class="keyword">new</span> <a class="code" href="classRequestRepairCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairCall</a>(<span class="stringliteral">&quot;REQUEST REPAIR Call&quot;</span>);
                call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a8f933575a54140da5ac51cbcdcb0666b">PASTRYREQUESTREPAIRCALL_L</a>(call));
                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a5f05d5cba3283f9b1dd421b036959aff">repairReqSent</a>++; <a class="code" href="classBasePastry.html#a9f02a29e59ff2af5c7af5b3a764e711a">repairReqBytesSent</a> += call-&gt;getByteLength());
                <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(askRt, call);
            }

            <span class="comment">// while not really known, it&#39;s safe to assume that a repair</span>
            <span class="comment">// message changed our state:</span>
            <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
        } <span class="keywordflow">else</span> {
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a0907d3b39de28e563bc6bf41c859c00e">outdatedUpdate</a>) {
                <span class="comment">// send another STATE message on outdated state update:</span>
                <a class="code" href="classPastry.html#ab6abf133583dc4f91ae74fcb7ad2d188">updateCounter</a>++;
                <a class="code" href="classPastry.html#a8bfd42826bb62ca0be9bcdd0ee2fc52d" title="send a standard state message with a small delay">sendStateDelayed</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>());
            } <span class="keywordflow">else</span> {
                <span class="comment">// merge info in own state tables</span>
                <span class="comment">// except leafset (was already handled in handleStateMessage)</span>
                <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>))
                    <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Merging nodes into routing table&quot;</span>
                   &lt;&lt; endl;
                <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>)) {
                    <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = now;
                    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::checkProxCache() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;    Merged nodes into routing table&quot;</span>
                       &lt;&lt; endl;
                }
            }
        }
        <a class="code" href="classBasePastry.html#abc8da91d0187799f60bddb3ddab3e2f6" title="updates information shown in tk-environment">updateTooltip</a>();

        <a class="code" href="classPastry.html#a4a681c9a40631e27cdb8a174ce8e2618">endProcessingState</a>();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ace3cd9ad6803c901a4de28d17f960d86"></a><!-- doxytag: member="Pastry::clearVectors" ref="ace3cd9ad6803c901a4de28d17f960d86" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::clearVectors </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00052">52</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00073">purgeVectors()</a>, and <a class="el" href="Pastry_8cc_source.html#l00039">~Pastry()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// purge pending state messages</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.empty()) {
        <span class="keywordflow">for</span> (std::vector&lt;PastryStateMsgHandle&gt;::iterator it =
            <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin(); it != <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end(); it++) {
            <span class="comment">// check whether one of the pointers is a duplicate of stateCache</span>
            <span class="keywordflow">if</span> (it-&gt;msg == <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>) <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> = NULL;
            <span class="keywordflow">if</span> (it-&gt;prox == <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>) <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a> = NULL;
            <span class="keyword">delete</span> it-&gt;msg;
            <span class="keyword">delete</span> it-&gt;prox;
        }
        <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.clear();
        <a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a> = <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end();
    }

    <span class="comment">// purge notify list:</span>
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa8358704c2a16e2723f048c4bcbe2922"></a><!-- doxytag: member="Pastry::doJoinUpdate" ref="aa8358704c2a16e2723f048c4bcbe2922" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::doJoinUpdate </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send updated state to all nodes when entering ready state </p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00761">761</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// send &quot;update&quot; state message to all nodes who sent us their state</span>
    <span class="comment">// during INIT, remove these from notifyList so they don&#39;t get our</span>
    <span class="comment">// state twice</span>
    std::vector&lt;TransportAddress&gt;::iterator nListPos;
    <span class="keywordflow">if</span> (!<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.empty()) {
        <span class="keywordflow">for</span> (std::vector&lt;PastryStateMsgHandle&gt;::iterator it =
                 <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin(); it != <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end(); ++it) {
            <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* stateMsg =
                 <a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>(<a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a54b61d3690155bcd38468f1a14de088e">PASTRY_STATE_UPDATE</a>,
                                    it-&gt;msg-&gt;getTimestamp());
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#aadec419a4c2560717f1db3e36866b837">stateSent</a>++;
                         <a class="code" href="classBasePastry.html#a43218c86ea28a36b14f76b54b2ccea07">stateBytesSent</a> += stateMsg-&gt;getByteLength());
            <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(it-&gt;msg-&gt;getSender(), stateMsg);

            nListPos = find(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end(),
                            it-&gt;msg-&gt;getSender());
            <span class="keywordflow">if</span> (nListPos != <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end()) {
                <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.erase(nListPos);
            }
            <span class="keyword">delete</span> it-&gt;msg;
            <span class="keyword">delete</span> it-&gt;prox;
        }
        <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.clear();
    }

    <span class="comment">// send a normal STATE message to all remaining known nodes</span>
    <span class="keywordflow">for</span> (std::vector&lt;TransportAddress&gt;::iterator it =
             <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(); it != <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end(); it++) {
        <span class="keywordflow">if</span> (*it != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
            <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* stateMsg =
                <a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>(<a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7aa3cde395106c55f5fb90538d45fdd46c">PASTRY_STATE_JOINUPDATE</a>);
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#aadec419a4c2560717f1db3e36866b837">stateSent</a>++;
                         stateBytesSent += stateMsg-&gt;getByteLength());
            <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(*it, stateMsg);
        }
    }
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();

    <a class="code" href="classBasePastry.html#abc8da91d0187799f60bddb3ddab3e2f6" title="updates information shown in tk-environment">updateTooltip</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a08e9157d1221cded34f870c3abc934f7"></a><!-- doxytag: member="Pastry::doRoutingTableMaintenance" ref="a08e9157d1221cded34f870c3abc934f7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::doRoutingTableMaintenance </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>periodic routing table maintenance requests the corresponding routing table row from one node in each row </p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00859">859</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a449b7e0abcd2be8a93816669201bfc4c" title="gets the number of rows in the routing table">getLastRow</a>(); i++) {
        <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; ask4row = <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#a37d02a2bda67fe9618b382f321a532d3" title="returns a random node from the routing table">getRandomNode</a>(i);

        assert(!dynamic_cast&lt;const NodeHandle&amp;&gt;(ask4row).getKey().isUnspecified());

        <span class="keywordflow">if</span> ((!ask4row.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) &amp;&amp; (ask4row != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)) {
            <a class="code" href="classRequestRoutingRowCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRoutingRowCall</a>* call =
                <span class="keyword">new</span> <a class="code" href="classRequestRoutingRowCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRoutingRowCall</a>(<span class="stringliteral">&quot;REQUEST ROUTING ROW Call&quot;</span>);
            call-&gt;<a class="code" href="classBaseOverlayMessage.html#a07301be10c346b328a0a9cc4cae48777">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
            call-&gt;<a class="code" href="classRequestRoutingRowCall.html#ae7fe893a792196e34510975a00503b26">setRow</a>(i + 1);
            call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a6c7bf6c9f0135ddd1b0c3e06cb92c270">PASTRYREQUESTROUTINGROWCALL_L</a>(call));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a1a1785687d9560edfe30d6b4f8d5c31f">routingTableRowReqSent</a>++;
            <a class="code" href="classBasePastry.html#a836e8dcea673d81c8e2a68500becd084">routingTableRowReqBytesSent</a> += call-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(ask4row, call);
        } <span class="keywordflow">else</span> {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::doRoutingTableMaintenance() @ &quot;</span>
               &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    could not send Message to Node in Row&quot;</span> &lt;&lt; i
               &lt;&lt; endl;
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a13e50eccbed545c79aed4d1f2d9ac9ae"></a><!-- doxytag: member="Pastry::doSecondStage" ref="a13e50eccbed545c79aed4d1f2d9ac9ae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::doSecondStage </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>do the second stage of initialization as described in the paper </p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00804">804</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    getParentModule()-&gt;getParentModule()-&gt;bubble(<span class="stringliteral">&quot;entering SECOND STAGE&quot;</span>);

    <span class="comment">// probe nodes in local state</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ae13d5a42c50606e3cc0fbcd830429322" title="check if LeafSet knows at least one node to the left and to the right">isValid</a>()) {
        <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* stateMsg = <a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>();

        <a class="code" href="structPastryStateMsgHandle.html" title="struct-type containing local info while processing a STATE message">PastryStateMsgHandle</a> handle(stateMsg);

        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>) {
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = handle;
            <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
        } <span class="keywordflow">else</span> {
            <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.push(handle);
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.size() &gt; 15) {
                <span class="keyword">delete</span> <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.front().msg;
                <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.pop();
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::doSecondStage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    stateCacheQueue full -&gt; pop()&quot;</span> &lt;&lt; endl;
            }
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a>) {
                <a class="code" href="classBasePastry.html#af6a7090deb645b1f79b33edb0409485c" title="ping all nodes in a given state message.">prePing</a>(stateMsg);
            }
        }
    }

    <span class="comment">// &quot;second stage&quot; for locality:</span>
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();
    <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#aed1ca355690a9e0354a420bf7c96e3a4" title="appends all routing table entries to a given vector of TransportAddresses, needed to find all Nodes t...">dumpToVector</a>(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>);
    <a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryNeighborhoodSet.html#ac0741c4c45fb5176e207dadc67a20a03" title="appends all neighborhood set entries to a given vector of TransportAddresses, needed to find all Node...">dumpToVector</a>(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>);
    sort(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end());
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.erase(unique(<a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin(), <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end()),
                     <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end());
    <span class="keywordflow">for</span> (std::vector&lt;TransportAddress&gt;::iterator it = <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.begin();
         it != <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.end(); it++) {
        <span class="keywordflow">if</span> (*it == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) <span class="keywordflow">continue</span>;

        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::doSecondStage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    second stage: requesting state from &quot;</span> &lt;&lt; *it
           &lt;&lt; endl;

        <a class="code" href="classRequestStateCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestStateCall</a>* call =
            <span class="keyword">new</span> <a class="code" href="classRequestStateCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestStateCall</a>(<span class="stringliteral">&quot;REQUEST STATE Call&quot;</span>);
        call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a8f933575a54140da5ac51cbcdcb0666b">PASTRYREQUESTREPAIRCALL_L</a>(call));
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#addc36312daa0ac4c85e4e8d77ee17ae5">stateReqSent</a>++;
                     <a class="code" href="classBasePastry.html#a79163b2c9ee6767a5844c10b3a273af2">stateReqBytesSent</a> += call-&gt;getByteLength());
        <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(*it, call);
    }
    <a class="code" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3" title="List of nodes to notify after join.">notifyList</a>.clear();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4a681c9a40631e27cdb8a174ce8e2618"></a><!-- doxytag: member="Pastry::endProcessingState" ref="a4a681c9a40631e27cdb8a174ce8e2618" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::endProcessingState </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l01070">1070</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00939">checkProxCache()</a>, and <a class="el" href="Pastry_8cc_source.html#l01410">processState()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// if state message was not an update, send one back:</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> &amp;&amp;
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() != <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a54b61d3690155bcd38468f1a14de088e">PASTRY_STATE_UPDATE</a> &amp;&amp;
        (<a class="code" href="classBasePastry.html#a26f8166e84753ec35921c7cff3ff10d9">alwaysSendUpdate</a> || <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> == simTime()) &amp;&amp;
        !<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>().<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>() &amp;&amp;
        <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> != <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>()) {<span class="comment">//hack</span>
        <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* stateMsg =
            <a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>(<a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a54b61d3690155bcd38468f1a14de088e">PASTRY_STATE_UPDATE</a>,
                               <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a64e104bf42d6785530fba51af52bc44c">getTimestamp</a>());
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#aadec419a4c2560717f1db3e36866b837">stateSent</a>++;
                     <a class="code" href="classBasePastry.html#a43218c86ea28a36b14f76b54b2ccea07">stateBytesSent</a> += stateMsg-&gt;getByteLength());

        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>(), stateMsg);
    }

    <span class="keyword">delete</span> <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>;
    <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> = NULL;
    <span class="keyword">delete</span> <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a>;
    <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a> = NULL;

    <span class="comment">// process next queued message:</span>
    <span class="keywordflow">if</span> (! <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.empty()) {
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.front();
        <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.pop();
        <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad94a0f122fe78b1b0002735ce19fea84"></a><!-- doxytag: member="Pastry::handleFailedNode" ref="ad94a0f122fe78b1b0002735ce19fea84" args="(const TransportAddress &amp;failed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Pastry::handleFailedNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>failed</em></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>notifies leafset and routingtable of a failed node and sends out a repair request if possible </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">failed</td><td>the failed node </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true as long as local state is READY (signals lookup to try again) </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#aa53ca4e1b4720ba0d2874afe29eacbf7">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00886">886</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00382">handlePastryJoinCall()</a>, and <a class="el" href="Pastry_8cc_source.html#l00696">recursiveRoutingHook()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="keywordtype">bool</span> wasValid = <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ae13d5a42c50606e3cc0fbcd830429322" title="check if LeafSet knows at least one node to the left and to the right">isValid</a>();

    <span class="keywordflow">if</span> (failed.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>())
        opp_error(<span class="stringliteral">&quot;Pastry::handleFailedNode(): failed is unspecified!&quot;</span>);

    <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; lsAsk = <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ad691bdd611ba773d5b7a0a90af491498" title="tells the leafset that a node has failed">failedNode</a>(failed);
    <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; rtAsk = <a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#ae440c8aa89543afc2147b8784be93c41" title="tells the routing table that a node has failed">failedNode</a>(failed);
    <a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryNeighborhoodSet.html#a86f227b707f881c8897ec334f2bd5a33" title="tell the neighborhood set about a failed node">failedNode</a>(failed);

    <span class="keywordflow">if</span> (!lsAsk.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a>) {
            <a class="code" href="classRequestRepairCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairCall</a>* call =
                <span class="keyword">new</span> <a class="code" href="classRequestRepairCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairCall</a>(<span class="stringliteral">&quot;REQUEST REPAIR Call&quot;</span>);
            call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a8f933575a54140da5ac51cbcdcb0666b">PASTRYREQUESTREPAIRCALL_L</a>(call));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a5f05d5cba3283f9b1dd421b036959aff">repairReqSent</a>++;
                         <a class="code" href="classBasePastry.html#a9f02a29e59ff2af5c7af5b3a764e711a">repairReqBytesSent</a> += call-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(lsAsk, call);
        } <span class="keywordflow">else</span> {
            <a class="code" href="classRequestLeafSetCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestLeafSetCall</a>* call =
                <span class="keyword">new</span> <a class="code" href="classRequestLeafSetCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestLeafSetCall</a>(<span class="stringliteral">&quot;REQUEST LEAFSET Call&quot;</span>);
            call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#ae4a17bae7faeed6a6c46cac07ad68d8d">PASTRYREQUESTLEAFSETCALL_L</a>(call));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a26cf01f1f60f7c76ec071d551d2bc77e">leafsetReqSent</a>++;
                         <a class="code" href="classBasePastry.html#ab200043644da860d9d8c260fb6735053">leafsetReqBytesSent</a> += call-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(lsAsk, call);
        }
    }
    <span class="keywordflow">if</span> (!rtAsk.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp; (lsAsk.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() || lsAsk != rtAsk)) {
        <a class="code" href="classRequestRepairCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairCall</a>* call =
            <span class="keyword">new</span> <a class="code" href="classRequestRepairCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairCall</a>(<span class="stringliteral">&quot;REQUEST REPAIR Call&quot;</span>);
        call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a8f933575a54140da5ac51cbcdcb0666b">PASTRYREQUESTREPAIRCALL_L</a>(call));
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a5f05d5cba3283f9b1dd421b036959aff">repairReqSent</a>++; repairReqBytesSent += call-&gt;getByteLength());
        <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(rtAsk, call);
    }

    <span class="keywordflow">if</span> (wasValid &amp;&amp; lsAsk.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() &amp;&amp; (! <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#ae13d5a42c50606e3cc0fbcd830429322" title="check if LeafSet knows at least one node to the left and to the right">isValid</a>())) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleFailedNode() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    lost connection to the network, trying to re-join.&quot;</span>
           &lt;&lt; endl;

        <a class="code" href="classBaseOverlay.html#acb8855faa86247ae37ab894891d9f4dd" title="Join the overlay with a given nodeID.">join</a>();
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2781a35f40c1531a1df46fe7231ca7cc"></a><!-- doxytag: member="Pastry::handlePastryJoinCall" ref="a2781a35f40c1531a1df46fe7231ca7cc" args="(PastryJoinCall *call)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handlePastryJoinCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPastryJoinCall.html">PastryJoinCall</a> *&#160;</td>
          <td class="paramname"><em>call</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00382">382</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00358">handleRpcCall()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handlePastryJoinCall() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
       &lt;&lt; endl;

    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a3d1f5f390900492fb714e0f420ded63a">joinReceived</a>++;
                 <a class="code" href="classBasePastry.html#ab2be7f6fc3c97b1d93f43f083cff6f6a">joinBytesReceived</a> += call-&gt;getByteLength());

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        <span class="keywordflow">if</span> (call-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handlePastryJoinCall() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    PastryJoinCall received by originator!&quot;</span>
               &lt;&lt; endl;
        } <span class="keywordflow">else</span> {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handlePastryJoinCall() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    received join message before reaching &quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;READY state, dropping message!&quot;</span>
               &lt;&lt; endl;
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (call-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>() == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handlePastryJoinCall() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    PastryJoinCall gets dropped because it is &quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;outdated and has been received by originator!&quot;</span>
           &lt;&lt; endl;
    } <span class="keywordflow">else</span> {
        <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>* overlayCtrlInfo =
            check_and_cast&lt;<a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*&gt;(call-&gt;getControlInfo());

        uint32_t <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> =  overlayCtrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#a76fd4681ebb00eb023e35a88e4ba9042">getHopCount</a>();
        <span class="keywordflow">if</span> ((joinHopCount &gt; 1) &amp;&amp;
                ((<a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ae4bd936cbb47803986c83242cbb51867">ITERATIVE_ROUTING</a>) ||
                        (<a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ad60cf756d6bb24af372d7fe7c279f44d">EXHAUSTIVE_ITERATIVE_ROUTING</a>)))
            joinHopCount--;

        <span class="comment">// remove node from state if it is rejoining</span>
        <a class="code" href="classPastry.html#ad94a0f122fe78b1b0002735ce19fea84" title="notifies leafset and routingtable of a failed node and sends out a repair request if possible...">handleFailedNode</a>(call-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>());

        <a class="code" href="classPastryJoinResponse.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinResponse</a>* response = <span class="keyword">new</span> <a class="code" href="classPastryJoinResponse.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinResponse</a>(<span class="stringliteral">&quot;JOIN Response&quot;</span>);

        <span class="comment">// create new state msg and set special fields for some types:</span>
        response-&gt;setStatType(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
        response-&gt;setTimestamp(simTime());

        response-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#ad7441d080f34a8faabe0e36a03d29ef3">PASTRYJOINRESPONSE_L</a>(response));
        response-&gt;encapsulate(<a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>((<a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> ?
                                                  <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7abfbb059d5d48ab5c68f49eb88464171d">PASTRY_STATE_MINJOIN</a> :
                                                  <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a2ca6c13943a398b19f55c7d53529ab4f">PASTRY_STATE_JOIN</a>),
                                                  -1, joinHopCount, <span class="keyword">true</span>));

        <span class="comment">// send...</span>
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#aadec419a4c2560717f1db3e36866b837">stateSent</a>++;
                     <a class="code" href="classBasePastry.html#a43218c86ea28a36b14f76b54b2ccea07">stateBytesSent</a> += response-&gt;getByteLength());

        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(call, response);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2017b9e580134416db45159f9585c6bf"></a><!-- doxytag: member="Pastry::handlePastryJoinResponse" ref="a2017b9e580134416db45159f9585c6bf" args="(PastryJoinResponse *response)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handlePastryJoinResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPastryJoinResponse.html">PastryJoinResponse</a> *&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00594">594</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00519">handleRpcResponse()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handlePastryJoinResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
           &lt;&lt; endl;

    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a26fa765c1f23635923477bc300637c4f">stateReceived</a>++;
                 <a class="code" href="classBasePastry.html#a8783f5db146cf00be3a347e92c36505e">stateBytesReceived</a> += response-&gt;getByteLength());

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>) {
        <a class="code" href="classPastry.html#a1dece33e7864cc0f823374daa28da6c9" title="processes state messages, merging with own state tables">handleStateMessage</a>(check_and_cast&lt;PastryStateMessage*&gt;(response-&gt;decapsulate()));
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a11e13b36752da53944e090d845588075"></a><!-- doxytag: member="Pastry::handleRequestLeafSetResponse" ref="a11e13b36752da53944e090d845588075" args="(RequestLeafSetResponse *response)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleRequestLeafSetResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequestLeafSetResponse.html">RequestLeafSetResponse</a> *&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBasePastry.html#ae745710e7bd27898ded7fe73987ef676">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00623">623</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00519">handleRpcResponse()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRequestLeafSetResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
       &lt;&lt; endl;

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa6f9e50300f12679850ddc29f15cdf37b">DISCOVERY</a>) {
        <span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>* node;
        <a class="code" href="classPastry.html#a662c8e13ab30edeeb36c591bcffed4c0">discoveryModeProbedNodes</a> = 0;
        <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* leaves =
            check_and_cast&lt;<a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>*&gt;(response-&gt;getEncapsulatedPacket());
        <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; leaves-&gt;<a class="code" href="classPastryStateMessage.html#ad792f9b41aee54969504dee46452252c">getLeafSetArraySize</a>(); ++i) {
            node = &amp;(leaves-&gt;<a class="code" href="classPastryStateMessage.html#a27c65fc289c9baa8121a8be1977839cd">getLeafSet</a>(i));
            <span class="comment">// unspecified nodes not considered</span>
            <span class="keywordflow">if</span> ( !(node-&gt;<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>()) ) {
                <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(*node, <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, 0,
                         NULL, <span class="stringliteral">&quot;PING received leaves for nearest node&quot;</span>,
                         NULL, -1, <a class="code" href="CommonMessages__m_8h.html#aca1e72535e7f260e54ed8bbf984dade9a01580b2e886cd821bd7f3f2bcd7c690c">UDP_TRANSPORT</a>); <span class="comment">//TODO</span>
                <a class="code" href="classPastry.html#a662c8e13ab30edeeb36c591bcffed4c0">discoveryModeProbedNodes</a>++;
            }
        }

        EV &lt;&lt; <span class="stringliteral">&quot;    received leafset, waiting for pings&quot;</span>
           &lt;&lt; endl;

        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>-&gt;isScheduled()) cancelEvent(<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
        scheduleAt(simTime() + <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, <a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a906a430e629f4aeb2bb5e38e767d4a78"></a><!-- doxytag: member="Pastry::handleRequestRepairCall" ref="a906a430e629f4aeb2bb5e38e767d4a78" args="(RequestRepairCall *call)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleRequestRepairCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequestRepairCall.html">RequestRepairCall</a> *&#160;</td>
          <td class="paramname"><em>call</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00474">474</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00358">handleRpcCall()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRequestRepairCall() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
       &lt;&lt; endl;

    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a7dcde1eb4abe361da782106038325c04">repairReqReceived</a>++;
                 <a class="code" href="classBasePastry.html#aee11180f103683fc2a55d4c8958078d0">repairReqBytesReceived</a> += call-&gt;getByteLength());

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;    received repair request before reaching&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot; READY state, dropping message!&quot;</span>
           &lt;&lt; endl;
        <span class="keyword">delete</span> call;
        <span class="keywordflow">return</span>;
    }

    <a class="code" href="classRequestRepairResponse.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairResponse</a>* response =
        <span class="keyword">new</span> <a class="code" href="classRequestRepairResponse.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairResponse</a>(<span class="stringliteral">&quot;REQUEST REPAIR Response&quot;</span>);
    response-&gt;<a class="code" href="classBaseOverlayMessage.html#a07301be10c346b328a0a9cc4cae48777">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);

    response-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a19a9cb29399732dbd564737e1dbdfb38">PASTRYREQUESTREPAIRRESPONSE_L</a>(response));
    response-&gt;encapsulate(<a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>(<a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a51f4659797b81e09bc35edfded346b7b">PASTRY_STATE_REPAIR</a>));
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#aadec419a4c2560717f1db3e36866b837">stateSent</a>++;
                 <a class="code" href="classBasePastry.html#a43218c86ea28a36b14f76b54b2ccea07">stateBytesSent</a> += response-&gt;getByteLength());

    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(call, response);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6ef8b8e0067f81f2579bfbb1d789fbe3"></a><!-- doxytag: member="Pastry::handleRequestRepairResponse" ref="a6ef8b8e0067f81f2579bfbb1d789fbe3" args="(RequestRepairResponse *response)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleRequestRepairResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequestRepairResponse.html">RequestRepairResponse</a> *&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00504">504</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00519">handleRpcResponse()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRequestRepairResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
       &lt;&lt; endl;

    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a26fa765c1f23635923477bc300637c4f">stateReceived</a>++;
                 <a class="code" href="classBasePastry.html#a8783f5db146cf00be3a347e92c36505e">stateBytesReceived</a> += response-&gt;getByteLength());

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        <a class="code" href="classPastry.html#a1dece33e7864cc0f823374daa28da6c9" title="processes state messages, merging with own state tables">handleStateMessage</a>(check_and_cast&lt;PastryStateMessage*&gt;(response-&gt;decapsulate()));
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3723e844ab5f2be793b4cd7bf6b03318"></a><!-- doxytag: member="Pastry::handleRequestRoutingRowResponse" ref="a3723e844ab5f2be793b4cd7bf6b03318" args="(RequestRoutingRowResponse *response)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleRequestRoutingRowResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequestRoutingRowResponse.html">RequestRoutingRowResponse</a> *&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBasePastry.html#aced0a16861b41d5dcd623fe49b0ccefa">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00654">654</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00519">handleRpcResponse()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRequestRoutingRowResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
       &lt;&lt; endl;

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa6f9e50300f12679850ddc29f15cdf37b">DISCOVERY</a>) {
        <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* rowState =
            check_and_cast&lt;<a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>*&gt;(response-&gt;getEncapsulatedPacket());
        uint32_t nodesPerRow = rowState-&gt;<a class="code" href="classPastryStateMessage.html#a2abf365a56348d30b99e9733c6905065">getRoutingTableArraySize</a>();
        <span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>* node;
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> == -1) {
            <a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> = rowState-&gt;<a class="code" href="classPastryStateMessage.html#abaeb686d69f39249dde7b2ce66964f9e">getRow</a>();
        }
        <a class="code" href="classPastry.html#a662c8e13ab30edeeb36c591bcffed4c0">discoveryModeProbedNodes</a> = 0;
        <a class="code" href="classBasePastry.html#a4ac33dcce9d9a383a740d1227cff76aa">nearNodeImproved</a> = <span class="keyword">false</span>;

        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> &gt; 0) {
            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; nodesPerRow; i++) {
                node = &amp;(rowState-&gt;<a class="code" href="classPastryStateMessage.html#a0e4a031d7e3a30bd94c3867d0862288e">getRoutingTable</a>(i));
                <span class="comment">// unspecified nodes not considered</span>
                <span class="keywordflow">if</span> ( !(node-&gt;<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>()) ) {
                    <span class="comment">// we look for best connection here,</span>
                    <span class="comment">// so Timeout is short and there are no retries</span>
                    <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(*node, <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, 0, NULL,
                             <span class="stringliteral">&quot;PING received routing table for nearest node&quot;</span>,
                             NULL, -1, <a class="code" href="CommonMessages__m_8h.html#aca1e72535e7f260e54ed8bbf984dade9a01580b2e886cd821bd7f3f2bcd7c690c">UDP_TRANSPORT</a>); <span class="comment">//TODO</span>
                    <a class="code" href="classPastry.html#a662c8e13ab30edeeb36c591bcffed4c0">discoveryModeProbedNodes</a>++;
                }
            }
            <a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a>--;
        }

        EV &lt;&lt; <span class="stringliteral">&quot;    received routing table, waiting for pings&quot;</span>
           &lt;&lt; endl;

        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>-&gt;isScheduled()) cancelEvent(<a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
        scheduleAt(simTime() + <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a>, <a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="adf9cf5b5ca0fc054102179df5174c2ad"></a><!-- doxytag: member="Pastry::handleRequestStateCall" ref="adf9cf5b5ca0fc054102179df5174c2ad" args="(RequestStateCall *call)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleRequestStateCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequestStateCall.html">RequestStateCall</a> *&#160;</td>
          <td class="paramname"><em>call</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00444">444</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00358">handleRpcCall()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRequestStateCall() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
       &lt;&lt; endl;

    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a727d8089dc7486f5f835ec427554c9b2">stateReqReceived</a>++;
                 <a class="code" href="classBasePastry.html#adca8e0ca12a6dbbaee7dc5884845ddce">stateReqBytesReceived</a> += call-&gt;getByteLength());

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;    received repair request before reaching&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot; READY state, dropping message!&quot;</span>
                &lt;&lt; endl;
        <span class="keyword">delete</span> call;
        <span class="keywordflow">return</span>;
    }

    <a class="code" href="classRequestStateResponse.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestStateResponse</a>* response =
        <span class="keyword">new</span> <a class="code" href="classRequestStateResponse.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestStateResponse</a>(<span class="stringliteral">&quot;REQUEST STATE Response&quot;</span>);
    response-&gt;<a class="code" href="classBaseOverlayMessage.html#a07301be10c346b328a0a9cc4cae48777">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);

    response-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a891633185b2a1e7756c3d53a92c5ac45">PASTRYREQUESTSTATERESPONSE_L</a>(response));
    response-&gt;encapsulate(<a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>());
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#aadec419a4c2560717f1db3e36866b837">stateSent</a>++;
                 <a class="code" href="classBasePastry.html#a43218c86ea28a36b14f76b54b2ccea07">stateBytesSent</a> += response-&gt;getByteLength());

    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(call, response);
}
</pre></div>
</div>
</div>
<a class="anchor" id="acf0d306c315c3745fb5b63a2158db286"></a><!-- doxytag: member="Pastry::handleRequestStateResponse" ref="acf0d306c315c3745fb5b63a2158db286" args="(RequestStateResponse *response)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleRequestStateResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRequestStateResponse.html">RequestStateResponse</a> *&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00608">608</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00519">handleRpcResponse()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRequestStateResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span>
       &lt;&lt; endl;

    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a26fa765c1f23635923477bc300637c4f">stateReceived</a>++;
                 <a class="code" href="classBasePastry.html#a8783f5db146cf00be3a347e92c36505e">stateBytesReceived</a> += response-&gt;getByteLength());

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        <a class="code" href="classPastry.html#a1dece33e7864cc0f823374daa28da6c9" title="processes state messages, merging with own state tables">handleStateMessage</a>(check_and_cast&lt;PastryStateMessage*&gt;(response-&gt;decapsulate()));
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a14a0a29c8c62c586425b174b9a1504d8"></a><!-- doxytag: member="Pastry::handleRpcCall" ref="a14a0a29c8c62c586425b174b9a1504d8" args="(BaseCallMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Pastry::handleRpcCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes Remote-Procedure-Call invocation messages. </p>
<p><br/>
</p>
<p>This method should be overloaded when the overlay provides RPC functionality.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if rpc has been handled </dd></dl>

<p>Reimplemented from <a class="el" href="classBasePastry.html#a64c0f2b97d1dd7b07c30f70b5ddc1496">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00358">358</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a64c0f2b97d1dd7b07c30f70b5ddc1496" title="Processes Remote-Procedure-Call invocation messages.">BasePastry::handleRpcCall</a>(msg)) <span class="keywordflow">return</span> <span class="keyword">true</span>;

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRpcCall() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Received RPC call and state != READY&quot;</span>
           &lt;&lt; endl;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// delegate messages</span>
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>( msg )
    <span class="comment">// RPC_DELEGATE( &lt;messageName&gt;[Call|Response], &lt;methodToCall&gt; )</span>
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( PastryJoin, <a class="code" href="classPastry.html#a2781a35f40c1531a1df46fe7231ca7cc">handlePastryJoinCall</a> );
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( RequestState, <a class="code" href="classPastry.html#adf9cf5b5ca0fc054102179df5174c2ad">handleRequestStateCall</a> );
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( RequestRepair, <a class="code" href="classPastry.html#a906a430e629f4aeb2bb5e38e767d4a78">handleRequestRepairCall</a> );
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( )

    return <a class="code" href="RpcMacros_8h.html#aa5e964b7c7129c0943237a786e455e9a">RPC_HANDLED</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae51a0a4846c1e44f2b383bcc1bda5640"></a><!-- doxytag: member="Pastry::handleRpcResponse" ref="ae51a0a4846c1e44f2b383bcc1bda5640" args="(BaseResponseMessage *msg, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC response has been received. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The response message. </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classPastry.html#ae51a0a4846c1e44f2b383bcc1bda5640" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">rtt</td><td>The Round-Trip-Time of this RPC </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBasePastry.html#a6bdf07238d36dc4fc8298e57632d78e5">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00519">519</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastry.html#ae51a0a4846c1e44f2b383bcc1bda5640" title="This method is called if an RPC response has been received.">BasePastry::handleRpcResponse</a>(msg, context, rpcId, rtt);

    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( PastryJoin ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Received a JOIN RPC Response: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_PastryJoinResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; SIMTIME_DBL(rtt)
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#a2017b9e580134416db45159f9585c6bf">handlePastryJoinResponse</a>(_PastryJoinResponse);
        <span class="keywordflow">break</span>;
        }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( RequestState ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Received a RequestState RPC Response: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_RequestStateResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; SIMTIME_DBL(rtt)
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#acf0d306c315c3745fb5b63a2158db286">handleRequestStateResponse</a>(_RequestStateResponse);
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( RequestRepair ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[BasePastry::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Received a Request Repair RPC Response: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_RequestRepairResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; SIMTIME_DBL(rtt)
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#a6ef8b8e0067f81f2579bfbb1d789fbe3">handleRequestRepairResponse</a>(_RequestRepairResponse);
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( RequestLeafSet ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Received a RequestLeafSet RPC Response: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_RequestLeafSetResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; SIMTIME_DBL(rtt)
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#a11e13b36752da53944e090d845588075">handleRequestLeafSetResponse</a>(_RequestLeafSetResponse);
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( RequestRoutingRow ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Received a RequestRoutingRow RPC Response: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_RequestRoutingRowResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#a3723e844ab5f2be793b4cd7bf6b03318">handleRequestRoutingRowResponse</a>(_RequestRoutingRowResponse);
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( )
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa8cb76965e9144823d6525b724668807"></a><!-- doxytag: member="Pastry::handleRpcTimeout" ref="aa8cb76965e9144823d6525b724668807" args="(BaseCallMessage *call, const TransportAddress &amp;dest, cPolymorphic *context, int rpcId, const OverlayKey &amp;key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleRpcTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>destKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC timeout has been reached. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The original RPC message. </td></tr>
    <tr><td class="paramname">dest</td><td>The destination node </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classPastry.html#ae51a0a4846c1e44f2b383bcc1bda5640" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">destKey</td><td>the destination <a class="el" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBasePastry.html#a7d0fb0a879ca2c4f7b3cdd1444066ab5">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00575">575</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastry.html#aa8cb76965e9144823d6525b724668807" title="This method is called if an RPC timeout has been reached.">BasePastry::handleRpcTimeout</a>(call, dest, context, rpcId, key);

    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleRpcTimeout() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    Timeout of RPC Call: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *call &lt;&lt; <span class="stringliteral">&quot; key=&quot;</span> &lt;&lt; key
       &lt;&lt; endl;

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa6f9e50300f12679850ddc29f15cdf37b">DISCOVERY</a> &amp;&amp; dynamic_cast&lt;RequestLeafSetCall*&gt;(call)) {
        <a class="code" href="classBaseOverlay.html#acb8855faa86247ae37ab894891d9f4dd" title="Join the overlay with a given nodeID.">join</a>();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1dece33e7864cc0f823374daa28da6c9"></a><!-- doxytag: member="Pastry::handleStateMessage" ref="a1dece33e7864cc0f823374daa28da6c9" args="(PastryStateMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleStateMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPastryStateMessage.html">PastryStateMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>processes state messages, merging with own state tables </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>the pastry state message </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classBasePastry.html#a1172a453b44856e2fdd7a027f0d03833">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l01193">1193</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00594">handlePastryJoinResponse()</a>, <a class="el" href="Pastry_8cc_source.html#l00504">handleRequestRepairResponse()</a>, <a class="el" href="Pastry_8cc_source.html#l00608">handleRequestStateResponse()</a>, and <a class="el" href="Pastry_8cc_source.html#l00339">handleUDPMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    new STATE message to process &quot;</span>
           &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(msg) &lt;&lt; <span class="stringliteral">&quot; in state &quot;</span> &lt;&lt;
            ((<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>)?<span class="stringliteral">&quot;READY&quot;</span>:((<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>)?<span class="stringliteral">&quot;JOIN&quot;</span>:<span class="stringliteral">&quot;INIT&quot;</span>))
           &lt;&lt; endl;
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    ***   own joinHopCount:  &quot;</span> &lt;&lt; <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> &lt;&lt; endl
               &lt;&lt; <span class="stringliteral">&quot;    ***   already received:  &quot;</span> &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt;&lt; endl
               &lt;&lt; <span class="stringliteral">&quot;    ***   last-hop flag:     &quot;</span>
               &lt;&lt; (msg-&gt;<a class="code" href="classPastryStateMessage.html#a3bc2696f0c1e87ea38b8bd7e7e56dbe7">getLastHop</a>() ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>) &lt;&lt; endl
               &lt;&lt; <span class="stringliteral">&quot;    ***   msg joinHopCount:  &quot;</span>
               &lt;&lt; msg-&gt;<a class="code" href="classPastryStateMessage.html#abaeb686d69f39249dde7b2ce66964f9e">getRow</a>() &lt;&lt; endl;
        }
    }
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a> || <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa6f9e50300f12679850ddc29f15cdf37b">DISCOVERY</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    can&#39;t handle state messages until at least reaching JOIN state.&quot;</span>
           &lt;&lt; endl;
        <span class="keyword">delete</span> msg;
        <span class="keywordflow">return</span>;
    }

    <a class="code" href="structPastryStateMsgHandle.html" title="struct-type containing local info while processing a STATE message">PastryStateMsgHandle</a> handle(msg);

    <span class="comment">// in JOIN state, store all received state Messages, need them later:</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>) {
        <span class="keywordflow">if</span> (!(msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() &amp;
              (<a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a2ca6c13943a398b19f55c7d53529ab4f">PASTRY_STATE_JOIN</a> | <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7abfbb059d5d48ab5c68f49eb88464171d">PASTRY_STATE_MINJOIN</a>))) {
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
        }

        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> &amp;&amp; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() == <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Warning: dropping state message received after &quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;all needed state messages were collected in JOIN state.&quot;</span>
               &lt;&lt; endl;
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
        }

        <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.push_back(handle);
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> &amp;&amp; <a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a>) <a class="code" href="classBasePastry.html#af6a7090deb645b1f79b33edb0409485c" title="ping all nodes in a given state message.">prePing</a>(msg);

        <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classPastryStateMessage.html#a3bc2696f0c1e87ea38b8bd7e7e56dbe7">getLastHop</a>()) {
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Error: received a second `last&#39; state message! Restarting ...&quot;</span>
                   &lt;&lt; endl;

                <a class="code" href="classPastry.html#a06fbfdc4446ac0cfe149eadbb6e59962" title="Join the overlay with a given nodeID in thisNode.key.">joinOverlay</a>();
                <span class="keywordflow">return</span>;
            }

            <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> = msg-&gt;<a class="code" href="classPastryStateMessage.html#abaeb686d69f39249dde7b2ce66964f9e">getRow</a>();

            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt; <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
                <span class="comment">// some states still missing:</span>
                cancelEvent(<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
                scheduleAt(simTime() + <a class="code" href="classBasePastry.html#a98b0c284102cd5f1fc78558937b9b19f">readyWaitAmount</a>, <a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
            }
        }

        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &gt; <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Error: too many state messages received in JOIN state! (&quot;</span>
                   &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt;&lt; <span class="stringliteral">&quot; &gt; &quot;</span> &lt;&lt; <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a> &lt;&lt; <span class="stringliteral">&quot;) Restarting ...&quot;</span>
                   &lt;&lt; endl;

                <a class="code" href="classPastry.html#a06fbfdc4446ac0cfe149eadbb6e59962" title="Join the overlay with a given nodeID in thisNode.key.">joinOverlay</a>();
                <span class="keywordflow">return</span>;
            }
            <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() == <a class="code" href="classBasePastry.html#a1a96c4a089fd9c1b21d7eb9c34d93580">joinHopCount</a>) {
                <span class="comment">// all state messages are here, sort by hopcount:</span>
                sort(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin(), <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end(),
                     <a class="code" href="BasePastry_8cc.html#ac391c2095c772c546f4804779001cea9" title="predicate for comparing two pointers to PastryStateMessages based on their joinHopCount.">stateMsgIsSmaller</a>);

                <span class="comment">// start pinging the nodes found in the first state message:</span>
                <a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a> = <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin();
                <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = *<a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a>;
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    have all STATE messages, now pinging nodes.&quot;</span>
                   &lt;&lt; endl;
                <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> &amp;&amp; <a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a>) {
                    <a class="code" href="classBasePastry.html#a445a74a2791f810975bf99b4ff7d9865" title="ping all nodes in the pastry state message pointed to by private member stateCache">pingNodes</a>();
                } <span class="keywordflow">else</span> {
                    <a class="code" href="classPastry.html#a38e3a1a5d04f570e8361b64ea59f1915">mergeState</a>();
                    <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> = NULL;
                    <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);

                    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;    changeState(READY) called&quot;</span>
                       &lt;&lt; endl;
                }

                <span class="comment">// cancel timeout:</span>
                <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>-&gt;isScheduled()) cancelEvent(<a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>);
            } <span class="keywordflow">else</span> {
                <span class="comment">//TODO occasionally, here we got a wrong hop count in</span>
                <span class="comment">// iterative mode due to more than one it. lookup during join</span>
                <span class="comment">// procedure</span>
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Still need some STATE messages.&quot;</span>
                   &lt;&lt; endl;
            }

        }
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    handling STATE message&quot;</span>
           &lt;&lt; endl;
        EV &lt;&lt; <span class="stringliteral">&quot;        type: &quot;</span> &lt;&lt; ((msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>()
                                    == <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a54b61d3690155bcd38468f1a14de088e">PASTRY_STATE_UPDATE</a>) ? <span class="stringliteral">&quot;update&quot;</span>
                                                            :<span class="stringliteral">&quot;standard&quot;</span>)
           &lt;&lt; endl;
        <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a54b61d3690155bcd38468f1a14de088e">PASTRY_STATE_UPDATE</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;        msg timestamp:      &quot;</span> &lt;&lt;
                msg-&gt;<a class="code" href="classPastryStateMessage.html#a64e104bf42d6785530fba51af52bc44c">getTimestamp</a>() &lt;&lt; endl;
            EV &lt;&lt; <span class="stringliteral">&quot;        last state change:  &quot;</span> &lt;&lt;
                <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> &lt;&lt; endl;
        }
    }

    <span class="keywordflow">if</span> (((msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a54b61d3690155bcd38468f1a14de088e">PASTRY_STATE_UPDATE</a>))
            &amp;&amp; (msg-&gt;<a class="code" href="classPastryStateMessage.html#a64e104bf42d6785530fba51af52bc44c">getTimestamp</a>() &lt;= <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a>)) {
        <span class="comment">// if we received an update based on our outdated state,</span>
        <span class="comment">// mark handle for retrying later:</span>
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    outdated state from &quot;</span> &lt;&lt; msg-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>()
           &lt;&lt; endl;
        handle.outdatedUpdate = <span class="keyword">true</span>;
    }

    <span class="comment">// determine aliveTable to prevent leafSet from merging nodes that are</span>
    <span class="comment">// known to be dead:</span>
    <a class="code" href="classBasePastry.html#a89aba6ca97abfbe6baff748a19969d1e" title="change the aliveTable to match the given stateMsg.">determineAliveTable</a>(msg);

    <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a51f4659797b81e09bc35edfded346b7b">PASTRY_STATE_REPAIR</a>) {
        <span class="comment">// try to repair leafset based on repair message right now</span>
        <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; askLs = <a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#aee63679544eb8ea21dbbf4d5dc7ef330" title="attempt to repair the leafset using a received REPAIR message">repair</a>(msg, &amp;<a class="code" href="classBasePastry.html#a22e76d53e4ba89d63eca403923a46da8" title="Early update of leaf set: helper structure for marking known-dead nodes.">aliveTable</a>);
        <span class="keywordflow">if</span> (! askLs.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
            <span class="comment">//sendRequest(askLs, PASTRY_REQ_REPAIR);</span>
            <a class="code" href="classRequestRepairCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairCall</a>* call =
                <span class="keyword">new</span> <a class="code" href="classRequestRepairCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRepairCall</a>(<span class="stringliteral">&quot;REQUEST REPAIR Call&quot;</span>);
            call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a8f933575a54140da5ac51cbcdcb0666b">PASTRYREQUESTREPAIRCALL_L</a>(call));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a5f05d5cba3283f9b1dd421b036959aff">repairReqSent</a>++; <a class="code" href="classBasePastry.html#a9f02a29e59ff2af5c7af5b3a764e711a">repairReqBytesSent</a> += call-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(askLs, call);
        }

        <span class="comment">// while not really known, it&#39;s safe to assume that a repair</span>
        <span class="comment">// message changed our state:</span>
        <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
        <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#a477c57b8227f5ec46a3d635b4590985a" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, &amp;<a class="code" href="classBasePastry.html#a22e76d53e4ba89d63eca403923a46da8" title="Early update of leaf set: helper structure for marking known-dead nodes.">aliveTable</a>)) {
        <span class="comment">// merged state into leafset right now</span>
        <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
        <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        <a class="code" href="classBasePastry.html#abc8da91d0187799f60bddb3ddab3e2f6" title="updates information shown in tk-environment">updateTooltip</a>();
    }
    <span class="comment">// in READY state, only ping nodes to get proximity metric:</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>) {
        <span class="comment">// no state message is processed right now, start immediately:</span>
        assert(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#a83106b985f989835e68654900708835b">prox</a> == NULL);
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = handle;
        <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a> &amp;&amp; (<a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> ||
            msg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a47af4c6e9cd3d1165507bcbb572215c1">PASTRY_STATE_STD</a>)) {
            <span class="comment">// enqueue message for later processing:</span>
            <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.push(handle);
            <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.size() &gt; 15) {
                <span class="keyword">delete</span> <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.front().msg;
                <a class="code" href="classBasePastry.html#a763ec48a49b047252ea3d758b335df70" title="Queue of state messages waiting to be processed in READY state.">stateCacheQueue</a>.pop();
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleStateMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    stateCacheQueue full -&gt; pop()&quot;</span> &lt;&lt; endl;
            }
            <a class="code" href="classBasePastry.html#af6a7090deb645b1f79b33edb0409485c" title="ping all nodes in a given state message.">prePing</a>(msg);
        } <span class="keywordflow">else</span> {
            <span class="keywordtype">bool</span> temp = <span class="keyword">true</span>;
            <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, NULL)) {
                temp = <span class="keyword">false</span>;
            }
            <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#a477c57b8227f5ec46a3d635b4590985a" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, NULL)) {
                temp = <span class="keyword">false</span>;
            } <span class="keywordflow">else</span> {
                <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
            }
            <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(msg, NULL)) {
                temp = <span class="keyword">false</span>;
            }
            <span class="keywordflow">if</span> (temp) <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
            <span class="keyword">delete</span> msg;
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aabc1a8eaab8eea9ec5e4830ee60499f8"></a><!-- doxytag: member="Pastry::handleTimerEvent" ref="aabc1a8eaab8eea9ec5e4830ee60499f8" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ab893c156412e38caa62fe058b229899b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00252">252</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg == <a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a>) {
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a6531029cc05c41c94976078bf0abd93a">partialJoinPath</a>) {
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a805e366ae01f6857dcb0e4a78c7e79d6">joinPartial</a>++);
            sort(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin(), <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.end(), <a class="code" href="BasePastry_8cc.html#ac391c2095c772c546f4804779001cea9" title="predicate for comparing two pointers to PastryStateMessages based on their joinHopCount.">stateMsgIsSmaller</a>);

            <span class="comment">// start pinging the nodes found in the first state message:</span>
            <a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a> = <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.begin();
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a> = *<a class="code" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">stReceivedPos</a>;
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    joining despite some missing STATE messages.&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classPastry.html#a4724884f045c31a5a4a25259981cf7ff">processState</a>();
        } <span class="keywordflow">else</span> {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    timeout waiting for missing state messages&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot; in JOIN state, restarting...&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classBaseOverlay.html#acb8855faa86247ae37ab894891d9f4dd" title="Join the overlay with a given nodeID.">join</a>();
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    sending state updates to all nodes.&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#aa8358704c2a16e2723f048c4bcbe2922" title="send updated state to all nodes when entering ready state">doJoinUpdate</a>();
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    sending STATE requests to all nodes in&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot; second stage of initialization.&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#a13e50eccbed545c79aed4d1f2d9ac9ae" title="do the second stage of initialization as described in the paper">doSecondStage</a>();
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a>) {
        <span class="keywordflow">if</span> ((<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> == 0) &amp;&amp; (<a class="code" href="classBasePastry.html#a4ac33dcce9d9a383a740d1227cff76aa">nearNodeImproved</a>)) {
            <a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a>++; <span class="comment">//repeat last step if closer node was found</span>
        }
        <span class="keywordflow">if</span> ((<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a> == 0) || (<a class="code" href="classPastry.html#a662c8e13ab30edeeb36c591bcffed4c0">discoveryModeProbedNodes</a> &lt; 1)) {
            <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>);
        } <span class="keywordflow">else</span> {
            <a class="code" href="classRequestRoutingRowCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRoutingRowCall</a>* call =
                <span class="keyword">new</span> <a class="code" href="classRequestRoutingRowCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">RequestRoutingRowCall</a>(<span class="stringliteral">&quot;REQUEST ROUTING ROW Call&quot;</span>);
            call-&gt;<a class="code" href="classBaseOverlayMessage.html#a07301be10c346b328a0a9cc4cae48777">setStatType</a>(<a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
            call-&gt;<a class="code" href="classRequestRoutingRowCall.html#ae7fe893a792196e34510975a00503b26">setRow</a>(<a class="code" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">depth</a>);
            call-&gt;setBitLength(<a class="code" href="PastryMessage__m_8h.html#a6c7bf6c9f0135ddd1b0c3e06cb92c270">PASTRYREQUESTROUTINGROWCALL_L</a>(call));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a1a1785687d9560edfe30d6b4f8d5c31f">routingTableRowReqSent</a>++;
                         <a class="code" href="classBasePastry.html#a836e8dcea673d81c8e2a68500becd084">routingTableRowReqBytesSent</a> += call-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(<a class="code" href="classBasePastry.html#af28427241a54155e6f9bf8539286ec9a">nearNode</a>, call);
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    starting routing table maintenance&quot;</span>
           &lt;&lt; endl;
        <a class="code" href="classPastry.html#a08e9157d1221cded34f870c3abc934f7" title="periodic routing table maintenance requests the corresponding routing table row from one node in each...">doRoutingTableMaintenance</a>();
        scheduleAt(simTime() + <a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a>,
                   <a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a>);
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;PastrySendState*&gt;(msg)) {
        <a class="code" href="classPastrySendState.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastrySendState</a>* sendStateMsg = <span class="keyword">static_cast&lt;</span><a class="code" href="classPastrySendState.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastrySendState</a>*<span class="keyword">&gt;</span>(msg);

        std::vector&lt;PastrySendState*&gt;::iterator pos =
            std::find(<a class="code" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a>.begin(), <a class="code" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a>.end(),
                      sendStateMsg);
        <span class="keywordflow">if</span> (pos != <a class="code" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a>.end()) <a class="code" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a>.erase(pos);

        <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* stateMsg = <a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>();
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#aadec419a4c2560717f1db3e36866b837">stateSent</a>++;
                     <a class="code" href="classBasePastry.html#a43218c86ea28a36b14f76b54b2ccea07">stateBytesSent</a> += stateMsg-&gt;getByteLength());
        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(sendStateMsg-&gt;<a class="code" href="classPastrySendState.html#a75f7974a4daa6381d9b3670096de5c61">getDest</a>(), stateMsg);

        <span class="keyword">delete</span> sendStateMsg;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a47fc606cfbb1977305f97c60c3c21481"></a><!-- doxytag: member="Pastry::handleUDPMessage" ref="a47fc606cfbb1977305f97c60c3c21481" args="(BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::handleUDPMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes messages from underlay. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Message from UDP </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a31d7dd39ddc9e62ad92f69f6d7210344">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00339">339</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* stateMsg = check_and_cast&lt;<a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>*&gt;(msg);
    uint32_t type = stateMsg-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>();

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::handleUDPMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    incoming STATE message of type &quot;</span>
           &lt;&lt; cEnum::get(<span class="stringliteral">&quot;PastryStateMsgType&quot;</span>)-&gt;getStringFor(type) &lt;&lt; endl;
    }

    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#a26fa765c1f23635923477bc300637c4f">stateReceived</a>++; <a class="code" href="classBasePastry.html#a8783f5db146cf00be3a347e92c36505e">stateBytesReceived</a> +=
                 stateMsg-&gt;getByteLength());

    <a class="code" href="classPastry.html#a1dece33e7864cc0f823374daa28da6c9" title="processes state messages, merging with own state tables">handleStateMessage</a>(stateMsg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="afe58f82e796e3f1ad6cc736fed856e3c"></a><!-- doxytag: member="Pastry::initializeOverlay" ref="afe58f82e796e3f1ad6cc736fed856e3c" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::initializeOverlay </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes derived-class-attributes. </p>
<p><br/>
</p>
<p>Initializes derived-class-attributes, called by <a class="el" href="classBaseOverlay.html#a9738ba6065b0f699f1921bbe82ab97be" title="initializes base-class-attributes">BaseOverlay::initialize()</a>. By default this method is called once. If more stages are needed one can overload <a class="el" href="classBaseOverlay.html#a3234dfcf81463984e88a42432734a615" title="Sets init stage.">numInitStages()</a> and add more stages.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a41f88dfbea856a2b38319ff52c758c96">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00091">91</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ( stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a58e83c497c7c8495e9c592ff3148b6b9" title="first stage for overlay modules (Tier 0 / KBR)">MIN_STAGE_OVERLAY</a> )
        <span class="keywordflow">return</span>;

    <span class="comment">// Pastry provides KBR services</span>
    <a class="code" href="classBaseOverlay.html#a53389ea3326d2e8ad53f02b388487d0b" title="set this to true, if the overlay provides KBR services">kbr</a> = <span class="keyword">true</span>;

    <a class="code" href="classBasePastry.html#a0bc39902de2d03ea45714bf8506d983f" title="initializes parameters and variables used in both Bamboo and Pastry">baseInit</a>();

    <a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a> = par(<span class="stringliteral">&quot;useDiscovery&quot;</span>);
    <a class="code" href="classPastry.html#a76def04af940e240a50c48e6040cee2b">useSecondStage</a> = par(<span class="stringliteral">&quot;useSecondStage&quot;</span>);
    <a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> = par(<span class="stringliteral">&quot;pingBeforeSecondStage&quot;</span>);
    <a class="code" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">secondStageInterval</a> = par(<span class="stringliteral">&quot;secondStageWait&quot;</span>);
    <a class="code" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">discoveryTimeoutAmount</a> = par(<span class="stringliteral">&quot;discoveryTimeoutAmount&quot;</span>);
    <a class="code" href="classPastry.html#ad2cab4f64253005e4cc67e1e116b8d77">useRoutingTableMaintenance</a> = par(<span class="stringliteral">&quot;useRoutingTableMaintenance&quot;</span>);
    <a class="code" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">routingTableMaintenanceInterval</a> = par(<span class="stringliteral">&quot;routingTableMaintenanceInterval&quot;</span>);
    <a class="code" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a> = par(<span class="stringliteral">&quot;sendStateAtLeafsetRepair&quot;</span>);
    <a class="code" href="classPastry.html#a6531029cc05c41c94976078bf0abd93a">partialJoinPath</a> = par(<span class="stringliteral">&quot;partialJoinPath&quot;</span>);
    <a class="code" href="classBasePastry.html#a98b0c284102cd5f1fc78558937b9b19f">readyWaitAmount</a> = par(<span class="stringliteral">&quot;readyWait&quot;</span>);
    <a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> = par(<span class="stringliteral">&quot;minimalJoinState&quot;</span>);

    <a class="code" href="classPastry.html#af80b068d6f88b70026caa7e5b2637b62">overrideOldPastry</a> = par(<span class="stringliteral">&quot;overrideOldPastry&quot;</span>);
    <a class="code" href="classPastry.html#a5a7acb21ccf23165142efa88bae71e52">overrideNewPastry</a> = par(<span class="stringliteral">&quot;overrideNewPastry&quot;</span>);

    <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#af80b068d6f88b70026caa7e5b2637b62">overrideOldPastry</a>) {
        <a class="code" href="classPastry.html#a76def04af940e240a50c48e6040cee2b">useSecondStage</a> = <span class="keyword">true</span>;
        <a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a> = <span class="keyword">false</span>;
        <a class="code" href="classPastry.html#ad2cab4f64253005e4cc67e1e116b8d77">useRoutingTableMaintenance</a> = <span class="keyword">false</span>;
        <a class="code" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a> = <span class="keyword">true</span>;
        <a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> = <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a5a7acb21ccf23165142efa88bae71e52">overrideNewPastry</a>) {
        <a class="code" href="classPastry.html#a76def04af940e240a50c48e6040cee2b">useSecondStage</a> = <span class="keyword">false</span>;
        <a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a> = <span class="keyword">true</span>;
        <a class="code" href="classPastry.html#ad2cab4f64253005e4cc67e1e116b8d77">useRoutingTableMaintenance</a> = <span class="keyword">true</span>;
        <a class="code" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">sendStateAtLeafsetRepair</a> = <span class="keyword">false</span>;
        <a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> = <span class="keyword">true</span>;
    }

    <a class="code" href="classBasePastry.html#a87b449a72607334387c2aa3a5d7673b2">readyWait</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;readyWait&quot;</span>);
    <a class="code" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">secondStageWait</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;secondStageWait&quot;</span>);
    <a class="code" href="classBasePastry.html#a9375a2c0cdee0493f0ea7b4983825934">joinUpdateWait</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;joinUpdateWait&quot;</span>);

    <a class="code" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">discoveryTimeout</a> =
        (<a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a> ? <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;discoveryTimeout&quot;</span>) : NULL);
    <a class="code" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">repairTaskTimeout</a> =
        (<a class="code" href="classPastry.html#ad2cab4f64253005e4cc67e1e116b8d77">useRoutingTableMaintenance</a> ? <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;repairTaskTimeout&quot;</span>) : NULL);

    <a class="code" href="classPastry.html#ab6abf133583dc4f91ae74fcb7ad2d188">updateCounter</a> = 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac202a93b3945381918d13b92060ff1da"></a><!-- doxytag: member="Pastry::iterativeJoinHook" ref="ac202a93b3945381918d13b92060ff1da" args="(BaseOverlayMessage *msg, bool incrHopCount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::iterativeJoinHook </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>incrHopCount</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBasePastry.html#a49e37d403457478acc0d352904bf104d">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00729">729</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastryFindNodeExtData.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryFindNodeExtData</a>* findNodeExt = NULL;
    <span class="keywordflow">if</span> (msg &amp;&amp; msg-&gt;hasObject(<span class="stringliteral">&quot;findNodeExt&quot;</span>)) {
        findNodeExt =
            check_and_cast&lt;<a class="code" href="classPastryFindNodeExtData.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryFindNodeExtData</a>*&gt;(msg-&gt;
                    getObject(<span class="stringliteral">&quot;findNodeExt&quot;</span>));
    }
    <span class="comment">// Send state tables on any JOIN message we see:</span>
    <span class="keywordflow">if</span> (findNodeExt) {
        <span class="keyword">const</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>&amp; stateRecipient =
            findNodeExt-&gt;<a class="code" href="classPastryFindNodeExtData.html#aaf18e8721a60306f069d795e9ac56f85">getSendStateTo</a>();
        <span class="keywordflow">if</span> (!stateRecipient.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#abfe72c7d75708d9e152375ecb708ce24">joinSeen</a>++);
            <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* stateMsg =
                <a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>((<a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> ?
                                    <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7abfbb059d5d48ab5c68f49eb88464171d">PASTRY_STATE_MINJOIN</a> :
                                    <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a2ca6c13943a398b19f55c7d53529ab4f">PASTRY_STATE_JOIN</a>),
                                   -1,
                                   findNodeExt-&gt;<a class="code" href="classPastryFindNodeExtData.html#a5b743f86dd249729d371f1a5c5e890a5">getJoinHopCount</a>(),
                                   <span class="keyword">false</span>);
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#aadec419a4c2560717f1db3e36866b837">stateSent</a>++;
                         <a class="code" href="classBasePastry.html#a43218c86ea28a36b14f76b54b2ccea07">stateBytesSent</a> += stateMsg-&gt;getByteLength());
            <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(stateRecipient, stateMsg);
        }
        <span class="keywordflow">if</span> (incrHopCount) {
            findNodeExt-&gt;<a class="code" href="classPastryFindNodeExtData.html#a713649f7db56877e1e726f6b7a1239f5">setJoinHopCount</a>(findNodeExt-&gt;<a class="code" href="classPastryFindNodeExtData.html#a5b743f86dd249729d371f1a5c5e890a5">getJoinHopCount</a>() + 1);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a06fbfdc4446ac0cfe149eadbb6e59962"></a><!-- doxytag: member="Pastry::joinOverlay" ref="a06fbfdc4446ac0cfe149eadbb6e59962" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::joinOverlay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Join the overlay with a given nodeID in thisNode.key. </p>
<p>Join the overlay with a given nodeID in thisNode.key. This method may be called by an application to join the overlay with a specific nodeID. It is also called if the node's IP address changes. </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a3eefb56c2396601373c89d21b5b58110">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00145">145</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00939">checkProxCache()</a>, and <a class="el" href="Pastry_8cc_source.html#l01193">handleStateMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>);

    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <span class="comment">// no existing pastry network -&gt; first node of a new one</span>
        <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
    } <span class="keywordflow">else</span> {
        <span class="comment">// join existing pastry network</span>
        <a class="code" href="classBasePastry.html#af28427241a54155e6f9bf8539286ec9a">nearNode</a> = <a class="code" href="classBasePastry.html#af534020c5663e436cf28aa83a4a790c9">bootstrapNode</a>;
        <span class="keywordflow">if</span> (<a class="code" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">useDiscovery</a>) <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa6f9e50300f12679850ddc29f15cdf37b">DISCOVERY</a>);
        <span class="keywordflow">else</span> <a class="code" href="classPastry.html#a2b363b914b911dcbc411da940efec08f" title="changes node state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a38e3a1a5d04f570e8361b64ea59f1915"></a><!-- doxytag: member="Pastry::mergeState" ref="a38e3a1a5d04f570e8361b64ea59f1915" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Pastry::mergeState </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l01101">1101</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00939">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l01193">handleStateMessage()</a>, and <a class="el" href="Pastry_8cc_source.html#l01410">processState()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> ret = <span class="keyword">true</span>;

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>) {
        <span class="comment">// building initial state</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    [JOIN] starting to build own state from &quot;</span>
               &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.size() &lt;&lt; <span class="stringliteral">&quot; received state messages...&quot;</span>
               &lt;&lt; endl;
        }
        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> &amp;&amp;
            <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a88929cf3d5340cda73e6305c25714788">getNeighborhoodSetArraySize</a>() &gt; 0) {
            <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    [JOIN] initializing NeighborhoodSet from &quot;</span>
                   &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.front().msg-&gt;getRow() &lt;&lt; <span class="stringliteral">&quot;. hop&quot;</span>
                   &lt;&lt; endl;
            }
            <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.front().msg,
                                             <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.front().prox )) {
                EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Error initializing own neighborhoodSet&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot; while joining! Restarting ...&quot;</span>
                   &lt;&lt; endl;
                ret = <span class="keyword">false</span>;
            }
        }
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    [JOIN] initializing LeafSet from &quot;</span>
               &lt;&lt; <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.back().msg-&gt;getRow() &lt;&lt; <span class="stringliteral">&quot;. hop&quot;</span>
               &lt;&lt; endl;
        }

        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#a477c57b8227f5ec46a3d635b4590985a" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.back().msg,
                                 <a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>.back().prox )) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Error initializing own leafSet while joining!&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot; Restarting ...&quot;</span>
               &lt;&lt; endl;

            ret = <span class="keyword">false</span>;
        } <span class="keywordflow">else</span> {
            <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        }
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a49ff0fb8c25792a1339d54a60c36f2cd" title="debug output ?">debugOutput</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    [JOIN] initializing RoutingTable from all hops&quot;</span>
               &lt;&lt; endl;
        }

        assert(!<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a> ||
               <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a2abf365a56348d30b99e9733c6905065">getRoutingTableArraySize</a>() &gt; 0);

        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryRoutingTable.html#aa5222c6a0ecd848658dd51b8d93b7fc3" title="initialize table from vector of PastryStateMsgHandles with STATE messages received during JOIN phase...">initStateFromHandleVector</a>(<a class="code" href="classPastry.html#a124da5018df353375c1b1b3af057c646" title="State messages to process during join.">stReceived</a>)) {
            EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::mergeState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Error initializing own routingTable while joining!&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot; Restarting ...&quot;</span>
               &lt;&lt; endl;

            ret = <span class="keyword">false</span>;
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        <span class="comment">// merging single state (stateCache.msg)</span>
        <span class="keywordflow">if</span> ((<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a88929cf3d5340cda73e6305c25714788">getNeighborhoodSetArraySize</a>() &gt; 0) &amp;&amp;
            (!<a class="code" href="classBasePastry.html#a66df35d5ace03485bf20db2d2899a98f">neighborhoodSet</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, NULL))) {
            ret = <span class="keyword">false</span>;
        }
        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a72c95d72afcded1185c628646e4f819c">leafSet</a>-&gt;<a class="code" href="classPastryLeafSet.html#a477c57b8227f5ec46a3d635b4590985a" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, NULL)) {
            ret = <span class="keyword">false</span>;
        } <span class="keywordflow">else</span> {
            <a class="code" href="classBasePastry.html#a71aa8137f8e2eaf0977a437d7d852189" title="Pastry API: send newLeafs() to application if enabled.">newLeafs</a>();
        }
        <span class="keywordflow">if</span> (!<a class="code" href="classBasePastry.html#a759c548b4bb1cb4f92b3a4b369cc8d02">routingTable</a>-&gt;<a class="code" href="classPastryStateObject.html#a36f82233ec05837bf3761057f2437c86" title="update own state based on a received PastryStateMessage">mergeState</a>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>, NULL)) {
            ret = <span class="keyword">false</span>;
        }
    }

    <span class="keywordflow">if</span> (ret) <a class="code" href="classBasePastry.html#a6c7b5c6e2d71db0c8233b80764e63dc6">lastStateChange</a> = simTime();
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5d3a97713d0a9653e64d252297d41c15"></a><!-- doxytag: member="Pastry::pingResponse" ref="a5d3a97713d0a9653e64d252297d41c15" args="(PingResponse *pingResponse, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::pingResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPingResponse.html">PingResponse</a> *&#160;</td>
          <td class="paramname"><em>pingResponse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#afdf8ba10dc92ed3d351c8a7472c2093e">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00232">232</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa6f9e50300f12679850ddc29f15cdf37b">DISCOVERY</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::pingResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Pong (or Ping-context from NeighborCache) received (from &quot;</span>
           &lt;&lt; pingResponse-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot;) in DISCOVERY mode&quot;</span>
           &lt;&lt; endl;

        <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#a715b166d2b3b397e047908f52f354be7">nearNodeRtt</a> &gt; rtt) {
            <a class="code" href="classBasePastry.html#af28427241a54155e6f9bf8539286ec9a">nearNode</a> = pingResponse-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>();
            <a class="code" href="classBasePastry.html#a715b166d2b3b397e047908f52f354be7">nearNodeRtt</a> = rtt;
            <a class="code" href="classBasePastry.html#a4ac33dcce9d9a383a740d1227cff76aa">nearNodeImproved</a> = <span class="keyword">true</span>;
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4724884f045c31a5a4a25259981cf7ff"></a><!-- doxytag: member="Pastry::processState" ref="a4724884f045c31a5a4a25259981cf7ff" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::processState </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l01410">1410</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00939">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l00804">doSecondStage()</a>, <a class="el" href="Pastry_8cc_source.html#l01070">endProcessingState()</a>, <a class="el" href="Pastry_8cc_source.html#l01193">handleStateMessage()</a>, and <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Pastry::processState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    new \&quot;&quot;</span>
       &lt;&lt; std::string(cEnum::find(<span class="stringliteral">&quot;PastryStateMsgType&quot;</span>)
              -&gt;getStringFor(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>())).erase(0, 13)
       &lt;&lt; <span class="stringliteral">&quot;\&quot; STATE message &quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(<a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>)
       &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#ab854faec5faca431685829ba8296ecfd">getSender</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; to process &quot;</span>
       &lt;&lt; endl;

    <span class="keywordflow">if</span> (<a class="code" href="classBasePastry.html#af6e8cefc3c62e666203cfedea1532f04">proximityNeighborSelection</a> &amp;&amp; (<a class="code" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">pingBeforeSecondStage</a> ||
        <a class="code" href="classBasePastry.html#a70d78d4ebef74ab2367fed00f77b2d65" title="Handle for processing a single state message.">stateCache</a>.<a class="code" href="structPastryStateMsgHandle.html#aecab9143d3bcf4e2d70272abbb74f428">msg</a>-&gt;<a class="code" href="classPastryStateMessage.html#a85ccf345e532cb9740d87e271209349c">getPastryStateMsgType</a>() == <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a47af4c6e9cd3d1165507bcbb572215c1">PASTRY_STATE_STD</a>)) {
        <a class="code" href="classBasePastry.html#a445a74a2791f810975bf99b4ff7d9865" title="ping all nodes in the pastry state message pointed to by private member stateCache">pingNodes</a>();
    } <span class="keywordflow">else</span> {
        <a class="code" href="classPastry.html#a38e3a1a5d04f570e8361b64ea59f1915">mergeState</a>();
        <a class="code" href="classPastry.html#a4a681c9a40631e27cdb8a174ce8e2618">endProcessingState</a>();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8899e17ebdaf922877b308b6e6408feb"></a><!-- doxytag: member="Pastry::purgeVectors" ref="a8899e17ebdaf922877b308b6e6408feb" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::purgeVectors </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete all information/messages caching vectors, used for restarting overlay or <a class="el" href="classBaseOverlay.html#aed7e3f36b2c70cbdb0e6daa32925917c" title="collects statistical data">finish()</a> </p>

<p>Reimplemented from <a class="el" href="classBasePastry.html#a72cdd5dde4fe7886068ebc35b4d96cea">BasePastry</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00073">73</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastry.html#ace3cd9ad6803c901a4de28d17f960d86">clearVectors</a>();

    <span class="comment">// purge vector of waiting sendState messages:</span>
    <span class="keywordflow">if</span> (! <a class="code" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a>.empty()) {
        <span class="keywordflow">for</span> (std::vector&lt;PastrySendState*&gt;::iterator it =
                 <a class="code" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a>.begin(); it != <a class="code" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a>.end(); it++) {
            <span class="keywordflow">if</span> ( (*it)-&gt;isScheduled() ) cancelEvent(*it);
            <span class="keyword">delete</span> *it;
        }
        <a class="code" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a>.clear();
    }

    <a class="code" href="classPastry.html#a8899e17ebdaf922877b308b6e6408feb" title="delete all information/messages caching vectors, used for restarting overlay or finish()">BasePastry::purgeVectors</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab467d712a7a56dece193bce66bd635d6"></a><!-- doxytag: member="Pastry::recursiveRoutingHook" ref="ab467d712a7a56dece193bce66bd635d6" args="(const TransportAddress &amp;dest, BaseRouteMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Pastry::recursiveRoutingHook </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseRouteMessage.html">BaseRouteMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Hook for forwarded message in recursive lookup mode. </p>
<p>This hook is called just before a message is forwarded to a next hop or if the message is at its destination just before it is sent to the app. Default implementation just returns true. This hook can for example be used to detect failed nodes and call <a class="el" href="classPastry.html#ad94a0f122fe78b1b0002735ce19fea84" title="notifies leafset and routingtable of a failed node and sends out a repair request if possible...">handleFailedNode()</a> before the actual forwarding takes place.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">dest</td><td>destination node </td></tr>
    <tr><td class="paramname">msg</td><td>message to send </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if message should be forwarded; false, if message will be forwarded later by an other function or message has been discarded </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a42f4c08f6408d155a9907957ecf12d79">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00696">696</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (dest == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <a class="code" href="classPastryJoinCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinCall</a>* call =
            <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classPastryJoinCall.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastryJoinCall</a>*<span class="keyword">&gt;</span>(msg-&gt;getEncapsulatedPacket());

        <span class="keywordflow">if</span> (call &amp;&amp; call-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#abfe72c7d75708d9e152375ecb708ce24">joinSeen</a>++;
                         <a class="code" href="classBasePastry.html#a8fb058e1e4991c923faf29ae72832c05">joinBytesSeen</a> += call-&gt;getByteLength());
            <span class="comment">// remove node from state if it is rejoining</span>
            <a class="code" href="classPastry.html#ad94a0f122fe78b1b0002735ce19fea84" title="notifies leafset and routingtable of a failed node and sends out a repair request if possible...">handleFailedNode</a>(call-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>());

            <a class="code" href="classPastryStateMessage.html">PastryStateMessage</a>* stateMsg =
                <a class="code" href="classBasePastry.html#aa5351a4ba129681864f7b6e3d77e2962">createStateMessage</a>((<a class="code" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">minimalJoinState</a> ?
                                    <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7abfbb059d5d48ab5c68f49eb88464171d">PASTRY_STATE_MINJOIN</a> :
                                    <a class="code" href="PastryMessage__m_8h.html#a36b8c7a9b6b9c184ab518606946446c7a2ca6c13943a398b19f55c7d53529ab4f">PASTRY_STATE_JOIN</a>),
                                   -1,
                                   check_and_cast&lt;OverlayCtrlInfo*&gt;(msg-&gt;getControlInfo())-&gt;getHopCount(),
                                   <span class="keyword">false</span>);
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBasePastry.html#aadec419a4c2560717f1db3e36866b837">stateSent</a>++;
                         <a class="code" href="classBasePastry.html#a43218c86ea28a36b14f76b54b2ccea07">stateBytesSent</a> += stateMsg-&gt;getByteLength());
            <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(call-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(), stateMsg);
        }

    <span class="comment">// forward now:</span>
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8bfd42826bb62ca0be9bcdd0ee2fc52d"></a><!-- doxytag: member="Pastry::sendStateDelayed" ref="a8bfd42826bb62ca0be9bcdd0ee2fc52d" args="(const TransportAddress &amp;destination)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Pastry::sendStateDelayed </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>destination</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send a standard state message with a small delay </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">destination</td><td>destination node </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Pastry_8cc_source.html#l00330">330</a> of file <a class="el" href="Pastry_8cc_source.html">Pastry.cc</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00939">checkProxCache()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classPastrySendState.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastrySendState</a>* selfMsg = <span class="keyword">new</span> <a class="code" href="classPastrySendState.html" title="Class generated from overlay/pastry/PastryMessage.msg by opp_msgc.">PastrySendState</a>(<span class="stringliteral">&quot;sendStateWait&quot;</span>);
    selfMsg-&gt;<a class="code" href="classPastrySendState.html#a98bec67ca2f64b3a3825b267d2af85f4">setDest</a>(destination);
    <a class="code" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">sendStateWait</a>.push_back(selfMsg);
    scheduleAt(simTime() + 0.0001, selfMsg);
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aed663ddfc74b4fa5dee232eacd9325fd"></a><!-- doxytag: member="Pastry::depth" ref="aed663ddfc74b4fa5dee232eacd9325fd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classPastry.html#aed663ddfc74b4fa5dee232eacd9325fd">Pastry::depth</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00139">139</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00654">handleRequestRoutingRowResponse()</a>, and <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>.</p>

</div>
</div>
<a class="anchor" id="a662c8e13ab30edeeb36c591bcffed4c0"></a><!-- doxytag: member="Pastry::discoveryModeProbedNodes" ref="a662c8e13ab30edeeb36c591bcffed4c0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t <a class="el" href="classPastry.html#a662c8e13ab30edeeb36c591bcffed4c0">Pastry::discoveryModeProbedNodes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00138">138</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00623">handleRequestLeafSetResponse()</a>, <a class="el" href="Pastry_8cc_source.html#l00654">handleRequestRoutingRowResponse()</a>, and <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>.</p>

</div>
</div>
<a class="anchor" id="af876bfc5832efcc74946fc92f468ebe9"></a><!-- doxytag: member="Pastry::discoveryTimeout" ref="af876bfc5832efcc74946fc92f468ebe9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classPastry.html#af876bfc5832efcc74946fc92f468ebe9">Pastry::discoveryTimeout</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00155">155</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00623">handleRequestLeafSetResponse()</a>, <a class="el" href="Pastry_8cc_source.html#l00654">handleRequestRoutingRowResponse()</a>, <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>, <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00039">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="a533318cca6e80d30c0ef723282331e5a"></a><!-- doxytag: member="Pastry::discoveryTimeoutAmount" ref="a533318cca6e80d30c0ef723282331e5a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classPastry.html#a533318cca6e80d30c0ef723282331e5a">Pastry::discoveryTimeoutAmount</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00135">135</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00623">handleRequestLeafSetResponse()</a>, <a class="el" href="Pastry_8cc_source.html#l00654">handleRequestRoutingRowResponse()</a>, and <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="af5d645f87337b64a2ce04e994d3436e7"></a><!-- doxytag: member="Pastry::minimalJoinState" ref="af5d645f87337b64a2ce04e994d3436e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#af5d645f87337b64a2ce04e994d3436e7">Pastry::minimalJoinState</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00143">143</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00382">handlePastryJoinCall()</a>, <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>, <a class="el" href="Pastry_8cc_source.html#l00729">iterativeJoinHook()</a>, and <a class="el" href="Pastry_8cc_source.html#l00696">recursiveRoutingHook()</a>.</p>

</div>
</div>
<a class="anchor" id="abaf6ee84a60273e509e713fabe4b25e3"></a><!-- doxytag: member="Pastry::notifyList" ref="abaf6ee84a60273e509e713fabe4b25e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classTransportAddress.html">TransportAddress</a>&gt; <a class="el" href="classPastry.html#abaf6ee84a60273e509e713fabe4b25e3">Pastry::notifyList</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>List of nodes to notify after join. </p>

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00125">125</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00052">clearVectors()</a>, <a class="el" href="Pastry_8cc_source.html#l00761">doJoinUpdate()</a>, and <a class="el" href="Pastry_8cc_source.html#l00804">doSecondStage()</a>.</p>

</div>
</div>
<a class="anchor" id="a5a7acb21ccf23165142efa88bae71e52"></a><!-- doxytag: member="Pastry::overrideNewPastry" ref="a5a7acb21ccf23165142efa88bae71e52" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a5a7acb21ccf23165142efa88bae71e52">Pastry::overrideNewPastry</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00151">151</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="af80b068d6f88b70026caa7e5b2637b62"></a><!-- doxytag: member="Pastry::overrideOldPastry" ref="af80b068d6f88b70026caa7e5b2637b62" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#af80b068d6f88b70026caa7e5b2637b62">Pastry::overrideOldPastry</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00150">150</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a6531029cc05c41c94976078bf0abd93a"></a><!-- doxytag: member="Pastry::partialJoinPath" ref="a6531029cc05c41c94976078bf0abd93a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a6531029cc05c41c94976078bf0abd93a">Pastry::partialJoinPath</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00136">136</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>, and <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a5c93eb479cbc43a00cb0886c3eb5b452"></a><!-- doxytag: member="Pastry::pingBeforeSecondStage" ref="a5c93eb479cbc43a00cb0886c3eb5b452" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a5c93eb479cbc43a00cb0886c3eb5b452">Pastry::pingBeforeSecondStage</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00148">148</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l01193">handleStateMessage()</a>, <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l01410">processState()</a>.</p>

</div>
</div>
<a class="anchor" id="a997e3c2755fb3dee24fe9142a4e5c08c"></a><!-- doxytag: member="Pastry::repairTaskTimeout" ref="a997e3c2755fb3dee24fe9142a4e5c08c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classPastry.html#a997e3c2755fb3dee24fe9142a4e5c08c">Pastry::repairTaskTimeout</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00156">156</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>, <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00039">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="aca67080bf2f219f3c1cd2eca39188aba"></a><!-- doxytag: member="Pastry::ringCheck" ref="aca67080bf2f219f3c1cd2eca39188aba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classPastry.html#aca67080bf2f219f3c1cd2eca39188aba">Pastry::ringCheck</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00154">154</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

</div>
</div>
<a class="anchor" id="a252d835018fef1273f54e1dba733daf5"></a><!-- doxytag: member="Pastry::routingTableMaintenanceInterval" ref="a252d835018fef1273f54e1dba733daf5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classPastry.html#a252d835018fef1273f54e1dba733daf5">Pastry::routingTableMaintenanceInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00134">134</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>, <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00039">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="a8bfec13ef53de9a9e938549f55d31355"></a><!-- doxytag: member="Pastry::secondStageInterval" ref="a8bfec13ef53de9a9e938549f55d31355" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classPastry.html#a8bfec13ef53de9a9e938549f55d31355">Pastry::secondStageInterval</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00133">133</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, and <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a6dfb09590ce5a63c21f6cbf7e2153e3d"></a><!-- doxytag: member="Pastry::secondStageWait" ref="a6dfb09590ce5a63c21f6cbf7e2153e3d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classPastry.html#a6dfb09590ce5a63c21f6cbf7e2153e3d">Pastry::secondStageWait</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00153">153</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>, <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00039">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="a697f91ef2bdef3df33c45755f3973d0e"></a><!-- doxytag: member="Pastry::sendStateAtLeafsetRepair" ref="a697f91ef2bdef3df33c45755f3973d0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a697f91ef2bdef3df33c45755f3973d0e">Pastry::sendStateAtLeafsetRepair</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00147">147</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00886">handleFailedNode()</a>, and <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="acc3e51662f6d2c7c72636e2a904cd6ca"></a><!-- doxytag: member="Pastry::sendStateWait" ref="acc3e51662f6d2c7c72636e2a904cd6ca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classPastrySendState.html">PastrySendState</a>*&gt; <a class="el" href="classPastry.html#acc3e51662f6d2c7c72636e2a904cd6ca">Pastry::sendStateWait</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00127">127</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>, <a class="el" href="Pastry_8cc_source.html#l00073">purgeVectors()</a>, and <a class="el" href="Pastry_8cc_source.html#l00330">sendStateDelayed()</a>.</p>

</div>
</div>
<a class="anchor" id="a124da5018df353375c1b1b3af057c646"></a><!-- doxytag: member="Pastry::stReceived" ref="a124da5018df353375c1b1b3af057c646" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structPastryStateMsgHandle.html">PastryStateMsgHandle</a>&gt; <a class="el" href="classPastry.html#a124da5018df353375c1b1b3af057c646">Pastry::stReceived</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State messages to process during join. </p>

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00119">119</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00939">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l00052">clearVectors()</a>, <a class="el" href="Pastry_8cc_source.html#l00761">doJoinUpdate()</a>, <a class="el" href="Pastry_8cc_source.html#l01193">handleStateMessage()</a>, <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>, and <a class="el" href="Pastry_8cc_source.html#l01101">mergeState()</a>.</p>

</div>
</div>
<a class="anchor" id="a39e21bad6ac44591dd04dd5cb69e0d69"></a><!-- doxytag: member="Pastry::stReceivedPos" ref="a39e21bad6ac44591dd04dd5cb69e0d69" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structPastryStateMsgHandle.html">PastryStateMsgHandle</a>&gt;::iterator <a class="el" href="classPastry.html#a39e21bad6ac44591dd04dd5cb69e0d69">Pastry::stReceivedPos</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00120">120</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00939">checkProxCache()</a>, <a class="el" href="Pastry_8cc_source.html#l00052">clearVectors()</a>, <a class="el" href="Pastry_8cc_source.html#l01193">handleStateMessage()</a>, and <a class="el" href="Pastry_8cc_source.html#l00252">handleTimerEvent()</a>.</p>

</div>
</div>
<a class="anchor" id="ab6abf133583dc4f91ae74fcb7ad2d188"></a><!-- doxytag: member="Pastry::updateCounter" ref="ab6abf133583dc4f91ae74fcb7ad2d188" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classPastry.html#ab6abf133583dc4f91ae74fcb7ad2d188">Pastry::updateCounter</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00141">141</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00939">checkProxCache()</a>, and <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a51ea6ebb7a60392699bf04a2f0b37309"></a><!-- doxytag: member="Pastry::useDiscovery" ref="a51ea6ebb7a60392699bf04a2f0b37309" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a51ea6ebb7a60392699bf04a2f0b37309">Pastry::useDiscovery</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00144">144</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>, <a class="el" href="Pastry_8cc_source.html#l00145">joinOverlay()</a>, and <a class="el" href="Pastry_8cc_source.html#l00039">~Pastry()</a>.</p>

</div>
</div>
<a class="anchor" id="ad2cab4f64253005e4cc67e1e116b8d77"></a><!-- doxytag: member="Pastry::useRoutingTableMaintenance" ref="ad2cab4f64253005e4cc67e1e116b8d77" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#ad2cab4f64253005e4cc67e1e116b8d77">Pastry::useRoutingTableMaintenance</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00146">146</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, and <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a76def04af940e240a50c48e6040cee2b"></a><!-- doxytag: member="Pastry::useSecondStage" ref="a76def04af940e240a50c48e6040cee2b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classPastry.html#a76def04af940e240a50c48e6040cee2b">Pastry::useSecondStage</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Pastry_8h_source.html#l00145">145</a> of file <a class="el" href="Pastry_8h_source.html">Pastry.h</a>.</p>

<p>Referenced by <a class="el" href="Pastry_8cc_source.html#l00161">changeState()</a>, and <a class="el" href="Pastry_8cc_source.html#l00091">initializeOverlay()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Pastry_8h_source.html">Pastry.h</a></li>
<li><a class="el" href="Pastry_8cc_source.html">Pastry.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classPastry.html">Pastry</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:56 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
