<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: Broose Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classBroose.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">Broose Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="Broose" --><!-- doxytag: inherits="BaseOverlay" -->
<p><a class="el" href="classBroose.html" title="Broose overlay module.">Broose</a> overlay module.  
 <a href="classBroose.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="Broose_8h_source.html">Broose.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Broose:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classBroose.png" usemap="#Broose_map" alt=""/>
  <map id="Broose_map" name="Broose_map">
<area href="classBaseOverlay.html" title="Base class for overlays." alt="BaseOverlay" shape="rect" coords="115,112,220,136"/>
<area href="classBaseRpc.html" title="Base class for RPCs." alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classTopologyVis.html" alt="TopologyVis" shape="rect" coords="230,56,335,80"/>
<area href="classRpcListener.html" title="A Remote-Procedure-Call listener class." alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
 </div></div>

<p><a href="classBroose-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#acfbf2b4f5696183209f9d0546e772821">Broose</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a3b0bca5bf25266faf0ffe7194f322805">~Broose</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a98565a4675febbe6e107e4c49dc58450">initializeOverlay</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes derived-class-attributes.  <a href="#a98565a4675febbe6e107e4c49dc58450"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a612a233a588034ad82589aab7769e196">finishOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">collects statistical data in derived class  <a href="#a612a233a588034ad82589aab7769e196"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a40ebbf7442175faf9f71527d297f2834">isSiblingFor</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, int numSiblings, bool *err)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Query if a node is among the siblings for a given key.  <a href="#a40ebbf7442175faf9f71527d297f2834"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a6e8d0813889738a8c12c47cce18586e5">joinOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Join the overlay with a given nodeID in thisNode.key.  <a href="#a6e8d0813889738a8c12c47cce18586e5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#aa1c5b32d5a8043dedb9e541d7d6a106a">recordOverlaySentStats</a> (<a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Collect overlay specific sent messages statistics.  <a href="#aa1c5b32d5a8043dedb9e541d7d6a106a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a9ff73fadcd26b7b793020517d5d248c0">handleRpcCall</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes Remote-Procedure-Call invocation messages.  <a href="#a9ff73fadcd26b7b793020517d5d248c0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#ac0e5eb20a2e995afeccc2b35a8e97967">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a96653c170474659145bbdeae4c8a6ca3">updateTooltip</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">updates information shown in tk-environment  <a href="#a96653c170474659145bbdeae4c8a6ca3"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a2c835e754977b5781ca74d9da3470721">handleJoinTimerExpired</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handles a expired join timer  <a href="#a2c835e754977b5781ca74d9da3470721"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a1077711ecf1d2da2cd87ab71766d2ade">handleBucketTimerExpired</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handles a expired bucket refresh timer  <a href="#a1077711ecf1d2da2cd87ab71766d2ade"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a2f8c758024a30b07ed271accebebd288">getRoutingDistance</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;node, int dist)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">calculates the de-buijn distance between a key and a nodeId  <a href="#a2f8c758024a30b07ed271accebebd288"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a265144e492745b2832eb6758cbf6385d">routingAdd</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node, bool isAlive, simtime_t rtt=MAXTIME)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a node to the routing table.  <a href="#a265144e492745b2832eb6758cbf6385d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a14b5e34e7b68ef3dcd588ca67e477e51">changeState</a> (int <a class="el" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">changes the node's state  <a href="#a14b5e34e7b68ef3dcd588ca67e477e51"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a7af9754f05bb7e0e7a53a9334ada5784">findNode</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, int numRedundantNodes, int numSiblings, <a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements the find node call.  <a href="#a7af9754f05bb7e0e7a53a9334ada5784"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#ade0172a588daa00efd1a0db945579047">getMaxNumSiblings</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay protocol.  <a href="#ade0172a588daa00efd1a0db945579047"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a510ec0b3d3378fc4ebb2a276cdff829b">getMaxNumRedundantNodes</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Query the maximum number of redundant next hop nodes that are returned by <a class="el" href="classBroose.html#a7af9754f05bb7e0e7a53a9334ada5784" title="Implements the find node call.">findNode()</a>.  <a href="#a510ec0b3d3378fc4ebb2a276cdff829b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a68de6c368892f19883e1ecd3db10ae5c">displayBucketState</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">debug function which output the content of the node's buckets  <a href="#a68de6c368892f19883e1ecd3db10ae5c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a374f84f156f25252dfe3fca84e29ccae">handleRpcResponse</a> (<a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *msg, const <a class="el" href="classRpcState.html">RpcState</a> &amp;rpcState, simtime_t rtt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC response has been received.  <a href="#a374f84f156f25252dfe3fca84e29ccae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a1f57a7b9ea934f2577f0336ce3530998">handleRpcTimeout</a> (const <a class="el" href="classRpcState.html">RpcState</a> &amp;rpcState)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC timeout has been reached.  <a href="#a1f57a7b9ea934f2577f0336ce3530998"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#ac10bba057753a16f4bac89ee8063f5da">handleFindNodeTimeout</a> (<a class="el" href="classFindNodeCall.html">FindNodeCall</a> *findNode, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;destKey)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an Find Node Call timeout has been reached.  <a href="#ac10bba057753a16f4bac89ee8063f5da"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a64365d561848d0f9be471ac2c6588d36">handleBucketRequestRpc</a> (<a class="el" href="classBucketCall.html">BucketCall</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handles a received Bucket request  <a href="#a64365d561848d0f9be471ac2c6588d36"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a2479baebf247d26c2cb9171104932b8e">handleBucketResponseRpc</a> (<a class="el" href="classBucketResponse.html">BucketResponse</a> *msg, const <a class="el" href="classRpcState.html">RpcState</a> &amp;rpcState)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handles a received Bucket response  <a href="#a2479baebf247d26c2cb9171104932b8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#ac2bee9148a5c6f7858f1ce900fd8205e">handleBucketTimeout</a> (<a class="el" href="classBucketCall.html">BucketCall</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handles a received Bucket timeout  <a href="#ac2bee9148a5c6f7858f1ce900fd8205e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a813367dd5a82aad256a0cff55192e8eb">routingTimeout</a> (const <a class="el" href="classBrooseHandle.html">BrooseHandle</a> &amp;handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a0e74d664db69ad2cefde9d3443a36cc6">pingResponse</a> (<a class="el" href="classPingResponse.html">PingResponse</a> *pingResponse, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#aa089c2853d648b0009fcf501f8ec8c7f">pingTimeout</a> (<a class="el" href="classPingCall.html">PingCall</a> *pingCall, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, cPolymorphic *context, int rpcId)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#afd491170a7241cc14745d18aa2cd904b">setLastSeen</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">updates the timestamp of a node in all buckets  <a href="#afd491170a7241cc14745d18aa2cd904b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#adfc7024ff64b930082b0635a95f4d9e4">addNode</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">adds a node to all buckets  <a href="#adfc7024ff64b930082b0635a95f4d9e4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a1832a98eeba497ade89b8081d4030ca8">resetFailedResponses</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">resets the counter of failed responses  <a href="#a1832a98eeba497ade89b8081d4030ca8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a639a843adbe84e396a016a29c165133e">setRTT</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node, simtime_t rtt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">sets the rtt to a node in all buckets  <a href="#a639a843adbe84e396a016a29c165133e"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a3e1bb89f2b86d107d0cbe08903f1591a">chooseLookup</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">decides which kind of lookup (right/left shifting) is used  <a href="#a3e1bb89f2b86d107d0cbe08903f1591a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#ad55f92653a0890957d51d709334934db">joinDelay</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">time interval between two join tries  <a href="#ad55f92653a0890957d51d709334934db"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#abec6e84f1003daab645f301b62b743dc">receivedJoinResponse</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of received join response messages  <a href="#abec6e84f1003daab645f301b62b743dc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a2478813cd5f204f9acf543af839d8cf9">receivedBBucketLookup</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of received lookup responses for the B bucket  <a href="#a2478813cd5f204f9acf543af839d8cf9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a224b9c0c4224c8616baf9a7d1215d008">numberBBucketLookup</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">maximal number of lookup responses for the B bucket  <a href="#a224b9c0c4224c8616baf9a7d1215d008"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#afba56946f8381bc639b4be08802f82a7">receivedLBucketLookup</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of received lookup responses for the L bucket  <a href="#afba56946f8381bc639b4be08802f82a7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a7dd130326a6147f64465f509c1373f3b">numberLBucketLookup</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">maximal number of lookup responses for the L bucket  <a href="#a7dd130326a6147f64465f509c1373f3b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53">shiftingBits</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of bits shifted in/out each step  <a href="#a2ba4078c7fc64338d75798beec808c53"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e">powShiftingBits</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">2^{variable shiftingBits}  <a href="#a64c8b15959539f76effe20c7a2fb605e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a9376acda2ea0dc2012b868eec0813d6a">bucketSize</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">maximal number of bucket entries  <a href="#a9376acda2ea0dc2012b868eec0813d6a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a5797b25e931a407a62e9ec12b5107136">rBucketSize</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">maximal number of entries in the r buckets  <a href="#a5797b25e931a407a62e9ec12b5107136"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a913ebd156f864f848f044466ea2279fd">keyLength</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">length of the node and data IDs  <a href="#a913ebd156f864f848f044466ea2279fd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#aabecab5487074574f3d24575abcbbb6f">refreshTime</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">idle time after which a node is pinged  <a href="#aabecab5487074574f3d24575abcbbb6f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a374530e57a3906d1094c755c45794ba3">userDist</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">how many hops are added to the estimated hop count  <a href="#a374530e57a3906d1094c755c45794ba3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a57652869a1fdae22b834a25a81cb1602">numberRetries</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of retries in case of timeout  <a href="#a57652869a1fdae22b834a25a81cb1602"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#ad82a8d9dd1024868b19f5d7fa9ee7b6e">bucketRetries</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of bucket retries for a successful join  <a href="#ad82a8d9dd1024868b19f5d7fa9ee7b6e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a5aabb67b0639701f115b58dc57593eda">stab1</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a9598a069920f5a2943b31107100a2c06">stab2</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a7f436170dc33d8639ce776ba2f778a65">bucketCount</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of Bucket messages  <a href="#a7f436170dc33d8639ce776ba2f778a65"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#abbe713ffb241ad11e401343889d1359b">bucketBytesSent</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">length of all Bucket messages  <a href="#abbe713ffb241ad11e401343889d1359b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#afc5b65d8a797fc49d8568ed7d20e8db4">numFailedPackets</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of packets which couldn't be routed correctly  <a href="#afc5b65d8a797fc49d8568ed7d20e8db4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classBrooseBucket.html">BrooseBucket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">lBucket</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classBrooseBucket.html">BrooseBucket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classBrooseBucket.html">BrooseBucket</a> **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classBrooseBucket.html">BrooseBucket</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a">bucketVector</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">vector of all <a class="el" href="classBroose.html" title="Broose overlay module.">Broose</a> buckets  <a href="#adcf7289c37c2df82620db0712d74e80a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a6456e3b9729a4a8136e7bdbf5a8a6bba">join_timer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#ab7113ef5ed2cf38e0d1001f5653665fc">bucket_timer</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">timer to reconstruct all buckets  <a href="#ab7113ef5ed2cf38e0d1001f5653665fc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTransportAddress.html">TransportAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#a61cf782a04f16846285e5705d2c634fe">bootstrapNode</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">node handle holding the bootstrap node  <a href="#a61cf782a04f16846285e5705d2c634fe"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBroose.html#acfe9d5a8bc85e9622bfad7f3a9b33a6e">BrooseBucket</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classBroose.html" title="Broose overlay module.">Broose</a> overlay module. </p>
<p>Implementation of the <a class="el" href="classBroose.html" title="Broose overlay module.">Broose</a> KBR overlay as described in "Broose: A Practical Distributed Hashtable Based on the
 De-Bruijn Topology" by Anh-Tuan Gai and Laurent Viennot</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Jochen Schenk </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>Bucket </dd></dl>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00052">52</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="acfbf2b4f5696183209f9d0546e772821"></a><!-- doxytag: member="Broose::Broose" ref="acfbf2b4f5696183209f9d0546e772821" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Broose::Broose </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00051">51</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classBroose.html#a6456e3b9729a4a8136e7bdbf5a8a6bba">join_timer</a> = NULL;
    <a class="code" href="classBroose.html#ab7113ef5ed2cf38e0d1001f5653665fc" title="timer to reconstruct all buckets">bucket_timer</a> = NULL;
    <a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a> = NULL;
    <a class="code" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">lBucket</a> = NULL;
    <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a> =  NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3b0bca5bf25266faf0ffe7194f322805"></a><!-- doxytag: member="Broose::~Broose" ref="a3b0bca5bf25266faf0ffe7194f322805" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Broose::~Broose </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00059">59</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// delete timers</span>
    cancelAndDelete(<a class="code" href="classBroose.html#a6456e3b9729a4a8136e7bdbf5a8a6bba">join_timer</a>);
    cancelAndDelete(<a class="code" href="classBroose.html#ab7113ef5ed2cf38e0d1001f5653665fc" title="timer to reconstruct all buckets">bucket_timer</a>);
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="adfc7024ff64b930082b0635a95f4d9e4"></a><!-- doxytag: member="Broose::addNode" ref="adfc7024ff64b930082b0635a95f4d9e4" args="(const NodeHandle &amp;node)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::addNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>adds a node to all buckets </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>node handle which should be added </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01116">1116</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// add node to all buckets</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.size(); i++) {
        <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;add(node);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a14b5e34e7b68ef3dcd588ca67e477e51"></a><!-- doxytag: member="Broose::changeState" ref="a14b5e34e7b68ef3dcd588ca67e477e51" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::changeState </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>changes the node's state </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>the state to which a node is changing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00145">145</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">switch</span> (toState) {
    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>: {
        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>;

        <span class="comment">// find a new bootstrap node and enroll to the bootstrap list</span>
        <a class="code" href="classBroose.html#a61cf782a04f16846285e5705d2c634fe" title="node handle holding the bootstrap node">bootstrapNode</a> = <a class="code" href="classBaseOverlay.html#abe4dea93564123116c97d5c4721f0504" title="pointer to the BootstrapList module">bootstrapList</a>-&gt;<a class="code" href="classBootstrapList.html#ac351433be1d43bbf8cbb871e9f9e1f69" title="Get a bootstrap node from the bootstrap list.">getBootstrapNode</a>();

        cancelEvent(<a class="code" href="classBroose.html#a6456e3b9729a4a8136e7bdbf5a8a6bba">join_timer</a>);
        scheduleAt(simTime(), <a class="code" href="classBroose.html#a6456e3b9729a4a8136e7bdbf5a8a6bba">join_timer</a>);

        <span class="comment">// initialize respectively clear the buckets</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a>; i++) {
            <a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a>[i]-&gt;<a class="code" href="classBrooseBucket.html#ac54c82db0009034bcbf028c86ae8045a" title="initializes a bucket">initializeBucket</a>(<a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>, i, <a class="code" href="classBroose.html#a5797b25e931a407a62e9ec12b5107136" title="maximal number of entries in the r buckets">rBucketSize</a>, <span class="keyword">this</span>);
        }

        <a class="code" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">lBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#ac54c82db0009034bcbf028c86ae8045a" title="initializes a bucket">initializeBucket</a>(-<a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>, 0, powShiftingBits*<a class="code" href="classBroose.html#a5797b25e931a407a62e9ec12b5107136" title="maximal number of entries in the r buckets">rBucketSize</a>,
                                  <span class="keyword">this</span>);
        <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#ac54c82db0009034bcbf028c86ae8045a" title="initializes a bucket">initializeBucket</a>(0, 0, 7*<a class="code" href="classBroose.html#a9376acda2ea0dc2012b868eec0813d6a" title="maximal number of bucket entries">bucketSize</a>, <span class="keyword">this</span>, <span class="keyword">true</span>);

        <span class="comment">// if we have restarted the join protocol reset parameters</span>
        <a class="code" href="classBroose.html#a2478813cd5f204f9acf543af839d8cf9" title="number of received lookup responses for the B bucket">receivedBBucketLookup</a> = 0;
        <a class="code" href="classBroose.html#afba56946f8381bc639b4be08802f82a7" title="number of received lookup responses for the L bucket">receivedLBucketLookup</a> = 0;
        <a class="code" href="classBroose.html#abec6e84f1003daab645f301b62b743dc" title="number of received join response messages">receivedJoinResponse</a> = 0;

        getParentModule()-&gt;getParentModule()-&gt;bubble(<span class="stringliteral">&quot;Enter INIT state.&quot;</span>);
        <a class="code" href="classBroose.html#a96653c170474659145bbdeae4c8a6ca3" title="updates information shown in tk-environment">updateTooltip</a>();
        <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faa17c975f477d6dd1f472e031d5bd6bc0">RSET</a>: {
        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faa17c975f477d6dd1f472e031d5bd6bc0">RSET</a>;

        <a class="code" href="classBrooseBucket.html" title="Broose bucket module.">BrooseBucket</a>* tmpBucket = <span class="keyword">new</span> <a class="code" href="classBroose.html#acfe9d5a8bc85e9622bfad7f3a9b33a6e">BrooseBucket</a>();
        tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#ac54c82db0009034bcbf028c86ae8045a" title="initializes a bucket">initializeBucket</a>(0, 0, powShiftingBits*rBucketSize, <span class="keyword">this</span>);

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a>; i++) {
            <span class="keywordtype">int</span> size = <a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a>[i]-&gt;<a class="code" href="classBrooseBucket.html#a7ef01cbcf70e7e8621793c8e94fa5198" title="returns number of current entries">getSize</a>();

            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; size; j++) {
                tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#ab3f7ae9d8575f049bc3ce6f501177f0c" title="adds a broose node handle to the bucket">add</a>(<a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a>[i]-&gt;<span class="keyword">get</span>(j));
            }
        }

        <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>** bCall = <span class="keyword">new</span> <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>*[tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#a7ef01cbcf70e7e8621793c8e94fa5198" title="returns number of current entries">getSize</a>()];
        <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#a7ef01cbcf70e7e8621793c8e94fa5198" title="returns number of current entries">getSize</a>(); i++) {
            bCall[i] = <span class="keyword">new</span> <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>(<span class="stringliteral">&quot;LBucketCall&quot;</span>);
            bCall[i]-&gt;<a class="code" href="classBucketCall.html#ab04b51e392e17924454bb4e5a1f9368a">setBucketType</a>(<a class="code" href="BrooseMessage__m_8h.html#a0d72090ca3225dfb0af1767bf6390a40adb45120aafd37a973140edee24708065">LEFT</a>);
            bCall[i]-&gt;<a class="code" href="classBucketCall.html#ab2256565d62dea3e984dee2c51bfa7f1">setProState</a>(<a class="code" href="BrooseMessage__m_8h.html#a1e4df1e60bb9501df7c024063484d127aa90bbfe38513a4fab312de105624e88e">PRSET</a>);
            bCall[i]-&gt;setBitLength(<a class="code" href="BrooseMessage__m_8h.html#a828592e4207a671e7eb7011a5cce9bc1">BUCKETCALL_L</a>(bcall[i]));

            <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#a9031c9a358274b8192b454a27eb0845e" title="returns a specific broose handle">get</a>(i), bCall[i], NULL,
                           10);
        }

        <span class="comment">// half of the calls must return for a state change</span>
        <a class="code" href="classBroose.html#a224b9c0c4224c8616baf9a7d1215d008" title="maximal number of lookup responses for the B bucket">numberBBucketLookup</a> = ceil((<span class="keywordtype">double</span>)tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#a7ef01cbcf70e7e8621793c8e94fa5198" title="returns number of current entries">getSize</a>() / 2);

        <span class="keyword">delete</span> tmpBucket;

        getParentModule()-&gt;getParentModule()-&gt;bubble(<span class="stringliteral">&quot;Enter RSET state.&quot;</span>);
        <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa5eb3bb010076f581e3a98cddf2531686">BSET</a>: {
        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa5eb3bb010076f581e3a98cddf2531686">BSET</a>;

        <span class="comment">// half of the calls must return for a state change</span>
        <a class="code" href="classBroose.html#a7dd130326a6147f64465f509c1373f3b" title="maximal number of lookup responses for the L bucket">numberLBucketLookup</a> = ceil((<span class="keywordtype">double</span>)<a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a7ef01cbcf70e7e8621793c8e94fa5198" title="returns number of current entries">getSize</a>() / 2);

        <span class="comment">// send messages to all entries of the B Bucket</span>
        <span class="keywordtype">int</span> size2 = <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a7ef01cbcf70e7e8621793c8e94fa5198" title="returns number of current entries">getSize</a>();
        <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>** bCall2 = <span class="keyword">new</span> <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>*[size2];
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size2; i++) {
            bCall2[i] = <span class="keyword">new</span> <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>(<span class="stringliteral">&quot;LBucketCall&quot;</span>);
            bCall2[i]-&gt;<a class="code" href="classBucketCall.html#ab04b51e392e17924454bb4e5a1f9368a">setBucketType</a>(<a class="code" href="BrooseMessage__m_8h.html#a0d72090ca3225dfb0af1767bf6390a40adb45120aafd37a973140edee24708065">LEFT</a>);
            bCall2[i]-&gt;<a class="code" href="classBucketCall.html#ab2256565d62dea3e984dee2c51bfa7f1">setProState</a>(<a class="code" href="BrooseMessage__m_8h.html#a1e4df1e60bb9501df7c024063484d127a59443e9ea684a77445f11ef9ebccebbd">PBSET</a>);
            bCall2[i]-&gt;setBitLength(<a class="code" href="BrooseMessage__m_8h.html#a828592e4207a671e7eb7011a5cce9bc1">BUCKETCALL_L</a>(bcall2[i]));

            <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(<a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a9031c9a358274b8192b454a27eb0845e" title="returns a specific broose handle">get</a>(i), bCall2[i], NULL,
                           10);
        }

        getParentModule()-&gt;getParentModule()-&gt;bubble(<span class="stringliteral">&quot;Enter BSET state.&quot;</span>);
        <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>: {
        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>;

        <span class="comment">// fill the bucket also with this node</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.size(); i++) {
            <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;add(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        }

        <span class="comment">// to disable the ping protocol a pingDelay or</span>
        <span class="comment">// refreshTime of zero was given</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBroose.html#aabecab5487074574f3d24575abcbbb6f" title="idle time after which a node is pinged">refreshTime</a> != 0) {
            cancelEvent(<a class="code" href="classBroose.html#ab7113ef5ed2cf38e0d1001f5653665fc" title="timer to reconstruct all buckets">bucket_timer</a>);
            scheduleAt(simTime() + (<a class="code" href="classBroose.html#aabecab5487074574f3d24575abcbbb6f" title="idle time after which a node is pinged">refreshTime</a> / 2.0), <a class="code" href="classBroose.html#ab7113ef5ed2cf38e0d1001f5653665fc" title="timer to reconstruct all buckets">bucket_timer</a>);
        }

        getParentModule()-&gt;getParentModule()-&gt;bubble(<span class="stringliteral">&quot;Enter READY state.&quot;</span>);

        <a class="code" href="classBroose.html#a96653c170474659145bbdeae4c8a6ca3" title="updates information shown in tk-environment">updateTooltip</a>();
        <span class="keywordflow">break</span>;
    }

    }
    <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>(<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a68de6c368892f19883e1ecd3db10ae5c"></a><!-- doxytag: member="Broose::displayBucketState" ref="a68de6c368892f19883e1ecd3db10ae5c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::displayBucketState </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>debug function which output the content of the node's buckets </p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00805">805</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[Broose::displayBucketState() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]&quot;</span> &lt;&lt; endl;

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a>; i++) {
        EV &lt;&lt; <span class="stringliteral">&quot;    Content of rBucket[&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span>;
        <a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a>[i]-&gt;<a class="code" href="classBrooseBucket.html#a3fdf948ac302e39c0a090d2c0f50971f" title="displays the content of the bucket on standard out">output</a>();
    }

    EV &lt;&lt; <span class="stringliteral">&quot;    Content of lBucket: &quot;</span>;
    <a class="code" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">lBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a3fdf948ac302e39c0a090d2c0f50971f" title="displays the content of the bucket on standard out">output</a>();
    EV &lt;&lt; <span class="stringliteral">&quot;    Content of bBucket: &quot;</span>;
    <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a3fdf948ac302e39c0a090d2c0f50971f" title="displays the content of the bucket on standard out">output</a>();
    EV &lt;&lt; endl;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7af9754f05bb7e0e7a53a9334ada5784"></a><!-- doxytag: member="Broose::findNode" ref="a7af9754f05bb7e0e7a53a9334ada5784" args="(const OverlayKey &amp;key, int numRedundantNodes, int numSiblings, BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a> * Broose::findNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numRedundantNodes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numSiblings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements the find node call. </p>
<p>This method simply returns the closest nodes known in the corresponding routing topology. If the node is a sibling for this key (isSiblingFor(key) = true), this method returns all numSiblings siblings, with the closest neighbor to the key first.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>The lookup key. </td></tr>
    <tr><td class="paramname">numRedundantNodes</td><td>Maximum number of next hop nodes to return. </td></tr>
    <tr><td class="paramname">numSiblings</td><td>number of siblings to return </td></tr>
    <tr><td class="paramname">msg</td><td>A pointer to the <a class="el" href="classBaseRouteMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">BaseRouteMessage</a> or <a class="el" href="classFindNodeCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">FindNodeCall</a> message of this lookup. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NodeVector with closest nodes. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a7cbdce336237331b67a3c69c4e43d489">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00574">574</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ((<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>) || (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faa17c975f477d6dd1f472e031d5bd6bc0">RSET</a>) || (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa99c9df0220f7a63e3b548d19181dc2b1">FAILED</a>))
        <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a>();

    <a class="code" href="classBrooseFindNodeExtMessage.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BrooseFindNodeExtMessage</a> *findNodeExt = NULL;
    <span class="keywordtype">bool</span> err;
    <span class="keywordtype">bool</span> isSibling = <a class="code" href="classBroose.html#a40ebbf7442175faf9f71527d297f2834" title="Query if a node is among the siblings for a given key.">isSiblingFor</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>, key, numSiblings, &amp;err);
    <span class="keywordtype">int</span> resultSize;

    <span class="keywordflow">if</span> (numSiblings &lt; 0) {
        <span class="comment">// exhaustive iterative doesn&#39;t care about siblings</span>
        resultSize = numRedundantNodes;
    } <span class="keywordflow">else</span> {
        resultSize = isSibling ? (numSiblings ? numSiblings : 1)
                                                      : numRedundantNodes;
    }
    assert(numSiblings || numRedundantNodes);
    <a class="code" href="classBaseKeySortedVector.html">NodeVector</a>* result = <span class="keyword">new</span> <a class="code" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a>(resultSize);

    <span class="keywordflow">if</span> (isSibling) {
        <span class="comment">//return the closest nodes</span>
        <span class="comment">// sort with XOR distance to key</span>
        <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>* comp =
            <span class="keyword">new</span> <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>(key);
        result-&gt;<a class="code" href="classBaseKeySortedVector.html#ac509494faf9fa46ca1d11964a21c8247">setComparator</a>(comp);

        <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#ad7660a8ba5d3b149b6527d62d4463992" title="Fills a NodeVector with all bucket entries.">fillVector</a>(result);
        result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

        <span class="keyword">delete</span> comp;

        <span class="comment">/*</span>
<span class="comment">        std::cout &lt;&lt; &quot;key: &quot; &lt;&lt; key.toString(2).substr(0, 8)</span>
<span class="comment">                  &lt;&lt; &quot; ThisNode: &quot; &lt;&lt; thisNode.getKey().toString(2).substr(0, 8);</span>
<span class="comment">        if (result-&gt;size() &gt; 0) {</span>
<span class="comment">            std::cout &lt;&lt; &quot; next hop (final): &quot; &lt;&lt; (*result)[0].getKey().toString(2).substr(0, 8);</span>
<span class="comment">        } else {</span>
<span class="comment">            std::cout &lt;&lt; &quot; no next hop! (final)&quot;;</span>
<span class="comment">        }</span>
<span class="comment">        std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</span>
<span class="comment">        */</span>

        <span class="keywordflow">return</span> result;
    }

    <span class="keywordflow">if</span> (msg != NULL) {
        <span class="keywordflow">if</span> (!msg-&gt;hasObject(<span class="stringliteral">&quot;findNodeExt&quot;</span>)) {
            findNodeExt = <span class="keyword">new</span> <a class="code" href="classBrooseFindNodeExtMessage.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BrooseFindNodeExtMessage</a>(<span class="stringliteral">&quot;findNodeExt&quot;</span>);

            <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> routeKey = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>();
            <span class="comment">// estimate distance</span>
            <span class="keywordtype">int</span> dist = max(<a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a>[0]-&gt;longestPrefix(),
                           <a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a>[1]-&gt;longestPrefix()) + 1 + <a class="code" href="classBroose.html#a374530e57a3906d1094c755c45794ba3" title="how many hops are added to the estimated hop count">userDist</a>;

            <span class="keywordflow">if</span> ((dist % <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>) != 0)
                dist += (shiftingBits - (dist % <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>));

            <span class="keywordflow">if</span> (dist &gt; <a class="code" href="classBroose.html#a913ebd156f864f848f044466ea2279fd" title="length of the node and data IDs">keyLength</a>) {
                <span class="keywordflow">if</span> ((<a class="code" href="classBroose.html#a913ebd156f864f848f044466ea2279fd" title="length of the node and data IDs">keyLength</a> % shiftingBits) == 0) {
                    dist = <a class="code" href="classBroose.html#a913ebd156f864f848f044466ea2279fd" title="length of the node and data IDs">keyLength</a>;
                } <span class="keywordflow">else</span> {
                    dist = (<a class="code" href="classBroose.html#a913ebd156f864f848f044466ea2279fd" title="length of the node and data IDs">keyLength</a> - <a class="code" href="classBroose.html#a913ebd156f864f848f044466ea2279fd" title="length of the node and data IDs">keyLength</a> % <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>);
                }
            }

            <span class="keywordflow">if</span> ((<a class="code" href="classBroose.html#a3e1bb89f2b86d107d0cbe08903f1591a" title="decides which kind of lookup (right/left shifting) is used">chooseLookup</a>++) % 2 == 0) {
                <span class="comment">// init left shifting lookup</span>
                findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#ac7b7626c4fe39706eed608b7473f72cc">setRightShifting</a>(<span class="keyword">false</span>);

                <span class="keywordtype">int</span> prefix = 0;
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; dist; i++) {
                    prefix += <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#abf5c47662357fb4f01de9a7a93523308">getBit</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">getLength</a>() - i - 1) &lt;&lt; (dist - i - 1);
                }

                <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> pre(prefix);
                routeKey = key &gt;&gt; dist;
                routeKey += (pre &lt;&lt; key.<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">getLength</a>() - dist);

                dist = -dist;
            } <span class="keywordflow">else</span> {
                <span class="comment">// init right shifting lookup</span>
                findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#ac7b7626c4fe39706eed608b7473f72cc">setRightShifting</a>(<span class="keyword">true</span>);
            }

            <span class="comment">//add contact for next Hop</span>
            findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a1045ab713622587d65f1f5b700f8983a">setLastNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
            findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#aae996c7e18f5f61f4e631b2a63a7a33b">setRouteKey</a>(routeKey);
            findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a32255169d451507c9a851813469d880b">setStep</a>(dist);
            findNodeExt-&gt;setBitLength(<a class="code" href="BrooseMessage__m_8h.html#a16ba8d8ad06fbd2154037234fa035de7">BROOSEFINDNODEEXTMESSAGE_L</a>);

            msg-&gt;addObject( findNodeExt );
        }

        findNodeExt = (<a class="code" href="classBrooseFindNodeExtMessage.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BrooseFindNodeExtMessage</a>*) msg-&gt;getObject(<span class="stringliteral">&quot;findNodeExt&quot;</span>);
    }

    <span class="comment">// update buckets with last hop</span>
    <a class="code" href="classBroose.html#adfc7024ff64b930082b0635a95f4d9e4" title="adds a node to all buckets">addNode</a>(findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a4645c8c25ebba1bdf48fd9f2919720ff">getLastNode</a>());
    <a class="code" href="classBroose.html#afd491170a7241cc14745d18aa2cd904b" title="updates the timestamp of a node in all buckets">setLastSeen</a>(findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a4645c8c25ebba1bdf48fd9f2919720ff">getLastNode</a>());

    <span class="comment">// replace last hop contact information with</span>
    <span class="comment">// this hop contact information</span>
    findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a1045ab713622587d65f1f5b700f8983a">setLastNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

    <span class="comment">// brother lookup</span>
    <span class="keywordflow">if</span> (findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a3be6649aae39d09d4ee64f52b6d3cf2d">getStep</a>() == 0) {
        <span class="comment">// return the closest nodes sorted by XOR distance to key</span>
        <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>* comp =
            <span class="keyword">new</span> <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>(key);
        result-&gt;<a class="code" href="classBaseKeySortedVector.html#ac509494faf9fa46ca1d11964a21c8247">setComparator</a>(comp);

        <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#ad7660a8ba5d3b149b6527d62d4463992" title="Fills a NodeVector with all bucket entries.">fillVector</a>(result);
        result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

        <span class="keyword">delete</span> comp;
        <span class="keywordflow">return</span> result;
    }

    <span class="keywordflow">if</span> (findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#ae7e0659698a926c65992d073a73004bb">getRightShifting</a>() == <span class="keyword">false</span>) {
        <span class="comment">// Left Shifting Lookup</span>

        <span class="comment">// can&#39;t handle left shifting lookup in BSET-State</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa5eb3bb010076f581e3a98cddf2531686">BSET</a>)
            <span class="keywordflow">return</span> result;

        <span class="comment">// calculate routing key</span>
        findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#aae996c7e18f5f61f4e631b2a63a7a33b">setRouteKey</a>((findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a09524aea04bc42a759d3c97786521094">getRouteKey</a>()) &lt;&lt; shiftingBits);
        findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a32255169d451507c9a851813469d880b">setStep</a>(findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a3be6649aae39d09d4ee64f52b6d3cf2d">getStep</a>() + <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>);

        <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>* comp = NULL;
        comp = <span class="keyword">new</span> <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>(
                findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a09524aea04bc42a759d3c97786521094">getRouteKey</a>());

        result-&gt;<a class="code" href="classBaseKeySortedVector.html#ac509494faf9fa46ca1d11964a21c8247">setComparator</a>(comp);
        <a class="code" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">lBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#ad7660a8ba5d3b149b6527d62d4463992" title="Fills a NodeVector with all bucket entries.">fillVector</a>(result);
        result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        <span class="keyword">delete</span> comp;
        <span class="comment">/*</span>
<span class="comment">        std::cout &lt;&lt; &quot;key: &quot; &lt;&lt; key.toString(2).substr(0, 8)</span>
<span class="comment">                  &lt;&lt; &quot; dist: &quot; &lt;&lt; findNodeExt-&gt;getStep()</span>
<span class="comment">                  &lt;&lt; &quot; rtkey: &quot; &lt;&lt; findNodeExt-&gt;getRouteKey().toString(2).substr(0, 8)</span>
<span class="comment">                  &lt;&lt; &quot; ThisNode: &quot; &lt;&lt; thisNode.getKey().toString(2).substr(0, 8);</span>
<span class="comment">        if (result-&gt;size() &gt; 0) {</span>
<span class="comment">            std::cout &lt;&lt; &quot; next hop: &quot; &lt;&lt; (*result)[0].getKey().toString(2).substr(0, 8);</span>
<span class="comment">        } else {</span>
<span class="comment">            std::cout &lt;&lt; &quot; no next hop!&quot;;</span>
<span class="comment">        }</span>
<span class="comment">        std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</span>
<span class="comment">        */</span>

    } <span class="keywordflow">else</span> {
        <span class="comment">// Right Shifting Lookup</span>


        <span class="comment">// calculate routing key</span>
        <span class="keywordtype">int</span> prefix = 0;
        <span class="keywordtype">int</span> dist = findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a3be6649aae39d09d4ee64f52b6d3cf2d">getStep</a>();
        <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> routeKey = findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a09524aea04bc42a759d3c97786521094">getRouteKey</a>() &gt;&gt; <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>;
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>; i++)
            prefix += ((<span class="keywordtype">int</span>)key.<a class="code" href="classOverlayKey.html#abf5c47662357fb4f01de9a7a93523308">getBit</a>(key.<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">getLength</a>() - dist + i) &lt;&lt; i);
        <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> pre(prefix);
        routeKey += (pre &lt;&lt; (routeKey.<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">getLength</a>()-<a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>));

        findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#aae996c7e18f5f61f4e631b2a63a7a33b">setRouteKey</a>(routeKey);
        findNodeExt-&gt;<a class="code" href="classBrooseFindNodeExtMessage.html#a32255169d451507c9a851813469d880b">setStep</a>(dist - shiftingBits);

        <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>* comp = NULL;
        comp = <span class="keyword">new</span> <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>(routeKey);

        result-&gt;<a class="code" href="classBaseKeySortedVector.html#ac509494faf9fa46ca1d11964a21c8247">setComparator</a>(comp);
        <a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a>[prefix]-&gt;<a class="code" href="classBrooseBucket.html#ad7660a8ba5d3b149b6527d62d4463992" title="Fills a NodeVector with all bucket entries.">fillVector</a>(result);
        result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        <span class="keyword">delete</span> comp;
        <span class="comment">/*</span>
<span class="comment">        std::cout &lt;&lt; &quot;key: &quot; &lt;&lt; key.toString(2).substr(0, 8)</span>
<span class="comment">                  &lt;&lt; &quot; dist: &quot; &lt;&lt; findNodeExt-&gt;getStep()</span>
<span class="comment">                  &lt;&lt; &quot; rtkey: &quot; &lt;&lt; findNodeExt-&gt;getRouteKey().toString(2).substr(0, 8)</span>
<span class="comment">                  &lt;&lt; &quot; ThisNode: &quot; &lt;&lt; thisNode.getKey().toString(2).substr(0, 8);</span>
<span class="comment">        if (result-&gt;size() &gt; 0) {</span>
<span class="comment">            std::cout &lt;&lt; &quot; next hop: &quot; &lt;&lt; (*result)[0].getKey().toString(2).substr(0, 8);</span>
<span class="comment">        } else {</span>
<span class="comment">            std::cout &lt;&lt; &quot; no next hop!&quot;;</span>
<span class="comment">        }</span>
<span class="comment">        std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</span>
<span class="comment">        */</span>
    }

    <span class="keywordflow">if</span> ((*result)[0] == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
        <span class="keyword">delete</span> result;
        <span class="keywordflow">return</span> (<a class="code" href="classBroose.html#a7af9754f05bb7e0e7a53a9334ada5784" title="Implements the find node call.">findNode</a>(key, numRedundantNodes, numSiblings, msg));
    } <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> result;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a612a233a588034ad82589aab7769e196"></a><!-- doxytag: member="Broose::finishOverlay" ref="a612a233a588034ad82589aab7769e196" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::finishOverlay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collects statistical data in derived class </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a8db85b9c706d04007154761d5a0cec16">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00772">772</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// store statistics</span>
    simtime_t time = <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a610799ebfbf64696c59b811870cc8300">calcMeasuredLifetime</a>(<a class="code" href="classBaseOverlay.html#af0eebaddea732ee4ab4d247c388e62bd" title="simtime when the node has been created">creationTime</a>);
    <span class="keywordflow">if</span> (time &lt; <a class="code" href="classGlobalStatistics.html#a169810c78519b271f7e32fdc7c9fc641" title="minimum useful measured lifetime in seconds">GlobalStatistics::MIN_MEASURED</a>) <span class="keywordflow">return</span>;

    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Broose: Number of non-routable packets/s&quot;</span>, <a class="code" href="classBroose.html#afc5b65d8a797fc49d8568ed7d20e8db4" title="number of packets which couldn&#39;t be routed correctly">numFailedPackets</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Broose: Sent BUCKET Messages/s&quot;</span>, <a class="code" href="classBroose.html#a7f436170dc33d8639ce776ba2f778a65" title="number of Bucket messages">bucketCount</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Broose: Sent BUCKET Byte/s&quot;</span>, <a class="code" href="classBroose.html#abbe713ffb241ad11e401343889d1359b" title="length of all Bucket messages">bucketBytesSent</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Broose: Bucket retries at join&quot;</span>, <a class="code" href="classBroose.html#ad82a8d9dd1024868b19f5d7fa9ee7b6e" title="number of bucket retries for a successful join">bucketRetries</a>);

}
</pre></div>
</div>
</div>
<a class="anchor" id="a510ec0b3d3378fc4ebb2a276cdff829b"></a><!-- doxytag: member="Broose::getMaxNumRedundantNodes" ref="a510ec0b3d3378fc4ebb2a276cdff829b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Broose::getMaxNumRedundantNodes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query the maximum number of redundant next hop nodes that are returned by <a class="el" href="classBroose.html#a7af9754f05bb7e0e7a53a9334ada5784" title="Implements the find node call.">findNode()</a>. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>int number of redundant nodes returned by <a class="el" href="classBroose.html#a7af9754f05bb7e0e7a53a9334ada5784" title="Implements the find node call.">findNode()</a>. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#ab4dadd02486560de3a58773b3a90fb41">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00351">351</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classBroose.html#a9376acda2ea0dc2012b868eec0813d6a" title="maximal number of bucket entries">bucketSize</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ade0172a588daa00efd1a0db945579047"></a><!-- doxytag: member="Broose::getMaxNumSiblings" ref="ade0172a588daa00efd1a0db945579047" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Broose::getMaxNumSiblings </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay protocol. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>int number of siblings. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#acd3058ad15b470e024500dd4872e2f09">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00346">346</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classBroose.html#a9376acda2ea0dc2012b868eec0813d6a" title="maximal number of bucket entries">bucketSize</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2f8c758024a30b07ed271accebebd288"></a><!-- doxytag: member="Broose::getRoutingDistance" ref="a2f8c758024a30b07ed271accebebd288" args="(const OverlayKey &amp;key, const OverlayKey &amp;node, int dist)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Broose::getRoutingDistance </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dist</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>calculates the de-buijn distance between a key and a nodeId </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>the overlay key </td></tr>
    <tr><td class="paramname">node</td><td>the nodeId </td></tr>
    <tr><td class="paramname">dist</td><td>the estimated maximum distance based on the number of nodes in the system </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of routing steps to the destination (negative for left shifting lookups) </dd></dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00356">356</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (uint i = 0; i &lt; (uint)abs(dist); i++) {
        <span class="keywordflow">if</span> (node.<a class="code" href="classOverlayKey.html#a0a44da45d3d52ce2ad76dad4e06a2888" title="Calculates the number of equal bits (digits) from the left with another Key (shared prefix length)...">sharedPrefixLength</a>(key &lt;&lt; i) &gt;= (abs(dist) - i)) {
             <span class="keywordflow">return</span> i; <span class="comment">// right shifting</span>
         }
        <span class="keywordflow">if</span> (key.<a class="code" href="classOverlayKey.html#a0a44da45d3d52ce2ad76dad4e06a2888" title="Calculates the number of equal bits (digits) from the left with another Key (shared prefix length)...">sharedPrefixLength</a>(node &lt;&lt; i) &gt;= (abs(dist) - i)) {
            <span class="keywordflow">return</span> -i; <span class="comment">// left shifting</span>
        }
    }

    <span class="keywordflow">if</span> (((<a class="code" href="classBroose.html#a3e1bb89f2b86d107d0cbe08903f1591a" title="decides which kind of lookup (right/left shifting) is used">chooseLookup</a>++) % 2) == 0) {
        <span class="keywordflow">return</span> -dist;
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">return</span> dist;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a64365d561848d0f9be471ac2c6588d36"></a><!-- doxytag: member="Broose::handleBucketRequestRpc" ref="a64365d561848d0f9be471ac2c6588d36" args="(BucketCall *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::handleBucketRequestRpc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBucketCall.html">BucketCall</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handles a received Bucket request </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>the message to process </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00962">962</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classBucketCall.html#a83d606b3bf9fdc48c709b10242a5c9ae">getBucketType</a>() == <a class="code" href="BrooseMessage__m_8h.html#a0d72090ca3225dfb0af1767bf6390a40adb45120aafd37a973140edee24708065">LEFT</a>) {
        <span class="comment">// TODO: dependent on the churn scenarios this may give better</span>
        <span class="comment">//       or worse results</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBroose.html#a5aabb67b0639701f115b58dc57593eda">stab1</a> &amp;&amp; (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa5eb3bb010076f581e3a98cddf2531686">BSET</a>)) {
            <span class="comment">// can&#39;t handle LBucketRequest in BSET-State</span>
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
        }

        <span class="comment">// return L-Bucket</span>
        <span class="keywordtype">int</span> size = <a class="code" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">lBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a7ef01cbcf70e7e8621793c8e94fa5198" title="returns number of current entries">getSize</a>();
        <a class="code" href="classBucketResponse.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketResponse</a>* bResponse = <span class="keyword">new</span> <a class="code" href="classBucketResponse.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketResponse</a>(<span class="stringliteral">&quot;LBucketResponse&quot;</span>);
        bResponse-&gt;<a class="code" href="classBucketResponse.html#a9a885b9b8d73756a0a8a84f8f96ef692">setNodesArraySize</a>(size);

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {
            bResponse-&gt;<a class="code" href="classBucketResponse.html#a7526129142469cbf7a82b57b83bf1fc0">setNodes</a>(i, <a class="code" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">lBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a9031c9a358274b8192b454a27eb0845e" title="returns a specific broose handle">get</a>(i));
        }

        bResponse-&gt;setBitLength(<a class="code" href="BrooseMessage__m_8h.html#a5be8fc7cfdcfdb3f48cad80a6f25a3cc">BUCKETRESPONSE_L</a>(bResponse));

        <span class="comment">// only add, if the originator is already in the BSET state</span>
        <span class="comment">// in which the node already is able to do right shifting lookups</span>
        <span class="comment">// TODO: this leads to lower lookup success rates in some scenarios</span>
        <span class="comment">//       but helps to prevent deadlock situations with high churn rates</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBroose.html#a9598a069920f5a2943b31107100a2c06">stab2</a> || (msg-&gt;<a class="code" href="classBucketCall.html#af28e5a564ef2cc1d07e9031401457412">getProState</a>() == <a class="code" href="BrooseMessage__m_8h.html#a1e4df1e60bb9501df7c024063484d127a59443e9ea684a77445f11ef9ebccebbd">PBSET</a>)) {
            <a class="code" href="classBroose.html#a265144e492745b2832eb6758cbf6385d" title="Adds a node to the routing table.">routingAdd</a>(msg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(), <span class="keyword">true</span>);
        }

        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(msg, bResponse);
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classBucketCall.html#a83d606b3bf9fdc48c709b10242a5c9ae">getBucketType</a>() == <a class="code" href="BrooseMessage__m_8h.html#a0d72090ca3225dfb0af1767bf6390a40a0448a6480348702c480296969de6dca0">BROTHER</a>) {
        <span class="comment">// return B-Bucket</span>
        <span class="keywordtype">int</span> size = <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a7ef01cbcf70e7e8621793c8e94fa5198" title="returns number of current entries">getSize</a>();
        <a class="code" href="classBucketResponse.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketResponse</a>* bResponse = <span class="keyword">new</span> <a class="code" href="classBucketResponse.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketResponse</a>(<span class="stringliteral">&quot;BBucketResponse&quot;</span>);
        bResponse-&gt;<a class="code" href="classBucketResponse.html#a9a885b9b8d73756a0a8a84f8f96ef692">setNodesArraySize</a>(size);

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {
            bResponse-&gt;<a class="code" href="classBucketResponse.html#a7526129142469cbf7a82b57b83bf1fc0">setNodes</a>(i, <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a9031c9a358274b8192b454a27eb0845e" title="returns a specific broose handle">get</a>(i));
        }
        bResponse-&gt;setBitLength(<a class="code" href="BrooseMessage__m_8h.html#a5be8fc7cfdcfdb3f48cad80a6f25a3cc">BUCKETRESPONSE_L</a>(bResponse));

        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(msg, bResponse);
    } <span class="keywordflow">else</span>
        <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">error</a>(<span class="stringliteral">&quot;Broose::handleBucketRequestRpc() - Wrong Bucket Type!&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2479baebf247d26c2cb9171104932b8e"></a><!-- doxytag: member="Broose::handleBucketResponseRpc" ref="a2479baebf247d26c2cb9171104932b8e" args="(BucketResponse *msg, const RpcState &amp;rpcState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::handleBucketResponseRpc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBucketResponse.html">BucketResponse</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classRpcState.html">RpcState</a> &amp;&#160;</td>
          <td class="paramname"><em>rpcState</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handles a received Bucket response </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>the message to process </td></tr>
    <tr><td class="paramname">rpcState</td><td>the state object for the received RPC </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01009">1009</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>* call = check_and_cast&lt;<a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>*&gt;(rpcState.<a class="code" href="classRpcState.html#a09b77220e4a2e2a95c364a1b69653ac5">getCallMsg</a>());

    <span class="keywordflow">for</span> (uint i = 0; i &lt; msg-&gt;<a class="code" href="classBucketResponse.html#ad88cd01819cf77f82a6987fa369e09bb">getNodesArraySize</a>(); i++) {
        <a class="code" href="classBroose.html#a265144e492745b2832eb6758cbf6385d" title="Adds a node to the routing table.">routingAdd</a>(msg-&gt;<a class="code" href="classBucketResponse.html#a35736a02a4810f57725e861449e7bb5b">getNodes</a>(i), <span class="keyword">false</span>);
    }

    <span class="keywordflow">if</span> (call-&gt;<a class="code" href="classBucketCall.html#a83d606b3bf9fdc48c709b10242a5c9ae">getBucketType</a>() == <a class="code" href="BrooseMessage__m_8h.html#a0d72090ca3225dfb0af1767bf6390a40adb45120aafd37a973140edee24708065">LEFT</a>) {
        <span class="keywordflow">switch</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a>) {
        <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faa17c975f477d6dd1f472e031d5bd6bc0">RSET</a>:
            <span class="keywordflow">if</span> (call-&gt;<a class="code" href="classBucketCall.html#af28e5a564ef2cc1d07e9031401457412">getProState</a>() == <a class="code" href="BrooseMessage__m_8h.html#a1e4df1e60bb9501df7c024063484d127aa90bbfe38513a4fab312de105624e88e">PRSET</a>) {
                <a class="code" href="classBroose.html#a2478813cd5f204f9acf543af839d8cf9" title="number of received lookup responses for the B bucket">receivedBBucketLookup</a>++;

                <span class="keywordflow">if</span> (<a class="code" href="classBroose.html#a2478813cd5f204f9acf543af839d8cf9" title="number of received lookup responses for the B bucket">receivedBBucketLookup</a> == <a class="code" href="classBroose.html#a224b9c0c4224c8616baf9a7d1215d008" title="maximal number of lookup responses for the B bucket">numberBBucketLookup</a>)
                    <a class="code" href="classBroose.html#a14b5e34e7b68ef3dcd588ca67e477e51" title="changes the node&#39;s state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa5eb3bb010076f581e3a98cddf2531686">BSET</a>);
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa5eb3bb010076f581e3a98cddf2531686">BSET</a>:
            <span class="keywordflow">if</span> (call-&gt;<a class="code" href="classBucketCall.html#af28e5a564ef2cc1d07e9031401457412">getProState</a>() == <a class="code" href="BrooseMessage__m_8h.html#a1e4df1e60bb9501df7c024063484d127a59443e9ea684a77445f11ef9ebccebbd">PBSET</a>) {
                <a class="code" href="classBroose.html#afba56946f8381bc639b4be08802f82a7" title="number of received lookup responses for the L bucket">receivedLBucketLookup</a>++;

                <span class="keywordflow">if</span> (<a class="code" href="classBroose.html#afba56946f8381bc639b4be08802f82a7" title="number of received lookup responses for the L bucket">receivedLBucketLookup</a> == <a class="code" href="classBroose.html#a7dd130326a6147f64465f509c1373f3b" title="maximal number of lookup responses for the L bucket">numberLBucketLookup</a>)
                    <a class="code" href="classBroose.html#a14b5e34e7b68ef3dcd588ca67e477e51" title="changes the node&#39;s state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <span class="keywordflow">break</span>;
        }
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (call-&gt;<a class="code" href="classBucketCall.html#a83d606b3bf9fdc48c709b10242a5c9ae">getBucketType</a>() == <a class="code" href="BrooseMessage__m_8h.html#a0d72090ca3225dfb0af1767bf6390a40a0448a6480348702c480296969de6dca0">BROTHER</a>) {
        <span class="keywordflow">switch</span>(<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a>) {
        <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>:
            <span class="keywordflow">if</span> (call-&gt;<a class="code" href="classBucketCall.html#af28e5a564ef2cc1d07e9031401457412">getProState</a>() == <a class="code" href="BrooseMessage__m_8h.html#a1e4df1e60bb9501df7c024063484d127a544019da4a7a9284830c20e6c4f5a5a8">PINIT</a>) {
                <a class="code" href="classBroose.html#abec6e84f1003daab645f301b62b743dc" title="number of received join response messages">receivedJoinResponse</a>++;
                <span class="keywordflow">if</span> (<a class="code" href="classBroose.html#abec6e84f1003daab645f301b62b743dc" title="number of received join response messages">receivedJoinResponse</a> == <a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a>)
                    <a class="code" href="classBroose.html#a14b5e34e7b68ef3dcd588ca67e477e51" title="changes the node&#39;s state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faa17c975f477d6dd1f472e031d5bd6bc0">RSET</a>);
            }
        <span class="keywordflow">default</span>:
            <span class="keywordflow">break</span>;
        }
    } <span class="keywordflow">else</span>
        <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">error</a>(<span class="stringliteral">&quot;Broose::handleBucketRequestRpc() - unknown error.&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac2bee9148a5c6f7858f1ce900fd8205e"></a><!-- doxytag: member="Broose::handleBucketTimeout" ref="ac2bee9148a5c6f7858f1ce900fd8205e" args="(BucketCall *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::handleBucketTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBucketCall.html">BucketCall</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handles a received Bucket timeout </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>the message to process </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01055">1055</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>)
        <span class="keywordflow">return</span>;
    <span class="keywordflow">else</span> {
        <a class="code" href="classBroose.html#ad82a8d9dd1024868b19f5d7fa9ee7b6e" title="number of bucket retries for a successful join">bucketRetries</a>++;
        <a class="code" href="classBroose.html#a14b5e34e7b68ef3dcd588ca67e477e51" title="changes the node&#39;s state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1077711ecf1d2da2cd87ab71766d2ade"></a><!-- doxytag: member="Broose::handleBucketTimerExpired" ref="a1077711ecf1d2da2cd87ab71766d2ade" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::handleBucketTimerExpired </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handles a expired bucket refresh timer </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>the bucket refresh self-message </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00318">318</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classBrooseBucket.html" title="Broose bucket module.">BrooseBucket</a>* tmpBucket = <span class="keyword">new</span> <a class="code" href="classBroose.html#acfe9d5a8bc85e9622bfad7f3a9b33a6e">BrooseBucket</a>();
    tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#ac54c82db0009034bcbf028c86ae8045a" title="initializes a bucket">initializeBucket</a>(0, 0,
                                (2*<a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a>*<a class="code" href="classBroose.html#a5797b25e931a407a62e9ec12b5107136" title="maximal number of entries in the r buckets">rBucketSize</a> + 7*<a class="code" href="classBroose.html#a9376acda2ea0dc2012b868eec0813d6a" title="maximal number of bucket entries">bucketSize</a>),
                                <span class="keyword">this</span>);

    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.size(); i++) {
        <span class="keywordflow">for</span>(uint32_t j = 0; j &lt; <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;getSize(); j++) {
            <span class="keywordflow">if</span> ((simTime() - <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;getLastSeen(
                        <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;<span class="keyword">get</span>(j))) &gt; <a class="code" href="classBroose.html#aabecab5487074574f3d24575abcbbb6f" title="idle time after which a node is pinged">refreshTime</a>
                    || <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;getRTT(<a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;<span class="keyword">get</span>(j)) == -1) {

                tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#ab3f7ae9d8575f049bc3ce6f501177f0c" title="adds a broose node handle to the bucket">add</a>(<a class="code" href="classBrooseHandle.html">BrooseHandle</a>(<a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;<span class="keyword">get</span>(j)));
            }
        }
    }

    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#a7ef01cbcf70e7e8621793c8e94fa5198" title="returns number of current entries">getSize</a>(); i++) {
        <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(tmpBucket-&gt;<a class="code" href="classBrooseBucket.html#a9031c9a358274b8192b454a27eb0845e" title="returns a specific broose handle">get</a>(i));
    }

    <span class="keyword">delete</span> tmpBucket;

    scheduleAt(simTime() + (<a class="code" href="classBroose.html#aabecab5487074574f3d24575abcbbb6f" title="idle time after which a node is pinged">refreshTime</a> / 2.0), <a class="code" href="classBroose.html#ab7113ef5ed2cf38e0d1001f5653665fc" title="timer to reconstruct all buckets">bucket_timer</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac10bba057753a16f4bac89ee8063f5da"></a><!-- doxytag: member="Broose::handleFindNodeTimeout" ref="ac10bba057753a16f4bac89ee8063f5da" args="(FindNodeCall *findNode, const TransportAddress &amp;dest, const OverlayKey &amp;destKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::handleFindNodeTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classFindNodeCall.html">FindNodeCall</a> *&#160;</td>
          <td class="paramname"><em>findNode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>destKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an Find Node Call timeout has been reached. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">findNode</td><td>The original <a class="el" href="classFindNodeCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">FindNodeCall</a> </td></tr>
    <tr><td class="paramname">dest</td><td>the destination node </td></tr>
    <tr><td class="paramname">destKey</td><td>the destination <a class="el" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01083">1083</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classBroose.html#a813367dd5a82aad256a0cff55192e8eb">routingTimeout</a>(dynamic_cast&lt;const NodeHandle&amp;&gt;(dest));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2c835e754977b5781ca74d9da3470721"></a><!-- doxytag: member="Broose::handleJoinTimerExpired" ref="a2c835e754977b5781ca74d9da3470721" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::handleJoinTimerExpired </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handles a expired join timer </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>the timer self-message </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00268">268</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>)
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (!<a class="code" href="classBroose.html#a61cf782a04f16846285e5705d2c634fe" title="node handle holding the bootstrap node">bootstrapNode</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <span class="comment">// create new lookup message</span>
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>        <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>* bCall = <span class="keyword">new</span> <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>();
        bCall-&gt;<a class="code" href="classBucketCall.html#ab04b51e392e17924454bb4e5a1f9368a">setBucketType</a>(<a class="code" href="BrooseMessage__m_8h.html#a0d72090ca3225dfb0af1767bf6390a40a0448a6480348702c480296969de6dca0">BROTHER</a>);
        bCall-&gt;<a class="code" href="classBucketCall.html#ab2256565d62dea3e984dee2c51bfa7f1">setProState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa99c9df0220f7a63e3b548d19181dc2b1">FAILED</a>);
        bCall-&gt;setBitLength(<a class="code" href="BrooseMessage__m_8h.html#a828592e4207a671e7eb7011a5cce9bc1">BUCKETCALL_L</a>(call));
        <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, <a class="code" href="classBroose.html#a61cf782a04f16846285e5705d2c634fe" title="node handle holding the bootstrap node">bootstrapNode</a>, <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(),
                         bCall);

        <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>* lCall = <span class="keyword">new</span> <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>();
        lCall-&gt;setBucketType(<a class="code" href="BrooseMessage__m_8h.html#a0d72090ca3225dfb0af1767bf6390a40a0448a6480348702c480296969de6dca0">BROTHER</a>);
        lCall-&gt;setProState(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa99c9df0220f7a63e3b548d19181dc2b1">FAILED</a>);
        lCall-&gt;setBitLength(<a class="code" href="BrooseMessage__m_8h.html#a828592e4207a671e7eb7011a5cce9bc1">BUCKETCALL_L</a>(call));
        <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, <a class="code" href="classBroose.html#a61cf782a04f16846285e5705d2c634fe" title="node handle holding the bootstrap node">bootstrapNode</a>,
                         <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() &lt;&lt; <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>, lCall);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="comment">// do lookups for key &gt;&gt; shiftingBits for each prefix</span>
        <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> newKey = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() &gt;&gt; <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>;
        <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>* bCallArray[<a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a>];
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a>; i++) {
            <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> add(i);
            add = add &lt;&lt; (<a class="code" href="classBroose.html#a913ebd156f864f848f044466ea2279fd" title="length of the node and data IDs">keyLength</a> - <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>);
            add += newKey;

            bCallArray[i] = <span class="keyword">new</span> <a class="code" href="classBucketCall.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketCall</a>(<span class="stringliteral">&quot;BBucketCall&quot;</span>);
            bCallArray[i]-&gt;<a class="code" href="classBucketCall.html#ab04b51e392e17924454bb4e5a1f9368a">setBucketType</a>(<a class="code" href="BrooseMessage__m_8h.html#a0d72090ca3225dfb0af1767bf6390a40a0448a6480348702c480296969de6dca0">BROTHER</a>);
            bCallArray[i]-&gt;<a class="code" href="classBucketCall.html#a4995fef3fcda1932032d869b4b0882d6">setBucketIndex</a>(i);
            bCallArray[i]-&gt;<a class="code" href="classBucketCall.html#ab2256565d62dea3e984dee2c51bfa7f1">setProState</a>(<a class="code" href="BrooseMessage__m_8h.html#a1e4df1e60bb9501df7c024063484d127a544019da4a7a9284830c20e6c4f5a5a8">PINIT</a>);
            bCallArray[i]-&gt;setBitLength(<a class="code" href="BrooseMessage__m_8h.html#a828592e4207a671e7eb7011a5cce9bc1">BUCKETCALL_L</a>(bCallArray[i]));

            <span class="comment">// restart join protocol if one call times out</span>
            <span class="comment">// otherwise the node might be isolated</span>
            <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, <a class="code" href="classBroose.html#a61cf782a04f16846285e5705d2c634fe" title="node handle holding the bootstrap node">bootstrapNode</a>, add,
                             bCallArray[i]);
        }
        <span class="comment">//createLookup()-&gt;lookup(getThisNode().getKey() + 1, 0, 0, 0,</span>
        <span class="comment">//                       new BrooseLookupListener(this));</span>
    } <span class="keywordflow">else</span> {
        <span class="comment">// if the bootstrap node is unspecified we are the only node in the network</span>
        <span class="comment">// so we can skip the &quot;normal&quot; join protocol</span>
        <a class="code" href="classBroose.html#a14b5e34e7b68ef3dcd588ca67e477e51" title="changes the node&#39;s state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9ff73fadcd26b7b793020517d5d248c0"></a><!-- doxytag: member="Broose::handleRpcCall" ref="a9ff73fadcd26b7b793020517d5d248c0" args="(BaseCallMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Broose::handleRpcCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes Remote-Procedure-Call invocation messages. </p>
<p><br/>
</p>
<p>This method should be overloaded when the overlay provides RPC functionality.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if rpc has been handled </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseRpc.html#a20e77c3e0c203762a5b582ffebe3ba4b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00873">873</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa5eb3bb010076f581e3a98cddf2531686">BSET</a> || <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        <span class="comment">// delegate messages</span>
        <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>(Bucket, <a class="code" href="classBroose.html#a64365d561848d0f9be471ac2c6588d36" title="handles a received Bucket request">handleBucketRequestRpc</a>);
        <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(Ping) {
            <span class="comment">// add pinging node to all buckets and update lastSeen of node</span>
            <a class="code" href="classBroose.html#a265144e492745b2832eb6758cbf6385d" title="Adds a node to the routing table.">routingAdd</a>(msg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(), <span class="keyword">true</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
            <span class="keywordflow">break</span>;
        }
        <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(FindNode) {
            <span class="comment">// add pinging node to all buckets and update lastSeen of node</span>
            <a class="code" href="classBroose.html#a265144e492745b2832eb6758cbf6385d" title="Adds a node to the routing table.">routingAdd</a>(msg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(), <span class="keyword">true</span>);
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
            <span class="keywordflow">break</span>;
        }
        <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()
        return <a class="code" href="RpcMacros_8h.html#aa5e964b7c7129c0943237a786e455e9a">RPC_HANDLED</a>;
    } else {
        <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
        <span class="comment">// don&#39;t answer PING and FIND_NODE calls, if the node can&#39;t route yet</span>
        <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(Ping) {
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
            <span class="keywordflow">break</span>;
        }
        <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(FindNode) {
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
            <span class="keywordflow">break</span>;
        }
        <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()
        return RPC_HANDLED;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a374f84f156f25252dfe3fca84e29ccae"></a><!-- doxytag: member="Broose::handleRpcResponse" ref="a374f84f156f25252dfe3fca84e29ccae" args="(BaseResponseMessage *msg, const RpcState &amp;rpcState, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::handleRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classRpcState.html">RpcState</a> &amp;&#160;</td>
          <td class="paramname"><em>rpcState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC response has been received. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The response message. </td></tr>
    <tr><td class="paramname">rpcState</td><td>Reference to an <a class="el" href="classRpcState.html">RpcState</a> object containing e.g. the original call message, the destination (<a class="el" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> and/or <a class="el" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a>), a context pointer, ... </td></tr>
    <tr><td class="paramname">rtt</td><td>The round-trip time of this RPC </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#ac7be6c4f944569921519314295fe7cf4">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00911">911</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// add sender to all buckets and update lastSeen of node</span>
    <a class="code" href="classBroose.html#a265144e492745b2832eb6758cbf6385d" title="Adds a node to the routing table.">routingAdd</a>(msg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(), <span class="keyword">true</span>, rtt);

    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( Bucket ) {
        <a class="code" href="classBroose.html#a2479baebf247d26c2cb9171104932b8e" title="handles a received Bucket response">handleBucketResponseRpc</a>(_BucketResponse, rpcState);
        EV &lt;&lt; <span class="stringliteral">&quot;[Broose::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Bucket RPC Response received: id=&quot;</span> &lt;&lt; rpcState.<a class="code" href="classRpcState.html#aef057cfd57307ee5893014084208a28e">getId</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_BucketResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(FindNode)
    {
        <span class="comment">// add inactive nodes</span>
        <span class="keywordflow">for</span> (uint32_t i=0; i&lt;_FindNodeResponse-&gt;getClosestNodesArraySize(); i++)
            <a class="code" href="classBroose.html#a265144e492745b2832eb6758cbf6385d" title="Adds a node to the routing table.">routingAdd</a>(_FindNodeResponse-&gt;getClosestNodes(i), <span class="keyword">false</span>);
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( )
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1f57a7b9ea934f2577f0336ce3530998"></a><!-- doxytag: member="Broose::handleRpcTimeout" ref="a1f57a7b9ea934f2577f0336ce3530998" args="(const RpcState &amp;rpcState)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::handleRpcTimeout </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classRpcState.html">RpcState</a> &amp;&#160;</td>
          <td class="paramname"><em>rpcState</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC timeout has been reached. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">rpcState</td><td>Reference to an <a class="el" href="classRpcState.html">RpcState</a> object containing e.g. the original call message, the destination (<a class="el" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> and/or <a class="el" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a>), a context pointer, ... </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#abb0de3d1e8d737c3d44864345d5fa732">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00938">938</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(rpcState.<a class="code" href="classRpcState.html#a09b77220e4a2e2a95c364a1b69653ac5">getCallMsg</a>())
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(FindNode) {
        <a class="code" href="classBroose.html#ac10bba057753a16f4bac89ee8063f5da" title="This method is called if an Find Node Call timeout has been reached.">handleFindNodeTimeout</a>(_FindNodeCall, rpcState.<a class="code" href="classRpcState.html#af72427e81f440292cea7de1f3a545a56">getDest</a>(), rpcState.<a class="code" href="classRpcState.html#a81be85c40f01ff6bc3f05869f959235d">getDestKey</a>());
        EV &lt;&lt; <span class="stringliteral">&quot;[Broose::handleRpcTimeout() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Find Node RPC Call timed out: id=&quot;</span> &lt;&lt; rpcState.<a class="code" href="classRpcState.html#aef057cfd57307ee5893014084208a28e">getId</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_FindNodeCall
        &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(Bucket) {
        <a class="code" href="classBroose.html#ac2bee9148a5c6f7858f1ce900fd8205e" title="handles a received Bucket timeout">handleBucketTimeout</a>(_BucketCall);
        EV &lt;&lt; <span class="stringliteral">&quot;[Broose::handleRpcTimeout() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Bucket RPC Call timed out: id=&quot;</span> &lt;&lt; rpcState.<a class="code" href="classRpcState.html#aef057cfd57307ee5893014084208a28e">getId</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_BucketCall
        &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac0e5eb20a2e995afeccc2b35a8e97967"></a><!-- doxytag: member="Broose::handleTimerEvent" ref="ac0e5eb20a2e995afeccc2b35a8e97967" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ab893c156412e38caa62fe058b229899b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00258">258</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg == <a class="code" href="classBroose.html#a6456e3b9729a4a8136e7bdbf5a8a6bba">join_timer</a>)
        <a class="code" href="classBroose.html#a2c835e754977b5781ca74d9da3470721" title="handles a expired join timer">handleJoinTimerExpired</a>(msg);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classBroose.html#ab7113ef5ed2cf38e0d1001f5653665fc" title="timer to reconstruct all buckets">bucket_timer</a>)
        <a class="code" href="classBroose.html#a1077711ecf1d2da2cd87ab71766d2ade" title="handles a expired bucket refresh timer">handleBucketTimerExpired</a>(msg);
    <span class="keywordflow">else</span>
        <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">error</a>(<span class="stringliteral">&quot;Broose::handleTimerEvent - no other timer currently in use!&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a98565a4675febbe6e107e4c49dc58450"></a><!-- doxytag: member="Broose::initializeOverlay" ref="a98565a4675febbe6e107e4c49dc58450" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::initializeOverlay </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes derived-class-attributes. </p>
<p><br/>
</p>
<p>Initializes derived-class-attributes, called by <a class="el" href="classBaseOverlay.html#a9738ba6065b0f699f1921bbe82ab97be" title="initializes base-class-attributes">BaseOverlay::initialize()</a>. By default this method is called once. If more stages are needed one can overload <a class="el" href="classBaseOverlay.html#a3234dfcf81463984e88a42432734a615" title="Sets init stage.">numInitStages()</a> and add more stages.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a41f88dfbea856a2b38319ff52c758c96">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00066">66</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// because of IPAddressResolver, we need to wait until interfaces</span>
    <span class="comment">// are registered, address auto-assignment takes place etc.</span>
    <span class="keywordflow">if</span> (stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a58e83c497c7c8495e9c592ff3148b6b9" title="first stage for overlay modules (Tier 0 / KBR)">MIN_STAGE_OVERLAY</a>)
        <span class="keywordflow">return</span>;

    <span class="comment">// Broose provides KBR services</span>
    <a class="code" href="classBaseOverlay.html#a53389ea3326d2e8ad53f02b388487d0b" title="set this to true, if the overlay provides KBR services">kbr</a> = <span class="keyword">true</span>;

    <span class="comment">// fetch some parameters</span>
    <a class="code" href="classBroose.html#a9376acda2ea0dc2012b868eec0813d6a" title="maximal number of bucket entries">bucketSize</a> = par(<span class="stringliteral">&quot;bucketSize&quot;</span>); <span class="comment">// = k</span>
    <a class="code" href="classBroose.html#a5797b25e931a407a62e9ec12b5107136" title="maximal number of entries in the r buckets">rBucketSize</a> = par(<span class="stringliteral">&quot;rBucketSize&quot;</span>); <span class="comment">// = k&#39;</span>
    <a class="code" href="classBroose.html#ad55f92653a0890957d51d709334934db" title="time interval between two join tries">joinDelay</a> = par(<span class="stringliteral">&quot;joinDelay&quot;</span>);
    <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a> = par(<span class="stringliteral">&quot;brooseShiftingBits&quot;</span>);
    <a class="code" href="classBroose.html#a374530e57a3906d1094c755c45794ba3" title="how many hops are added to the estimated hop count">userDist</a> = par(<span class="stringliteral">&quot;userDist&quot;</span>);
    <a class="code" href="classBroose.html#aabecab5487074574f3d24575abcbbb6f" title="idle time after which a node is pinged">refreshTime</a> = par(<span class="stringliteral">&quot;refreshTime&quot;</span>);
    <a class="code" href="classBroose.html#a57652869a1fdae22b834a25a81cb1602" title="number of retries in case of timeout">numberRetries</a> = par(<span class="stringliteral">&quot;numberRetries&quot;</span>);
    <a class="code" href="classBroose.html#a5aabb67b0639701f115b58dc57593eda">stab1</a> = par(<span class="stringliteral">&quot;stab1&quot;</span>);
    <a class="code" href="classBroose.html#a9598a069920f5a2943b31107100a2c06">stab2</a> = par(<span class="stringliteral">&quot;stab2&quot;</span>);

    <span class="comment">//statistics</span>
    <a class="code" href="classBroose.html#a7f436170dc33d8639ce776ba2f778a65" title="number of Bucket messages">bucketCount</a> = 0;
    <a class="code" href="classBroose.html#abbe713ffb241ad11e401343889d1359b" title="length of all Bucket messages">bucketBytesSent</a> = 0;

    <span class="comment">//init local parameters</span>
    <a class="code" href="classBroose.html#a3e1bb89f2b86d107d0cbe08903f1591a" title="decides which kind of lookup (right/left shifting) is used">chooseLookup</a> = 0;
    <a class="code" href="classBroose.html#abec6e84f1003daab645f301b62b743dc" title="number of received join response messages">receivedJoinResponse</a> = 0;
    <a class="code" href="classBroose.html#a2478813cd5f204f9acf543af839d8cf9" title="number of received lookup responses for the B bucket">receivedBBucketLookup</a> = 0;
    <a class="code" href="classBroose.html#a224b9c0c4224c8616baf9a7d1215d008" title="maximal number of lookup responses for the B bucket">numberBBucketLookup</a> = 0;
    <a class="code" href="classBroose.html#afba56946f8381bc639b4be08802f82a7" title="number of received lookup responses for the L bucket">receivedLBucketLookup</a> = 0;
    <a class="code" href="classBroose.html#a7dd130326a6147f64465f509c1373f3b" title="maximal number of lookup responses for the L bucket">numberLBucketLookup</a> = 0;
    <a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a> = 1 &lt;&lt; <a class="code" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53" title="number of bits shifted in/out each step">shiftingBits</a>;
    <a class="code" href="classBroose.html#a913ebd156f864f848f044466ea2279fd" title="length of the node and data IDs">keyLength</a> = <a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>();
    <a class="code" href="classBroose.html#afc5b65d8a797fc49d8568ed7d20e8db4" title="number of packets which couldn&#39;t be routed correctly">numFailedPackets</a> = 0;
    <a class="code" href="classBroose.html#ad82a8d9dd1024868b19f5d7fa9ee7b6e" title="number of bucket retries for a successful join">bucketRetries</a> = 0;

    <span class="comment">// add some watches</span>
    WATCH(<a class="code" href="classBroose.html#abec6e84f1003daab645f301b62b743dc" title="number of received join response messages">receivedJoinResponse</a>);
    WATCH(<a class="code" href="classBroose.html#a2478813cd5f204f9acf543af839d8cf9" title="number of received lookup responses for the B bucket">receivedBBucketLookup</a>);
    WATCH(<a class="code" href="classBroose.html#a224b9c0c4224c8616baf9a7d1215d008" title="maximal number of lookup responses for the B bucket">numberBBucketLookup</a>);
    WATCH(<a class="code" href="classBroose.html#afba56946f8381bc639b4be08802f82a7" title="number of received lookup responses for the L bucket">receivedLBucketLookup</a>);
    WATCH(<a class="code" href="classBroose.html#a7dd130326a6147f64465f509c1373f3b" title="maximal number of lookup responses for the L bucket">numberLBucketLookup</a>);
    WATCH(<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a>);

    <span class="comment">// get module pointers for all buckets</span>
    <a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a> = <span class="keyword">new</span> <a class="code" href="classBrooseBucket.html" title="Broose bucket module.">BrooseBucket</a>*[<a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a>];

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e" title="2^{variable shiftingBits}">powShiftingBits</a>; i++) {
        <a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a>[i] = check_and_cast&lt;<a class="code" href="classBrooseBucket.html" title="Broose bucket module.">BrooseBucket</a>*&gt;
                     (getParentModule()-&gt;getSubmodule(<span class="stringliteral">&quot;rBucket&quot;</span>,i));
        <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.push_back(<a class="code" href="classBroose.html#a12388519b4d2f59982458400beff3058">rBucket</a>[i]);
    }

    <a class="code" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">lBucket</a> = check_and_cast&lt;<a class="code" href="classBrooseBucket.html" title="Broose bucket module.">BrooseBucket</a>*&gt;
              (getParentModule()-&gt;getSubmodule(<span class="stringliteral">&quot;lBucket&quot;</span>));
    <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.push_back(<a class="code" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">lBucket</a>);

    <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a> = check_and_cast&lt;<a class="code" href="classBrooseBucket.html" title="Broose bucket module.">BrooseBucket</a>*&gt;
              (getParentModule()-&gt;getSubmodule(<span class="stringliteral">&quot;bBucket&quot;</span>));
    <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.push_back(<a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>);

    <span class="comment">// create join and bucket timer</span>
    <a class="code" href="classBroose.html#a6456e3b9729a4a8136e7bdbf5a8a6bba">join_timer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;join_timer&quot;</span>);
    <a class="code" href="classBroose.html#ab7113ef5ed2cf38e0d1001f5653665fc" title="timer to reconstruct all buckets">bucket_timer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;bucket_timer&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a40ebbf7442175faf9f71527d297f2834"></a><!-- doxytag: member="Broose::isSiblingFor" ref="a40ebbf7442175faf9f71527d297f2834" args="(const NodeHandle &amp;node, const OverlayKey &amp;key, int numSiblings, bool *err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Broose::isSiblingFor </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numSiblings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query if a node is among the siblings for a given key. </p>
<p>Query if a node is among the siblings for a given key. This means, that the nodeId of this node is among the closest numSiblings nodes to the key and that by a local <a class="el" href="classBroose.html#a7af9754f05bb7e0e7a53a9334ada5784" title="Implements the find node call.">findNode()</a> call all other siblings to this key can be retrieved.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>the <a class="el" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> </td></tr>
    <tr><td class="paramname">key</td><td>destination key </td></tr>
    <tr><td class="paramname">numSiblings</td><td>The nodes knows all numSiblings nodes close to this key </td></tr>
    <tr><td class="paramname">err</td><td>return false if the range could not be determined </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>bool true, if the node is responsible for the key. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#ab5887b89ba9da5973068e834feb69ce7">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00823">823</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="comment">// TODO: node != thisNode doesn&#39;t work yet</span>
    <span class="keywordflow">if</span> (key.<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>())
        <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">error</a>(<span class="stringliteral">&quot;Broose::isSiblingFor(): key is unspecified!&quot;</span>);

    <span class="keywordflow">if</span> (node != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>)
        <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">error</a>(<span class="stringliteral">&quot;Broose::isSiblingsFor(): &quot;</span>
              <span class="stringliteral">&quot;node != thisNode is not implemented!&quot;</span>);

    <span class="keywordflow">if</span> (numSiblings &gt; <a class="code" href="classBroose.html#ade0172a588daa00efd1a0db945579047" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>()) {
        opp_error(<span class="stringliteral">&quot;Broose::isSiblingFor(): numSiblings too big!&quot;</span>);
    }
    <span class="comment">// set default number of siblings to consider</span>
    <span class="keywordflow">if</span> (numSiblings == -1) numSiblings = <a class="code" href="classBroose.html#ade0172a588daa00efd1a0db945579047" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>();

    <span class="keywordflow">if</span> (numSiblings == 0) {
        *err = <span class="keyword">false</span>;
        <span class="keywordflow">return</span> (node.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() == key);
    }

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        *err = <span class="keyword">true</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// TODO: handle numSibling parameter</span>
    <span class="keywordflow">return</span> <a class="code" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">bBucket</a>-&gt;<a class="code" href="classBrooseBucket.html#a55406f32d897b2a98d46714ae5503c75" title="checks if the key close to the owner&#39;s id">keyInRange</a>(key);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6e8d0813889738a8c12c47cce18586e5"></a><!-- doxytag: member="Broose::joinOverlay" ref="a6e8d0813889738a8c12c47cce18586e5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::joinOverlay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Join the overlay with a given nodeID in thisNode.key. </p>
<p>Join the overlay with a given nodeID in thisNode.key. This method may be called by an application to join the overlay with a specific nodeID. It is also called if the node's IP address changes. </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a3eefb56c2396601373c89d21b5b58110">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00133">133</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classBroose.html#a14b5e34e7b68ef3dcd588ca67e477e51" title="changes the node&#39;s state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>);

    <span class="comment">// if the bootstrap node is unspecified we are the only node in the network</span>
    <span class="comment">// so we can skip the &quot;normal&quot; join protocol</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBroose.html#a61cf782a04f16846285e5705d2c634fe" title="node handle holding the bootstrap node">bootstrapNode</a>.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <a class="code" href="classBroose.html#a14b5e34e7b68ef3dcd588ca67e477e51" title="changes the node&#39;s state">changeState</a>(<a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0e74d664db69ad2cefde9d3443a36cc6"></a><!-- doxytag: member="Broose::pingResponse" ref="a0e74d664db69ad2cefde9d3443a36cc6" args="(PingResponse *pingResponse, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::pingResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPingResponse.html">PingResponse</a> *&#160;</td>
          <td class="paramname"><em>pingResponse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#afdf8ba10dc92ed3d351c8a7472c2093e">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01065">1065</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                    {
    <span class="comment">// if node respond reset failedResponses and add lastSeen to node</span>
    <a class="code" href="classBroose.html#a265144e492745b2832eb6758cbf6385d" title="Adds a node to the routing table.">routingAdd</a>(pingResponse-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(), <span class="keyword">true</span>, rtt);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa089c2853d648b0009fcf501f8ec8c7f"></a><!-- doxytag: member="Broose::pingTimeout" ref="aa089c2853d648b0009fcf501f8ec8c7f" args="(PingCall *pingCall, const TransportAddress &amp;dest, cPolymorphic *context, int rpcId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::pingTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPingCall.html">PingCall</a> *&#160;</td>
          <td class="paramname"><em>pingCall</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#afd90e156e9aa1dff7e4e99f50b2c9b51">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01090">1090</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classBroose.html#a813367dd5a82aad256a0cff55192e8eb">routingTimeout</a>(dynamic_cast&lt;const NodeHandle&amp;&gt;(dest));
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa1c5b32d5a8043dedb9e541d7d6a106a"></a><!-- doxytag: member="Broose::recordOverlaySentStats" ref="aa1c5b32d5a8043dedb9e541d7d6a106a" args="(BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::recordOverlaySentStats </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Collect overlay specific sent messages statistics. </p>
<p>This method is called from <a class="el" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">BaseOverlay::sendMessageToUDP()</a> for every overlay message that is sent by a node. Use this to collect statistical data for overlay protocol specific message types.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The overlay message to be sent to the UDP layer </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a921ac1fec5765f4099276800a82953ab">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00785">785</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classBaseOverlayMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">BaseOverlayMessage</a>* innerMsg = msg;
    <span class="keywordflow">while</span> (innerMsg-&gt;<a class="code" href="classBaseOverlayMessage.html#a406e342c0841abe2d82b9bb5c1e2aabd">getType</a>() != <a class="code" href="CommonMessages__m_8h.html#a6af1a552a7a6bce33c291758c369b17eab0641a3f5bcb1e08ee72afe9583ff5e6">APPDATA</a> &amp;&amp;
           innerMsg-&gt;getEncapsulatedPacket() != NULL) {
        innerMsg =
            <span class="keyword">static_cast&lt;</span><a class="code" href="classBaseOverlayMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">BaseOverlayMessage</a>*<span class="keyword">&gt;</span>(innerMsg-&gt;getEncapsulatedPacket());
    }

    <span class="keywordflow">switch</span> (innerMsg-&gt;<a class="code" href="classBaseOverlayMessage.html#a406e342c0841abe2d82b9bb5c1e2aabd">getType</a>()) {
    <span class="keywordflow">case</span> <a class="code" href="CommonMessages__m_8h.html#a6af1a552a7a6bce33c291758c369b17ea7f7e32ed10aea1dd73b80e96c70e8abf">RPC</a>:
        <span class="keywordflow">if</span> ((dynamic_cast&lt;BucketCall*&gt;(innerMsg) != NULL) ||
                (<span class="keyword">dynamic_cast&lt;</span><a class="code" href="classBucketResponse.html" title="Class generated from overlay/broose/BrooseMessage.msg by opp_msgc.">BucketResponse</a>*<span class="keyword">&gt;</span>(innerMsg) != NULL)) {
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBroose.html#a7f436170dc33d8639ce776ba2f778a65" title="number of Bucket messages">bucketCount</a>++; <a class="code" href="classBroose.html#abbe713ffb241ad11e401343889d1359b" title="length of all Bucket messages">bucketBytesSent</a> +=
                             msg-&gt;getByteLength());
        }
        <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1832a98eeba497ade89b8081d4030ca8"></a><!-- doxytag: member="Broose::resetFailedResponses" ref="a1832a98eeba497ade89b8081d4030ca8" args="(const NodeHandle &amp;node)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::resetFailedResponses </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>resets the counter of failed responses </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>node handle of the responding node </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01124">1124</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.size(); i++) {
        <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;resetFailedResponses(node);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a265144e492745b2832eb6758cbf6385d"></a><!-- doxytag: member="Broose::routingAdd" ref="a265144e492745b2832eb6758cbf6385d" args="(const NodeHandle &amp;node, bool isAlive, simtime_t rtt=MAXTIME)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Broose::routingAdd </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isAlive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em> = <code>MAXTIME</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a node to the routing table. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td><a class="el" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> to add </td></tr>
    <tr><td class="paramname">isAlive</td><td>true, if it is known that the node is alive </td></tr>
    <tr><td class="paramname">rtt</td><td>measured round-trip-time to node </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if the node was known or has been added </dd></dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01097">1097</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> added = <span class="keyword">false</span>;

    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.size(); i++) {
        added |= <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;add(node, isAlive, rtt);
    }

    <span class="keywordflow">return</span> added;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a813367dd5a82aad256a0cff55192e8eb"></a><!-- doxytag: member="Broose::routingTimeout" ref="a813367dd5a82aad256a0cff55192e8eb" args="(const BrooseHandle &amp;handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::routingTimeout </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classBrooseHandle.html">BrooseHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01071">1071</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.size(); i++) {
        <span class="keywordflow">if</span> (<a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;getFailedResponses(handle) == <a class="code" href="classBroose.html#a57652869a1fdae22b834a25a81cb1602" title="number of retries in case of timeout">numberRetries</a>)
            <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;<span class="keyword">remove</span>(handle);
        <span class="keywordflow">else</span>
            <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;increaseFailedResponses(handle);
    }
    <span class="comment">// TODO: if we loose the last node (despite ourself) from the</span>
    <span class="comment">//       B bucket, we should call join() to rejoin the network</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="afd491170a7241cc14745d18aa2cd904b"></a><!-- doxytag: member="Broose::setLastSeen" ref="afd491170a7241cc14745d18aa2cd904b" args="(const NodeHandle &amp;node)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::setLastSeen </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>updates the timestamp of a node in all buckets </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>node handle which should be updated </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01109">1109</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.size(); i++) {
        <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;setLastSeen(node, simTime());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a639a843adbe84e396a016a29c165133e"></a><!-- doxytag: member="Broose::setRTT" ref="a639a843adbe84e396a016a29c165133e" args="(const NodeHandle &amp;node, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::setRTT </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>sets the rtt to a node in all buckets </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>node handle to which a rtt is added/updated </td></tr>
    <tr><td class="paramname">rtt</td><td>round trip time to the node </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l01131">1131</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>.size(); i++) {
        <a class="code" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a" title="vector of all Broose buckets">bucketVector</a>[i]-&gt;setRTT(node, rtt);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a96653c170474659145bbdeae4c8a6ca3"></a><!-- doxytag: member="Broose::updateTooltip" ref="a96653c170474659145bbdeae4c8a6ca3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Broose::updateTooltip </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>updates information shown in tk-environment </p>

<p>Definition at line <a class="el" href="Broose_8cc_source.html#l00856">856</a> of file <a class="el" href="Broose_8cc_source.html">Broose.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (ev.isGUI()) {
        std::stringstream ttString;

        <span class="comment">// show our ip and key in tooltip</span>
        ttString &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>();

        getParentModule()-&gt;getParentModule()-&gt;getDisplayString().
                                  setTagArg(<span class="stringliteral">&quot;tt&quot;</span>, 0, ttString.str().c_str());
        getParentModule()-&gt;getDisplayString().
                                  setTagArg(<span class="stringliteral">&quot;tt&quot;</span>, 0, ttString.str().c_str());
        getDisplayString().setTagArg(<span class="stringliteral">&quot;tt&quot;</span>, 0, ttString.str().c_str());

    }
}
</pre></div>
</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="acfe9d5a8bc85e9622bfad7f3a9b33a6e"></a><!-- doxytag: member="Broose::BrooseBucket" ref="acfe9d5a8bc85e9622bfad7f3a9b33a6e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classBrooseBucket.html">BrooseBucket</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00273">273</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ab073f1150e2148dae1f909bf470abdfc"></a><!-- doxytag: member="Broose::bBucket" ref="ab073f1150e2148dae1f909bf470abdfc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBrooseBucket.html">BrooseBucket</a> * <a class="el" href="classBroose.html#ab073f1150e2148dae1f909bf470abdfc">Broose::bBucket</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00114">114</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a61cf782a04f16846285e5705d2c634fe"></a><!-- doxytag: member="Broose::bootstrapNode" ref="a61cf782a04f16846285e5705d2c634fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTransportAddress.html">TransportAddress</a> <a class="el" href="classBroose.html#a61cf782a04f16846285e5705d2c634fe">Broose::bootstrapNode</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>node handle holding the bootstrap node </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00124">124</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab7113ef5ed2cf38e0d1001f5653665fc"></a><!-- doxytag: member="Broose::bucket_timer" ref="ab7113ef5ed2cf38e0d1001f5653665fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classBroose.html#ab7113ef5ed2cf38e0d1001f5653665fc">Broose::bucket_timer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>timer to reconstruct all buckets </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00121">121</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="abbe713ffb241ad11e401343889d1359b"></a><!-- doxytag: member="Broose::bucketBytesSent" ref="abbe713ffb241ad11e401343889d1359b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#abbe713ffb241ad11e401343889d1359b">Broose::bucketBytesSent</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>length of all Bucket messages </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00110">110</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7f436170dc33d8639ce776ba2f778a65"></a><!-- doxytag: member="Broose::bucketCount" ref="a7f436170dc33d8639ce776ba2f778a65" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#a7f436170dc33d8639ce776ba2f778a65">Broose::bucketCount</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of Bucket messages </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00109">109</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad82a8d9dd1024868b19f5d7fa9ee7b6e"></a><!-- doxytag: member="Broose::bucketRetries" ref="ad82a8d9dd1024868b19f5d7fa9ee7b6e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#ad82a8d9dd1024868b19f5d7fa9ee7b6e">Broose::bucketRetries</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of bucket retries for a successful join </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00104">104</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9376acda2ea0dc2012b868eec0813d6a"></a><!-- doxytag: member="Broose::bucketSize" ref="a9376acda2ea0dc2012b868eec0813d6a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classBroose.html#a9376acda2ea0dc2012b868eec0813d6a">Broose::bucketSize</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>maximal number of bucket entries </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00098">98</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="adcf7289c37c2df82620db0712d74e80a"></a><!-- doxytag: member="Broose::bucketVector" ref="adcf7289c37c2df82620db0712d74e80a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classBrooseBucket.html">BrooseBucket</a>*&gt; <a class="el" href="classBroose.html#adcf7289c37c2df82620db0712d74e80a">Broose::bucketVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>vector of all <a class="el" href="classBroose.html" title="Broose overlay module.">Broose</a> buckets </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00117">117</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3e1bb89f2b86d107d0cbe08903f1591a"></a><!-- doxytag: member="Broose::chooseLookup" ref="a3e1bb89f2b86d107d0cbe08903f1591a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#a3e1bb89f2b86d107d0cbe08903f1591a">Broose::chooseLookup</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>decides which kind of lookup (right/left shifting) is used </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00089">89</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6456e3b9729a4a8136e7bdbf5a8a6bba"></a><!-- doxytag: member="Broose::join_timer" ref="a6456e3b9729a4a8136e7bdbf5a8a6bba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classBroose.html#a6456e3b9729a4a8136e7bdbf5a8a6bba">Broose::join_timer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00120">120</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad55f92653a0890957d51d709334934db"></a><!-- doxytag: member="Broose::joinDelay" ref="ad55f92653a0890957d51d709334934db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classBroose.html#ad55f92653a0890957d51d709334934db">Broose::joinDelay</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>time interval between two join tries </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00090">90</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a913ebd156f864f848f044466ea2279fd"></a><!-- doxytag: member="Broose::keyLength" ref="a913ebd156f864f848f044466ea2279fd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#a913ebd156f864f848f044466ea2279fd">Broose::keyLength</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>length of the node and data IDs </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00100">100</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae53864d71461e617e88ec1780d9793ea"></a><!-- doxytag: member="Broose::lBucket" ref="ae53864d71461e617e88ec1780d9793ea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBrooseBucket.html">BrooseBucket</a>* <a class="el" href="classBroose.html#ae53864d71461e617e88ec1780d9793ea">Broose::lBucket</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00114">114</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a224b9c0c4224c8616baf9a7d1215d008"></a><!-- doxytag: member="Broose::numberBBucketLookup" ref="a224b9c0c4224c8616baf9a7d1215d008" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#a224b9c0c4224c8616baf9a7d1215d008">Broose::numberBBucketLookup</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>maximal number of lookup responses for the B bucket </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00093">93</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7dd130326a6147f64465f509c1373f3b"></a><!-- doxytag: member="Broose::numberLBucketLookup" ref="a7dd130326a6147f64465f509c1373f3b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#a7dd130326a6147f64465f509c1373f3b">Broose::numberLBucketLookup</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>maximal number of lookup responses for the L bucket </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00095">95</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a57652869a1fdae22b834a25a81cb1602"></a><!-- doxytag: member="Broose::numberRetries" ref="a57652869a1fdae22b834a25a81cb1602" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#a57652869a1fdae22b834a25a81cb1602">Broose::numberRetries</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of retries in case of timeout </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00103">103</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="afc5b65d8a797fc49d8568ed7d20e8db4"></a><!-- doxytag: member="Broose::numFailedPackets" ref="afc5b65d8a797fc49d8568ed7d20e8db4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#afc5b65d8a797fc49d8568ed7d20e8db4">Broose::numFailedPackets</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of packets which couldn't be routed correctly </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00111">111</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a64c8b15959539f76effe20c7a2fb605e"></a><!-- doxytag: member="Broose::powShiftingBits" ref="a64c8b15959539f76effe20c7a2fb605e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#a64c8b15959539f76effe20c7a2fb605e">Broose::powShiftingBits</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>2^{variable shiftingBits} </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00097">97</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a12388519b4d2f59982458400beff3058"></a><!-- doxytag: member="Broose::rBucket" ref="a12388519b4d2f59982458400beff3058" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBrooseBucket.html">BrooseBucket</a>** <a class="el" href="classBroose.html#a12388519b4d2f59982458400beff3058">Broose::rBucket</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00115">115</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5797b25e931a407a62e9ec12b5107136"></a><!-- doxytag: member="Broose::rBucketSize" ref="a5797b25e931a407a62e9ec12b5107136" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classBroose.html#a5797b25e931a407a62e9ec12b5107136">Broose::rBucketSize</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>maximal number of entries in the r buckets </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00099">99</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2478813cd5f204f9acf543af839d8cf9"></a><!-- doxytag: member="Broose::receivedBBucketLookup" ref="a2478813cd5f204f9acf543af839d8cf9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#a2478813cd5f204f9acf543af839d8cf9">Broose::receivedBBucketLookup</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of received lookup responses for the B bucket </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00092">92</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="abec6e84f1003daab645f301b62b743dc"></a><!-- doxytag: member="Broose::receivedJoinResponse" ref="abec6e84f1003daab645f301b62b743dc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#abec6e84f1003daab645f301b62b743dc">Broose::receivedJoinResponse</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of received join response messages </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00091">91</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="afba56946f8381bc639b4be08802f82a7"></a><!-- doxytag: member="Broose::receivedLBucketLookup" ref="afba56946f8381bc639b4be08802f82a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#afba56946f8381bc639b4be08802f82a7">Broose::receivedLBucketLookup</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of received lookup responses for the L bucket </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00094">94</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="aabecab5487074574f3d24575abcbbb6f"></a><!-- doxytag: member="Broose::refreshTime" ref="aabecab5487074574f3d24575abcbbb6f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classBroose.html#aabecab5487074574f3d24575abcbbb6f">Broose::refreshTime</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>idle time after which a node is pinged </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00101">101</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2ba4078c7fc64338d75798beec808c53"></a><!-- doxytag: member="Broose::shiftingBits" ref="a2ba4078c7fc64338d75798beec808c53" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classBroose.html#a2ba4078c7fc64338d75798beec808c53">Broose::shiftingBits</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of bits shifted in/out each step </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00096">96</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5aabb67b0639701f115b58dc57593eda"></a><!-- doxytag: member="Broose::stab1" ref="a5aabb67b0639701f115b58dc57593eda" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classBroose.html#a5aabb67b0639701f115b58dc57593eda">Broose::stab1</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00105">105</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9598a069920f5a2943b31107100a2c06"></a><!-- doxytag: member="Broose::stab2" ref="a9598a069920f5a2943b31107100a2c06" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classBroose.html#a9598a069920f5a2943b31107100a2c06">Broose::stab2</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00106">106</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<a class="anchor" id="a374530e57a3906d1094c755c45794ba3"></a><!-- doxytag: member="Broose::userDist" ref="a374530e57a3906d1094c755c45794ba3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classBroose.html#a374530e57a3906d1094c755c45794ba3">Broose::userDist</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>how many hops are added to the estimated hop count </p>

<p>Definition at line <a class="el" href="Broose_8h_source.html#l00102">102</a> of file <a class="el" href="Broose_8h_source.html">Broose.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Broose_8h_source.html">Broose.h</a></li>
<li><a class="el" href="Broose_8cc_source.html">Broose.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classBroose.html">Broose</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:42 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
