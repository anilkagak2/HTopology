<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: InetUnderlayConfigurator Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classInetUnderlayConfigurator.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<div class="title">InetUnderlayConfigurator Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="InetUnderlayConfigurator" --><!-- doxytag: inherits="UnderlayConfigurator" -->
<p>Configurator module for the InetUnderlay.  
 <a href="classInetUnderlayConfigurator.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for InetUnderlayConfigurator:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classInetUnderlayConfigurator.png" usemap="#InetUnderlayConfigurator_map" alt=""/>
  <map id="InetUnderlayConfigurator_map" name="InetUnderlayConfigurator_map">
<area href="classUnderlayConfigurator.html" title="Base class for configurators of different underlay models." alt="UnderlayConfigurator" shape="rect" coords="0,0,154,24"/>
</map>
 </div></div>

<p><a href="classInetUnderlayConfigurator-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classTransportAddress.html">TransportAddress</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#ae8568a771c843767277558c4350774ec">createNode</a> (<a class="el" href="classNodeType.html">NodeType</a> type, bool initialize=false)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates an overlay node.  <a href="#ae8568a771c843767277558c4350774ec"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#ad2416c55aa741e9fb8a5c534c8dbdf58">preKillNode</a> (<a class="el" href="classNodeType.html">NodeType</a> type, <a class="el" href="classTransportAddress.html">TransportAddress</a> *addr=NULL)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Notifies and schedules overlay nodes for removal.  <a href="#ad2416c55aa741e9fb8a5c534c8dbdf58"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a66db5fcccbd12df400b1707863cae9e1">migrateNode</a> (<a class="el" href="classNodeType.html">NodeType</a> type, <a class="el" href="classTransportAddress.html">TransportAddress</a> *addr=NULL)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Migrates overlay nodes from one access net to another.  <a href="#a66db5fcccbd12df400b1707863cae9e1"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#ab2766113859f05dc03723dbc2a9736a6">initializeUnderlay</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up backbone, assigns ip addresses, calculates routing tables, sets some parameters and adds the initial number of nodes to the network.  <a href="#ab2766113859f05dc03723dbc2a9736a6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a8a7d9b35842e31ffa7a590110d11205a">setUpIPv4</a> (cTopology &amp;topo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#ac37e6f6adee00d6dfbce628b3fc735f9">setUpIPv6</a> (cTopology &amp;topo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#ab228f2cb20ae7bd43befd637645b4f7e">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">process timer messages  <a href="#ab228f2cb20ae7bd43befd637645b4f7e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a49b4205bc24b00ef83d3eb634f6f8f63">finishUnderlay</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves statistics, prints simulation time.  <a href="#a49b4205bc24b00ef83d3eb634f6f8f63"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a4745a89b7610e8b79207d6ea5b667a92">setDisplayString</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the statistics display string.  <a href="#a4745a89b7610e8b79207d6ea5b667a92"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; cModule * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9">accessNode</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">stores accessRouter  <a href="#a8271d89920574711ddd9c8cd4a65fab9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::deque&lt; IPvXAddress &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a9dd551ac81ef13c2da0aed929c5c3256">killList</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">stores nodes scheduled to be killed  <a href="#a9dd551ac81ef13c2da0aed929c5c3256"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::set&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a703bd91d5cc400f60418ef23b40e0944">scheduledID</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">stores nodeIds to prevent migration of prekilled nodes  <a href="#a703bd91d5cc400f60418ef23b40e0944"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a3ce6afb58a3a639cd8fc7977233b02b6">numCreated</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of overall created overlay terminals  <a href="#a3ce6afb58a3a639cd8fc7977233b02b6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#aa7434e33dfa90cc8b0b14575a12a33fc">numKilled</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of overall killed overlay terminals  <a href="#aa7434e33dfa90cc8b0b14575a12a33fc"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#af94467080ac95c8b5197568da39cb1fe">accessRouterNum</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of access router  <a href="#af94467080ac95c8b5197568da39cb1fe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a9ba1baa1cd1979f23eda0585eadd39e5">overlayAccessRouterNum</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of overlayAccessRouter  <a href="#a9ba1baa1cd1979f23eda0585eadd39e5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classInetUnderlayConfigurator.html#a0bf427de189feb3897000684a12aee55">overlayTerminalNum</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">number of terminal in the overlay  <a href="#a0bf427de189feb3897000684a12aee55"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Configurator module for the InetUnderlay. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Markus Mauch </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>possibility to disable tier1-3 in overlay(access)routers </dd></dl>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8h_source.html#l00041">41</a> of file <a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ae8568a771c843767277558c4350774ec"></a><!-- doxytag: member="InetUnderlayConfigurator::createNode" ref="ae8568a771c843767277558c4350774ec" args="(NodeType type, bool initialize=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classTransportAddress.html">TransportAddress</a> * InetUnderlayConfigurator::createNode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNodeType.html">NodeType</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>initialize</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Creates an overlay node. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">type</td><td>the <a class="el" href="classNodeType.html" title="Enum specifying node properties.">NodeType</a> of the node to create </td></tr>
    <tr><td class="paramname">initialize</td><td>creation during init phase? </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classUnderlayConfigurator.html#a65d64297bacdcf855bc13e8410754c7e">UnderlayConfigurator</a>.</p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00087">87</a> of file <a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    Enter_Method_Silent();
    <span class="comment">// derive overlay node from ned</span>
    std::string nameStr = <span class="stringliteral">&quot;overlayTerminal&quot;</span>;
    <span class="keywordflow">if</span>( <a class="code" href="classUnderlayConfigurator.html#a45b9ecd5f8deb026db63afc69c60d5a5" title="pointer to the ChurnGenerators">churnGenerator</a>.size() &gt; 1 ){
        nameStr += <span class="stringliteral">&quot;-&quot;</span> + convertToString&lt;uint32_t&gt;(type.<a class="code" href="classNodeType.html#ad6f207541b281c15db64c6d87ee43143">typeID</a>);
    }
    cModuleType* moduleType = cModuleType::get(type.<a class="code" href="classNodeType.html#a60aa8ee80380320728c200d5ea9edcea">terminalType</a>.c_str());
    cModule* node = moduleType-&gt;create(nameStr.c_str(), getParentModule(),
                                       <a class="code" href="classInetUnderlayConfigurator.html#a3ce6afb58a3a639cd8fc7977233b02b6" title="number of overall created overlay terminals">numCreated</a> + 1, <a class="code" href="classInetUnderlayConfigurator.html#a3ce6afb58a3a639cd8fc7977233b02b6" title="number of overall created overlay terminals">numCreated</a>);

    <span class="keywordflow">if</span> (type.<a class="code" href="classNodeType.html#a4c4e8497d48ac644ed1dd3cb024a74f5">channelTypesTx</a>.size() &gt; 0) {
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;InetUnderlayConfigurator::createNode(): Setting &quot;</span>
                    <span class="stringliteral">&quot;channel types via the churn generator is not allowed &quot;</span>
                    <span class="stringliteral">&quot;with the InetUnderlay. Use **.accessNet.channelTypes instead!&quot;</span>);
    }

    node-&gt;setGateSize(<span class="stringliteral">&quot;pppg&quot;</span>, 1);

    std::string displayString;

    <span class="keywordflow">if</span> ((type.<a class="code" href="classNodeType.html#ad6f207541b281c15db64c6d87ee43143">typeID</a> &gt; 0) &amp;&amp; (type.<a class="code" href="classNodeType.html#ad6f207541b281c15db64c6d87ee43143">typeID</a> &lt;= <a class="code" href="classUnderlayConfigurator.html#a98cdd2bec4b42ccf467e8062cc5a0f7c">NUM_COLORS</a>)) {
        ((displayString += <span class="stringliteral">&quot;i=device/wifilaptop_l,&quot;</span>)
                        += <a class="code" href="classUnderlayConfigurator.html#ab5366368e36a4884d97ae5c3d2a82182">colorNames</a>[type.<a class="code" href="classNodeType.html#ad6f207541b281c15db64c6d87ee43143">typeID</a> - 1])
                        += <span class="stringliteral">&quot;,40;i2=block/circle_s&quot;</span>;
    } <span class="keywordflow">else</span> {
        displayString = <span class="stringliteral">&quot;i=device/wifilaptop_l;i2=block/circle_s&quot;</span>;
    }

    node-&gt;finalizeParameters();
    node-&gt;setDisplayString(displayString.c_str());

    node-&gt;buildInside();
    node-&gt;scheduleStart(simTime());

    <span class="comment">// create meta information</span>
    <a class="code" href="classInetInfo.html">InetInfo</a>* info = <span class="keyword">new</span> <a class="code" href="classInetInfo.html">InetInfo</a>(type.<a class="code" href="classNodeType.html#ad6f207541b281c15db64c6d87ee43143">typeID</a>, node-&gt;getId(), type.<a class="code" href="classNodeType.html#a9490adb73cbd8c8283eba9afc7c61dc7">context</a>);
    <a class="code" href="classAccessNet.html" title="Configuration module for access networks.">AccessNet</a>* accessNet= check_and_cast&lt;<a class="code" href="classAccessNet.html" title="Configuration module for access networks.">AccessNet</a>*&gt;
        (<a class="code" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9" title="stores accessRouter">accessNode</a>[intuniform(0, <a class="code" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9" title="stores accessRouter">accessNode</a>.size() - 1)]
                -&gt;getSubmodule(<span class="stringliteral">&quot;accessNet&quot;</span>));

    info-&gt;<a class="code" href="classInetInfo.html#a9585d1249c2b1afcfedbf79e7256dcb9" title="setter and getter">setAccessNetModule</a>(accessNet);
    info-&gt;<a class="code" href="classInetInfo.html#ad815c71baf87d6e6104aedade4f8aa73">setNodeID</a>(node-&gt;getId());

    <span class="comment">// add node to a randomly chosen access net and bootstrap oracle</span>
    <a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a82a6c218304d734e2169e1c8fc5817ee" title="Adds new peers to the peer set.">addPeer</a>(accessNet-&gt;addOverlayNode(node), info);

    <span class="comment">// if the node was not created during startup we have to</span>
    <span class="comment">// finish the initialization process manually</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classUnderlayConfigurator.html#a2c191c8f38c7ac86509061801664b69b" title="OMNeT init methods.">initialize</a>) {
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a51360a7e54ff555dc3d078d686500cb9" title="last stage for underlay configurators">MAX_STAGE_UNDERLAY</a> + 1; i &lt; <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a89279af766b25396b796fe5cfd77d717" title="total number of stages">NUM_STAGES_ALL</a>; i++) {
            node-&gt;callInitialize(i);
        }
    }

    <a class="code" href="classUnderlayConfigurator.html#aed1fe1d613fb061b714fc281cbb0b820" title="current number of overlay terminals">overlayTerminalCount</a>++;
    <a class="code" href="classInetUnderlayConfigurator.html#a3ce6afb58a3a639cd8fc7977233b02b6" title="number of overall created overlay terminals">numCreated</a>++;

    <a class="code" href="classUnderlayConfigurator.html#a45b9ecd5f8deb026db63afc69c60d5a5" title="pointer to the ChurnGenerators">churnGenerator</a>[type.<a class="code" href="classNodeType.html#ad6f207541b281c15db64c6d87ee43143">typeID</a>]-&gt;terminalCount++;

    <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> *address = <span class="keyword">new</span> <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>(
                                       IPAddressResolver().addressOf(node));

    <span class="comment">// update display</span>
    <a class="code" href="classInetUnderlayConfigurator.html#a4745a89b7610e8b79207d6ea5b667a92" title="Updates the statistics display string.">setDisplayString</a>();

    <span class="keywordflow">return</span> address;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a49b4205bc24b00ef83d3eb634f6f8f63"></a><!-- doxytag: member="InetUnderlayConfigurator::finishUnderlay" ref="a49b4205bc24b00ef83d3eb634f6f8f63" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InetUnderlayConfigurator::finishUnderlay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Saves statistics, prints simulation time. </p>

<p>Reimplemented from <a class="el" href="classUnderlayConfigurator.html#a774e30cdd3aced06e5a04eb3ec4e4b0b">UnderlayConfigurator</a>.</p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00324">324</a> of file <a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// statistics</span>
    recordScalar(<span class="stringliteral">&quot;Terminals added&quot;</span>, <a class="code" href="classInetUnderlayConfigurator.html#a3ce6afb58a3a639cd8fc7977233b02b6" title="number of overall created overlay terminals">numCreated</a>);
    recordScalar(<span class="stringliteral">&quot;Terminals removed&quot;</span>, <a class="code" href="classInetUnderlayConfigurator.html#aa7434e33dfa90cc8b0b14575a12a33fc" title="number of overall killed overlay terminals">numKilled</a>);

    <span class="keywordflow">if</span> (!<a class="code" href="classUnderlayConfigurator.html#a00c2e85286a38799c7a04edb52ae6e76" title="still in initialization phase?">isInInitPhase</a>()) {
        <span class="keyword">struct </span>timeval now, diff;
        gettimeofday(&amp;now, NULL);
        <a class="code" href="UnderlayConfigurator_8h.html#a8b18f762e42417ce5d86090331d3e4eb">timersub</a>(&amp;now, &amp;<a class="code" href="classUnderlayConfigurator.html#a2675d1d01baaac0fe01436d01deabd13" title="timestamp at end of init phase">initFinishedTime</a>, &amp;diff);
        printf(<span class="stringliteral">&quot;Simulation time: %li.%06li\n&quot;</span>, diff.tv_sec, diff.tv_usec);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab228f2cb20ae7bd43befd637645b4f7e"></a><!-- doxytag: member="InetUnderlayConfigurator::handleTimerEvent" ref="ab228f2cb20ae7bd43befd637645b4f7e" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InetUnderlayConfigurator::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>process timer messages </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>the received message </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classUnderlayConfigurator.html#a90985a5b37ced8385ae394f1648757c4">UnderlayConfigurator</a>.</p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00283">283</a> of file <a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    Enter_Method_Silent();

    <span class="comment">// get next scheduled node from the kill list</span>
    IPvXAddress addr = <a class="code" href="classInetUnderlayConfigurator.html#a9dd551ac81ef13c2da0aed929c5c3256" title="stores nodes scheduled to be killed">killList</a>.back();
    <a class="code" href="classInetUnderlayConfigurator.html#a9dd551ac81ef13c2da0aed929c5c3256" title="stores nodes scheduled to be killed">killList</a>.pop_back();

    <a class="code" href="classAccessNet.html" title="Configuration module for access networks.">AccessNet</a>* accessNetModule = NULL;
    <span class="keywordtype">int</span> nodeID = -1;

    <a class="code" href="classInetInfo.html">InetInfo</a>* info = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classInetInfo.html">InetInfo</a>*<span class="keyword">&gt;</span>(<a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a985bf687f11d68d4a6699e7fa2367e9a" title="Searches the peerSet for the specified node.">getPeerInfo</a>(addr));
    <span class="keywordflow">if</span>(info != NULL) {
        accessNetModule = info-&gt;<a class="code" href="classInetInfo.html#a4daa8d6aa4109c5add6ed2f5da7adf23">getAccessNetModule</a>();
        nodeID = info-&gt;<a class="code" href="classInetInfo.html#a85bd199781386272bf66bb3af9141a08">getNodeID</a>();
    } <span class="keywordflow">else</span> {
        opp_error(<span class="stringliteral">&quot;IPv4UnderlayConfigurator: Trying to kill node with nonexistant TransportAddress!&quot;</span>);
    }

    <a class="code" href="classInetUnderlayConfigurator.html#a703bd91d5cc400f60418ef23b40e0944" title="stores nodeIds to prevent migration of prekilled nodes">scheduledID</a>.erase(nodeID);
    <a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a94d01badb00975930c2ed108e065fdf7" title="Removes a peer from the peerSet.">killPeer</a>(addr);

    cModule* node = accessNetModule-&gt;<a class="code" href="classAccessNet.html#a24b138a835855095b3e4482e40c546bc" title="Removes a node from the access net.">removeOverlayNode</a>(nodeID);

    <span class="keywordflow">if</span>(node == NULL)
        opp_error(<span class="stringliteral">&quot;IPv4UnderlayConfigurator: Trying to remove node which is nonexistant in AccessNet!&quot;</span>);

    node-&gt;callFinish();
    node-&gt;deleteModule();

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab2766113859f05dc03723dbc2a9736a6"></a><!-- doxytag: member="InetUnderlayConfigurator::initializeUnderlay" ref="ab2766113859f05dc03723dbc2a9736a6" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InetUnderlayConfigurator::initializeUnderlay </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets up backbone, assigns ip addresses, calculates routing tables, sets some parameters and adds the initial number of nodes to the network. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the phase of the initialisation </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classUnderlayConfigurator.html#a00b370315b9dcd39b41e254837d9a7ad">UnderlayConfigurator</a>.</p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00043">43</a> of file <a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">//backbone configuration</span>
    <span class="keywordflow">if</span> (stage == <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532ac691a73094515eb9c580b1cac99f416c" title="first stage for underlay configurators">MIN_STAGE_UNDERLAY</a>) {
        <span class="comment">// Find all router modules.</span>
        cTopology topo(<span class="stringliteral">&quot;topo&quot;</span>);
        topo.extractByProperty(<span class="stringliteral">&quot;node&quot;</span>);

        <span class="keywordflow">if</span> (par(<span class="stringliteral">&quot;useIPv6Addresses&quot;</span>).boolValue()) {
            <a class="code" href="classInetUnderlayConfigurator.html#ac37e6f6adee00d6dfbce628b3fc735f9">setUpIPv6</a>(topo);
            <span class="comment">//opp_error(&quot;IPv6 is not supported in this release but is coming soon.&quot;);</span>
        } <span class="keywordflow">else</span> {
            <a class="code" href="classInetUnderlayConfigurator.html#a8a7d9b35842e31ffa7a590110d11205a">setUpIPv4</a>(topo);
        }
    }
    <span class="comment">//access net configuration</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(stage == <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a51360a7e54ff555dc3d078d686500cb9" title="last stage for underlay configurators">MAX_STAGE_UNDERLAY</a>) {
        <span class="comment">// fetch some parameters</span>
        <a class="code" href="classInetUnderlayConfigurator.html#af94467080ac95c8b5197568da39cb1fe" title="number of access router">accessRouterNum</a> = getParentModule()-&gt;par(<span class="stringliteral">&quot;accessRouterNum&quot;</span>);
        <a class="code" href="classInetUnderlayConfigurator.html#a9ba1baa1cd1979f23eda0585eadd39e5" title="number of overlayAccessRouter">overlayAccessRouterNum</a> = getParentModule()-&gt;par(<span class="stringliteral">&quot;overlayAccessRouterNum&quot;</span>);

        <span class="comment">// count the overlay clients</span>
        <a class="code" href="classUnderlayConfigurator.html#aed1fe1d613fb061b714fc281cbb0b820" title="current number of overlay terminals">overlayTerminalCount</a> = 0;

        <a class="code" href="classInetUnderlayConfigurator.html#a3ce6afb58a3a639cd8fc7977233b02b6" title="number of overall created overlay terminals">numCreated</a> = 0;
        <a class="code" href="classInetUnderlayConfigurator.html#aa7434e33dfa90cc8b0b14575a12a33fc" title="number of overall killed overlay terminals">numKilled</a> = 0;

        <span class="comment">// add access node modules to access node vector</span>
        cModule* node;
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classInetUnderlayConfigurator.html#af94467080ac95c8b5197568da39cb1fe" title="number of access router">accessRouterNum</a>; i++) {
            node = getParentModule()-&gt;getSubmodule(<span class="stringliteral">&quot;accessRouter&quot;</span>, i);
            <a class="code" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9" title="stores accessRouter">accessNode</a>.push_back( node );
        }

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classInetUnderlayConfigurator.html#a9ba1baa1cd1979f23eda0585eadd39e5" title="number of overlayAccessRouter">overlayAccessRouterNum</a>; i++) {
            node = getParentModule()-&gt;getSubmodule(<span class="stringliteral">&quot;overlayAccessRouter&quot;</span>, i);
            <a class="code" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9" title="stores accessRouter">accessNode</a>.push_back( node );
        }

        <span class="comment">// debug stuff</span>
        WATCH_PTRVECTOR(<a class="code" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9" title="stores accessRouter">accessNode</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a66db5fcccbd12df400b1707863cae9e1"></a><!-- doxytag: member="InetUnderlayConfigurator::migrateNode" ref="a66db5fcccbd12df400b1707863cae9e1" args="(NodeType type, TransportAddress *addr=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InetUnderlayConfigurator::migrateNode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNodeType.html">NodeType</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classTransportAddress.html">TransportAddress</a> *&#160;</td>
          <td class="paramname"><em>addr</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Migrates overlay nodes from one access net to another. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">type</td><td>the <a class="el" href="classNodeType.html" title="Enum specifying node properties.">NodeType</a> of the node to migrate </td></tr>
    <tr><td class="paramname">addr</td><td>NULL for random node </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classUnderlayConfigurator.html#a31e6fc55c914b3a6606f6c2bc532a1cc">UnderlayConfigurator</a>.</p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00225">225</a> of file <a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    Enter_Method_Silent();

    <a class="code" href="classAccessNet.html" title="Configuration module for access networks.">AccessNet</a>* accessNetModule = NULL;
    <span class="keywordtype">int</span> nodeID = -1;
    <a class="code" href="classInetInfo.html">InetInfo</a>* info;

    <span class="comment">// If no address given, get random node</span>
    <span class="keywordflow">if</span>(addr == NULL) {
        info = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classInetInfo.html">InetInfo</a>*<span class="keyword">&gt;</span>(<a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a0b09f249680c3ae737af916a8a54f75f" title="Selects a random node from the peerSet.">getRandomPeerInfo</a>(type.<a class="code" href="classNodeType.html#ad6f207541b281c15db64c6d87ee43143">typeID</a>));
    } <span class="keywordflow">else</span> {
        <span class="comment">// get node information</span>
        info = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classInetInfo.html">InetInfo</a>*<span class="keyword">&gt;</span>(<a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a985bf687f11d68d4a6699e7fa2367e9a" title="Searches the peerSet for the specified node.">getPeerInfo</a>(*addr));
    }

    <span class="keywordflow">if</span>(info != NULL) {
        accessNetModule = info-&gt;<a class="code" href="classInetInfo.html#a4daa8d6aa4109c5add6ed2f5da7adf23">getAccessNetModule</a>();
        nodeID = info-&gt;<a class="code" href="classInetInfo.html#a85bd199781386272bf66bb3af9141a08">getNodeID</a>();
    } <span class="keywordflow">else</span> {
        opp_error(<span class="stringliteral">&quot;IPv4UnderlayConfigurator: Trying to pre kill node with nonexistant TransportAddress!&quot;</span>);
    }

    <span class="comment">// do not migrate node that is already scheduled</span>
    <span class="keywordflow">if</span>(<a class="code" href="classInetUnderlayConfigurator.html#a703bd91d5cc400f60418ef23b40e0944" title="stores nodeIds to prevent migration of prekilled nodes">scheduledID</a>.count(nodeID))
        <span class="keywordflow">return</span>;

    cModule* node = accessNetModule-&gt;<a class="code" href="classAccessNet.html#a24b138a835855095b3e4482e40c546bc" title="Removes a node from the access net.">removeOverlayNode</a>(nodeID);<span class="comment">//intuniform(0, accessNetModule-&gt;size() - 1));</span>

    <span class="keywordflow">if</span>(node == NULL)
        opp_error(<span class="stringliteral">&quot;IPv4UnderlayConfigurator: Trying to remove node which is nonexistant in AccessNet!&quot;</span>);

    <span class="comment">//remove node from bootstrap oracle</span>
    <a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a94d01badb00975930c2ed108e065fdf7" title="Removes a peer from the peerSet.">killPeer</a>(IPAddressResolver().addressOf(node));

    node-&gt;bubble(<span class="stringliteral">&quot;I am migrating!&quot;</span>);

    <span class="comment">// connect the node to another access net</span>
    <a class="code" href="classAccessNet.html" title="Configuration module for access networks.">AccessNet</a>* newAccessNetModule;

    <span class="keywordflow">do</span> {
        newAccessNetModule = check_and_cast&lt;<a class="code" href="classAccessNet.html" title="Configuration module for access networks.">AccessNet</a>*&gt;(<a class="code" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9" title="stores accessRouter">accessNode</a>[intuniform(0, <a class="code" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9" title="stores accessRouter">accessNode</a>.size() - 1)]-&gt;getSubmodule(<span class="stringliteral">&quot;accessNet&quot;</span>));
    } <span class="keywordflow">while</span>((newAccessNetModule == accessNetModule) &amp;&amp; (<a class="code" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9" title="stores accessRouter">accessNode</a>.size() != 1));

    <span class="comment">// create meta information</span>
    <a class="code" href="classInetInfo.html">InetInfo</a>* newinfo = <span class="keyword">new</span> <a class="code" href="classInetInfo.html">InetInfo</a>(type.<a class="code" href="classNodeType.html#ad6f207541b281c15db64c6d87ee43143">typeID</a>, node-&gt;getId(), type.<a class="code" href="classNodeType.html#a9490adb73cbd8c8283eba9afc7c61dc7">context</a>);

    newinfo-&gt;<a class="code" href="classInetInfo.html#a9585d1249c2b1afcfedbf79e7256dcb9" title="setter and getter">setAccessNetModule</a>(newAccessNetModule);
    newinfo-&gt;<a class="code" href="classInetInfo.html#ad815c71baf87d6e6104aedade4f8aa73">setNodeID</a>(node-&gt;getId());

    <span class="comment">//add node to a randomly chosen access net bootstrap oracle</span>
    <a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a82a6c218304d734e2169e1c8fc5817ee" title="Adds new peers to the peer set.">addPeer</a>(newAccessNetModule-&gt;<a class="code" href="classAccessNet.html#a0fbbc43fd47f107e7f769e2602f0fdad" title="Gathers some information about the terminal and appends it to the overlay terminal vector...">addOverlayNode</a>(node, <span class="keyword">true</span>), newinfo);

    <span class="comment">// inform the notification board about the migration</span>
    NotificationBoard* nb = check_and_cast&lt;NotificationBoard*&gt;(node-&gt;getSubmodule(<span class="stringliteral">&quot;notificationBoard&quot;</span>));
    nb-&gt;fireChangeNotification(NF_OVERLAY_TRANSPORTADDRESS_CHANGED);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad2416c55aa741e9fb8a5c534c8dbdf58"></a><!-- doxytag: member="InetUnderlayConfigurator::preKillNode" ref="ad2416c55aa741e9fb8a5c534c8dbdf58" args="(NodeType type, TransportAddress *addr=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InetUnderlayConfigurator::preKillNode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNodeType.html">NodeType</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classTransportAddress.html">TransportAddress</a> *&#160;</td>
          <td class="paramname"><em>addr</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Notifies and schedules overlay nodes for removal. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">type</td><td><a class="el" href="classNodeType.html" title="Enum specifying node properties.">NodeType</a> of the node to remove </td></tr>
    <tr><td class="paramname">addr</td><td>NULL for random node </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classUnderlayConfigurator.html#a365808ae3d6f667e897f5bf3ee8666b8">UnderlayConfigurator</a>.</p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00158">158</a> of file <a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    Enter_Method_Silent();

    <a class="code" href="classAccessNet.html" title="Configuration module for access networks.">AccessNet</a>* accessNetModule = NULL;
    <span class="keywordtype">int</span> nodeID;
    <a class="code" href="classInetInfo.html">InetInfo</a>* info;

    <span class="comment">// If no address given, get random node</span>
    <span class="keywordflow">if</span> (addr == NULL) {
        addr = <a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#afb768cce8523f2c55eb9449b2d489678" title="Selects a random node from the peerSet, which is not already marked for deletion.">getRandomAliveNode</a>(type.<a class="code" href="classNodeType.html#ad6f207541b281c15db64c6d87ee43143">typeID</a>);

        <span class="keywordflow">if</span> (addr == NULL) {
            <span class="comment">// all nodes are already prekilled</span>
            std::cout &lt;&lt; <span class="stringliteral">&quot;all nodes are already prekilled&quot;</span> &lt;&lt; std::endl;
            <span class="keywordflow">return</span>;
        }
    }

    <span class="comment">// get node information</span>
    info = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classInetInfo.html">InetInfo</a>*<span class="keyword">&gt;</span>(<a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a985bf687f11d68d4a6699e7fa2367e9a" title="Searches the peerSet for the specified node.">getPeerInfo</a>(*addr));

    <span class="keywordflow">if</span> (info != NULL) {
        accessNetModule = info-&gt;<a class="code" href="classInetInfo.html#a4daa8d6aa4109c5add6ed2f5da7adf23">getAccessNetModule</a>();
        nodeID = info-&gt;<a class="code" href="classInetInfo.html#a85bd199781386272bf66bb3af9141a08">getNodeID</a>();
    } <span class="keywordflow">else</span> {
        opp_error(<span class="stringliteral">&quot;IPv4UnderlayConfigurator: Trying to pre kill node &quot;</span>
                  <span class="stringliteral">&quot;with nonexistant TransportAddress!&quot;</span>);
    }

    uint32_t effectiveType = info-&gt;<a class="code" href="classPeerInfo.html#a7b01dcdd9a7828c03feef39d5135ab1d" title="returns the type of the node">getTypeID</a>();

    <span class="comment">// do not kill node that is already scheduled</span>
    <span class="keywordflow">if</span>(<a class="code" href="classInetUnderlayConfigurator.html#a703bd91d5cc400f60418ef23b40e0944" title="stores nodeIds to prevent migration of prekilled nodes">scheduledID</a>.count(nodeID))
        <span class="keywordflow">return</span>;

    cModule* node = accessNetModule-&gt;<a class="code" href="classAccessNet.html#ae8fe2ceae197c110c0da3024082c3fcf" title="searches overlayTerminal[] for a given node">getOverlayNode</a>(nodeID);
    <a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#ad71420e64d6f5466ecfd95d8ab56ca55" title="Debootstraps peers in the peer set.">removePeer</a>(IPAddressResolver().addressOf(node));

    <span class="comment">//put node into the kill list and schedule a message for final removal of the node</span>
    <a class="code" href="classInetUnderlayConfigurator.html#a9dd551ac81ef13c2da0aed929c5c3256" title="stores nodes scheduled to be killed">killList</a>.push_front(IPAddressResolver().addressOf(node));
    <a class="code" href="classInetUnderlayConfigurator.html#a703bd91d5cc400f60418ef23b40e0944" title="stores nodeIds to prevent migration of prekilled nodes">scheduledID</a>.insert(nodeID);

    <a class="code" href="classUnderlayConfigurator.html#aed1fe1d613fb061b714fc281cbb0b820" title="current number of overlay terminals">overlayTerminalCount</a>--;
    <a class="code" href="classInetUnderlayConfigurator.html#aa7434e33dfa90cc8b0b14575a12a33fc" title="number of overall killed overlay terminals">numKilled</a>++;

    <a class="code" href="classUnderlayConfigurator.html#a45b9ecd5f8deb026db63afc69c60d5a5" title="pointer to the ChurnGenerators">churnGenerator</a>[effectiveType]-&gt;terminalCount--;

    <span class="comment">// update display</span>
    <a class="code" href="classInetUnderlayConfigurator.html#a4745a89b7610e8b79207d6ea5b667a92" title="Updates the statistics display string.">setDisplayString</a>();

    <span class="comment">// inform the notification board about the removal</span>
    NotificationBoard* nb = check_and_cast&lt;NotificationBoard*&gt;(
            node-&gt;getSubmodule(<span class="stringliteral">&quot;notificationBoard&quot;</span>));
    nb-&gt;fireChangeNotification(NF_OVERLAY_NODE_LEAVE);

    <span class="keywordtype">double</span> random = uniform(0, 1);

    <span class="keywordflow">if</span> (random &lt; <a class="code" href="classUnderlayConfigurator.html#afac0cabcbc3d20fd6c490ea27918372e" title="probability that node is notified befor removal">gracefulLeaveProbability</a>) {
        nb-&gt;fireChangeNotification(NF_OVERLAY_NODE_GRACEFUL_LEAVE);
    }

    cMessage* msg = <span class="keyword">new</span> cMessage();
    scheduleAt(simTime() + <a class="code" href="classUnderlayConfigurator.html#a940d214081be6860f8410511c2da7ad5" title="delay until scheduled node is removed from overlay">gracefulLeaveDelay</a>, msg);

}
</pre></div>
</div>
</div>
<a class="anchor" id="a4745a89b7610e8b79207d6ea5b667a92"></a><!-- doxytag: member="InetUnderlayConfigurator::setDisplayString" ref="a4745a89b7610e8b79207d6ea5b667a92" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InetUnderlayConfigurator::setDisplayString </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Updates the statistics display string. </p>

<p>Implements <a class="el" href="classUnderlayConfigurator.html#a38c591a7837a8d7a426111229955c9fd">UnderlayConfigurator</a>.</p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00316">316</a> of file <a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00087">createNode()</a>, and <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00158">preKillNode()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> buf[80];
    sprintf(buf, <span class="stringliteral">&quot;%i overlay terminals\n%i access router\n%i overlay access router&quot;</span>,
            <a class="code" href="classUnderlayConfigurator.html#aed1fe1d613fb061b714fc281cbb0b820" title="current number of overlay terminals">overlayTerminalCount</a>, <a class="code" href="classInetUnderlayConfigurator.html#af94467080ac95c8b5197568da39cb1fe" title="number of access router">accessRouterNum</a>, <a class="code" href="classInetUnderlayConfigurator.html#a9ba1baa1cd1979f23eda0585eadd39e5" title="number of overlayAccessRouter">overlayAccessRouterNum</a>);
    getDisplayString().setTagArg(<span class="stringliteral">&quot;t&quot;</span>, 0, buf);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8a7d9b35842e31ffa7a590110d11205a"></a><!-- doxytag: member="InetUnderlayConfigurator::setUpIPv4" ref="a8a7d9b35842e31ffa7a590110d11205a" args="(cTopology &amp;topo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InetUnderlayConfigurator::setUpIPv4 </td>
          <td>(</td>
          <td class="paramtype">cTopology &amp;&#160;</td>
          <td class="paramname"><em>topo</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00338">338</a> of file <a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00043">initializeUnderlay()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Assign IP addresses to all router modules.</span>
    std::vector&lt;uint32&gt; nodeAddresses;
    nodeAddresses.resize(topo.getNumNodes());

    <span class="comment">// IP addresses for backbone</span>
    <span class="comment">// Take start IP from config file</span>
    <span class="comment">// FIXME: Make Netmask for Routers configurable!</span>
    uint32 lowIPBoundary = IPAddress(par(<span class="stringliteral">&quot;startIPv4&quot;</span>).stringValue()).getInt();

    <span class="comment">// uint32 lowIPBoundary = uint32((1 &lt;&lt; 24) + 1);</span>
    <span class="keywordtype">int</span> numIPNodes = 0;

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; topo.getNumNodes(); i++) {
        ++numIPNodes;

        uint32 addr = lowIPBoundary + uint32(numIPNodes &lt;&lt; 16);
        nodeAddresses[i] = addr;

        <span class="comment">// update ip display string</span>
        <span class="keywordflow">if</span> (ev.isGUI()) {
            topo.getNode(i)-&gt;getModule()-&gt;getDisplayString().insertTag(<span class="stringliteral">&quot;t&quot;</span>, 0);
            topo.getNode(i)-&gt;getModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;t&quot;</span>, 0,
                                    const_cast&lt;char*&gt;(IPAddress(addr).str().c_str()));
            topo.getNode(i)-&gt;getModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;t&quot;</span>, 1, <span class="stringliteral">&quot;l&quot;</span>);
            topo.getNode(i)-&gt;getModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;t&quot;</span>, 2, <span class="stringliteral">&quot;red&quot;</span>);
        }

        <span class="comment">// find interface table and assign address to all (non-loopback) interfaces</span>
        IInterfaceTable* ift = IPAddressResolver().interfaceTableOf(topo.getNode(i)-&gt;getModule());

        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k = 0; k &lt; ift-&gt;getNumInterfaces(); k++ ) {
            InterfaceEntry* ie = ift-&gt;getInterface(k);
            <span class="keywordflow">if</span> (!ie-&gt;isLoopback()) {
                ie-&gt;ipv4Data()-&gt;setIPAddress(IPAddress(addr));
                <span class="comment">// full address must match for local delivery</span>
                ie-&gt;ipv4Data()-&gt;setNetmask(IPAddress::ALLONES_ADDRESS);
            }
        }
    }

    <span class="comment">// Fill in routing tables.</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; topo.getNumNodes(); i++) {
        cTopology::Node* destNode = topo.getNode(i);
        uint32 destAddr = nodeAddresses[i];

        <span class="comment">// calculate shortest paths from everywhere towards destNode</span>
        topo.calculateUnweightedSingleShortestPathsTo(destNode);

        <span class="comment">// add overlayAccessRouters and overlayBackboneRouters</span>
        <span class="comment">// to the GlobalNodeList</span>
        <span class="keywordflow">if</span> ((strcmp(destNode-&gt;getModule()-&gt;getName(), <span class="stringliteral">&quot;overlayBackboneRouter&quot;</span>) == 0) ||
                (strcmp(destNode-&gt;getModule()-&gt;getName(), <span class="stringliteral">&quot;overlayAccessRouter&quot;</span>) == 0)) {
            <span class="comment">//add node to bootstrap oracle</span>
            <a class="code" href="classPeerInfo.html" title="Base class for providing additional underlay specific information associated with a certain transport...">PeerInfo</a>* info = <span class="keyword">new</span> <a class="code" href="classPeerInfo.html" title="Base class for providing additional underlay specific information associated with a certain transport...">PeerInfo</a>(0, destNode-&gt;getModule()-&gt;getId(), NULL);
            <a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a82a6c218304d734e2169e1c8fc5817ee" title="Adds new peers to the peer set.">addPeer</a>(IPvXAddress(nodeAddresses[i]), info);
        }


        <span class="comment">// If destNode is the outRouter, add a default route</span>
        <span class="comment">// to outside network via the TunOutDevice and a route to the</span>
        <span class="comment">// Gateway</span>
        <span class="keywordflow">if</span> ( strcmp(destNode-&gt;getModule()-&gt;getName(), <span class="stringliteral">&quot;outRouter&quot;</span> ) == 0 ) {
            IPRoute* defRoute = <span class="keyword">new</span> IPRoute();
            defRoute-&gt;setHost(IPAddress::UNSPECIFIED_ADDRESS);
            defRoute-&gt;setNetmask(IPAddress::UNSPECIFIED_ADDRESS);
            defRoute-&gt;setGateway(IPAddress(par(<span class="stringliteral">&quot;gatewayIP&quot;</span>).stringValue()));
            defRoute-&gt;setInterface(IPAddressResolver().interfaceTableOf(destNode-&gt;getModule())-&gt;getInterfaceByName(<span class="stringliteral">&quot;tunDev&quot;</span>));
            defRoute-&gt;setType(IPRoute::REMOTE);
            defRoute-&gt;setSource(IPRoute::MANUAL);
            IPAddressResolver().routingTableOf(destNode-&gt;getModule())-&gt;addRoute(defRoute);

            IPRoute* gwRoute = <span class="keyword">new</span> IPRoute();
            gwRoute-&gt;setHost(IPAddress(par(<span class="stringliteral">&quot;gatewayIP&quot;</span>).stringValue()));
            gwRoute-&gt;setNetmask(IPAddress(255, 255, 255, 255));
            gwRoute-&gt;setInterface(IPAddressResolver().interfaceTableOf(destNode-&gt;getModule())-&gt;getInterfaceByName(<span class="stringliteral">&quot;tunDev&quot;</span>));
            gwRoute-&gt;setType(IPRoute::DIRECT);
            gwRoute-&gt;setSource(IPRoute::MANUAL);
            IPAddressResolver().routingTableOf(destNode-&gt;getModule())-&gt;addRoute(gwRoute);
        }

        <span class="comment">// add route (with host=destNode) to every routing table in the network</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; topo.getNumNodes(); j++) {
            <span class="comment">// continue if same node</span>
            <span class="keywordflow">if</span> (i == j)
                <span class="keywordflow">continue</span>;

            <span class="comment">// cancel simulation if node is not connected with destination</span>
            cTopology::Node* atNode = topo.getNode(j);

            <span class="keywordflow">if</span> (atNode-&gt;getNumPaths() == 0) {
                <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">error</a>((std::string(atNode-&gt;getModule()-&gt;getName()) + <span class="stringliteral">&quot;: Network is not entirely connected.&quot;</span>
                        <span class="stringliteral">&quot;Please increase your value for the &quot;</span>
                        <span class="stringliteral">&quot;connectivity parameter&quot;</span>).c_str());
            }

            <span class="comment">//</span>
            <span class="comment">// Add routes at the atNode.</span>
            <span class="comment">//</span>

            <span class="comment">// find atNode&#39;s interface and routing table</span>
            IInterfaceTable* ift = IPAddressResolver().interfaceTableOf(atNode-&gt;getModule());
            IRoutingTable* rt = IPAddressResolver().routingTableOf(atNode-&gt;getModule());

            <span class="comment">// find atNode&#39;s interface entry for the next hop node</span>
            <span class="keywordtype">int</span> outputGateId = atNode-&gt;getPath(0)-&gt;getLocalGate()-&gt;getId();
            InterfaceEntry *ie = ift-&gt;getInterfaceByNodeOutputGateId(outputGateId);

            <span class="comment">// find the next hop node on the path towards destNode</span>
            cModule* next_hop = atNode-&gt;getPath(0)-&gt;getRemoteNode()-&gt;getModule();
            IPAddress next_hop_ip = IPAddressResolver().addressOf(next_hop).get4();


            <span class="comment">// Requirement 1: Each router has exactly one routing entry</span>
            <span class="comment">// (netmask 255.255.0.0) to each other router</span>
            IPRoute* <a class="code" href="VastDefs_8h.html#a51f63d24f02be00251e895721eae51b0">re</a> = <span class="keyword">new</span> IPRoute();

            re-&gt;setHost(IPAddress(destAddr));
            re-&gt;setInterface(ie);
            re-&gt;setSource(IPRoute::MANUAL);
            re-&gt;setNetmask(IPAddress(255, 255, 0, 0));
            re-&gt;setGateway(IPAddress(next_hop_ip));
            re-&gt;setType(IPRoute::REMOTE);

            rt-&gt;addRoute(re);

            <span class="comment">// Requirement 2: Each router has a point-to-point routing</span>
            <span class="comment">// entry (netmask 255.255.255.255) for each immediate neighbour</span>
            <span class="keywordflow">if</span> (atNode-&gt;getDistanceToTarget() == 1) {
                IPRoute* re2 = <span class="keyword">new</span> IPRoute();

                re2-&gt;setHost(IPAddress(destAddr));
                re2-&gt;setInterface(ie);
                re2-&gt;setSource(IPRoute::MANUAL);
                re2-&gt;setNetmask(IPAddress(255, 255, 255, 255));
                re2-&gt;setType(IPRoute::DIRECT);

                rt-&gt;addRoute(re2);
            }

            <span class="comment">// If destNode is the outRouter, add a default route</span>
            <span class="comment">// to the next hop in the direction of the outRouter</span>
            <span class="keywordflow">if</span> (strcmp(destNode-&gt;getModule()-&gt;getName(), <span class="stringliteral">&quot;outRouter&quot;</span> ) == 0) {
                IPRoute* defRoute = <span class="keyword">new</span> IPRoute();
                defRoute-&gt;setHost(IPAddress::UNSPECIFIED_ADDRESS);
                defRoute-&gt;setNetmask(IPAddress::UNSPECIFIED_ADDRESS);
                defRoute-&gt;setGateway(IPAddress(next_hop_ip));
                defRoute-&gt;setInterface(ie);
                defRoute-&gt;setType(IPRoute::REMOTE);
                defRoute-&gt;setSource(IPRoute::MANUAL);

                rt-&gt;addRoute(defRoute);
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac37e6f6adee00d6dfbce628b3fc735f9"></a><!-- doxytag: member="InetUnderlayConfigurator::setUpIPv6" ref="ac37e6f6adee00d6dfbce628b3fc735f9" args="(cTopology &amp;topo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InetUnderlayConfigurator::setUpIPv6 </td>
          <td>(</td>
          <td class="paramtype">cTopology &amp;&#160;</td>
          <td class="paramname"><em>topo</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00496">496</a> of file <a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00043">initializeUnderlay()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Assign IP addresses to all router modules.</span>
    std::vector&lt;IPv6Words&gt; nodeAddresses;
    nodeAddresses.resize(topo.getNumNodes());

    <span class="comment">// IP addresses for backbone</span>
    <span class="comment">// Take start IP from config file</span>
    <span class="comment">// FIXME: Make Netmask for Routers configurable!</span>
    <a class="code" href="structIPv6Words.html" title="Structure to manipulate IPv6 addresses easily.">IPv6Words</a> lowIPBoundary(IPv6Address(par(<span class="stringliteral">&quot;startIPv6&quot;</span>).stringValue()));

    <span class="comment">// uint32 lowIPBoundary = uint32((1 &lt;&lt; 24) + 1);</span>
    <span class="keywordtype">int</span> numIPNodes = 0;

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; topo.getNumNodes(); i++) {
        ++numIPNodes;

        <a class="code" href="structIPv6Words.html" title="Structure to manipulate IPv6 addresses easily.">IPv6Words</a> addr = lowIPBoundary;
        addr.<a class="code" href="structIPv6Words.html#a02ec1eedad12fdb90a2632a32616aee1">d0</a> += numIPNodes;
        nodeAddresses[i] = addr;

        <span class="comment">// update ip display string</span>
        <span class="keywordflow">if</span> (ev.isGUI()) {
            topo.getNode(i)-&gt;getModule()-&gt;getDisplayString().insertTag(<span class="stringliteral">&quot;t&quot;</span>, 0);
            topo.getNode(i)-&gt;getModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;t&quot;</span>, 0,
                                    const_cast&lt;char*&gt;(IPv6Address(addr.<a class="code" href="structIPv6Words.html#a02ec1eedad12fdb90a2632a32616aee1">d0</a>, addr.<a class="code" href="structIPv6Words.html#aec4a2eb8a6be8e6a216e56e2d0a150eb">d1</a>, addr.<a class="code" href="structIPv6Words.html#a8048b4119ed9147a7f38efa7f8038cf3">d2</a>, addr.<a class="code" href="structIPv6Words.html#ad5a73f32f7caaa24ea432f81d38b04ab">d3</a>).str().c_str()));
            topo.getNode(i)-&gt;getModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;t&quot;</span>, 1, <span class="stringliteral">&quot;l&quot;</span>);
            topo.getNode(i)-&gt;getModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;t&quot;</span>, 2, <span class="stringliteral">&quot;red&quot;</span>);
        }

        <span class="comment">// find interface table and assign address to all (non-loopback) interfaces</span>
        IInterfaceTable* ift = IPAddressResolver().interfaceTableOf(topo.getNode(i)-&gt;getModule());

        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> k = 0; k &lt; ift-&gt;getNumInterfaces(); k++ ) {
            InterfaceEntry* ie = ift-&gt;getInterface(k);
            <span class="keywordflow">if</span> (!ie-&gt;isLoopback() &amp;&amp; ie-&gt;ipv6Data()) {
                <span class="comment">//ie-&gt;ipv6Data()-&gt;assignAddress(IPv6Address(addr.d0, addr.d1, addr.d2, addr.d3), false, 0, 0);</span>
                <span class="comment">// full address must match for local delivery</span>
                IPv6Address prefix(addr.<a class="code" href="structIPv6Words.html#a02ec1eedad12fdb90a2632a32616aee1">d0</a>, addr.<a class="code" href="structIPv6Words.html#aec4a2eb8a6be8e6a216e56e2d0a150eb">d1</a>, addr.<a class="code" href="structIPv6Words.html#a8048b4119ed9147a7f38efa7f8038cf3">d2</a>, addr.<a class="code" href="structIPv6Words.html#ad5a73f32f7caaa24ea432f81d38b04ab">d3</a>);
                IPv6InterfaceData::AdvPrefix p;
                p.prefix = prefix;
                p.prefixLength = 32;
                p.advAutonomousFlag = <span class="keyword">true</span>;
                p.advPreferredLifetime = 0;
                p.advValidLifetime = 0;
                p.advOnLinkFlag = <span class="keyword">true</span>;
                ie-&gt;ipv6Data()-&gt;addAdvPrefix(p);
                ie-&gt;setMACAddress(MACAddress::generateAutoAddress());

                ie-&gt;ipv6Data()-&gt;assignAddress(prefix,<span class="keyword">false</span>, 0, 0);

                <span class="keywordflow">if</span> (ie-&gt;ipv6Data()-&gt;getLinkLocalAddress().isUnspecified()) {
                    ie-&gt;ipv6Data()-&gt;assignAddress(IPv6Address::formLinkLocalAddress(ie-&gt;getInterfaceToken()),<span class="keyword">false</span>, 0, 0);
                }
            }
        }
    }

    <span class="comment">// Fill in routing tables.</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; topo.getNumNodes(); i++) {
        cTopology::Node* destNode = topo.getNode(i);

        <span class="comment">// calculate shortest paths from everywhere towards destNode</span>
        topo.calculateUnweightedSingleShortestPathsTo(destNode);

        <span class="comment">// add overlayAccessRouters and overlayBackboneRouters</span>
        <span class="comment">// to the GlobalNodeList</span>
        <span class="keywordflow">if</span> ((strcmp(destNode-&gt;getModule()-&gt;getName(), <span class="stringliteral">&quot;overlayBackboneRouter&quot;</span>) == 0) ||
                (strcmp(destNode-&gt;getModule()-&gt;getName(), <span class="stringliteral">&quot;overlayAccessRouter&quot;</span>) == 0)) {
            <span class="comment">//add node to bootstrap oracle</span>
            <a class="code" href="classPeerInfo.html" title="Base class for providing additional underlay specific information associated with a certain transport...">PeerInfo</a>* info = <span class="keyword">new</span> <a class="code" href="classPeerInfo.html" title="Base class for providing additional underlay specific information associated with a certain transport...">PeerInfo</a>(0, destNode-&gt;getModule()-&gt;getId(), NULL);
            <a class="code" href="classUnderlayConfigurator.html#a18732aa18ca952e0f7973216692d7777" title="pointer to GlobalNodeList">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a82a6c218304d734e2169e1c8fc5817ee" title="Adds new peers to the peer set.">addPeer</a>(IPvXAddress(IPv6Address(nodeAddresses[i].d0, nodeAddresses[i].d1, nodeAddresses[i].d2, nodeAddresses[i].d3)), info);
        }

        <span class="comment">// add route (with host=destNode) to every routing table in the network</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; topo.getNumNodes(); j++) {
            <span class="comment">// continue if same node</span>
            <span class="keywordflow">if</span> (i == j)
                <span class="keywordflow">continue</span>;

            <span class="comment">// cancel simulation if node is not connected with destination</span>
            cTopology::Node* atNode = topo.getNode(j);

            <span class="keywordflow">if</span> (atNode-&gt;getNumPaths() == 0) {
                <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">error</a>((std::string(atNode-&gt;getModule()-&gt;getName()) + <span class="stringliteral">&quot;: Network is not entirely connected.&quot;</span>
                        <span class="stringliteral">&quot;Please increase your value for the &quot;</span>
                        <span class="stringliteral">&quot;connectivity parameter&quot;</span>).c_str());
            }

            <span class="comment">//</span>
            <span class="comment">// Add routes at the atNode.</span>
            <span class="comment">//</span>

            <span class="comment">// find atNode&#39;s interface and routing table</span>
            IInterfaceTable* ift = IPAddressResolver().interfaceTableOf(atNode-&gt;getModule());
            RoutingTable6* rt = IPAddressResolver().routingTable6Of(atNode-&gt;getModule());

            <span class="comment">// find atNode&#39;s interface entry for the next hop node</span>
            <span class="keywordtype">int</span> outputGateId = atNode-&gt;getPath(0)-&gt;getLocalGate()-&gt;getId();
            InterfaceEntry *ie = ift-&gt;getInterfaceByNodeOutputGateId(outputGateId);

            <span class="comment">// find the next hop node on the path towards destNode</span>
            cModule* next_hop = atNode-&gt;getPath(0)-&gt;getRemoteNode()-&gt;getModule();
            <span class="keywordtype">int</span> destGateId = destNode-&gt;getLinkIn(0)-&gt;getLocalGateId();
            IInterfaceTable* destIft = IPAddressResolver().interfaceTableOf(destNode-&gt;getModule());
            <span class="keywordtype">int</span> remoteGateId = atNode-&gt;getPath(0)-&gt;getRemoteGateId();
            IInterfaceTable* remoteIft = IPAddressResolver().interfaceTableOf(next_hop);
            IPv6Address next_hop_ip = remoteIft-&gt;getInterfaceByNodeInputGateId(remoteGateId)-&gt;ipv6Data()-&gt;getLinkLocalAddress();
            IPv6InterfaceData::AdvPrefix destPrefix = destIft-&gt;getInterfaceByNodeInputGateId(destGateId)-&gt;ipv6Data()-&gt;getAdvPrefix(0);

            <span class="comment">// create routing entry for next hop</span>
            rt-&gt;addStaticRoute(destPrefix.prefix, destPrefix.prefixLength, ie-&gt;getInterfaceId(), next_hop_ip);

        }
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a8271d89920574711ddd9c8cd4a65fab9"></a><!-- doxytag: member="InetUnderlayConfigurator::accessNode" ref="a8271d89920574711ddd9c8cd4a65fab9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;cModule*&gt; <a class="el" href="classInetUnderlayConfigurator.html#a8271d89920574711ddd9c8cd4a65fab9">InetUnderlayConfigurator::accessNode</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>stores accessRouter </p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8h_source.html#l00104">104</a> of file <a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00087">createNode()</a>, <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00043">initializeUnderlay()</a>, and <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00225">migrateNode()</a>.</p>

</div>
</div>
<a class="anchor" id="af94467080ac95c8b5197568da39cb1fe"></a><!-- doxytag: member="InetUnderlayConfigurator::accessRouterNum" ref="af94467080ac95c8b5197568da39cb1fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classInetUnderlayConfigurator.html#af94467080ac95c8b5197568da39cb1fe">InetUnderlayConfigurator::accessRouterNum</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of access router </p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8h_source.html#l00070">70</a> of file <a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00043">initializeUnderlay()</a>, and <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00316">setDisplayString()</a>.</p>

</div>
</div>
<a class="anchor" id="a9dd551ac81ef13c2da0aed929c5c3256"></a><!-- doxytag: member="InetUnderlayConfigurator::killList" ref="a9dd551ac81ef13c2da0aed929c5c3256" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::deque&lt;IPvXAddress&gt; <a class="el" href="classInetUnderlayConfigurator.html#a9dd551ac81ef13c2da0aed929c5c3256">InetUnderlayConfigurator::killList</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>stores nodes scheduled to be killed </p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8h_source.html#l00105">105</a> of file <a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00283">handleTimerEvent()</a>, and <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00158">preKillNode()</a>.</p>

</div>
</div>
<a class="anchor" id="a3ce6afb58a3a639cd8fc7977233b02b6"></a><!-- doxytag: member="InetUnderlayConfigurator::numCreated" ref="a3ce6afb58a3a639cd8fc7977233b02b6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classInetUnderlayConfigurator.html#a3ce6afb58a3a639cd8fc7977233b02b6">InetUnderlayConfigurator::numCreated</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of overall created overlay terminals </p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8h_source.html#l00109">109</a> of file <a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00087">createNode()</a>, <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00324">finishUnderlay()</a>, and <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00043">initializeUnderlay()</a>.</p>

</div>
</div>
<a class="anchor" id="aa7434e33dfa90cc8b0b14575a12a33fc"></a><!-- doxytag: member="InetUnderlayConfigurator::numKilled" ref="aa7434e33dfa90cc8b0b14575a12a33fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classInetUnderlayConfigurator.html#aa7434e33dfa90cc8b0b14575a12a33fc">InetUnderlayConfigurator::numKilled</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of overall killed overlay terminals </p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8h_source.html#l00110">110</a> of file <a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00324">finishUnderlay()</a>, <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00043">initializeUnderlay()</a>, and <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00158">preKillNode()</a>.</p>

</div>
</div>
<a class="anchor" id="a9ba1baa1cd1979f23eda0585eadd39e5"></a><!-- doxytag: member="InetUnderlayConfigurator::overlayAccessRouterNum" ref="a9ba1baa1cd1979f23eda0585eadd39e5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classInetUnderlayConfigurator.html#a9ba1baa1cd1979f23eda0585eadd39e5">InetUnderlayConfigurator::overlayAccessRouterNum</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of overlayAccessRouter </p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8h_source.html#l00071">71</a> of file <a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00043">initializeUnderlay()</a>, and <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00316">setDisplayString()</a>.</p>

</div>
</div>
<a class="anchor" id="a0bf427de189feb3897000684a12aee55"></a><!-- doxytag: member="InetUnderlayConfigurator::overlayTerminalNum" ref="a0bf427de189feb3897000684a12aee55" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classInetUnderlayConfigurator.html#a0bf427de189feb3897000684a12aee55">InetUnderlayConfigurator::overlayTerminalNum</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of terminal in the overlay </p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8h_source.html#l00072">72</a> of file <a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>.</p>

</div>
</div>
<a class="anchor" id="a703bd91d5cc400f60418ef23b40e0944"></a><!-- doxytag: member="InetUnderlayConfigurator::scheduledID" ref="a703bd91d5cc400f60418ef23b40e0944" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;int&gt; <a class="el" href="classInetUnderlayConfigurator.html#a703bd91d5cc400f60418ef23b40e0944">InetUnderlayConfigurator::scheduledID</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>stores nodeIds to prevent migration of prekilled nodes </p>

<p>Definition at line <a class="el" href="InetUnderlayConfigurator_8h_source.html#l00106">106</a> of file <a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a>.</p>

<p>Referenced by <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00283">handleTimerEvent()</a>, <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00225">migrateNode()</a>, and <a class="el" href="InetUnderlayConfigurator_8cc_source.html#l00158">preKillNode()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="InetUnderlayConfigurator_8h_source.html">InetUnderlayConfigurator.h</a></li>
<li><a class="el" href="InetUnderlayConfigurator_8cc_source.html">InetUnderlayConfigurator.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classInetUnderlayConfigurator.html">InetUnderlayConfigurator</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:51 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
