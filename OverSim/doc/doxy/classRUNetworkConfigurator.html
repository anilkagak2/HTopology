<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: RUNetworkConfigurator Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classRUNetworkConfigurator.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">RUNetworkConfigurator Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="RUNetworkConfigurator" -->
<p>Configures the nodes belonging to the topology before starting the actual simulation.  
 <a href="classRUNetworkConfigurator.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>&gt;</code></p>

<p><a href="classRUNetworkConfigurator-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#aba016f23487f65741e64750e9c108077">RUNetworkConfigurator</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#ac3c755585e66b66c8e14129f506c0102">~RUNetworkConfigurator</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a67a67982af1653c7995725fed3fd24c9">numInitStages</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a765afe519b25635a49814d66926a1572">initialize</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Main method of the network configurator.  <a href="#a765afe519b25635a49814d66926a1572"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a780159652abe9fdefb4e99552b86435f">handleMessage</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a0e877c710d69eb6195ee8e2530ec3e1f">createInterASPaths</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Add Inter-AS routing paths between core nodes.  <a href="#a0e877c710d69eb6195ee8e2530ec3e1f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#ab1339f94809321bdb7e215621676f2ea">disableStubLinks</a> (<a class="el" href="structnodeInfoRL.html">nodeInfoRL</a> &amp;dst, <a class="el" href="structnodeInfoRL.html">nodeInfoRL</a> &amp;src)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable all incoming links of Stub AS except to and from dst and src.  <a href="#ab1339f94809321bdb7e215621676f2ea"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a738c8ddbc264996f3de6cb36cc630506">enableStubLinks</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable all incoming links of Stub AS.  <a href="#a738c8ddbc264996f3de6cb36cc630506"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#aa019b1491f74b65a07629969a47ac829">extractTopology</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Extract topology from NED file.  <a href="#aa019b1491f74b65a07629969a47ac829"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a0e5be501ddf4ca493eeb9a3094256632">assignAddressAndSetDefaultRoutes</a> (<a class="el" href="structnodeInfoAS.html">nodeInfoAS</a> &amp;asInfo)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Assign IP address and add default route.  <a href="#a0e5be501ddf4ca493eeb9a3094256632"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a576044fccb31eda5ce308cd6cf3ff52e">setIntraASRoutes</a> (cTopology &amp;topology, <a class="el" href="structnodeInfoAS.html">nodeInfoAS</a> &amp;asInfo)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Add explicit Intra-AS routing paths (except of default routes)  <a href="#a576044fccb31eda5ce308cd6cf3ff52e"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; cTopology * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a6166955bf85b1861f9de62c97fa34d77">rlTopology</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cTopology&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a7bd0bbb4b6fbaa8013fa4b03803d55e1">asTopology</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">nextPow</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="RUNetworkConfigurator_8h.html#a7a920f5509c0db8ac1e38ab066094562">NODE_INFO_AS_VEC</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRUNetworkConfigurator.html#a9bc70b00c73c0475ee7cb4344b12d1c5">NET_MASK</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Configures the nodes belonging to the topology before starting the actual simulation. </p>
<p>This class is responsible for assignment of IP addresses to all nodes of the topology. Furthermore, routing tables have to be filled and default routing paths must be created. Routing is separated into Intra-AS and Inter-AS routing. </p>

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00252">252</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aba016f23487f65741e64750e9c108077"></a><!-- doxytag: member="RUNetworkConfigurator::RUNetworkConfigurator" ref="aba016f23487f65741e64750e9c108077" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RUNetworkConfigurator::RUNetworkConfigurator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8cc_source.html#l00034">34</a> of file <a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac3c755585e66b66c8e14129f506c0102"></a><!-- doxytag: member="RUNetworkConfigurator::~RUNetworkConfigurator" ref="ac3c755585e66b66c8e14129f506c0102" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RUNetworkConfigurator::~RUNetworkConfigurator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8cc_source.html#l00038">38</a> of file <a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a0e5be501ddf4ca493eeb9a3094256632"></a><!-- doxytag: member="RUNetworkConfigurator::assignAddressAndSetDefaultRoutes" ref="a0e5be501ddf4ca493eeb9a3094256632" args="(nodeInfoAS &amp;asInfo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RUNetworkConfigurator::assignAddressAndSetDefaultRoutes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnodeInfoAS.html">nodeInfoAS</a> &amp;&#160;</td>
          <td class="paramname"><em>asInfo</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Assign IP address and add default route. </p>
<p>Assigns an IP address of the calculated prefix to each of the router-level nodes.</p>
<p>Additionally, default routes are added for gateway, edge, and host nodes. Core nodes are stored into an additional list for later processing.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">asInfo</td><td>AS for which IP addresses should be assigned to router-level nodes. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8cc_source.html#l00244">244</a> of file <a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> currentIP = asInfo.<a class="code" href="structnodeInfoAS.html#a9bb59c60111cfda43b5fe63d1945a099">addr</a>.getInt() + 1;
    <span class="keywordtype">int</span> countEdgeRouter = 2; <span class="comment">// avoids IP address 127.0.0.1</span>
    <span class="keywordtype">int</span> countRouter = 1;
    <span class="keywordtype">int</span> edgeShift = 0;

    NODE_MAP::iterator mapIt = asInfo.<a class="code" href="structnodeInfoAS.html#aa50927e73d778fc3b8e201dc87bd1e2e">nodeMap</a>.begin();
    <span class="keywordflow">while</span> (mapIt != asInfo.<a class="code" href="structnodeInfoAS.html#aa50927e73d778fc3b8e201dc87bd1e2e">nodeMap</a>.end()) {
        <span class="keywordflow">if</span> (mapIt-&gt;second.routerType == <a class="code" href="RUNetworkConfigurator_8h.html#ab37daea78a5c66c3eb8fa27cd34a8d53">EDGE</a>) {
            countEdgeRouter++;
        }
        mapIt++;
    }

    <a class="code" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">nextPow</a> = 0;
    <span class="keywordflow">while</span> ((1 &lt;&lt; <a class="code" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">nextPow</a>) &lt; countEdgeRouter) {
        <a class="code" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">nextPow</a>++;
    }

    edgeShift = <a class="code" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a> - <a class="code" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">nextPow</a>;
    asInfo.<a class="code" href="structnodeInfoAS.html#a04a0f2d7dabb7a6eca0754935851c979">subnetmask</a> = IPAddress(0xffffffff &lt;&lt; edgeShift);
    countEdgeRouter = 1;

    mapIt = asInfo.<a class="code" href="structnodeInfoAS.html#aa50927e73d778fc3b8e201dc87bd1e2e">nodeMap</a>.begin();
    <span class="keywordflow">while</span> (mapIt != asInfo.<a class="code" href="structnodeInfoAS.html#aa50927e73d778fc3b8e201dc87bd1e2e">nodeMap</a>.end()) {
        <span class="keywordflow">if</span> (mapIt-&gt;second.routerType == <a class="code" href="RUNetworkConfigurator_8h.html#ade65dea0a340142cca19acc35bac5f81">ENDSYS</a>) {
            mapIt++;
            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">if</span> (mapIt-&gt;second.routerType == <a class="code" href="RUNetworkConfigurator_8h.html#ab37daea78a5c66c3eb8fa27cd34a8d53">EDGE</a>) {
            currentIP = asInfo.<a class="code" href="structnodeInfoAS.html#a9bb59c60111cfda43b5fe63d1945a099">addr</a>.getInt() + 1 + (countEdgeRouter++ &lt;&lt; edgeShift);
            <a class="code" href="structedgeRouter.html">edgeRouter</a> temp;
            temp.<a class="code" href="structedgeRouter.html#a450d84ba9425f34832170d7ea9811635">edgeIP</a> = currentIP;
            temp.<a class="code" href="structedgeRouter.html#a8ef737c9c1ca877edc5313ed336f4eee">usedIPs</a> = 1;
            temp.<a class="code" href="structedgeRouter.html#a0407d28d2a8b617240698b94c309e304">module</a> = mapIt-&gt;second.module;
            asInfo.<a class="code" href="structnodeInfoAS.html#a98b48f924b844cf584f829bbba893921">edgeRouter</a>.push_back(temp);
        }
        <span class="keywordflow">else</span> {
            currentIP = asInfo.<a class="code" href="structnodeInfoAS.html#a9bb59c60111cfda43b5fe63d1945a099">addr</a>.getInt() + countRouter++;
        }

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; mapIt-&gt;second.ift-&gt;getNumInterfaces(); j++) {
            <span class="comment">//</span>
            <span class="comment">// all interfaces except loopback get the same IP address</span>
            <span class="comment">//</span>
            InterfaceEntry *ie = mapIt-&gt;second.ift-&gt;getInterface(j);
            <span class="keywordflow">if</span> (!ie-&gt;isLoopback()) {
                ie-&gt;ipv4Data()-&gt;setIPAddress(IPAddress(currentIP));
                ie-&gt;ipv4Data()-&gt;setNetmask(IPAddress::ALLONES_ADDRESS);
            }
        }
        <span class="keywordflow">if</span> (mapIt-&gt;second.rt-&gt;getRouterId().isUnspecified())
            mapIt-&gt;second.rt-&gt;setRouterId(IPAddress(currentIP));
        mapIt-&gt;second.addr.set(currentIP);

        <span class="comment">// remember core nodes of each AS in additional list for assignment</span>
        <span class="comment">// of Inter-AS routing paths</span>
        <span class="keywordflow">if</span> (mapIt-&gt;second.routerType == <a class="code" href="RUNetworkConfigurator_8h.html#a551104da64be7f7ac0ab37a6f05e8af2">CORE</a>)
            asInfo.<a class="code" href="structnodeInfoAS.html#a99d4242969fb579b7c28083a809b1571">coreNode</a>.push_back(mapIt-&gt;second);
        <span class="keywordflow">else</span> {
            <span class="comment">//</span>
            <span class="comment">// add default route in case of gw, edge, or host</span>
            <span class="comment">//</span>
            IPRoute *e = <span class="keyword">new</span> IPRoute();
            e-&gt;setHost(IPAddress());
            e-&gt;setNetmask(IPAddress());
            e-&gt;setInterface(mapIt-&gt;second.defaultRouteIE);
            e-&gt;setType(IPRoute::REMOTE);
            e-&gt;setSource(IPRoute::MANUAL);
            <span class="comment">//e-&gt;setMetric(1);</span>
            mapIt-&gt;second.rt-&gt;addRoute(e);
        }

        currentIP++;
        mapIt++;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0e877c710d69eb6195ee8e2530ec3e1f"></a><!-- doxytag: member="RUNetworkConfigurator::createInterASPaths" ref="a0e877c710d69eb6195ee8e2530ec3e1f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RUNetworkConfigurator::createInterASPaths </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add Inter-AS routing paths between core nodes. </p>
<p>Calculate all Inter-AS. This is achieved by calculating all shortest paths between all core routers of the whole topology. Temporarily disable all stub links during calculation of shortest paths to ensure that a stub AS is not crossed but may only be present at start or end of a routing path. </p>

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8cc_source.html#l00102">102</a> of file <a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    IPAddress netmask(<a class="code" href="classRUNetworkConfigurator.html#a9bc70b00c73c0475ee7cb4344b12d1c5">NET_MASK</a>);
    <span class="keywordtype">int</span> asIdHistory = 0;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmpAddr = 0;
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classRUNetworkConfigurator.html#a7bd0bbb4b6fbaa8013fa4b03803d55e1">asTopology</a>.getNumNodes(); i++) {
        <span class="comment">// calculate prefix of current core node</span>
        <a class="code" href="structnodeInfoRL.html" title="Structure that contains all information about a router-level node.">nodeInfoRL</a> destCore(<a class="code" href="classRUNetworkConfigurator.html#a7bd0bbb4b6fbaa8013fa4b03803d55e1">asTopology</a>.getNode(i));
        tmpAddr = destCore.<a class="code" href="structnodeInfoRL.html#ad630ef964da3d252e86c7d25ffeb097e">addr</a>.getInt() &gt;&gt; <a class="code" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a>;
        tmpAddr = tmpAddr &lt;&lt; <a class="code" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a>;
        destCore.addr = IPAddress(tmpAddr);
        asIdHistory = -1;
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classRUNetworkConfigurator.html#a7bd0bbb4b6fbaa8013fa4b03803d55e1">asTopology</a>.getNumNodes(); j++) {
            <span class="keywordflow">if</span> (i == j)
                <span class="keywordflow">continue</span>;
            <a class="code" href="structnodeInfoRL.html" title="Structure that contains all information about a router-level node.">nodeInfoRL</a> srcCore(<a class="code" href="classRUNetworkConfigurator.html#a7bd0bbb4b6fbaa8013fa4b03803d55e1">asTopology</a>.getNode(j));
            tmpAddr = srcCore.<a class="code" href="structnodeInfoRL.html#ad630ef964da3d252e86c7d25ffeb097e">addr</a>.getInt() &gt;&gt; <a class="code" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a>;
            tmpAddr = tmpAddr &lt;&lt; <a class="code" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a>;
            srcCore.addr = IPAddress(tmpAddr);

            <span class="comment">// do not calculate paths between nodes of the same AS</span>
            <span class="keywordflow">if</span> (destCore.asId == srcCore.asId)
                <span class="keywordflow">continue</span>;

            <span class="comment">// cross only transit AS in order to reach destination core node</span>
            <span class="comment">// therefore, temporarily disable all stub links</span>
            <span class="keywordflow">if</span> (asIdHistory != srcCore.asId) {
                <a class="code" href="classRUNetworkConfigurator.html#ab1339f94809321bdb7e215621676f2ea" title="Disable all incoming links of Stub AS except to and from dst and src.">disableStubLinks</a>(destCore, srcCore);
                <a class="code" href="classRUNetworkConfigurator.html#a7bd0bbb4b6fbaa8013fa4b03803d55e1">asTopology</a>.calculateUnweightedSingleShortestPathsTo(destCore.node);
            }
            <span class="comment">// add routing entry from srcCore to destCore into routing table of srcCore</span>
            InterfaceEntry *ie = srcCore.ift-&gt;getInterfaceByNodeOutputGateId(srcCore.node-&gt;getPath(0)-&gt;getLocalGate()-&gt;getId());
            IPRoute *e = <span class="keyword">new</span> IPRoute();
            e-&gt;setHost(destCore.addr);
            e-&gt;setNetmask(netmask);
            e-&gt;setInterface(ie);
            e-&gt;setType(IPRoute::DIRECT);
            e-&gt;setSource(IPRoute::MANUAL);
            srcCore.rt-&gt;addRoute(e);

            <span class="comment">// re-enable all stub links</span>
            <span class="keywordflow">if</span> (asIdHistory != srcCore.asId) {
                <a class="code" href="classRUNetworkConfigurator.html#a738c8ddbc264996f3de6cb36cc630506" title="Enable all incoming links of Stub AS.">enableStubLinks</a>();
            }
            asIdHistory = srcCore.asId;
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab1339f94809321bdb7e215621676f2ea"></a><!-- doxytag: member="RUNetworkConfigurator::disableStubLinks" ref="ab1339f94809321bdb7e215621676f2ea" args="(nodeInfoRL &amp;dst, nodeInfoRL &amp;src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RUNetworkConfigurator::disableStubLinks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnodeInfoRL.html">nodeInfoRL</a> &amp;&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structnodeInfoRL.html">nodeInfoRL</a> &amp;&#160;</td>
          <td class="paramname"><em>src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Disable all incoming links of Stub AS except to and from dst and src. </p>
<p>Disable all incoming links to core nodes of each stub AS that do not match on given dst or src router-level node ID. </p>

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8cc_source.html#l00151">151</a> of file <a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>.size(); i++) {
        <span class="keywordflow">if</span> ((<a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].<span class="keywordtype">id</span> == dst.<a class="code" href="structnodeInfoRL.html#ad0a98b416877f6c8bd34cd9815f39cbd">asId</a>) || (<a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].id == src.<a class="code" href="structnodeInfoRL.html#ad0a98b416877f6c8bd34cd9815f39cbd">asId</a>))
            <span class="keywordflow">continue</span>;
        <span class="keywordflow">if</span> (<a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].asType == <a class="code" href="RUNetworkConfigurator_8h.html#adc4ae6ba0050e6227212f666b740fdf6">TRANSIT_AS</a>)
            <span class="keywordflow">continue</span>;

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].coreNode.size(); j++) {
            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].coreNode[j].node-&gt;getNumInLinks(); k++)
                <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].coreNode[j].node-&gt;getLinkIn(k)-&gt;disable();
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a738c8ddbc264996f3de6cb36cc630506"></a><!-- doxytag: member="RUNetworkConfigurator::enableStubLinks" ref="a738c8ddbc264996f3de6cb36cc630506" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RUNetworkConfigurator::enableStubLinks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enable all incoming links of Stub AS. </p>
<p>Enable all incoming links to core nodes of each stub AS </p>

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8cc_source.html#l00166">166</a> of file <a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>.size(); i++) {
        <span class="keywordflow">if</span> (<a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].asType == <a class="code" href="RUNetworkConfigurator_8h.html#adc4ae6ba0050e6227212f666b740fdf6">TRANSIT_AS</a>)
            <span class="keywordflow">continue</span>;
        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].coreNode.size(); j++) {
            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].coreNode[j].node-&gt;getNumInLinks(); k++)
                <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].coreNode[j].node-&gt;getLinkIn(k)-&gt;enable();
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa019b1491f74b65a07629969a47ac829"></a><!-- doxytag: member="RUNetworkConfigurator::extractTopology" ref="aa019b1491f74b65a07629969a47ac829" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RUNetworkConfigurator::extractTopology </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Extract topology from NED file. </p>
<p>Extracts AS-level topology and each router-level topology into asTopology and rlTopology. Additionally, each AS gets assigned a unique calculated prefix </p>

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8cc_source.html#l00178">178</a> of file <a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    cTopology currentAS;

    <span class="comment">// get the AS-level topology</span>
    <span class="keywordflow">if</span> (<a class="code" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a> &gt; 0) {
        currentAS.extractByProperty(<span class="stringliteral">&quot;AS&quot;</span>); <span class="comment">//TODO: check if this is acceptable</span>
        <span class="keywordflow">if</span> (currentAS.getNumNodes() != <a class="code" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a>)
            opp_error(<span class="stringliteral">&quot;Error: AS-Topology contains %u elements - expected %u\n&quot;</span>, currentAS.getNumNodes(), <a class="code" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a>);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a> == 0) {
        <span class="comment">// Network is router-level only</span>
        currentAS.extractByProperty(<span class="stringliteral">&quot;Internet&quot;</span>); <span class="comment">//TODO: check if this is acceptable</span>
        <span class="keywordflow">if</span> (currentAS.getNumNodes() != 1)
            opp_error(<span class="stringliteral">&quot;Error: tried to extract router-level only topology, but found more than 1 Inet module\n&quot;</span>);
    }

    <span class="comment">// get each router-level topology</span>
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> netIP = 1 &lt;&lt; <a class="code" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a>;
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; currentAS.getNumNodes(); i++) {
        cTopology *tmpTopo = <span class="keyword">new</span> cTopology();
        <span class="comment">// extract router-level nodes from NED file</span>
        tmpTopo-&gt;extractFromNetwork(<a class="code" href="namespaceRUNetConf.html#a74e4a0730da15bd2adfbc7670aa60c8d" title="Callback method that is used by extractFromNetwork.">getRouterLevelNodes</a>, (<span class="keywordtype">void</span> *) currentAS.getNode(i)-&gt;getModule()-&gt;getName());
        <a class="code" href="classRUNetworkConfigurator.html#a6166955bf85b1861f9de62c97fa34d77">rlTopology</a>.push_back(tmpTopo);
        <span class="comment">// assign unique /16 IP address prefix to each AS</span>
        <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>.push_back(<a class="code" href="structnodeInfoAS.html" title="Structure that contains all information about an AS-level node.">nodeInfoAS</a>(currentAS.getNode(i), IPAddress(netIP), IPAddress(<a class="code" href="classRUNetworkConfigurator.html#a9bc70b00c73c0475ee7cb4344b12d1c5">NET_MASK</a>)));
        netIP += 1 &lt;&lt; <a class="code" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a>;
    }

    <a class="code" href="classRUNetworkConfigurator.html#a7bd0bbb4b6fbaa8013fa4b03803d55e1">asTopology</a>.extractFromNetwork(<a class="code" href="namespaceRUNetConf.html#ad6241551161840908b615ba2adea3d73" title="Callback method that is used by extractFromNetwork.">getCoreNodes</a>); <span class="comment">//TODO: the extra function may be superfuous. extraction could be probably be done via asTopology.extractByProperty(&quot;CoreRouter&quot;); -Claus</span>

    <span class="comment">//free memory</span>
    currentAS.clear();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a780159652abe9fdefb4e99552b86435f"></a><!-- doxytag: member="RUNetworkConfigurator::handleMessage" ref="a780159652abe9fdefb4e99552b86435f" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void RUNetworkConfigurator::handleMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00278">278</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>
<div class="fragment"><pre class="fragment">{opp_error(<span class="stringliteral">&quot;message received&quot;</span>);};
</pre></div>
</div>
</div>
<a class="anchor" id="a765afe519b25635a49814d66926a1572"></a><!-- doxytag: member="RUNetworkConfigurator::initialize" ref="a765afe519b25635a49814d66926a1572" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RUNetworkConfigurator::initialize </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Main method of the network configurator. </p>
<p>Topology is extracted from NED file, IP addresses are assigned, and routing paths are established. </p>

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8cc_source.html#l00042">42</a> of file <a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (stage != 2)
        <span class="keywordflow">return</span>;


    <span class="comment">//TODO: read number of AS</span>
    cTopology tempTopology(<span class="stringliteral">&quot;tempTopo&quot;</span>);
    tempTopology.extractByProperty(<span class="stringliteral">&quot;AS&quot;</span>);

    <a class="code" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a> = tempTopology.getNumNodes();
    cout &lt;&lt; <a class="code" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a> &lt;&lt;endl;
    <a class="code" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">nextPow</a> = 1;
    <span class="keywordflow">while</span> ((1 &lt;&lt; <a class="code" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">nextPow</a>) &lt; <a class="code" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a> + 1) {
        <a class="code" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">nextPow</a>++;
    }
    <a class="code" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a> = 32 - <a class="code" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">nextPow</a>;
    <a class="code" href="classRUNetworkConfigurator.html#a9bc70b00c73c0475ee7cb4344b12d1c5">NET_MASK</a> = 0xffffffff &lt;&lt; <a class="code" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">IP_NET_SHIFT</a>;

    <span class="comment">// extract topology nodes and assign IP addresses</span>
    <a class="code" href="classRUNetworkConfigurator.html#aa019b1491f74b65a07629969a47ac829" title="Extract topology from NED file.">extractTopology</a>();

    <span class="comment">// assign an IPAddress to all nodes in the network</span>
    <span class="comment">//FIXME: does asNodeVec.size() work as intended? may need to use noAS instead</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>.size(); i++) {
        <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="classRUNetworkConfigurator.html#a6166955bf85b1861f9de62c97fa34d77">rlTopology</a>[i]-&gt;getNumNodes() &gt; (0xffffffff - <a class="code" href="classRUNetworkConfigurator.html#a9bc70b00c73c0475ee7cb4344b12d1c5">NET_MASK</a>))
            opp_error(<span class="stringliteral">&quot;to many nodes in current topology&quot;</span>);
        cerr &lt;&lt; <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].module-&gt;getFullPath() &lt;&lt; endl;
        <span class="comment">//</span>
        <span class="comment">//  insert each router-level node into a node map</span>
        <span class="comment">//</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="classRUNetworkConfigurator.html#a6166955bf85b1861f9de62c97fa34d77">rlTopology</a>[i]-&gt;getNumNodes(); j++) {
            <a class="code" href="structnodeInfoRL.html" title="Structure that contains all information about a router-level node.">nodeInfoRL</a> curRLNode(<a class="code" href="classRUNetworkConfigurator.html#a6166955bf85b1861f9de62c97fa34d77">rlTopology</a>[i]-&gt;getNode(j));
            <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].nodeMap.insert(<a class="code" href="RUNetworkConfigurator_8h.html#ac1a91224c16d97f2cde479dee994c427">NODE_MAP_PAIR</a>(curRLNode.moduleId, curRLNode));
        }

        <span class="comment">// assign IP address and add default route</span>
        <a class="code" href="classRUNetworkConfigurator.html#a0e5be501ddf4ca493eeb9a3094256632" title="Assign IP address and add default route.">assignAddressAndSetDefaultRoutes</a>(<a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i]);
    }

    <span class="comment">// add all further routes in router-level topology</span>
    <span class="comment">// (unequal to default route)</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>.size(); i++)
        <a class="code" href="classRUNetworkConfigurator.html#a576044fccb31eda5ce308cd6cf3ff52e" title="Add explicit Intra-AS routing paths (except of default routes)">setIntraASRoutes</a>(*<a class="code" href="classRUNetworkConfigurator.html#a6166955bf85b1861f9de62c97fa34d77">rlTopology</a>[i], <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i]);

    <span class="comment">// Having configured all router topologies, add Inter-AS routing paths</span>
    <span class="keywordflow">if</span> (<a class="code" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a> &gt; 0)
        <a class="code" href="classRUNetworkConfigurator.html#a0e877c710d69eb6195ee8e2530ec3e1f" title="Add Inter-AS routing paths between core nodes.">createInterASPaths</a>();

    <span class="comment">// free Memory</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">noAS</a>; i++) {
        <a class="code" href="classRUNetworkConfigurator.html#a6166955bf85b1861f9de62c97fa34d77">rlTopology</a>[i]-&gt;clear();
        <span class="keyword">delete</span> <a class="code" href="classRUNetworkConfigurator.html#a6166955bf85b1861f9de62c97fa34d77">rlTopology</a>[i];
        <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>[i].nodeMap.clear();
    }
    <a class="code" href="classRUNetworkConfigurator.html#a7bd0bbb4b6fbaa8013fa4b03803d55e1">asTopology</a>.clear();
    <a class="code" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">asNodeVec</a>.clear();
    tempTopology.clear();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a67a67982af1653c7995725fed3fd24c9"></a><!-- doxytag: member="RUNetworkConfigurator::numInitStages" ref="a67a67982af1653c7995725fed3fd24c9" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual int RUNetworkConfigurator::numInitStages </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00270">270</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> 3;}
</pre></div>
</div>
</div>
<a class="anchor" id="a576044fccb31eda5ce308cd6cf3ff52e"></a><!-- doxytag: member="RUNetworkConfigurator::setIntraASRoutes" ref="a576044fccb31eda5ce308cd6cf3ff52e" args="(cTopology &amp;topology, nodeInfoAS &amp;asInfo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RUNetworkConfigurator::setIntraASRoutes </td>
          <td>(</td>
          <td class="paramtype">cTopology &amp;&#160;</td>
          <td class="paramname"><em>topology</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structnodeInfoAS.html">nodeInfoAS</a> &amp;&#160;</td>
          <td class="paramname"><em>asInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add explicit Intra-AS routing paths (except of default routes) </p>
<p>Calculate all Intra-AS routes that are unequal to the default routes. Therefore, all shortest paths between all router-level nodes are calculated. If the first hop is unequal to the default route, a new specific route is added.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">topology</td><td></td></tr>
    <tr><td class="paramname">asInfo</td><td>AS for which Intra-AS routes should be determined </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8cc_source.html#l00324">324</a> of file <a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// calculate static routes from each of the AS&#39;s router-level nodes to all</span>
    <span class="comment">// other nodes of the AS</span>

    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; topology.getNumNodes(); i++) {
        <a class="code" href="structnodeInfoRL.html" title="Structure that contains all information about a router-level node.">nodeInfoRL</a> destNode = asInfo.<a class="code" href="structnodeInfoAS.html#aa50927e73d778fc3b8e201dc87bd1e2e">nodeMap</a>[topology.getNode(i)-&gt;getModule()-&gt;getId()];
        <span class="comment">//</span>
        <span class="comment">// calculate shortest path form everywhere toward destNode</span>
        <span class="comment">//</span>
        topology.calculateUnweightedSingleShortestPathsTo(destNode.<a class="code" href="structnodeInfoRL.html#a699add7ac7de1847c7e0830908fe2b5d">node</a>);
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; topology.getNumNodes(); j++) {
            <span class="keywordflow">if</span> (j == i)
                <span class="keywordflow">continue</span>;
            <a class="code" href="structnodeInfoRL.html" title="Structure that contains all information about a router-level node.">nodeInfoRL</a> srcNode = asInfo.<a class="code" href="structnodeInfoAS.html#aa50927e73d778fc3b8e201dc87bd1e2e">nodeMap</a>[topology.getNode(j)-&gt;getModule()-&gt;getId()];
            <span class="comment">// no route exists at all</span>
            <span class="keywordflow">if</span> (srcNode.<a class="code" href="structnodeInfoRL.html#a699add7ac7de1847c7e0830908fe2b5d">node</a>-&gt;getNumPaths() == 0)
                <span class="keywordflow">continue</span>;
            <span class="comment">// end systems only know a default route to the edge router</span>
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (srcNode.<a class="code" href="structnodeInfoRL.html#a3522354bb22b8f5afcf90bdadf09812c">routerType</a> == <a class="code" href="RUNetworkConfigurator_8h.html#ade65dea0a340142cca19acc35bac5f81">ENDSYS</a>)
                <span class="keywordflow">continue</span>;
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (destNode.<a class="code" href="structnodeInfoRL.html#a3522354bb22b8f5afcf90bdadf09812c">routerType</a> == <a class="code" href="RUNetworkConfigurator_8h.html#ade65dea0a340142cca19acc35bac5f81">ENDSYS</a>) {
                <span class="keywordflow">if</span> (srcNode.<a class="code" href="structnodeInfoRL.html#a3522354bb22b8f5afcf90bdadf09812c">routerType</a> != <a class="code" href="RUNetworkConfigurator_8h.html#ab37daea78a5c66c3eb8fa27cd34a8d53">EDGE</a>)
                        <span class="keywordflow">continue</span>;
                InterfaceEntry *ie = srcNode.<a class="code" href="structnodeInfoRL.html#a2093424e604a83bd35e0851919cbb309">ift</a>-&gt;getInterfaceByNodeOutputGateId(srcNode.<a class="code" href="structnodeInfoRL.html#a699add7ac7de1847c7e0830908fe2b5d">node</a>-&gt;getPath(0)-&gt;getLocalGate()-&gt;getId());
                <span class="keywordflow">if</span> (ie == srcNode.<a class="code" href="structnodeInfoRL.html#a09c11d1e424b19a7328d48b494ef1598">defaultRouteIE</a>)
                    <span class="keywordflow">continue</span>;

                <span class="keywordflow">for</span> (uint32 i = 0; i &lt; asInfo.<a class="code" href="structnodeInfoAS.html#a98b48f924b844cf584f829bbba893921">edgeRouter</a>.size(); i++) {

                    <span class="keywordflow">if</span> (srcNode.<a class="code" href="structnodeInfoRL.html#aab015d1c3ca29bcbc53d6b47fa877747">module</a> == asInfo.<a class="code" href="structnodeInfoAS.html#a98b48f924b844cf584f829bbba893921">edgeRouter</a>[i].module) {

                        destNode.<a class="code" href="structnodeInfoRL.html#ad630ef964da3d252e86c7d25ffeb097e">addr</a> = IPAddress(asInfo.<a class="code" href="structnodeInfoAS.html#a98b48f924b844cf584f829bbba893921">edgeRouter</a>[i].edgeIP + asInfo.<a class="code" href="structnodeInfoAS.html#a98b48f924b844cf584f829bbba893921">edgeRouter</a>[i].usedIPs);
                        asInfo.<a class="code" href="structnodeInfoAS.html#a98b48f924b844cf584f829bbba893921">edgeRouter</a>[i].usedIPs++;
                    }
                }

                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; destNode.<a class="code" href="structnodeInfoRL.html#a2093424e604a83bd35e0851919cbb309">ift</a>-&gt;getNumInterfaces(); j++) {
                    <span class="comment">//</span>
                    <span class="comment">// all interfaces except loopback get the same IP address</span>
                    <span class="comment">//</span>
                    InterfaceEntry *ie = destNode.<a class="code" href="structnodeInfoRL.html#a2093424e604a83bd35e0851919cbb309">ift</a>-&gt;getInterface(j);
                    <span class="keywordflow">if</span> (!ie-&gt;isLoopback()) {
                        ie-&gt;ipv4Data()-&gt;setIPAddress(destNode.<a class="code" href="structnodeInfoRL.html#ad630ef964da3d252e86c7d25ffeb097e">addr</a>);
                        ie-&gt;ipv4Data()-&gt;setNetmask(IPAddress::ALLONES_ADDRESS);
                    }
                }
                IPRoute *e = <span class="keyword">new</span> IPRoute();
                e-&gt;setHost(IPAddress());
                e-&gt;setNetmask(IPAddress());
                e-&gt;setInterface(destNode.<a class="code" href="structnodeInfoRL.html#a09c11d1e424b19a7328d48b494ef1598">defaultRouteIE</a>);
                e-&gt;setType(IPRoute::REMOTE);
                e-&gt;setSource(IPRoute::MANUAL);
                destNode.<a class="code" href="structnodeInfoRL.html#a84254528f9e2a6c16507147cc4083b51">rt</a>-&gt;addRoute(e);

                ie = srcNode.<a class="code" href="structnodeInfoRL.html#a2093424e604a83bd35e0851919cbb309">ift</a>-&gt;getInterfaceByNodeOutputGateId(srcNode.<a class="code" href="structnodeInfoRL.html#a699add7ac7de1847c7e0830908fe2b5d">node</a>-&gt;getPath(0)-&gt;getLocalGate()-&gt;getId());
                e = <span class="keyword">new</span> IPRoute();
                e-&gt;setHost(destNode.<a class="code" href="structnodeInfoRL.html#ad630ef964da3d252e86c7d25ffeb097e">addr</a>);
                e-&gt;setNetmask(IPAddress(255, 255, 255, 255));
                e-&gt;setInterface(ie);
                e-&gt;setType(IPRoute::DIRECT);
                e-&gt;setSource(IPRoute::MANUAL);
                srcNode.<a class="code" href="structnodeInfoRL.html#a84254528f9e2a6c16507147cc4083b51">rt</a>-&gt;addRoute(e);
            }
            <span class="keywordflow">else</span> {
                <span class="comment">//</span>
                <span class="comment">// if destination is reachable through default route, no routing entry is necessary</span>
                <span class="comment">//</span>
                InterfaceEntry *ie = srcNode.<a class="code" href="structnodeInfoRL.html#a2093424e604a83bd35e0851919cbb309">ift</a>-&gt;getInterfaceByNodeOutputGateId(srcNode.<a class="code" href="structnodeInfoRL.html#a699add7ac7de1847c7e0830908fe2b5d">node</a>-&gt;getPath(0)-&gt;getLocalGate()-&gt;getId());
                <span class="keywordflow">if</span> (ie == srcNode.<a class="code" href="structnodeInfoRL.html#a09c11d1e424b19a7328d48b494ef1598">defaultRouteIE</a>)
                    <span class="keywordflow">continue</span>;
                <span class="keywordflow">else</span> {
                    <span class="comment">// add specific routing entry into routing table</span>
                    IPRoute *e = <span class="keyword">new</span> IPRoute();
                    e-&gt;setHost(destNode.<a class="code" href="structnodeInfoRL.html#ad630ef964da3d252e86c7d25ffeb097e">addr</a>);
                    <span class="keywordflow">if</span> (destNode.<a class="code" href="structnodeInfoRL.html#a3522354bb22b8f5afcf90bdadf09812c">routerType</a> == <a class="code" href="RUNetworkConfigurator_8h.html#ab37daea78a5c66c3eb8fa27cd34a8d53">EDGE</a>)
                        e-&gt;setNetmask(asInfo.<a class="code" href="structnodeInfoAS.html#a04a0f2d7dabb7a6eca0754935851c979">subnetmask</a>);
                    <span class="keywordflow">else</span>
                        e-&gt;setNetmask(IPAddress(255, 255, 255, 255));
                    e-&gt;setInterface(ie);
                    e-&gt;setType(IPRoute::DIRECT);
                    e-&gt;setSource(IPRoute::MANUAL);
                    srcNode.<a class="code" href="structnodeInfoRL.html#a84254528f9e2a6c16507147cc4083b51">rt</a>-&gt;addRoute(e);
                }
            }
        }
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a1319eac1d29e8fa215654fa65ca43e2e"></a><!-- doxytag: member="RUNetworkConfigurator::asNodeVec" ref="a1319eac1d29e8fa215654fa65ca43e2e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="RUNetworkConfigurator_8h.html#a7a920f5509c0db8ac1e38ab066094562">NODE_INFO_AS_VEC</a> <a class="el" href="classRUNetworkConfigurator.html#a1319eac1d29e8fa215654fa65ca43e2e">RUNetworkConfigurator::asNodeVec</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00259">259</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7bd0bbb4b6fbaa8013fa4b03803d55e1"></a><!-- doxytag: member="RUNetworkConfigurator::asTopology" ref="a7bd0bbb4b6fbaa8013fa4b03803d55e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cTopology <a class="el" href="classRUNetworkConfigurator.html#a7bd0bbb4b6fbaa8013fa4b03803d55e1">RUNetworkConfigurator::asTopology</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00256">256</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae41c257b6bd5c01979183935d09bfe6b"></a><!-- doxytag: member="RUNetworkConfigurator::IP_NET_SHIFT" ref="ae41c257b6bd5c01979183935d09bfe6b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classRUNetworkConfigurator.html#ae41c257b6bd5c01979183935d09bfe6b">RUNetworkConfigurator::IP_NET_SHIFT</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00260">260</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9bc70b00c73c0475ee7cb4344b12d1c5"></a><!-- doxytag: member="RUNetworkConfigurator::NET_MASK" ref="a9bc70b00c73c0475ee7cb4344b12d1c5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classRUNetworkConfigurator.html#a9bc70b00c73c0475ee7cb4344b12d1c5">RUNetworkConfigurator::NET_MASK</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00261">261</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>

</div>
</div>
<a class="anchor" id="af18fc283527f1912988896bc32d9abf3"></a><!-- doxytag: member="RUNetworkConfigurator::nextPow" ref="af18fc283527f1912988896bc32d9abf3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classRUNetworkConfigurator.html#af18fc283527f1912988896bc32d9abf3">RUNetworkConfigurator::nextPow</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00258">258</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>

</div>
</div>
<a class="anchor" id="acd70c4eb7852927212252256b8b7686e"></a><!-- doxytag: member="RUNetworkConfigurator::noAS" ref="acd70c4eb7852927212252256b8b7686e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classRUNetworkConfigurator.html#acd70c4eb7852927212252256b8b7686e">RUNetworkConfigurator::noAS</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00257">257</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6166955bf85b1861f9de62c97fa34d77"></a><!-- doxytag: member="RUNetworkConfigurator::rlTopology" ref="a6166955bf85b1861f9de62c97fa34d77" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;cTopology*&gt; <a class="el" href="classRUNetworkConfigurator.html#a6166955bf85b1861f9de62c97fa34d77">RUNetworkConfigurator::rlTopology</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RUNetworkConfigurator_8h_source.html#l00255">255</a> of file <a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="RUNetworkConfigurator_8h_source.html">RUNetworkConfigurator.h</a></li>
<li><a class="el" href="RUNetworkConfigurator_8cc_source.html">RUNetworkConfigurator.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classRUNetworkConfigurator.html">RUNetworkConfigurator</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:07:01 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
