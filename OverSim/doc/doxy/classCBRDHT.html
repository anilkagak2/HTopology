<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: CBRDHT Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classCBRDHT.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">CBRDHT Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="CBRDHT" --><!-- doxytag: inherits="BaseApp" -->
<p>A Distributed Hash Table (<a class="el" href="classDHT.html" title="A Distributed Hash Table (DHT) for KBR protocols.">DHT</a>) for KBR protocols.  
 <a href="classCBRDHT.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for CBRDHT:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classCBRDHT.png" usemap="#CBRDHT_map" alt=""/>
  <map id="CBRDHT_map" name="CBRDHT_map">
<area href="classBaseApp.html" title="Base class for applications." alt="BaseApp" shape="rect" coords="57,112,162,136"/>
<area href="classBaseRpc.html" title="Base class for RPCs." alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classRpcListener.html" title="A Remote-Procedure-Call listener class." alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
 </div></div>

<p><a href="classCBRDHT-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCBRDHT_1_1GetMapEntry.html">GetMapEntry</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCBRDHT_1_1PutMapEntry.html">PutMapEntry</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#af058bc6bca0c7036770c62ec6ba0f55d">CBRDHT</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#aa2d4398b97c1c06e4379fc8460f6b766">~CBRDHT</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pro-types"></a>
Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::vector&lt; <a class="el" href="classNodeHandle.html">NodeHandle</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a9af784d0b574bb87b2fad6a73c8eb5a1">ReplicaVector</a></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a55759c7002f6f347c9a331f475e714f6">initializeApp</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">initializes derived class-attributes  <a href="#a55759c7002f6f347c9a331f475e714f6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#acd8b461a846a1d8c52098d32f0152edc">finishApp</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">collects statistical data of derived app  <a href="#acd8b461a846a1d8c52098d32f0152edc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a9687f217efef7be22f63f89eb98316c9">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a23a206659056d25bc06bdb6a4655fc6a">handleRpcCall</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes Remote-Procedure-Call invocation messages.  <a href="#a23a206659056d25bc06bdb6a4655fc6a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a1d9992ca6b273d28c05bc70f6d108cf0">handleRpcResponse</a> (<a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *msg, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC response has been received.  <a href="#a1d9992ca6b273d28c05bc70f6d108cf0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a02c24b6ada58e1d0d690459b5e56e729">handleRpcTimeout</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, cPolymorphic *context, int rpcId, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;destKey)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC timeout has been reached.  <a href="#a02c24b6ada58e1d0d690459b5e56e729"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a5ec14534f25aa85c1b720d511e8329cd">handleUpperMessage</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handleUpperMessage gets called of <a class="el" href="classBaseApp.html#a98800700e14545cd84636ca4413f605a" title="checks for message type and calls corresponding method">handleMessage(cMessage* msg)</a> if msg arrivedOn from_upperTier (currently msg gets deleted in this function)  <a href="#a5ec14534f25aa85c1b720d511e8329cd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a48f879f883e47696e35aa272e0e1eeaa">handlePutRequest</a> (<a class="el" href="classDHTPutCall.html">DHTPutCall</a> *dhtMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#ace52565c0b61f5e025241087255c5c68">handleGetRequest</a> (<a class="el" href="classCBRDHTGetCall.html">CBRDHTGetCall</a> *dhtMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#af1ddb52cc46f8cb27d059f05953f9653">handlePutResponse</a> (<a class="el" href="classDHTPutResponse.html">DHTPutResponse</a> *dhtMsg, int rpcId)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#aef96e24cd11666913a54d122b60bb749">handleGetResponse</a> (<a class="el" href="classCBRDHTGetResponse.html">CBRDHTGetResponse</a> *dhtMsg, int rpcId)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#af525e8ee6e3b2feaa06cd4ac50df0c13">handlePutCAPIRequest</a> (<a class="el" href="classDHTputCAPICall.html">DHTputCAPICall</a> *capiPutMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a3978bfc13875b74884480df035955f2f">handleGetCAPIRequest</a> (<a class="el" href="classDHTgetCAPICall.html">DHTgetCAPICall</a> *capiGetMsg, int teamnum=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a6b38aa6bfccdc46db10052aad003819b">handleDumpDhtRequest</a> (<a class="el" href="classDHTdumpCall.html">DHTdumpCall</a> *call)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a603c05617bd2a6c629b5f36c2721af21">update</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node, bool joined)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Common API function: informs application about neighbors and own nodeID.  <a href="#a603c05617bd2a6c629b5f36c2721af21"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a8955c8fd6280759931edc227d2519b88">handleLookupResponse</a> (<a class="el" href="classLookupResponse.html">LookupResponse</a> *lookupMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a7facbd76bcd1a944cc416be139091a6d">resultValuesBitLength</a> (<a class="el" href="classDHTGetResponse.html">DHTGetResponse</a> *msg)</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#ab3afabd3f65d272ec42d6ebe97e40fb3">maintenanceMessages</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a1ebe642d98fa1807657b437083db4677">numBytesMaintenance</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#adb365160b104ebad6a6d67718f242484">lastGetCall</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::map&lt; unsigned int, <br class="typebreak"/>
<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4">rpcIdMap</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member)  <a href="#aca3294a891258cca91a66aab04f73ad4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::map&lt; int, <a class="el" href="structCBRDHT_1_1GetMapEntry.html">GetMapEntry</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::map&lt; int, <a class="el" href="structCBRDHT_1_1PutMapEntry.html">PutMapEntry</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDHTDataStorage.html">DHTDataStorage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc">dataStorage</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pointer to the dht data storage  <a href="#ad0576bc5a424d7c491c7d061ce9759fc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classCoordBasedRouting.html">CoordBasedRouting</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#a55a40d5b1e807a5238049e0b9331ece3">coordBasedRouting</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classNeighborCache.html">NeighborCache</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCBRDHT.html#ad79c28188c6a3d9283ee8da5dcb72da4">neighborCache</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pointer to the neighbor cache  <a href="#ad79c28188c6a3d9283ee8da5dcb72da4"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>A Distributed Hash Table (<a class="el" href="classDHT.html" title="A Distributed Hash Table (DHT) for KBR protocols.">DHT</a>) for KBR protocols. </p>
<p>A Distributed Hash Table (<a class="el" href="classDHT.html" title="A Distributed Hash Table (DHT) for KBR protocols.">DHT</a>) for KBR protocols </p>

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00048">48</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>
</div><hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="a9af784d0b574bb87b2fad6a73c8eb5a1"></a><!-- doxytag: member="CBRDHT::ReplicaVector" ref="a9af784d0b574bb87b2fad6a73c8eb5a1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::vector&lt;<a class="el" href="classNodeHandle.html">NodeHandle</a>&gt; <a class="el" href="classCBRDHT.html#a9af784d0b574bb87b2fad6a73c8eb5a1">CBRDHT::ReplicaVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00055">55</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="af058bc6bca0c7036770c62ec6ba0f55d"></a><!-- doxytag: member="CBRDHT::CBRDHT" ref="af058bc6bca0c7036770c62ec6ba0f55d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CBRDHT::CBRDHT </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00038">38</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a> = NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa2d4398b97c1c06e4379fc8460f6b766"></a><!-- doxytag: member="CBRDHT::~CBRDHT" ref="aa2d4398b97c1c06e4379fc8460f6b766" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CBRDHT::~CBRDHT </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00043">43</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::map&lt;unsigned int, BaseCallMessage*&gt;::iterator it;

    <span class="keywordflow">for</span> (it = <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.begin(); it != <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.end(); it++) {
        <span class="keyword">delete</span> it-&gt;second;
        it-&gt;second = NULL;
    }

    std::map&lt;int, GetMapEntry&gt;::iterator it2;
    <span class="keywordflow">for</span> (it2 = <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.begin(); it2 != <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.end(); it2++) {
        <span class="comment">//cancelAndDelete(it2-&gt;second.callMsg);</span>
        <span class="keyword">delete</span> it2-&gt;second.callMsg;
        it2-&gt;second.callMsg = NULL;
    }

    std::map&lt;int, PutMapEntry&gt;::iterator it3;

    <span class="keywordflow">for</span> (it3 = <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.begin(); it3 != <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.end(); it3++) {
        <span class="comment">//if (it3-&gt;second.callMsg != NULL) {</span>
        <span class="comment">//    cancelAndDelete(it3-&gt;second.callMsg);</span>
        <span class="comment">//}</span>
        <span class="keyword">delete</span> it3-&gt;second.callMsg;
        it3-&gt;second.callMsg = NULL;
    }

    <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.clear();
    <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.clear();
    <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.clear();

    <span class="keywordflow">if</span> (<a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a> != NULL) {
        <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a8b9558b53b6c7d64aa82bed6662a74b2" title="Clears all stored data items.">clear</a>();
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="acd8b461a846a1d8c52098d32f0152edc"></a><!-- doxytag: member="CBRDHT::finishApp" ref="acd8b461a846a1d8c52098d32f0152edc" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::finishApp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collects statistical data of derived app </p>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a9702f80de642a3e090aaf5bedea8e4a6">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00914">914</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    simtime_t time = <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a610799ebfbf64696c59b811870cc8300">calcMeasuredLifetime</a>(<a class="code" href="classBaseApp.html#ac365b8c1cb45fb1e37f95535936a0f31" title="simTime when the App has been created">creationTime</a>);

    <span class="keywordflow">if</span> (time != 0) {
        <span class="comment">// std::cout &lt;&lt; dataStorage-&gt;getSize() &lt;&lt; &quot; &quot; &lt;&lt; overlay-&gt;getThisNode().getKey().toString(16) &lt;&lt; std::endl;</span>
        <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;DHT: Sent Maintenance Messages/s&quot;</span>,
                                    <a class="code" href="classCBRDHT.html#ab3afabd3f65d272ec42d6ebe97e40fb3">maintenanceMessages</a> / time);
        <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;DHT: Sent Normal Messages/s&quot;</span>,
                                    <a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a> / time);
        <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;DHT: Sent Maintenance Bytes/s&quot;</span>,
                                    <a class="code" href="classCBRDHT.html#a1ebe642d98fa1807657b437083db4677">numBytesMaintenance</a> / time);
        <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;DHT: Sent Normal Bytes/s&quot;</span>,
                                    <a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a> / time);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6b38aa6bfccdc46db10052aad003819b"></a><!-- doxytag: member="CBRDHT::handleDumpDhtRequest" ref="a6b38aa6bfccdc46db10052aad003819b" args="(DHTdumpCall *call)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handleDumpDhtRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTdumpCall.html">DHTdumpCall</a> *&#160;</td>
          <td class="paramname"><em>call</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00552">552</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classDHTdumpResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTdumpResponse</a>* response = <span class="keyword">new</span> <a class="code" href="classDHTdumpResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTdumpResponse</a>();
    <a class="code" href="DHTDataStorage_8h.html#ae1791efbd50a05f79354e7b6444044ff">DhtDumpVector</a>* dumpVector = <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#ab8425aa4123fc352970c78f1890c08c4" title="Dump filtered local data records into a vector.">dumpDht</a>();

    response-&gt;<a class="code" href="classDHTdumpResponse.html#a8f1afdbe3bd1ec96597a35d97cb0b338">setRecordArraySize</a>(dumpVector-&gt;size());

    <span class="keywordflow">for</span> (uint i = 0; i &lt; dumpVector-&gt;size(); i++) {
        response-&gt;<a class="code" href="classDHTdumpResponse.html#adf0d878708681db4e8108b64ee4146b1">setRecord</a>(i, (*dumpVector)[i]);
    }

    <span class="keyword">delete</span> dumpVector;

    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(call, response);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3978bfc13875b74884480df035955f2f"></a><!-- doxytag: member="CBRDHT::handleGetCAPIRequest" ref="a3978bfc13875b74884480df035955f2f" args="(DHTgetCAPICall *capiGetMsg, int teamnum=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handleGetCAPIRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTgetCAPICall.html">DHTgetCAPICall</a> *&#160;</td>
          <td class="paramname"><em>capiGetMsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>teamnum</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00422">422</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                                         {
    <span class="comment">// Extended multi team version, default: teamnum = 0</span>
        <span class="keywordflow">if</span> (teamnum &gt;= <a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a>)
                <span class="keywordflow">return</span>;

        <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> originalKey = capiGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#af9440c7e23e999225e8a8aacd4865596">getKey</a>();
        std::vector&lt;OverlayKey&gt; possibleKeys;

        assert(!originalKey.<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>());
        possibleKeys.push_back(originalKey);

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; <a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a>; i++) {
                <span class="comment">// multiple SHA1 hashing of original key</span>
                <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> keyHash = originalKey;
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; i; j++) {
                        keyHash = <a class="code" href="classOverlayKey.html#abbd73571f97d27468c417c9b3f91f175" title="Returns a key with the SHA1 cryptographic hash of a BinaryValue.">OverlayKey::sha1</a>(<a class="code" href="classBinaryValue.html">BinaryValue</a>(keyHash.<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16).c_str()));
                }
                assert(!keyHash.<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>());
                possibleKeys.push_back(keyHash);
        }

    <span class="comment">// Order possible keys by euclidian distance to this node</span>
    std::vector&lt;OverlayKey&gt; orderedKeys;
    <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> compareKey = <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>();

    <span class="keywordflow">while</span> (possibleKeys.size() &gt; 0) {
        <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> bestKey = possibleKeys[0];
        <span class="keywordtype">int</span> bestpos = 0;

        <span class="comment">// TODO: i = 1?</span>
        <span class="keywordflow">for</span> (uint i = 0; i &lt; possibleKeys.size(); i++) {
            <span class="comment">//std::cout &lt;&lt; neighborCache-&gt;getOwnEuclidianDistanceToKey(possibleKeys[i]) &lt;&lt; std::endl;</span>
            <span class="keywordflow">if</span> (<a class="code" href="classCBRDHT.html#a55a40d5b1e807a5238049e0b9331ece3">coordBasedRouting</a>
                    -&gt;getEuclidianDistanceByKeyAndCoords(possibleKeys[i],
                                                         ((<span class="keyword">const</span> <a class="code" href="classNps.html">Nps</a>&amp;)<a class="code" href="classCBRDHT.html#ad79c28188c6a3d9283ee8da5dcb72da4" title="pointer to the neighbor cache">neighborCache</a>-&gt;<a class="code" href="classNeighborCache.html#affdf04759fd1df8315954b8789d91eab">getNcsAccess</a>()).getOwnCoordinates(), <span class="comment">//TODO</span>
                                                         <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#afcab85a6c5a4f8aa70a65ecabaa78180">getBitsPerDigit</a>()) &lt;
                <a class="code" href="classCBRDHT.html#a55a40d5b1e807a5238049e0b9331ece3">coordBasedRouting</a>
                    -&gt;getEuclidianDistanceByKeyAndCoords(bestKey,
                                                         ((<span class="keyword">const</span> <a class="code" href="classNps.html">Nps</a>&amp;)<a class="code" href="classCBRDHT.html#ad79c28188c6a3d9283ee8da5dcb72da4" title="pointer to the neighbor cache">neighborCache</a>-&gt;<a class="code" href="classNeighborCache.html#affdf04759fd1df8315954b8789d91eab">getNcsAccess</a>()).getOwnCoordinates(), <span class="comment">//TODO</span>
                                                         <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#afcab85a6c5a4f8aa70a65ecabaa78180">getBitsPerDigit</a>())) {
                bestKey = possibleKeys[i];
                bestpos = i;
            }
        }
        <span class="comment">//std::cout &lt;&lt; neighborCache-&gt;getOwnEuclidianDistanceToKey(bestKey) &lt;&lt; &quot;\n&quot; &lt;&lt; std::endl;</span>
        orderedKeys.push_back(bestKey);
        possibleKeys.erase(possibleKeys.begin()+bestpos);
    }

    <span class="comment">/*</span>
<span class="comment">    std::cout &lt;&lt; &quot;NodeID: &quot; &lt;&lt; overlay-&gt;getThisNode().getKey().toString(16) &lt;&lt; std::endl;</span>
<span class="comment">    std::cout &lt;&lt; &quot;Original Key: &quot; &lt;&lt; originalKey.toString(16) &lt;&lt; std::endl;</span>
<span class="comment">    for (int i = 0; i &lt; orderedKeys.size(); i++) {</span>
<span class="comment">        std::cout &lt;&lt; &quot;Sorted Key &quot; &lt;&lt; i &lt;&lt; &quot;: &quot; &lt;&lt; orderedKeys[i].toString(16) &lt;&lt; &quot; (&quot; &lt;&lt; overlay-&gt;getOwnEuclidianDistanceToKey(orderedKeys[i]) &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;</span>
<span class="comment">    }</span>
<span class="comment">    */</span>

    <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> searchKey = orderedKeys[teamnum];

<span class="preprocessor">#define DIRECT_ROUTE_GET</span>
<span class="preprocessor"></span><span class="preprocessor">#ifndef DIRECT_ROUTE_GET</span>
<span class="preprocessor"></span>
    <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>* replicaMsg = <span class="keyword">new</span> <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>();
    replicaMsg-&gt;<a class="code" href="classLookupCall.html#ac9cfcf7fe5298270b6b3898b65541a4b">setKey</a>(searchKey);
    replicaMsg-&gt;<a class="code" href="classLookupCall.html#a1a365b8c947e000203e7fdc144715c2b">setNumSiblings</a>(floor(<a class="code" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a> / numReplicaTeams));
    <span class="keywordtype">int</span> nonce = <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, replicaMsg);
    <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.insert(make_pair(nonce, capiGetMsg));
    <a class="code" href="classCBRDHT.html#adb365160b104ebad6a6d67718f242484">lastGetCall</a> = SIMTIME_DBL(simTime());

<span class="preprocessor">#else</span>
<span class="preprocessor"></span>
    GetMapEntry mapEntry;
    mapEntry.numSent = 0;

    <span class="comment">// Multi team version: Already mapEntry from earlier team?</span>
    std::map&lt;int, GetMapEntry&gt;::iterator it2 =
        <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.find(capiGetMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());

    <span class="keywordflow">if</span> (it2 != <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.end()) {
        mapEntry = it2-&gt;second;
    } <span class="keywordflow">else</span> {
        mapEntry.teamNumber = 0;
    }
    mapEntry.numAvailableReplica = 1;<span class="comment">//lookupMsg-&gt;getSiblingsArraySize();</span>
    mapEntry.numResponses = 0;
    mapEntry.callMsg = capiGetMsg;
    mapEntry.hashVector = NULL;
    mapEntry.replica.clear();
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 1<span class="comment">/*lookupMsg-&gt;getSiblingsArraySize()*/</span>; i++) {
        <span class="comment">// Simplified GET Request: Just one real request, rest is for fallback</span>
        <span class="keywordflow">if</span> (i == 0) {
            <a class="code" href="classCBRDHTGetCall.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetCall</a>* dhtMsg = <span class="keyword">new</span> <a class="code" href="classCBRDHTGetCall.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetCall</a>();

            dhtMsg-&gt;<a class="code" href="classCBRDHTGetCall.html#ae95efe175723c5c2ee8a3b7c394f7728">setOriginalKey</a>(capiGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#af9440c7e23e999225e8a8aacd4865596">getKey</a>());
            dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(searchKey);<span class="comment">//lookupMsg-&gt;getKey());</span>

            dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">false</span>);
            dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a1f1372d79e99d1b20a5b3e5bddecefba">setKind</a>(capiGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#a5333f4532795e8875d3155ceedc9e6fc">getKind</a>());
            dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#af169c73b1cd80f669a2f20aace5e8ed0">setId</a>(capiGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#a72be7487934870799d455d3f45b183bc">getId</a>());
            dhtMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(dhtMsg));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a>++;
            <a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a> += dhtMsg-&gt;getByteLength());

            <span class="comment">/*int nonce = */</span><a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, searchKey, dhtMsg,
                                         NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1, 0,
                                         capiGetMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());

            <span class="comment">//rpcIdMap.insert(make_pair(nonce, capiGetMsg));</span>
            <span class="comment">//sendRouteRpcCall(TIER1_COMP, lookupMsg-&gt;getSiblings(i), dhtMsg,</span>
            <span class="comment">//                 NULL, DEFAULT_ROUTING, -1, 0,</span>
            <span class="comment">//                 capiGetMsg-&gt;getNonce());</span>
            mapEntry.numSent++;
        } <span class="keywordflow">else</span> {
            <span class="comment">//We don&#39;t send, we just store the remaining keys as fallback</span>
            <span class="comment">//mapEntry.replica.push_back(lookupMsg-&gt;getSiblings(i));</span>
        }
    }
    <span class="comment">/*</span>
<span class="comment">                std::cout &lt;&lt; &quot;New replica: &quot; &lt;&lt;  std::endl;</span>
<span class="comment">                for (int i = 0; i &lt; mapEntry.replica.size(); i++) {</span>
<span class="comment">                    std::cout &lt;&lt; mapEntry.replica[i] &lt;&lt; std::endl;</span>
<span class="comment">                }</span>
<span class="comment">                std::cout &lt;&lt; &quot;*************************&quot; &lt;&lt; std::endl;</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (it2 != <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.end())
        <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.erase(it2);
    <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.insert(make_pair(capiGetMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>(), mapEntry));
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="ace52565c0b61f5e025241087255c5c68"></a><!-- doxytag: member="CBRDHT::handleGetRequest" ref="ace52565c0b61f5e025241087255c5c68" args="(CBRDHTGetCall *dhtMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handleGetRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCBRDHTGetCall.html">CBRDHTGetCall</a> *&#160;</td>
          <td class="paramname"><em>dhtMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00336">336</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::string tempString = <span class="stringliteral">&quot;GET_REQUEST received: &quot;</span>
            + std::string(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16));

    getParentModule()-&gt;getParentModule()-&gt;bubble(tempString.c_str());

    <a class="code" href="classBinaryValue.html">BinaryValue</a> storedValue;
    <a class="code" href="structDhtDataEntry.html">DhtDataEntry</a>* dataEntry = <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a59ed0b3b3970dbf1057636f4c7cb2c17" title="Returns a pointer to the requested stored data item.">getDataEntry</a>(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>(), 1, 1);
    <span class="keywordflow">if</span> (dataEntry) {
        storedValue = <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a59ed0b3b3970dbf1057636f4c7cb2c17" title="Returns a pointer to the requested stored data item.">getDataEntry</a>(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>(), 1, 1)-&gt;value;
    } <span class="keywordflow">else</span> {
        storedValue = <a class="code" href="classBinaryValue.html#a895c82622c044fbc70da7c18e3ce87b9">BinaryValue::UNSPECIFIED_VALUE</a>;
    }

    <span class="comment">// send back</span>
    <a class="code" href="classCBRDHTGetResponse.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetResponse</a>* responseMsg = <span class="keyword">new</span> <a class="code" href="classCBRDHTGetResponse.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetResponse</a>();

    responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#aee599fbcfde0d48bd33c3d05c3691311">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>());
    responseMsg-&gt;<a class="code" href="classCBRDHTGetResponse.html#acc687ad067d68c0f2c0f5b7e51a704af">setOriginalKey</a>(dhtMsg-&gt;<a class="code" href="classCBRDHTGetCall.html#a375fb6c80868635ae43835a1488baa33">getOriginalKey</a>());
    responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#a5b5e75da024693e50e01f6947e39f44d">setIsHash</a>(<span class="keyword">false</span>);
    <span class="keywordflow">if</span> (storedValue.<a class="code" href="classBinaryValue.html#aec4715605a0c0cc5bf2081dadb8abaa6">isUnspecified</a>()) {
        <span class="comment">//responseMsg-&gt;setValue(BinaryValue::UNSPECIFIED_VALUE);</span>
        <a class="code" href="classDhtDumpEntry.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DhtDumpEntry</a> result;
        result.<a class="code" href="classDhtDumpEntry.html#a05c7cf256b17d3736505ab9c67b6f45a">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>());
        result.<a class="code" href="classDhtDumpEntry.html#a2683c4e8c0b12acfd3cb342c6f0e0412">setValue</a>(<a class="code" href="classBinaryValue.html#a895c82622c044fbc70da7c18e3ce87b9">BinaryValue::UNSPECIFIED_VALUE</a>);
        responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#ad2917319ae1b35ef9ba01959a544278e">setResultArraySize</a>(1);
        responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#a1fd72ab9b816511ddc04852a98f440ea">setResult</a>(0, result);
    } <span class="keywordflow">else</span> {
        <span class="comment">//responseMsg-&gt;setValue(storedValue);</span>
        <a class="code" href="classDhtDumpEntry.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DhtDumpEntry</a> result;
        result.<a class="code" href="classDhtDumpEntry.html#a05c7cf256b17d3736505ab9c67b6f45a">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>());
        result.<a class="code" href="classDhtDumpEntry.html#a2683c4e8c0b12acfd3cb342c6f0e0412">setValue</a>(storedValue);
        responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#ad2917319ae1b35ef9ba01959a544278e">setResultArraySize</a>(1);
        responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#a1fd72ab9b816511ddc04852a98f440ea">setResult</a>(0, result);
    }
    <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.insert(make_pair(dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>(), (<a class="code" href="classBaseCallMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">BaseCallMessage</a>*)NULL));

    responseMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#a4d1e9bd925aefbe37e7efbc528004a78">GETRESPONSE_L</a>(responseMsg));
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a>++;
                 <a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a> += responseMsg-&gt;getByteLength());
    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(dhtMsg, responseMsg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aef96e24cd11666913a54d122b60bb749"></a><!-- doxytag: member="CBRDHT::handleGetResponse" ref="aef96e24cd11666913a54d122b60bb749" args="(CBRDHTGetResponse *dhtMsg, int rpcId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handleGetResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCBRDHTGetResponse.html">CBRDHTGetResponse</a> *&#160;</td>
          <td class="paramname"><em>dhtMsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00591">591</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::map&lt;int, GetMapEntry&gt;::iterator it2 =
            <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.find(rpcId);

    <span class="comment">//unknown request</span>
    <span class="keywordflow">if</span> (it2 == <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.end()) {
        std::cout &lt;&lt; <span class="stringliteral">&quot;- 1 -&quot;</span> &lt;&lt; std::endl;
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (!dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#aca5249d6e9d6701d4c33ac69abff0775">getIsHash</a>()) {
        <span class="comment">//std::cout &lt;&lt; &quot;[&quot; &lt;&lt; overlay-&gt;getThisNode().getIp() &lt;&lt; &quot;] &quot; &lt;&lt; &quot;Received an answer! Sending up key &quot; &lt;&lt; dhtMsg-&gt;getKey().toString(16) &lt;&lt; &quot;(orig: &quot; &lt;&lt; dhtMsg-&gt;getOriginalKey().toString(16) &lt;&lt; &quot;) -- value &quot; &lt;&lt; dhtMsg-&gt;getHashValue() &lt;&lt; std::endl;</span>
        <span class="comment">//std::cout &lt;&lt; &quot;Replica left: &quot; &lt;&lt; it2-&gt;second.replica.size() &lt;&lt; std::endl;</span>

        <span class="keywordflow">if</span> (dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a41a43da2058b0dba9eebfa42f89b9b8f">getHashValue</a>().size() &gt; 0 || dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a81808e33769d67b6ae7e6d99ae77d87f">getResultArraySize</a>() &gt; 0) {
            <span class="comment">// Successful Lookup, received a value</span>
            <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
            <span class="comment">//capiGetRespMsg-&gt;setKey(dhtMsg-&gt;getOriginalKey());</span>
            <span class="comment">//capiGetRespMsg-&gt;setValue(dhtMsg-&gt;getHashValue());</span>
            <a class="code" href="classDhtDumpEntry.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DhtDumpEntry</a> result;
            result.<a class="code" href="classDhtDumpEntry.html#a05c7cf256b17d3736505ab9c67b6f45a">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a37506a19478fa27760f4e4b5a8869101">getKey</a>());
            result.<a class="code" href="classDhtDumpEntry.html#a2683c4e8c0b12acfd3cb342c6f0e0412">setValue</a>(dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a96e395ff8f99931e27815f6d6c33ce00">getResult</a>(0).<a class="code" href="classDhtDumpEntry.html#a690fe434ac3281d8e31670fb944e1771">getValue</a>());<span class="comment">//getHashValue());</span>
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#a4c40ba014acb1bc5a2f4cdfca0893159">setResultArraySize</a>(1);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#aa3180b2feb0fba62d21832932d7dd03d">setResult</a>(0, result);

            <span class="comment">//std::cout &lt;&lt; &quot;[&quot; &lt;&lt; overlay-&gt;getThisNode().getIp() &lt;&lt; &quot;] &quot; &lt;&lt; &quot;SUCCESSFUL LOOKUP! Sending up key &quot; &lt;&lt; dhtMsg-&gt;getKey().toString(16) &lt;&lt; &quot;(orig: &quot; &lt;&lt; dhtMsg-&gt;getOriginalKey().toString(16) &lt;&lt; &quot;) -- value &quot; &lt;&lt; dhtMsg-&gt;getHashValue() &lt;&lt; std::endl;</span>

            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#ab11c85724ad974880150524aa8ecd777">setIsSuccess</a>(<span class="keyword">true</span>);
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it2-&gt;second.callMsg, capiGetRespMsg);
            <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.erase(rpcId);
            <span class="keywordflow">return</span>;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it2-&gt;second.replica.size() &gt; 0) {
            <span class="comment">// Received empty value, try fallback replica</span>
            <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> fallbackReplica = it2-&gt;second.replica.back();

            std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot;] &quot;</span> &lt;&lt; <span class="stringliteral">&quot;Empty value received. Asking replica now (&quot;</span>&lt;&lt; it2-&gt;second.replica.size()&lt;&lt;<span class="stringliteral">&quot; left)!&quot;</span> &lt;&lt; std::endl;

            <a class="code" href="classCBRDHTGetCall.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetCall</a>* dhtRecall = <span class="keyword">new</span> <a class="code" href="classCBRDHTGetCall.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetCall</a>();
            dhtRecall-&gt;<a class="code" href="classCBRDHTGetCall.html#ae95efe175723c5c2ee8a3b7c394f7728">setOriginalKey</a>(dhtMsg-&gt;<a class="code" href="classCBRDHTGetResponse.html#a5ec812850aec035e4b6172730fc2b927">getOriginalKey</a>());
            dhtRecall-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a37506a19478fa27760f4e4b5a8869101">getKey</a>());
            dhtRecall-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">false</span>);
            dhtRecall-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(dhtRecall));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a>++;
            <a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a> += dhtRecall-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, fallbackReplica, dhtRecall,
                             NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1, 0,
                             it2-&gt;second.callMsg-&gt;getNonce());
            it2-&gt;second.numSent++;
            it2-&gt;second.replica.pop_back();
            <span class="keywordflow">return</span>;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it2-&gt;second.teamNumber &lt; (<a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a> - 1)) {
            <span class="comment">// No more fallback replica in this team, try next one</span>

            std::cout &lt;&lt; <span class="stringliteral">&quot;it2-&gt;second.teamNumber (&quot;</span> &lt;&lt; it2-&gt;second.teamNumber &lt;&lt; <span class="stringliteral">&quot;) &lt; (numReplicaTeams - 1) (&quot;</span> &lt;&lt; (<a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a> - 1) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;
            std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot;] &quot;</span> &lt;&lt; <span class="stringliteral">&quot;No more fallback replica in this team &quot;</span>&lt;&lt; it2-&gt;second.teamNumber&lt;&lt;<span class="stringliteral">&quot;. Trying next one (&quot;</span>&lt;&lt; it2-&gt;second.teamNumber+1 &lt;&lt;  <span class="stringliteral">&quot;)...&quot;</span> &lt;&lt; std::endl;

            it2-&gt;second.teamNumber++;
            <a class="code" href="classCBRDHT.html#a3978bfc13875b74884480df035955f2f">handleGetCAPIRequest</a>(it2-&gt;second.callMsg, it2-&gt;second.teamNumber);
            <span class="keywordflow">return</span>;
        } <span class="keywordflow">else</span> {
            <span class="comment">// No more replica, no more teams, send success == false to Tier 2 :(</span>

            std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot;] &quot;</span> &lt;&lt; <span class="stringliteral">&quot;No more fallback replica. Lookup failed. :(&quot;</span> &lt;&lt; std::endl;

            <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
            <span class="comment">//capiGetRespMsg-&gt;setKey(dhtMsg-&gt;getOriginalKey());</span>
            <span class="comment">//capiGetRespMsg-&gt;setValue(BinaryValue::UNSPECIFIED_VALUE);</span>
            <a class="code" href="classDhtDumpEntry.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DhtDumpEntry</a> result;
            result.<a class="code" href="classDhtDumpEntry.html#a05c7cf256b17d3736505ab9c67b6f45a">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a37506a19478fa27760f4e4b5a8869101">getKey</a>());
            result.<a class="code" href="classDhtDumpEntry.html#a2683c4e8c0b12acfd3cb342c6f0e0412">setValue</a>(<a class="code" href="classBinaryValue.html#a895c82622c044fbc70da7c18e3ce87b9">BinaryValue::UNSPECIFIED_VALUE</a>);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#a4c40ba014acb1bc5a2f4cdfca0893159">setResultArraySize</a>(1);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#aa3180b2feb0fba62d21832932d7dd03d">setResult</a>(0, result);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#ab11c85724ad974880150524aa8ecd777">setIsSuccess</a>(<span class="keyword">false</span>);
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it2-&gt;second.callMsg, capiGetRespMsg);
            <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.erase(rpcId);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8955c8fd6280759931edc227d2519b88"></a><!-- doxytag: member="CBRDHT::handleLookupResponse" ref="a8955c8fd6280759931edc227d2519b88" args="(LookupResponse *lookupMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handleLookupResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classLookupResponse.html">LookupResponse</a> *&#160;</td>
          <td class="paramname"><em>lookupMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00740">740</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
        std::map&lt;unsigned int, BaseCallMessage*&gt;::iterator it =
            <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.find(lookupMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());

    <span class="keywordflow">if</span> (it == <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.end() || it-&gt;second == NULL)
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (dynamic_cast&lt;DHTputCAPICall*&gt; (it-&gt;second)) {

<span class="preprocessor">        #if 0</span>
<span class="preprocessor"></span>        cout &lt;&lt; <span class="stringliteral">&quot;DHT::handleLookupResponse(): PUT &quot;</span>
             &lt;&lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span>
             &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>(); i++) {
            cout &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i) &lt;&lt; endl;
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        <a class="code" href="classDHTputCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPICall</a>* capiPutMsg = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classDHTputCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPICall</a>*<span class="keyword">&gt;</span> (it-&gt;second);
        <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.erase(lookupMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());


        <span class="keywordflow">if</span> ((lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a86a9d5fd7849c18b989f2e5260cfbf12">getIsValid</a>() == <span class="keyword">false</span>)
                || (lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>() == 0)) {

            EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleLookupResponse()]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Unable to get replica list : invalid lookup&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>* capiPutRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>();
            capiPutRespMsg-&gt;<a class="code" href="classDHTputCAPIResponse.html#a2ad17ddcf6ecc8a47d5a8e3b7083cbce">setIsSuccess</a>(<span class="keyword">false</span>);
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(capiPutMsg, capiPutRespMsg);
            <span class="keywordflow">return</span>;
        }

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>(); i++) {
            <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>* dhtMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>();
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#abccc8395b7208b7ac33ba1f03f78ddfe">setKey</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a83ea3738377de538517b65e7d5dfed19">getKey</a>());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aaf331ce0bc75e6f4bdd9a4f0453f44ed">setValue</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#ab53d76fa1d8b9af3e2b82e3e3a56281c">getValue</a>());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a627e5cb4626dd10d21b4e9ab6e044ec1">setKind</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a545bd7efb240e1b7349c72d4f0eb8bfc">getKind</a>());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a265b86acab1f9dfb5038e30b0f6f72d7">setId</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a9d236d38e8d0840c112718431ae96e16">getId</a>());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#ad477378656a109b12f08cda5d9ac59c1">setTtl</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#afcc32543d842cb93216aa8abd4921d6c">getTtl</a>());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a4a7d0ab79090ca61a4afac26dd74b10d">setIsModifiable</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#aa16546137e52c1d43a0dceafb8ce39a5">getIsModifiable</a>());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a37f2793eb1f6d4a666a79cbeef8e26ed">setMaintenance</a>(<span class="keyword">false</span>);
            dhtMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#add3d32552f5e0954f907fc1ece9d476d">PUTCALL_L</a>(dhtMsg));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a>++;
                         <a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a> += dhtMsg-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i),
                             dhtMsg, NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1,
                             0, capiPutMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());
        }

        PutMapEntry mapEntry;
        mapEntry.callMsg = capiPutMsg;
        mapEntry.numResponses = 0;
        mapEntry.numFailed = 0;
        mapEntry.numSent = lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>();

        <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.insert(make_pair(capiPutMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>(), mapEntry));
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;DHTgetCAPICall*&gt;(it-&gt;second)) {

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>        cout &lt;&lt; <span class="stringliteral">&quot;DHT::handleLookupResponse(): GET &quot;</span>
             &lt;&lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span>
             &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>(); i++) {
            cout &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i) &lt;&lt; endl;
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        <a class="code" href="classDHTgetCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPICall</a>* capiGetMsg = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classDHTgetCAPICall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPICall</a>*<span class="keyword">&gt;</span>(it-&gt;second);
        <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.erase(lookupMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());

        <span class="comment">// Invalid lookup</span>
        <span class="keywordflow">if</span> ((lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a86a9d5fd7849c18b989f2e5260cfbf12">getIsValid</a>() == <span class="keyword">false</span>)
                || (lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>() == 0)) {

            EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleLookupResponse()]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Unable to get replica list : invalid lookup&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
            <span class="comment">//capiGetRespMsg-&gt;setKey(lookupMsg-&gt;getKey());</span>
            <span class="comment">//capiGetRespMsg-&gt;setValue(BinaryValue::UNSPECIFIED_VALUE);</span>
            <a class="code" href="classDhtDumpEntry.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DhtDumpEntry</a> result;
            result.<a class="code" href="classDhtDumpEntry.html#a05c7cf256b17d3736505ab9c67b6f45a">setKey</a>(lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>());
            result.<a class="code" href="classDhtDumpEntry.html#a2683c4e8c0b12acfd3cb342c6f0e0412">setValue</a>(<a class="code" href="classBinaryValue.html#a895c82622c044fbc70da7c18e3ce87b9">BinaryValue::UNSPECIFIED_VALUE</a>);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#a4c40ba014acb1bc5a2f4cdfca0893159">setResultArraySize</a>(1);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#aa3180b2feb0fba62d21832932d7dd03d">setResult</a>(0, result);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#ab11c85724ad974880150524aa8ecd777">setIsSuccess</a>(<span class="keyword">false</span>);
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(capiGetMsg, capiGetRespMsg);
            <span class="keywordflow">return</span>;
        }

        <span class="comment">// Valid lookup</span>
        GetMapEntry mapEntry;
        mapEntry.numSent = 0;

        <span class="comment">// Multi team version: Already mapEntry from earlier team?</span>

        std::map&lt;int, GetMapEntry&gt;::iterator it2 =
            <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.find(capiGetMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());

        <span class="keywordflow">if</span> (it2 != <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.end()) {
            mapEntry = it2-&gt;second;
        } <span class="keywordflow">else</span> {
            mapEntry.teamNumber = 0;
        }
        mapEntry.numAvailableReplica = lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>();
        mapEntry.numResponses = 0;
        mapEntry.callMsg = capiGetMsg;
        mapEntry.hashVector = NULL;
        mapEntry.replica.clear();
        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>(); i++) {
            <span class="comment">// Simplified GET Request: Just one real request, rest is for fallback</span>
            <span class="keywordflow">if</span> (i == 0) {
                <a class="code" href="classCBRDHTGetCall.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetCall</a>* dhtMsg = <span class="keyword">new</span> <a class="code" href="classCBRDHTGetCall.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetCall</a>();

                dhtMsg-&gt;<a class="code" href="classCBRDHTGetCall.html#ae95efe175723c5c2ee8a3b7c394f7728">setOriginalKey</a>(capiGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#af9440c7e23e999225e8a8aacd4865596">getKey</a>());
                dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>());

                dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">false</span>);
                dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a1f1372d79e99d1b20a5b3e5bddecefba">setKind</a>(capiGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#a5333f4532795e8875d3155ceedc9e6fc">getKind</a>());
                dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#af169c73b1cd80f669a2f20aace5e8ed0">setId</a>(capiGetMsg-&gt;<a class="code" href="classDHTgetCAPICall.html#a72be7487934870799d455d3f45b183bc">getId</a>());
                dhtMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(dhtMsg));
                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a>++;
                numBytesNormal += dhtMsg-&gt;getByteLength());
                <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i), dhtMsg,
                                 NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1, 0,
                                 capiGetMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());
                mapEntry.numSent++;
            } <span class="keywordflow">else</span> {
                <span class="comment">//We don&#39;t send, we just store the remaining keys as fallback</span>
                mapEntry.replica.push_back(lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i));
            }
        }
        <span class="comment">/*</span>
<span class="comment">            std::cout &lt;&lt; &quot;New replica: &quot; &lt;&lt;  std::endl;</span>
<span class="comment">            for (int i = 0; i &lt; mapEntry.replica.size(); i++) {</span>
<span class="comment">                std::cout &lt;&lt; mapEntry.replica[i] &lt;&lt; std::endl;</span>
<span class="comment">            }</span>
<span class="comment">            std::cout &lt;&lt; &quot;*************************&quot; &lt;&lt; std::endl;</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (it2 != <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.end())
            <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.erase(it2);
        <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.insert(make_pair(capiGetMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>(), mapEntry));
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;DHTPutCall*&gt;(it-&gt;second)) {
        <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>* putMsg = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>*<span class="keyword">&gt;</span>(it-&gt;second);
        <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.erase(lookupMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());

        <span class="keywordflow">if</span> ((lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a86a9d5fd7849c18b989f2e5260cfbf12">getIsValid</a>() == <span class="keyword">false</span>)
            || (lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>() == 0)) {

            EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleLookupResponse()]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Unable to get replica list : invalid lookup&quot;</span>
               &lt;&lt; endl;
            <span class="keyword">delete</span> putMsg;
            <span class="keywordflow">return</span>;
        }

        <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>(); i++ ) {
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ab3afabd3f65d272ec42d6ebe97e40fb3">maintenanceMessages</a>++;
                         <a class="code" href="classCBRDHT.html#a1ebe642d98fa1807657b437083db4677">numBytesMaintenance</a> += putMsg-&gt;getByteLength());

            <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i),
                             <span class="keyword">new</span> <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>(*putMsg));
        }

        <span class="keyword">delete</span> putMsg;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="af525e8ee6e3b2feaa06cd4ac50df0c13"></a><!-- doxytag: member="CBRDHT::handlePutCAPIRequest" ref="af525e8ee6e3b2feaa06cd4ac50df0c13" args="(DHTputCAPICall *capiPutMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handlePutCAPIRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTputCAPICall.html">DHTputCAPICall</a> *&#160;</td>
          <td class="paramname"><em>capiPutMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00380">380</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// provide copies of this message for other teams</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; <a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a>; i++) {
        <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>* teamCopyPutMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>; <span class="comment">//TODO memleak</span>

        <span class="comment">// transfer attributes of original DHTputCAPICall to DHTPutCall for teams</span>
        teamCopyPutMsg-&gt;<a class="code" href="classDHTPutCall.html#aaf331ce0bc75e6f4bdd9a4f0453f44ed">setValue</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#ab53d76fa1d8b9af3e2b82e3e3a56281c">getValue</a>());
        teamCopyPutMsg-&gt;<a class="code" href="classDHTPutCall.html#ad477378656a109b12f08cda5d9ac59c1">setTtl</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#afcc32543d842cb93216aa8abd4921d6c">getTtl</a>());
        teamCopyPutMsg-&gt;<a class="code" href="classDHTPutCall.html#a4a7d0ab79090ca61a4afac26dd74b10d">setIsModifiable</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#aa16546137e52c1d43a0dceafb8ce39a5">getIsModifiable</a>());
        teamCopyPutMsg-&gt;<a class="code" href="classDHTPutCall.html#a627e5cb4626dd10d21b4e9ab6e044ec1">setKind</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a545bd7efb240e1b7349c72d4f0eb8bfc">getKind</a>());
        teamCopyPutMsg-&gt;<a class="code" href="classDHTPutCall.html#a265b86acab1f9dfb5038e30b0f6f72d7">setId</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a9d236d38e8d0840c112718431ae96e16">getId</a>());

        <span class="comment">// control info needs to be copied by value</span>
        <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a> controlInfo = *(check_and_cast&lt;<a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*&gt;(capiPutMsg-&gt;getControlInfo()));
        <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>* controlInfoCopy = <span class="keyword">new</span> <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>;
        *controlInfoCopy = controlInfo;
        teamCopyPutMsg-&gt;setControlInfo(controlInfoCopy);

        <span class="comment">// multiple SHA1 hashing of original key</span>
        <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> destKey = capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a83ea3738377de538517b65e7d5dfed19">getKey</a>();
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; i; j++) {
            destKey = <a class="code" href="classOverlayKey.html#abbd73571f97d27468c417c9b3f91f175" title="Returns a key with the SHA1 cryptographic hash of a BinaryValue.">OverlayKey::sha1</a>(<a class="code" href="classBinaryValue.html">BinaryValue</a>(destKey.<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16).c_str()));
        }
        teamCopyPutMsg-&gt;<a class="code" href="classDHTPutCall.html#abccc8395b7208b7ac33ba1f03f78ddfe">setKey</a>(destKey);

        <span class="comment">// rest is analog to handlePutCAPIRequest, but for DHTPutCall</span>
        <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>* replicaMsg = <span class="keyword">new</span> <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>();
        replicaMsg-&gt;<a class="code" href="classLookupCall.html#ac9cfcf7fe5298270b6b3898b65541a4b">setKey</a>(teamCopyPutMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>());
        replicaMsg-&gt;<a class="code" href="classLookupCall.html#a1a365b8c947e000203e7fdc144715c2b">setNumSiblings</a>(floor(<a class="code" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a> / numReplicaTeams));
        <span class="keywordtype">int</span> nonce = <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, replicaMsg);
        <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.insert(make_pair(nonce, teamCopyPutMsg));
    }

    <span class="comment">//asks the replica list</span>
    <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>* replicaMsg = <span class="keyword">new</span> <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>();
    replicaMsg-&gt;<a class="code" href="classLookupCall.html#ac9cfcf7fe5298270b6b3898b65541a4b">setKey</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a83ea3738377de538517b65e7d5dfed19">getKey</a>());
    replicaMsg-&gt;<a class="code" href="classLookupCall.html#a1a365b8c947e000203e7fdc144715c2b">setNumSiblings</a>(floor(<a class="code" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a> / numReplicaTeams));
    <span class="keywordtype">int</span> nonce = <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, replicaMsg);
    <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.insert(make_pair(nonce, capiPutMsg));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a48f879f883e47696e35aa272e0e1eeaa"></a><!-- doxytag: member="CBRDHT::handlePutRequest" ref="a48f879f883e47696e35aa272e0e1eeaa" args="(DHTPutCall *dhtMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handlePutRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTPutCall.html">DHTPutCall</a> *&#160;</td>
          <td class="paramname"><em>dhtMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00279">279</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::string tempString = <span class="stringliteral">&quot;PUT_REQUEST received: &quot;</span>
            + std::string(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16));
    getParentModule()-&gt;getParentModule()-&gt;bubble(tempString.c_str());

    <span class="keywordflow">if</span> (!(<a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a4ddcc8ac2516fc7db403fd4a27069a75" title="Returns a boolean telling if this data if modifiable.">isModifiable</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(),
                                    dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>()))) {
        <span class="comment">//check if the put request came from the right node</span>
        <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> sourceNode = <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#aa99008f59fd5b3beb8f2cfccfaf54fc3" title="Returns the source node of a stored data item with a given key.">getSourceNode</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(),
                                                           dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>());
        <span class="keywordflow">if</span> (((!sourceNode.<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>())
                &amp;&amp; (!dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>().<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>()) &amp;&amp; (sourceNode
                != dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>())) || ((dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a813b96e27699123d6f50fd20b4973248">getMaintenance</a>())
                &amp;&amp; (dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#af5825ceb2c816c26f4f9e0f66db298bd">getOwnerNode</a>() == sourceNode))) {
            <span class="comment">// TODO: set owner</span>
            <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>* responseMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>();
            responseMsg-&gt;<a class="code" href="classDHTPutResponse.html#a39abc13f444f85a12feff708a91edf09">setSuccess</a>(<span class="keyword">false</span>);
            responseMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#a845afd31387cf944fd8f6c173b69507f">PUTRESPONSE_L</a>(responseMsg));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a>++;
                         <a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a> += responseMsg-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(dhtMsg, responseMsg);
            <span class="keywordflow">return</span>;
        }

    }

    <span class="comment">// remove data item from local data storage</span>
    <span class="comment">//cancelAndDelete(dataStorage-&gt;getTtlMessage(dhtMsg-&gt;getKey()));</span>
    <span class="comment">//dataStorage-&gt;removeData(dhtMsg-&gt;getKey());</span>
    <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#af64b6e6563f5934443182986ab7b9f63" title="Removes a certain data item from the map.">removeData</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(),
                                dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>());
    <span class="keywordflow">if</span> (dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a07c6946f5546b7b64c4df52374bba55c">getValue</a>().size() &gt; 0) {
        <span class="comment">// add ttl timer</span>
        <a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a> *timerMsg = <span class="keyword">new</span> <a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a>(<span class="stringliteral">&quot;ttl_timer&quot;</span>);
        timerMsg-&gt;<a class="code" href="classDHTTtlTimer.html#abd0c245f818e4a67033275d5058d9fed">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>());
        scheduleAt(simTime() + dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#ad33da3c1f52a586e4175e407e5f98fc7">getTtl</a>(), timerMsg);
        <span class="comment">// storage data item in local data storage</span>
        <span class="keywordtype">bool</span> err;
        <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a1fab63fa3bb75248a4118fdbb50c95f5" title="Store a new data item in the map.">addData</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(),
                             dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a07c6946f5546b7b64c4df52374bba55c">getValue</a>(), timerMsg,
                             dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a96a50b9f789b3834b2d2cf97b488658d">getIsModifiable</a>(), dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(),
                             <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#ab5887b89ba9da5973068e834feb69ce7" title="Query if a node is among the siblings for a given key.">isSiblingFor</a>(<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>(),
                                                   dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(),
                                                   1, &amp;err));
    }

    <span class="comment">// send back</span>
    <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>* responseMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>();

    responseMsg-&gt;<a class="code" href="classDHTPutResponse.html#a39abc13f444f85a12feff708a91edf09">setSuccess</a>(<span class="keyword">true</span>);
    responseMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#a845afd31387cf944fd8f6c173b69507f">PUTRESPONSE_L</a>(responseMsg));
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a>++; <a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a> += responseMsg-&gt;getByteLength());

    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(dhtMsg, responseMsg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af1ddb52cc46f8cb27d059f05953f9653"></a><!-- doxytag: member="CBRDHT::handlePutResponse" ref="af1ddb52cc46f8cb27d059f05953f9653" args="(DHTPutResponse *dhtMsg, int rpcId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handlePutResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTPutResponse.html">DHTPutResponse</a> *&#160;</td>
          <td class="paramname"><em>dhtMsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00568">568</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::map&lt;int, PutMapEntry&gt;::iterator it2 =
            <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.find(rpcId);

    <span class="keywordflow">if</span> (it2 == <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.end()) <span class="comment">//unknown request</span>
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (dhtMsg-&gt;<a class="code" href="classDHTPutResponse.html#a81b52a68e7782d7a9a7417b59e922afd">getSuccess</a>()) {
        it2-&gt;second.numResponses++;
    } <span class="keywordflow">else</span> {
        it2-&gt;second.numFailed++;
    }

    <span class="keywordflow">if</span> (it2-&gt;second.numResponses / (<span class="keywordtype">double</span>)it2-&gt;second.numSent &gt; 0.5) {
        <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>* capiPutRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>();
        capiPutRespMsg-&gt;<a class="code" href="classDHTputCAPIResponse.html#a2ad17ddcf6ecc8a47d5a8e3b7083cbce">setIsSuccess</a>(<span class="keyword">true</span>);
        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it2-&gt;second.callMsg, capiPutRespMsg);
        it2-&gt;second.callMsg = NULL;
        <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.erase(rpcId);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a23a206659056d25bc06bdb6a4655fc6a"></a><!-- doxytag: member="CBRDHT::handleRpcCall" ref="a23a206659056d25bc06bdb6a4655fc6a" args="(BaseCallMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CBRDHT::handleRpcCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes Remote-Procedure-Call invocation messages. </p>
<p><br/>
</p>
<p>This method should be overloaded when the overlay provides RPC functionality.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if rpc has been handled </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseRpc.html#a20e77c3e0c203762a5b582ffebe3ba4b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00148">148</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// delegate messages</span>
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>( msg )
        <span class="comment">// RPC_DELEGATE( &lt;messageName&gt;[Call|Response], &lt;methodToCall&gt; )</span>
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( DHTPut, <a class="code" href="classCBRDHT.html#a48f879f883e47696e35aa272e0e1eeaa">handlePutRequest</a> );
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( CBRDHTGet, <a class="code" href="classCBRDHT.html#ace52565c0b61f5e025241087255c5c68">handleGetRequest</a> );
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( DHTputCAPI, <a class="code" href="classCBRDHT.html#af525e8ee6e3b2feaa06cd4ac50df0c13">handlePutCAPIRequest</a> ); <span class="comment">//requests coming from an upper tier</span>
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( DHTgetCAPI, <a class="code" href="classCBRDHT.html#a3978bfc13875b74884480df035955f2f">handleGetCAPIRequest</a> );
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( DHTdump, <a class="code" href="classCBRDHT.html#a6b38aa6bfccdc46db10052aad003819b">handleDumpDhtRequest</a> );
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( )

    return <a class="code" href="RpcMacros_8h.html#aa5e964b7c7129c0943237a786e455e9a">RPC_HANDLED</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1d9992ca6b273d28c05bc70f6d108cf0"></a><!-- doxytag: member="CBRDHT::handleRpcResponse" ref="a1d9992ca6b273d28c05bc70f6d108cf0" args="(BaseResponseMessage *msg, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handleRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC response has been received. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The response message. </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classCBRDHT.html#a1d9992ca6b273d28c05bc70f6d108cf0" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">rtt</td><td>The Round-Trip-Time of this RPC </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#a6229090a446fb649cfec3c1fb61e7167">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00163">163</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
        <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(DHTPut){
        <a class="code" href="classCBRDHT.html#af1ddb52cc46f8cb27d059f05953f9653">handlePutResponse</a>(_DHTPutResponse, rpcId);
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHT Put RPC Response received: id=&quot;</span> &lt;&lt; rpcId
           &lt;&lt; <span class="stringliteral">&quot; msg=&quot;</span> &lt;&lt; *_DHTPutResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(CBRDHTGet) {
        <a class="code" href="classCBRDHT.html#aef96e24cd11666913a54d122b60bb749">handleGetResponse</a>(_CBRDHTGetResponse, rpcId);
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHT Get RPC Response received: id=&quot;</span> &lt;&lt; rpcId
           &lt;&lt; <span class="stringliteral">&quot; msg=&quot;</span> &lt;&lt; *_CBRDHTGetResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(<a class="code" href="classLookup.html">Lookup</a>) {
        <a class="code" href="classCBRDHT.html#a8955c8fd6280759931edc227d2519b88">handleLookupResponse</a>(_LookupResponse);
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Replica Set RPC Response received: id=&quot;</span> &lt;&lt; rpcId
           &lt;&lt; <span class="stringliteral">&quot; msg=&quot;</span> &lt;&lt; *_LookupResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()
}
</pre></div>
</div>
</div>
<a class="anchor" id="a02c24b6ada58e1d0d690459b5e56e729"></a><!-- doxytag: member="CBRDHT::handleRpcTimeout" ref="a02c24b6ada58e1d0d690459b5e56e729" args="(BaseCallMessage *msg, const TransportAddress &amp;dest, cPolymorphic *context, int rpcId, const OverlayKey &amp;destKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handleRpcTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>destKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC timeout has been reached. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The original RPC message. </td></tr>
    <tr><td class="paramname">dest</td><td>The destination node </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classCBRDHT.html#a1d9992ca6b273d28c05bc70f6d108cf0" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">destKey</td><td>the destination <a class="el" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#aaaf9cd362481527ed995dd159aa96b73">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00194">194</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(DHTPut){
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHTPut Timeout&quot;</span>
           &lt;&lt; endl;

        std::map&lt;int, PutMapEntry&gt;::iterator it2 =
                <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.find(rpcId);

        <span class="keywordflow">if</span> (it2 == <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.end()) <span class="comment">//unknown request</span>
            <span class="keywordflow">return</span>;

        it2-&gt;second.numFailed++;

        <span class="keywordflow">if</span> (it2-&gt;second.numFailed / (<span class="keywordtype">double</span>)it2-&gt;second.numSent &gt;= 0.5) {
            <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>* capiPutRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>();
            capiPutRespMsg-&gt;<a class="code" href="classDHTputCAPIResponse.html#a2ad17ddcf6ecc8a47d5a8e3b7083cbce">setIsSuccess</a>(<span class="keyword">false</span>);
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it2-&gt;second.callMsg, capiPutRespMsg);
            it2-&gt;second.callMsg = NULL;
            <a class="code" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">putMap</a>.erase(rpcId);
        }
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(CBRDHTGet) {
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHTGet Timeout&quot;</span>
           &lt;&lt; endl;

        std::map&lt;int, GetMapEntry&gt;::iterator it2 =
            <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.find(rpcId);

        <span class="keywordflow">if</span> (it2 == <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.end()) <span class="comment">//unknown request</span>
            <span class="keywordflow">return</span>;

        <span class="keywordflow">if</span> (it2-&gt;second.replica.size() &gt; 0) {
            <span class="comment">// Received empty value, try fallback replica</span>
            <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> fallbackReplica = it2-&gt;second.replica.back();
            <a class="code" href="classCBRDHTGetCall.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetCall</a>* dhtRecall = <span class="keyword">new</span> <a class="code" href="classCBRDHTGetCall.html" title="Class generated from common/cbr/CBR-DHTMessage.msg by opp_msgc.">CBRDHTGetCall</a>();
            dhtRecall-&gt;<a class="code" href="classCBRDHTGetCall.html#ae95efe175723c5c2ee8a3b7c394f7728">setOriginalKey</a>(_CBRDHTGetCall-&gt;getOriginalKey());
            dhtRecall-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(_CBRDHTGetCall-&gt;getKey());
            dhtRecall-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">false</span>);
            dhtRecall-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(dhtRecall));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a>++;
            <a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a> += dhtRecall-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, fallbackReplica, dhtRecall,
                             NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1, 0,
                             it2-&gt;second.callMsg-&gt;getNonce());
            it2-&gt;second.numSent++;
            it2-&gt;second.replica.pop_back();
            <span class="keywordflow">return</span>;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it2-&gt;second.teamNumber &lt; (<a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a> - 1)) {
            <span class="comment">// No more fallback replica in this team, try next one</span>
            it2-&gt;second.teamNumber++;
            <a class="code" href="classCBRDHT.html#a3978bfc13875b74884480df035955f2f">handleGetCAPIRequest</a>(it2-&gt;second.callMsg, it2-&gt;second.teamNumber);
            <span class="keywordflow">return</span>;
        } <span class="keywordflow">else</span> {
            <span class="comment">// No more replica, no more teams, send success == false to Tier 2 :(</span>
            <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
            <span class="comment">//capiGetRespMsg-&gt;setKey(_CBRDHTGetCall-&gt;getOriginalKey());</span>
            <span class="comment">//capiGetRespMsg-&gt;setValue(BinaryValue::UNSPECIFIED_VALUE);</span>
            <a class="code" href="classDhtDumpEntry.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DhtDumpEntry</a> result;
            result.<a class="code" href="classDhtDumpEntry.html#a05c7cf256b17d3736505ab9c67b6f45a">setKey</a>(_CBRDHTGetCall-&gt;getKey());
            result.<a class="code" href="classDhtDumpEntry.html#a2683c4e8c0b12acfd3cb342c6f0e0412">setValue</a>(<a class="code" href="classBinaryValue.html#a895c82622c044fbc70da7c18e3ce87b9">BinaryValue::UNSPECIFIED_VALUE</a>);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#a4c40ba014acb1bc5a2f4cdfca0893159">setResultArraySize</a>(1);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#aa3180b2feb0fba62d21832932d7dd03d">setResult</a>(0, result);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#ab11c85724ad974880150524aa8ecd777">setIsSuccess</a>(<span class="keyword">false</span>);
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it2-&gt;second.callMsg, capiGetRespMsg);
            <a class="code" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">getMap</a>.erase(rpcId);
        }
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( )
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9687f217efef7be22f63f89eb98316c9"></a><!-- doxytag: member="CBRDHT::handleTimerEvent" ref="a9687f217efef7be22f63f89eb98316c9" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ab893c156412e38caa62fe058b229899b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00114">114</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a>* msg_timer = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a>*<span class="keyword">&gt;</span> (msg);

    <span class="keywordflow">if</span> (msg_timer) {
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleTimerEvent()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    received timer ttl, key: &quot;</span>
           &lt;&lt; msg_timer-&gt;<a class="code" href="classDHTTtlTimer.html#a15eb83bf8f2e1def81c28b4f9d212982">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16)
           &lt;&lt; <span class="stringliteral">&quot;\n (overlay-&gt;getThisNode().key = &quot;</span>
           &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>
           &lt;&lt; endl;

        <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#af64b6e6563f5934443182986ab7b9f63" title="Removes a certain data item from the map.">removeData</a>(msg_timer-&gt;<a class="code" href="classDHTTtlTimer.html#a15eb83bf8f2e1def81c28b4f9d212982">getKey</a>(), msg_timer-&gt;<a class="code" href="classDHTTtlTimer.html#a67f6b49b590a2a011a8eaa12e6d6bcb3">getKind</a>(),
                                msg_timer-&gt;<a class="code" href="classDHTTtlTimer.html#a4661d8eee16ade14ab082f12e7336c3d">getId</a>());
        <span class="comment">//delete msg_timer;</span>
    }
    <span class="comment">/*DHTTtlTimer* msg_timer;</span>
<span class="comment"></span>
<span class="comment">    if (msg-&gt;isName(&quot;ttl_timer&quot;)) {</span>
<span class="comment">        msg_timer = check_and_cast&lt;DHTTtlTimer*&gt; (msg);</span>
<span class="comment"></span>
<span class="comment">        EV &lt;&lt; &quot;[DHT::handleTimerEvent()]\n&quot;</span>
<span class="comment">           &lt;&lt; &quot;    received timer ttl, key: &quot;</span>
<span class="comment">           &lt;&lt; msg_timer-&gt;getKey().toString(16)</span>
<span class="comment">           &lt;&lt; &quot;\n (overlay-&gt;getThisNode().key = &quot;</span>
<span class="comment">           &lt;&lt; overlay-&gt;getThisNode().getKey().toString(16) &lt;&lt; &quot;)&quot;</span>
<span class="comment">           &lt;&lt; endl;</span>
<span class="comment"></span>
<span class="comment">        dataStorage-&gt;removeData(msg_timer-&gt;getKey(), msg_timer-&gt;getKind(),</span>
<span class="comment">                                msg_timer-&gt;getId());</span>
<span class="comment">        delete msg_timer;</span>
<span class="comment">    }*/</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5ec14534f25aa85c1b720d511e8329cd"></a><!-- doxytag: member="CBRDHT::handleUpperMessage" ref="a5ec14534f25aa85c1b720d511e8329cd" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::handleUpperMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handleUpperMessage gets called of <a class="el" href="classBaseApp.html#a98800700e14545cd84636ca4413f605a" title="checks for message type and calls corresponding method">handleMessage(cMessage* msg)</a> if msg arrivedOn from_upperTier (currently msg gets deleted in this function) </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>the message to handle </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a621d25b1cb1f6aac033860fe8c1dcc80">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00272">272</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">error</a>(<span class="stringliteral">&quot;DHT::handleUpperMessage(): Received message with unknown type!&quot;</span>);

    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a55759c7002f6f347c9a331f475e714f6"></a><!-- doxytag: member="CBRDHT::initializeApp" ref="a55759c7002f6f347c9a331f475e714f6" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::initializeApp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initializes derived class-attributes </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#ac9a059a2cfb67f4c38f462bb1383e795">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00078">78</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordflow">if</span> (stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532ad9afa81d0184c5f0649fa111f7a821bc" title="deprecated">MIN_STAGE_APP</a>)
        <span class="keywordflow">return</span>;

    <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a> = check_and_cast&lt;<a class="code" href="classDHTDataStorage.html">DHTDataStorage</a>*&gt;
                      (getParentModule()-&gt;getSubmodule(<span class="stringliteral">&quot;dhtDataStorage&quot;</span>));

    <a class="code" href="classCBRDHT.html#a55a40d5b1e807a5238049e0b9331ece3">coordBasedRouting</a> = <a class="code" href="classCoordBasedRoutingAccess.html" title="Gives access to the CoordBasedRouting.">CoordBasedRoutingAccess</a>().<a class="code" href="classCoordBasedRoutingAccess.html#a52ae7545ba854d93787e15fb4f4bf0a6">get</a>();
    <a class="code" href="classCBRDHT.html#ad79c28188c6a3d9283ee8da5dcb72da4" title="pointer to the neighbor cache">neighborCache</a> = (<a class="code" href="classNeighborCache.html">NeighborCache</a>*)getParentModule()
        -&gt;getParentModule()-&gt;getSubmodule(<span class="stringliteral">&quot;neighborCache&quot;</span>);

    <a class="code" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a> = par(<span class="stringliteral">&quot;numReplica&quot;</span>);
    <a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a> = par(<span class="stringliteral">&quot;numReplicaTeams&quot;</span>);

    <span class="keywordflow">if</span> (<a class="code" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a> &gt; <a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a> * <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#acd3058ad15b470e024500dd4872e2f09" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>()) {
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;DHT::initialize(): numReplica bigger than what this &quot;</span>
                <span class="stringliteral">&quot;overlay can handle (%d)&quot;</span>, <a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a>*<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#acd3058ad15b470e024500dd4872e2f09" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>());
    }

    <span class="keywordflow">if</span> (<a class="code" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a> &lt; <a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a>) {
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;DHT::initialize(): numReplica (%d) smaller than numReplicaTeam (%d)&quot;</span>,
                            <a class="code" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a>, <a class="code" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">numReplicaTeams</a>);
    }

    <a class="code" href="classCBRDHT.html#ab3afabd3f65d272ec42d6ebe97e40fb3">maintenanceMessages</a> = 0;
    <a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a> = 0;
    <a class="code" href="classCBRDHT.html#a1ebe642d98fa1807657b437083db4677">numBytesMaintenance</a> = 0;
    <a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a> = 0;
    WATCH(<a class="code" href="classCBRDHT.html#ab3afabd3f65d272ec42d6ebe97e40fb3">maintenanceMessages</a>);
    WATCH(<a class="code" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">normalMessages</a>);
    WATCH(<a class="code" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">numBytesNormal</a>);
    WATCH(<a class="code" href="classCBRDHT.html#a1ebe642d98fa1807657b437083db4677">numBytesMaintenance</a>);
    WATCH_MAP(<a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7facbd76bcd1a944cc416be139091a6d"></a><!-- doxytag: member="CBRDHT::resultValuesBitLength" ref="a7facbd76bcd1a944cc416be139091a6d" args="(DHTGetResponse *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CBRDHT::resultValuesBitLength </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTGetResponse.html">DHTGetResponse</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00931">931</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                     {
    <span class="keywordtype">int</span> bitSize = 0;
    <span class="keywordflow">for</span> (uint i = 0; i &lt; msg-&gt;<a class="code" href="classDHTGetResponse.html#a81808e33769d67b6ae7e6d99ae77d87f">getResultArraySize</a>(); i++) {
        bitSize += msg-&gt;<a class="code" href="classDHTGetResponse.html#a96e395ff8f99931e27815f6d6c33ce00">getResult</a>(i).<a class="code" href="classDhtDumpEntry.html#a690fe434ac3281d8e31670fb944e1771">getValue</a>().size();

    }
    <span class="keywordflow">return</span> bitSize;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a603c05617bd2a6c629b5f36c2721af21"></a><!-- doxytag: member="CBRDHT::update" ref="a603c05617bd2a6c629b5f36c2721af21" args="(const NodeHandle &amp;node, bool joined)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CBRDHT::update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>joined</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Common API function: informs application about neighbors and own nodeID. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>new or lost neighbor </td></tr>
    <tr><td class="paramname">joined</td><td>new or lost? </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a129d228137df46b04c8b3272b6a32fcc">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="CBR-DHT_8cc_source.html#l00671">671</a> of file <a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> key;
    <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>* dhtMsg;
    <span class="keywordtype">bool</span> err = <span class="keyword">false</span>;
    <span class="comment">//DHTData entry;</span>
    <a class="code" href="structDhtDataEntry.html">DhtDataEntry</a> entry;
    <span class="comment">//std::map&lt;OverlayKey, DHTData&gt;::iterator it = dataStorage-&gt;begin();</span>
    DhtDataMap::iterator it = <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a9a5546debdaa4522c63b0b7e0a92545a" title="Returns an iterator to the beginning of the map.">begin</a>();
    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#aa1cdb30a1524923e95af88540f84d00e" title="Returns number of stored data items in the map.">getSize</a>(); i++) {
        key = it-&gt;first;
        entry = it-&gt;second;
        <span class="keywordflow">if</span> (joined) {
            <span class="keywordflow">if</span> (entry.<a class="code" href="structDhtDataEntry.html#a6fb8dca58f59421a7c02e830d42b7e6f">responsible</a> &amp;&amp; (<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#ab5887b89ba9da5973068e834feb69ce7" title="Query if a node is among the siblings for a given key.">isSiblingFor</a>(node, key,
                                                            <a class="code" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a>, &amp;err)
                    || err)) { <span class="comment">// hack for Chord, if we&#39;ve got a new predecessor</span>

                dhtMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>();
                dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#abccc8395b7208b7ac33ba1f03f78ddfe">setKey</a>(key);
                dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aaf331ce0bc75e6f4bdd9a4f0453f44ed">setValue</a>(entry.<a class="code" href="structDhtDataEntry.html#abffbe314f97ae10a9ca461e18102d618">value</a>);
                dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a627e5cb4626dd10d21b4e9ab6e044ec1">setKind</a>(entry.<a class="code" href="structDhtDataEntry.html#a6f3be99f7b0cdcd215a4ccb813e9f703">kind</a>);
                dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a265b86acab1f9dfb5038e30b0f6f72d7">setId</a>(entry.<a class="code" href="structDhtDataEntry.html#af40de9c1b7d6b4e1136ca6f2b9144a14">id</a>);

                <span class="comment">//dhtMsg-&gt;setTtl((int) (entry.ttlMessage-&gt;arrivalTime()</span>
                <span class="comment">//        - simTime()));</span>
                dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#ad477378656a109b12f08cda5d9ac59c1">setTtl</a>((<span class="keywordtype">int</span>)SIMTIME_DBL(entry.<a class="code" href="structDhtDataEntry.html#af91eb3436a52ad0c6f424047113beee9">ttlMessage</a>-&gt;getArrivalTime()
                                                - simTime()));
                dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a4a7d0ab79090ca61a4afac26dd74b10d">setIsModifiable</a>(entry.<a class="code" href="structDhtDataEntry.html#a67c185200bbf51575e08bb8f5f646d42">is_modifiable</a>);
                dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a37f2793eb1f6d4a666a79cbeef8e26ed">setMaintenance</a>(<span class="keyword">true</span>);
                dhtMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#add3d32552f5e0954f907fc1ece9d476d">PUTCALL_L</a>(dhtMsg));
                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classCBRDHT.html#ab3afabd3f65d272ec42d6ebe97e40fb3">maintenanceMessages</a>++;
                        <a class="code" href="classCBRDHT.html#a1ebe642d98fa1807657b437083db4677">numBytesMaintenance</a> += dhtMsg-&gt;getByteLength());
                <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, node, dhtMsg);
            }

            <span class="keywordflow">if</span> (err) {
                EV &lt;&lt; <span class="stringliteral">&quot;[DHT::update()]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    Unable to know if key: &quot;</span> &lt;&lt; key
                   &lt;&lt; <span class="stringliteral">&quot; is in range of node: &quot;</span> &lt;&lt; node
                   &lt;&lt; endl;
            }
        } <span class="keywordflow">else</span> {
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>            <span class="comment">//the update concerns a node who has left</span>
            <span class="comment">//replicate</span>
            <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>* replicaMsg = <span class="keyword">new</span> <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>();
            replicaMsg-&gt;<a class="code" href="classLookupCall.html#ac9cfcf7fe5298270b6b3898b65541a4b">setKey</a>(key);
            replicaMsg-&gt;<a class="code" href="classLookupCall.html#a1a365b8c947e000203e7fdc144715c2b">setNumSiblings</a>(<a class="code" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">numReplica</a>);
            <span class="keywordtype">int</span> nonce = <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>,
                                            replicaMsg);
            dhtMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>();
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#abccc8395b7208b7ac33ba1f03f78ddfe">setKey</a>(key);
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aaf331ce0bc75e6f4bdd9a4f0453f44ed">setValue</a>(entry.<a class="code" href="structDhtDataEntry.html#abffbe314f97ae10a9ca461e18102d618">value</a>);
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#ad477378656a109b12f08cda5d9ac59c1">setTtl</a>((<span class="keywordtype">int</span>)(entry.<a class="code" href="structDhtDataEntry.html#af91eb3436a52ad0c6f424047113beee9">ttlMessage</a>-&gt;arrivalTime()
                    - simulation.simTime()));
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a4a7d0ab79090ca61a4afac26dd74b10d">setIsModifiable</a>(entry.<a class="code" href="structDhtDataEntry.html#a67c185200bbf51575e08bb8f5f646d42">is_modifiable</a>);
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a37f2793eb1f6d4a666a79cbeef8e26ed">setMaintenance</a>(<span class="keyword">true</span>);
            dhtMsg-&gt;setLength(<a class="code" href="DHTMessage__m_8h.html#add3d32552f5e0954f907fc1ece9d476d">PUTCALL_L</a>(dhtMsg));

            <a class="code" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4" title="List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member...">rpcIdMap</a>.insert(make_pair(nonce, dhtMsg));
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }

        entry.<a class="code" href="structDhtDataEntry.html#a6fb8dca58f59421a7c02e830d42b7e6f">responsible</a> = <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#ab5887b89ba9da5973068e834feb69ce7" title="Query if a node is among the siblings for a given key.">isSiblingFor</a>(<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>(),
                                                  key, 1, &amp;err);
        it++;
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a55a40d5b1e807a5238049e0b9331ece3"></a><!-- doxytag: member="CBRDHT::coordBasedRouting" ref="a55a40d5b1e807a5238049e0b9331ece3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classCoordBasedRouting.html">CoordBasedRouting</a>* <a class="el" href="classCBRDHT.html#a55a40d5b1e807a5238049e0b9331ece3">CBRDHT::coordBasedRouting</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00116">116</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad0576bc5a424d7c491c7d061ce9759fc"></a><!-- doxytag: member="CBRDHT::dataStorage" ref="ad0576bc5a424d7c491c7d061ce9759fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDHTDataStorage.html">DHTDataStorage</a>* <a class="el" href="classCBRDHT.html#ad0576bc5a424d7c491c7d061ce9759fc">CBRDHT::dataStorage</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>pointer to the dht data storage </p>

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00115">115</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6df5127a51b0bc161ddb5bcb6f6dfd42"></a><!-- doxytag: member="CBRDHT::getMap" ref="a6df5127a51b0bc161ddb5bcb6f6dfd42" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;int, <a class="el" href="structCBRDHT_1_1GetMapEntry.html">GetMapEntry</a>&gt; <a class="el" href="classCBRDHT.html#a6df5127a51b0bc161ddb5bcb6f6dfd42">CBRDHT::getMap</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00111">111</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="adb365160b104ebad6a6d67718f242484"></a><!-- doxytag: member="CBRDHT::lastGetCall" ref="adb365160b104ebad6a6d67718f242484" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classCBRDHT.html#adb365160b104ebad6a6d67718f242484">CBRDHT::lastGetCall</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00109">109</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab3afabd3f65d272ec42d6ebe97e40fb3"></a><!-- doxytag: member="CBRDHT::maintenanceMessages" ref="ab3afabd3f65d272ec42d6ebe97e40fb3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classCBRDHT.html#ab3afabd3f65d272ec42d6ebe97e40fb3">CBRDHT::maintenanceMessages</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00105">105</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad79c28188c6a3d9283ee8da5dcb72da4"></a><!-- doxytag: member="CBRDHT::neighborCache" ref="ad79c28188c6a3d9283ee8da5dcb72da4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classNeighborCache.html">NeighborCache</a>* <a class="el" href="classCBRDHT.html#ad79c28188c6a3d9283ee8da5dcb72da4">CBRDHT::neighborCache</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>pointer to the neighbor cache </p>

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ad80237130dc2316d0d76ac6757c50f4f">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00117">117</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae2ced50524806f31a4b9bbee332fe317"></a><!-- doxytag: member="CBRDHT::normalMessages" ref="ae2ced50524806f31a4b9bbee332fe317" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classCBRDHT.html#ae2ced50524806f31a4b9bbee332fe317">CBRDHT::normalMessages</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00106">106</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1ebe642d98fa1807657b437083db4677"></a><!-- doxytag: member="CBRDHT::numBytesMaintenance" ref="a1ebe642d98fa1807657b437083db4677" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classCBRDHT.html#a1ebe642d98fa1807657b437083db4677">CBRDHT::numBytesMaintenance</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00107">107</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5f04c1260b356b18e4349bee77c7d4d9"></a><!-- doxytag: member="CBRDHT::numBytesNormal" ref="a5f04c1260b356b18e4349bee77c7d4d9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classCBRDHT.html#a5f04c1260b356b18e4349bee77c7d4d9">CBRDHT::numBytesNormal</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00108">108</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9f14db944d947d95cb6912be653c36d6"></a><!-- doxytag: member="CBRDHT::numReplica" ref="a9f14db944d947d95cb6912be653c36d6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classCBRDHT.html#a9f14db944d947d95cb6912be653c36d6">CBRDHT::numReplica</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00102">102</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a002095b5f33d56bf265080b246793b72"></a><!-- doxytag: member="CBRDHT::numReplicaTeams" ref="a002095b5f33d56bf265080b246793b72" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="classCBRDHT.html#a002095b5f33d56bf265080b246793b72">CBRDHT::numReplicaTeams</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00103">103</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a249022025a87a901f2ad33af2af44497"></a><!-- doxytag: member="CBRDHT::putMap" ref="a249022025a87a901f2ad33af2af44497" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;int, <a class="el" href="structCBRDHT_1_1PutMapEntry.html">PutMapEntry</a>&gt; <a class="el" href="classCBRDHT.html#a249022025a87a901f2ad33af2af44497">CBRDHT::putMap</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00112">112</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="aca3294a891258cca91a66aab04f73ad4"></a><!-- doxytag: member="CBRDHT::rpcIdMap" ref="aca3294a891258cca91a66aab04f73ad4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;unsigned int, <a class="el" href="classBaseCallMessage.html">BaseCallMessage</a>*&gt; <a class="el" href="classCBRDHT.html#aca3294a891258cca91a66aab04f73ad4">CBRDHT::rpcIdMap</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>List of the Rpc Ids of the messages sent following the reception of an rpc request (the second member) </p>

<p>Definition at line <a class="el" href="CBR-DHT_8h_source.html#l00110">110</a> of file <a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="CBR-DHT_8h_source.html">CBR-DHT.h</a></li>
<li><a class="el" href="CBR-DHT_8cc_source.html">CBR-DHT.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classCBRDHT.html">CBRDHT</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:42 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
