<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: XmlRpcServer.cc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('XmlRpcServer_8cc.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">XmlRpcServer.cc</div>  </div>
</div>
<div class="contents">
<a href="XmlRpcServer_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="XmlRpcServer_8h.html">XmlRpcServer.h</a>&quot;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="XmlRpcServerConnection_8h.html">XmlRpcServerConnection.h</a>&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="XmlRpcServerMethod_8h.html">XmlRpcServerMethod.h</a>&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="XmlRpcSocket_8h.html">XmlRpcSocket.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="XmlRpcUtil_8h.html">XmlRpcUtil.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="XmlRpcException_8h.html">XmlRpcException.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="XmlRpc_8h.html">XmlRpc.h</a>&quot;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="keyword">using namespace </span>XmlRpc;
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="comment">// Static data</span>
<a name="l00020"></a>00020 <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a5bf03fd86a729904e3361293a61e9cfb">XmlRpcServer::METHODNAME_TAG</a>[] = <span class="stringliteral">&quot;&lt;methodName&gt;&quot;</span>;
<a name="l00021"></a>00021 <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#aa47ed2b6fc713508d4f8045295eff34e">XmlRpcServer::PARAMS_TAG</a>[] = <span class="stringliteral">&quot;&lt;params&gt;&quot;</span>;
<a name="l00022"></a>00022 <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a16e93fe9e0a0f53379b082659b036c51">XmlRpcServer::PARAMS_ETAG</a>[] = <span class="stringliteral">&quot;&lt;/params&gt;&quot;</span>;
<a name="l00023"></a>00023 <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a795675c72586fdbd60bebfc84081b5d8">XmlRpcServer::PARAM_TAG</a>[] = <span class="stringliteral">&quot;&lt;param&gt;&quot;</span>;
<a name="l00024"></a>00024 <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a5fc8a668f1d9766815b00707b7449d4a">XmlRpcServer::PARAM_ETAG</a>[] = <span class="stringliteral">&quot;&lt;/param&gt;&quot;</span>;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">const</span> std::string <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#afa08aee751ae2b966a07eee6c3dc21d7">XmlRpcServer::METHODNAME</a> = <span class="stringliteral">&quot;methodName&quot;</span>;
<a name="l00027"></a>00027 <span class="keyword">const</span> std::string <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a52a0786fc89f8dfba149af64dcd1e816">XmlRpcServer::PARAMS</a> = <span class="stringliteral">&quot;params&quot;</span>;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">const</span> std::string <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ac21fb7ebd2c3b98aec3985fbb2c501fa">XmlRpcServer::FAULTCODE</a> = <span class="stringliteral">&quot;faultCode&quot;</span>;
<a name="l00030"></a>00030 <span class="keyword">const</span> std::string <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a6a206e59932cbf60268bbafb5be3b8c3">XmlRpcServer::FAULTSTRING</a> = <span class="stringliteral">&quot;faultString&quot;</span>;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a60e9792221dc8c2142e62d1be8d925b2">00034</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a60e9792221dc8c2142e62d1be8d925b2" title="Create a server object.">XmlRpcServer::XmlRpcServer</a>()
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a8df2d59929398dfd25dd9e19c909a468" title="Whether the introspection API is supported by this server.">_introspectionEnabled</a> = <span class="keyword">false</span>;
<a name="l00037"></a>00037   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a3a2920cfb521b18948ce2b311d6fff7d" title="List all registered RPC methods (only available if introspection is enabled)">_listMethods</a> = 0;
<a name="l00038"></a>00038   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a80f4e13155f51ab6d76cdd75dc598a45" title="Return help string for a specified method (only available if introspection is enabled)">_methodHelp</a> = 0;
<a name="l00039"></a>00039 }
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#aae1a21a97ffaa6172f54a2cbf2b67fae">00042</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#aae1a21a97ffaa6172f54a2cbf2b67fae" title="Destructor.">XmlRpcServer::~XmlRpcServer</a>()
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044   this-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1efc6113f5b9d3d4faede2aa19c62452" title="Close all connections with clients and the socket file descriptor.">shutdown</a>();
<a name="l00045"></a>00045   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.clear();
<a name="l00046"></a>00046   <span class="keyword">delete</span> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a3a2920cfb521b18948ce2b311d6fff7d" title="List all registered RPC methods (only available if introspection is enabled)">_listMethods</a>;
<a name="l00047"></a>00047   <span class="keyword">delete</span> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a80f4e13155f51ab6d76cdd75dc598a45" title="Return help string for a specified method (only available if introspection is enabled)">_methodHelp</a>;
<a name="l00048"></a>00048 }
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="comment">// Add a command to the RPC server</span>
<a name="l00052"></a>00052 <span class="keywordtype">void</span> 
<a name="l00053"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a95e71b6ee1c2b7756d3d71fed9c661e3">00053</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a95e71b6ee1c2b7756d3d71fed9c661e3" title="Add a command to the RPC server.">XmlRpcServer::addMethod</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html" title="Abstract class representing a single RPC method.">XmlRpcServerMethod</a>* method)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>[method-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html#aab0409eeaf47abf10f3ff5e97b8e84cc" title="Returns the name of the method.">getName</a>()] = method;
<a name="l00056"></a>00056 }
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="comment">// Remove a command from the RPC server</span>
<a name="l00059"></a>00059 <span class="keywordtype">void</span> 
<a name="l00060"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a728cd389552fe8d18b4cdbfcee18890e">00060</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a728cd389552fe8d18b4cdbfcee18890e" title="Remove a command from the RPC server.">XmlRpcServer::removeMethod</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html" title="Abstract class representing a single RPC method.">XmlRpcServerMethod</a>* method)
<a name="l00061"></a>00061 {
<a name="l00062"></a>00062   MethodMap::iterator i = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.find(method-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html#aab0409eeaf47abf10f3ff5e97b8e84cc" title="Returns the name of the method.">getName</a>());
<a name="l00063"></a>00063   <span class="keywordflow">if</span> (i != <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.end())
<a name="l00064"></a>00064     <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.erase(i);
<a name="l00065"></a>00065 }
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">// Remove a command from the RPC server by name</span>
<a name="l00068"></a>00068 <span class="keywordtype">void</span> 
<a name="l00069"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a425e2e71f2d23b3c15a96d58acf0537f">00069</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a728cd389552fe8d18b4cdbfcee18890e" title="Remove a command from the RPC server.">XmlRpcServer::removeMethod</a>(<span class="keyword">const</span> std::string&amp; methodName)
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071   MethodMap::iterator i = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.find(methodName);
<a name="l00072"></a>00072   <span class="keywordflow">if</span> (i != <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.end())
<a name="l00073"></a>00073     <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.erase(i);
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="comment">// Look up a method by name</span>
<a name="l00078"></a>00078 <a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html" title="Abstract class representing a single RPC method.">XmlRpcServerMethod</a>* 
<a name="l00079"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a30471d5fa674f0d41f6b4f3b5f3b5e9c">00079</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a30471d5fa674f0d41f6b4f3b5f3b5e9c" title="Look up a method by name.">XmlRpcServer::findMethod</a>(<span class="keyword">const</span> std::string&amp; name)<span class="keyword"> const</span>
<a name="l00080"></a>00080 <span class="keyword"></span>{
<a name="l00081"></a>00081   MethodMap::const_iterator i = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.find(name);
<a name="l00082"></a>00082   <span class="keywordflow">if</span> (i == <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.end())
<a name="l00083"></a>00083     <span class="keywordflow">return</span> 0;
<a name="l00084"></a>00084   <span class="keywordflow">return</span> i-&gt;second;
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">// Create a socket, bind to the specified port, and</span>
<a name="l00089"></a>00089 <span class="comment">// set it in listen mode to make it available for clients.</span>
<a name="l00090"></a>00090 <span class="keywordtype">bool</span> 
<a name="l00091"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a48caf2fa417377fe53768d0909eff617">00091</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a48caf2fa417377fe53768d0909eff617" title="Create a socket, bind to the specified port, and set it in listen mode to make it available for clien...">XmlRpcServer::bindAndListen</a>(<span class="keywordtype">int</span> port, <span class="keywordtype">int</span> backlog <span class="comment">/*= 5*/</span>)
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093   <span class="keywordtype">int</span> fd = <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#a3c69282c6c7cfbdcb8afc90c178c2cf1" title="Creates a stream (TCP) socket. Returns -1 on failure.">XmlRpcSocket::getSocket</a>();
<a name="l00094"></a>00094   <span class="keywordflow">if</span> (fd &lt; 0)
<a name="l00095"></a>00095   {
<a name="l00096"></a>00096     <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">XmlRpcUtil::error</a>(<span class="stringliteral">&quot;XmlRpcServer::bindAndListen: Could not create socket (%s).&quot;</span>, <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#ae1926209b963e3e1a95a41fd25dcd43d" title="Returns message corresponding to last error.">XmlRpcSocket::getErrorMsg</a>().c_str());
<a name="l00097"></a>00097     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00098"></a>00098   }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100   this-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcSource.html#ae95e0e691dca904db429b10774757b1f" title="Specify the file descriptor to monitor.">setfd</a>(fd);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   <span class="comment">// Don&#39;t block on reads/writes</span>
<a name="l00103"></a>00103   <span class="keywordflow">if</span> ( ! <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#abc6fc4083d79a873bdeab20ae09ab549" title="Sets a stream (TCP) socket to perform non-blocking IO. Returns false on failure.">XmlRpcSocket::setNonBlocking</a>(fd))
<a name="l00104"></a>00104   {
<a name="l00105"></a>00105     this-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcSource.html#a37f25f335c37dd408b2e5f71448d59bd" title="Close the owned fd. If deleteOnClose was specified at construction, the object is deleted...">close</a>();
<a name="l00106"></a>00106     <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">XmlRpcUtil::error</a>(<span class="stringliteral">&quot;XmlRpcServer::bindAndListen: Could not set socket to non-blocking input mode (%s).&quot;</span>, <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#ae1926209b963e3e1a95a41fd25dcd43d" title="Returns message corresponding to last error.">XmlRpcSocket::getErrorMsg</a>().c_str());
<a name="l00107"></a>00107     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00108"></a>00108   }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   <span class="comment">// Allow this port to be re-bound immediately so server re-starts are not delayed</span>
<a name="l00111"></a>00111   <span class="keywordflow">if</span> ( ! <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#a8a98b18862a7b79e82ee608484a1a460" title="Allow the port the specified socket is bound to to be re-bound immediately so server re-starts are no...">XmlRpcSocket::setReuseAddr</a>(fd))
<a name="l00112"></a>00112   {
<a name="l00113"></a>00113     this-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcSource.html#a37f25f335c37dd408b2e5f71448d59bd" title="Close the owned fd. If deleteOnClose was specified at construction, the object is deleted...">close</a>();
<a name="l00114"></a>00114     <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">XmlRpcUtil::error</a>(<span class="stringliteral">&quot;XmlRpcServer::bindAndListen: Could not set SO_REUSEADDR socket option (%s).&quot;</span>, <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#ae1926209b963e3e1a95a41fd25dcd43d" title="Returns message corresponding to last error.">XmlRpcSocket::getErrorMsg</a>().c_str());
<a name="l00115"></a>00115     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00116"></a>00116   }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <span class="comment">// Bind to the specified port on the default interface</span>
<a name="l00119"></a>00119   <span class="keywordflow">if</span> ( ! <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#ad7bcf641b1e2e5857ee3b7f57439b959" title="Bind to a specified port.">XmlRpcSocket::bind</a>(fd, port))
<a name="l00120"></a>00120   {
<a name="l00121"></a>00121     this-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcSource.html#a37f25f335c37dd408b2e5f71448d59bd" title="Close the owned fd. If deleteOnClose was specified at construction, the object is deleted...">close</a>();
<a name="l00122"></a>00122     <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">XmlRpcUtil::error</a>(<span class="stringliteral">&quot;XmlRpcServer::bindAndListen: Could not bind to specified port (%s).&quot;</span>, <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#ae1926209b963e3e1a95a41fd25dcd43d" title="Returns message corresponding to last error.">XmlRpcSocket::getErrorMsg</a>().c_str());
<a name="l00123"></a>00123     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00124"></a>00124   }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126   <span class="comment">// Set in listening mode</span>
<a name="l00127"></a>00127   <span class="keywordflow">if</span> ( ! <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#a3fe3ac75b1d632b94f233d743cc2bed5" title="Set socket in listen mode.">XmlRpcSocket::listen</a>(fd, backlog))
<a name="l00128"></a>00128   {
<a name="l00129"></a>00129     this-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcSource.html#a37f25f335c37dd408b2e5f71448d59bd" title="Close the owned fd. If deleteOnClose was specified at construction, the object is deleted...">close</a>();
<a name="l00130"></a>00130     <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">XmlRpcUtil::error</a>(<span class="stringliteral">&quot;XmlRpcServer::bindAndListen: Could not set socket in listening mode (%s).&quot;</span>, <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#ae1926209b963e3e1a95a41fd25dcd43d" title="Returns message corresponding to last error.">XmlRpcSocket::getErrorMsg</a>().c_str());
<a name="l00131"></a>00131     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00132"></a>00132   }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#ac8423b781acbcbf90e5d4558591e7c61" title="Dump messages somewhere.">XmlRpcUtil::log</a>(2, <span class="stringliteral">&quot;XmlRpcServer::bindAndListen: server listening on port %d fd %d&quot;</span>, port, fd);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136   <span class="comment">// Notify the dispatcher to listen on this source when we are in work()</span>
<a name="l00137"></a>00137   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#af8b775cd2ed2a0838ed21686b8900bea" title="Event dispatcher.">_disp</a>.<a class="code" href="classXmlRpc_1_1XmlRpcDispatch.html#ad8b2904f9fd4ef2e22b68245db4a153f" title="Monitor this source for the event types specified by the event mask and call its event handler when a...">addSource</a>(<span class="keyword">this</span>, <a class="code" href="classXmlRpc_1_1XmlRpcDispatch.html#a4f75ac1cdd83a138699d2bbf10511d5da882cc1bb5d0f955eb07240c1cb01949f" title="data available to read">XmlRpcDispatch::ReadableEvent</a>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">// Get port number that this server is listening on</span>
<a name="l00144"></a>00144 <span class="keywordtype">int</span>
<a name="l00145"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a25e255005711a08c151e756adea77ef6">00145</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a25e255005711a08c151e756adea77ef6" title="Get the port number this server is listening on.">XmlRpcServer::getPort</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00146"></a>00146 <span class="keyword"></span>{
<a name="l00147"></a>00147   <span class="keywordflow">return</span> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a25e255005711a08c151e756adea77ef6" title="Get the port number this server is listening on.">XmlRpcSocket::getPort</a>(<a class="code" href="classXmlRpc_1_1XmlRpcSource.html#a58f7ffbcdbdc10a7102938b5cf8d6146" title="Return the file descriptor being monitored.">getfd</a>());
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="comment">// Process client requests for the specified time</span>
<a name="l00153"></a>00153 <span class="keywordtype">void</span> 
<a name="l00154"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#aa271504216a40e4a9e52e5b66165ede3">00154</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#aa271504216a40e4a9e52e5b66165ede3" title="Process client requests for the specified time.">XmlRpcServer::work</a>(<span class="keywordtype">double</span> msTime)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156   <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#ac8423b781acbcbf90e5d4558591e7c61" title="Dump messages somewhere.">XmlRpcUtil::log</a>(2, <span class="stringliteral">&quot;XmlRpcServer::work: waiting for a connection&quot;</span>);
<a name="l00157"></a>00157   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#af8b775cd2ed2a0838ed21686b8900bea" title="Event dispatcher.">_disp</a>.<a class="code" href="classXmlRpc_1_1XmlRpcDispatch.html#a51abc65ad1aa043189b7417409cad3ab" title="Watch current set of sources and process events for the specified duration (in ms, -1 implies wait forever, or until exit is called)">work</a>(msTime);
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">// Handle input on the server socket by accepting the connection</span>
<a name="l00163"></a>00163 <span class="comment">// and reading the rpc request.</span>
<a name="l00164"></a>00164 <span class="keywordtype">unsigned</span>
<a name="l00165"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a8379b211be0cfd3381f9e36e318bafc5">00165</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a8379b211be0cfd3381f9e36e318bafc5" title="Handle client connection requests.">XmlRpcServer::handleEvent</a>(<span class="keywordtype">unsigned</span> mask)
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab10270cba339177be9d8987a5d6c438c" title="Accept a client connection request.">acceptConnection</a>();
<a name="l00168"></a>00168   <span class="keywordflow">return</span> <a class="code" href="classXmlRpc_1_1XmlRpcDispatch.html#a4f75ac1cdd83a138699d2bbf10511d5da882cc1bb5d0f955eb07240c1cb01949f" title="data available to read">XmlRpcDispatch::ReadableEvent</a>;         <span class="comment">// Continue to monitor this fd</span>
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 <span class="comment">// Accept a client connection request and create a connection to</span>
<a name="l00173"></a>00173 <span class="comment">// handle method calls from the client.</span>
<a name="l00174"></a>00174 <span class="keywordtype">void</span>
<a name="l00175"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab10270cba339177be9d8987a5d6c438c">00175</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab10270cba339177be9d8987a5d6c438c" title="Accept a client connection request.">XmlRpcServer::acceptConnection</a>()
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177   <span class="keywordtype">int</span> s = <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#a653b1f5a5eb6991d69fdb405100fc170" title="Accept a client connection request.">XmlRpcSocket::accept</a>(this-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcSource.html#a58f7ffbcdbdc10a7102938b5cf8d6146" title="Return the file descriptor being monitored.">getfd</a>());
<a name="l00178"></a>00178   <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#ac8423b781acbcbf90e5d4558591e7c61" title="Dump messages somewhere.">XmlRpcUtil::log</a>(2, <span class="stringliteral">&quot;XmlRpcServer::acceptConnection: socket %d&quot;</span>, s);
<a name="l00179"></a>00179   <span class="keywordflow">if</span> (s &lt; 0)
<a name="l00180"></a>00180   {
<a name="l00181"></a>00181     <span class="comment">//this-&gt;close();</span>
<a name="l00182"></a>00182     <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">XmlRpcUtil::error</a>(<span class="stringliteral">&quot;XmlRpcServer::acceptConnection: Could not accept connection (%s).&quot;</span>, <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#ae1926209b963e3e1a95a41fd25dcd43d" title="Returns message corresponding to last error.">XmlRpcSocket::getErrorMsg</a>().c_str());
<a name="l00183"></a>00183   }
<a name="l00184"></a>00184   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#abc6fc4083d79a873bdeab20ae09ab549" title="Sets a stream (TCP) socket to perform non-blocking IO. Returns false on failure.">XmlRpcSocket::setNonBlocking</a>(s))
<a name="l00185"></a>00185   {
<a name="l00186"></a>00186     <a class="code" href="classXmlRpc_1_1XmlRpcSource.html#a37f25f335c37dd408b2e5f71448d59bd" title="Close the owned fd. If deleteOnClose was specified at construction, the object is deleted...">XmlRpcSocket::close</a>(s);
<a name="l00187"></a>00187     <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">XmlRpcUtil::error</a>(<span class="stringliteral">&quot;XmlRpcServer::acceptConnection: Could not set socket to non-blocking input mode (%s).&quot;</span>, <a class="code" href="classXmlRpc_1_1XmlRpcSocket.html#ae1926209b963e3e1a95a41fd25dcd43d" title="Returns message corresponding to last error.">XmlRpcSocket::getErrorMsg</a>().c_str());
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189   <span class="keywordflow">else</span>  <span class="comment">// Notify the dispatcher to listen for input on this source when we are in work()</span>
<a name="l00190"></a>00190   {
<a name="l00191"></a>00191     <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#ac8423b781acbcbf90e5d4558591e7c61" title="Dump messages somewhere.">XmlRpcUtil::log</a>(2, <span class="stringliteral">&quot;XmlRpcServer::acceptConnection: creating a connection&quot;</span>);
<a name="l00192"></a>00192     <a class="code" href="classXmlRpc_1_1XmlRpcServerConnection.html" title="A class to handle XML RPC requests from a particular client.">XmlRpcServerConnection</a>* c = this-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a79e86c730e6cd54ca794517cc0061b63" title="Create a new connection object for processing requests from a specific client.">createConnection</a>(s);
<a name="l00193"></a>00193     <span class="keywordflow">if</span> (c) this-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1225945af4ec688d35d5245f02819943" title="Hand off a new connection object to a dispatcher.">dispatchConnection</a>(c);
<a name="l00194"></a>00194   }
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="comment">// Create a new connection object for processing requests from a specific client.</span>
<a name="l00199"></a>00199 <a class="code" href="classXmlRpc_1_1XmlRpcServerConnection.html" title="A class to handle XML RPC requests from a particular client.">XmlRpcServerConnection</a>*
<a name="l00200"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a79e86c730e6cd54ca794517cc0061b63">00200</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a79e86c730e6cd54ca794517cc0061b63" title="Create a new connection object for processing requests from a specific client.">XmlRpcServer::createConnection</a>(<span class="keywordtype">int</span> s)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202   <span class="comment">// Specify that the connection object be deleted when it is closed</span>
<a name="l00203"></a>00203   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classXmlRpc_1_1XmlRpcServerConnection.html" title="A class to handle XML RPC requests from a particular client.">XmlRpcServerConnection</a>(s, <span class="keyword">this</span>, <span class="keyword">true</span>);
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="comment">// Hand off a new connection to a dispatcher</span>
<a name="l00208"></a>00208 <span class="keywordtype">void</span>
<a name="l00209"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1225945af4ec688d35d5245f02819943">00209</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1225945af4ec688d35d5245f02819943" title="Hand off a new connection object to a dispatcher.">XmlRpcServer::dispatchConnection</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServerConnection.html" title="A class to handle XML RPC requests from a particular client.">XmlRpcServerConnection</a>* sc)
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#af8b775cd2ed2a0838ed21686b8900bea" title="Event dispatcher.">_disp</a>.<a class="code" href="classXmlRpc_1_1XmlRpcDispatch.html#ad8b2904f9fd4ef2e22b68245db4a153f" title="Monitor this source for the event types specified by the event mask and call its event handler when a...">addSource</a>(sc, <a class="code" href="classXmlRpc_1_1XmlRpcDispatch.html#a4f75ac1cdd83a138699d2bbf10511d5da882cc1bb5d0f955eb07240c1cb01949f" title="data available to read">XmlRpcDispatch::ReadableEvent</a>);
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="comment">// Remove a connection. Called by the connection when it closes down.</span>
<a name="l00216"></a>00216 <span class="keywordtype">void</span> 
<a name="l00217"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a784922a9ac3787c05e9247269752c98c">00217</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a784922a9ac3787c05e9247269752c98c" title="Remove a connection from the dispatcher.">XmlRpcServer::removeConnection</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServerConnection.html" title="A class to handle XML RPC requests from a particular client.">XmlRpcServerConnection</a>* sc)
<a name="l00218"></a>00218 {
<a name="l00219"></a>00219   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#af8b775cd2ed2a0838ed21686b8900bea" title="Event dispatcher.">_disp</a>.<a class="code" href="classXmlRpc_1_1XmlRpcDispatch.html#a459ee4d5339a5663fbcc6a2b561ff266" title="Stop monitoring this source.">removeSource</a>(sc);
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="comment">// Stop processing client requests</span>
<a name="l00224"></a>00224 <span class="keywordtype">void</span> 
<a name="l00225"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#aef0f7b568fe456efb01a269cb30f0c3d">00225</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#aef0f7b568fe456efb01a269cb30f0c3d" title="Temporarily stop processing client requests and exit the work() method.">XmlRpcServer::exit</a>()
<a name="l00226"></a>00226 {
<a name="l00227"></a>00227   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#af8b775cd2ed2a0838ed21686b8900bea" title="Event dispatcher.">_disp</a>.<a class="code" href="classXmlRpc_1_1XmlRpcDispatch.html#a72e7cc7862e33d19fc7f71acf6d9f1cf" title="Exit from work routine.">exit</a>();
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="comment">// Close the server socket file descriptor and stop monitoring connections</span>
<a name="l00232"></a>00232 <span class="keywordtype">void</span> 
<a name="l00233"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1efc6113f5b9d3d4faede2aa19c62452">00233</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1efc6113f5b9d3d4faede2aa19c62452" title="Close all connections with clients and the socket file descriptor.">XmlRpcServer::shutdown</a>()
<a name="l00234"></a>00234 {
<a name="l00235"></a>00235   <span class="comment">// This closes and destroys all connections as well as closing this socket</span>
<a name="l00236"></a>00236   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#af8b775cd2ed2a0838ed21686b8900bea" title="Event dispatcher.">_disp</a>.<a class="code" href="classXmlRpc_1_1XmlRpcDispatch.html#ab7810fe3264a4540ff9b3f9a3c8c924b" title="Clear all sources from the monitored sources list. Sources are closed.">clear</a>();
<a name="l00237"></a>00237 }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 <span class="comment">// Introspection support</span>
<a name="l00241"></a>00241 <span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code" href="XmlRpcServer_8cc.html#a456b0f8e376882650810dab71054f1c1">LIST_METHODS</a>(<span class="stringliteral">&quot;system.listMethods&quot;</span>);
<a name="l00242"></a>00242 <span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code" href="XmlRpcServer_8cc.html#a0decc83a880176d4179ed88636082a1a">METHOD_HELP</a>(<span class="stringliteral">&quot;system.methodHelp&quot;</span>);
<a name="l00243"></a>00243 <span class="keyword">static</span> <span class="keyword">const</span> std::string <a class="code" href="XmlRpcServer_8cc.html#a9b11830d266ccec140d096e63ad8be2f">MULTICALL</a>(<span class="stringliteral">&quot;system.multicall&quot;</span>);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="comment">// List all methods available on a server</span>
<a name="l00247"></a><a class="code" href="classListMethods.html">00247</a> <span class="keyword">class </span><a class="code" href="classListMethods.html">ListMethods</a> : <span class="keyword">public</span> <a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html" title="Abstract class representing a single RPC method.">XmlRpcServerMethod</a>
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249 <span class="keyword">public</span>:
<a name="l00250"></a><a class="code" href="classListMethods.html#a915b0f8e1447f462be68aa90ad31cb63">00250</a>   <a class="code" href="classListMethods.html#a915b0f8e1447f462be68aa90ad31cb63">ListMethods</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html" title="A class to handle XML RPC requests.">XmlRpcServer</a>* s) : <a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html" title="Abstract class representing a single RPC method.">XmlRpcServerMethod</a>(<a class="code" href="XmlRpcServer_8cc.html#a456b0f8e376882650810dab71054f1c1">LIST_METHODS</a>, s) {}
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="classListMethods.html#a2315a3c1739ce9e7ffaf816112f55233">00252</a>   <span class="keywordtype">void</span> execute(<a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; params, <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; result)
<a name="l00253"></a>00253   {
<a name="l00254"></a>00254     _server-&gt;listMethods(result);
<a name="l00255"></a>00255   }
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="classListMethods.html#aa90db0d282ab90fd13d47230e21147c7">00257</a>   std::string <a class="code" href="classListMethods.html#aa90db0d282ab90fd13d47230e21147c7" title="Returns a help string for the method.">help</a>() { <span class="keywordflow">return</span> std::string(<span class="stringliteral">&quot;List all methods available on a server as an array of strings&quot;</span>); }
<a name="l00258"></a>00258 };
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="comment">// Retrieve the help string for a named method</span>
<a name="l00262"></a><a class="code" href="classMethodHelp.html">00262</a> <span class="keyword">class </span><a class="code" href="classMethodHelp.html">MethodHelp</a> : <span class="keyword">public</span> <a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html" title="Abstract class representing a single RPC method.">XmlRpcServerMethod</a>
<a name="l00263"></a>00263 {
<a name="l00264"></a>00264 <span class="keyword">public</span>:
<a name="l00265"></a><a class="code" href="classMethodHelp.html#aa8b96129f5cf175df320f1c0e78a7727">00265</a>   <a class="code" href="classMethodHelp.html#aa8b96129f5cf175df320f1c0e78a7727">MethodHelp</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html" title="A class to handle XML RPC requests.">XmlRpcServer</a>* s) : <a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html" title="Abstract class representing a single RPC method.">XmlRpcServerMethod</a>(<a class="code" href="XmlRpcServer_8cc.html#a0decc83a880176d4179ed88636082a1a">METHOD_HELP</a>, s) {}
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="classMethodHelp.html#af87a5987b71d52d06738270ece7159ae">00267</a>   <span class="keywordtype">void</span> execute(<a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; params, <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; result)
<a name="l00268"></a>00268   {
<a name="l00269"></a>00269     <span class="keywordflow">if</span> (params[0].getType() != <a class="code" href="classXmlRpc_1_1XmlRpcValue.html#a39bba28bc00ed6c271f142f3bc9d21f6a493d258493cbc67e245dedaaf61cca8c">XmlRpcValue::TypeString</a>)
<a name="l00270"></a>00270       <span class="keywordflow">throw</span> <a class="code" href="classXmlRpc_1_1XmlRpcException.html" title="A class representing an error.">XmlRpcException</a>(<a class="code" href="XmlRpcServer_8cc.html#a0decc83a880176d4179ed88636082a1a">METHOD_HELP</a> + <span class="stringliteral">&quot;: Invalid argument type&quot;</span>);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html" title="Abstract class representing a single RPC method.">XmlRpcServerMethod</a>* m = _server-&gt;findMethod(params[0]);
<a name="l00273"></a>00273     <span class="keywordflow">if</span> ( ! m)
<a name="l00274"></a>00274       <span class="keywordflow">throw</span> <a class="code" href="classXmlRpc_1_1XmlRpcException.html" title="A class representing an error.">XmlRpcException</a>(<a class="code" href="XmlRpcServer_8cc.html#a0decc83a880176d4179ed88636082a1a">METHOD_HELP</a> + <span class="stringliteral">&quot;: Unknown method name&quot;</span>);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     result = m-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html#a214a09aa8b29e24041e6bd016e3007e0" title="Returns a help string for the method.">help</a>();
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278 
<a name="l00279"></a><a class="code" href="classMethodHelp.html#aaed76173124f0924f476df7f17e485ed">00279</a>   std::string <a class="code" href="classMethodHelp.html#aaed76173124f0924f476df7f17e485ed" title="Returns a help string for the method.">help</a>() { <span class="keywordflow">return</span> std::string(<span class="stringliteral">&quot;Retrieve the help string for a named method&quot;</span>); }
<a name="l00280"></a>00280 };
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     
<a name="l00283"></a>00283 <span class="comment">// Specify whether introspection is enabled or not. Default is enabled.</span>
<a name="l00284"></a>00284 <span class="keywordtype">void</span> 
<a name="l00285"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a5d2d4bedbd35b262b2a49494176a1167">00285</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a5d2d4bedbd35b262b2a49494176a1167" title="Specify whether introspection is enabled or not. Default is not enabled.">XmlRpcServer::enableIntrospection</a>(<span class="keywordtype">bool</span> enabled)
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287   <span class="keywordflow">if</span> (<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a8df2d59929398dfd25dd9e19c909a468" title="Whether the introspection API is supported by this server.">_introspectionEnabled</a> == enabled)
<a name="l00288"></a>00288     <span class="keywordflow">return</span>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290   <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a8df2d59929398dfd25dd9e19c909a468" title="Whether the introspection API is supported by this server.">_introspectionEnabled</a> = enabled;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   <span class="keywordflow">if</span> (enabled)
<a name="l00293"></a>00293   {
<a name="l00294"></a>00294     <span class="keywordflow">if</span> ( ! <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a3a2920cfb521b18948ce2b311d6fff7d" title="List all registered RPC methods (only available if introspection is enabled)">_listMethods</a>)
<a name="l00295"></a>00295     {
<a name="l00296"></a>00296       <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a3a2920cfb521b18948ce2b311d6fff7d" title="List all registered RPC methods (only available if introspection is enabled)">_listMethods</a> = <span class="keyword">new</span> <a class="code" href="classListMethods.html">ListMethods</a>(<span class="keyword">this</span>);
<a name="l00297"></a>00297       <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a80f4e13155f51ab6d76cdd75dc598a45" title="Return help string for a specified method (only available if introspection is enabled)">_methodHelp</a> = <span class="keyword">new</span> <a class="code" href="classMethodHelp.html">MethodHelp</a>(<span class="keyword">this</span>);
<a name="l00298"></a>00298     } <span class="keywordflow">else</span> {
<a name="l00299"></a>00299       <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a95e71b6ee1c2b7756d3d71fed9c661e3" title="Add a command to the RPC server.">addMethod</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a3a2920cfb521b18948ce2b311d6fff7d" title="List all registered RPC methods (only available if introspection is enabled)">_listMethods</a>);
<a name="l00300"></a>00300       <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a95e71b6ee1c2b7756d3d71fed9c661e3" title="Add a command to the RPC server.">addMethod</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a80f4e13155f51ab6d76cdd75dc598a45" title="Return help string for a specified method (only available if introspection is enabled)">_methodHelp</a>);
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303   <span class="keywordflow">else</span>
<a name="l00304"></a>00304   {
<a name="l00305"></a>00305     <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a728cd389552fe8d18b4cdbfcee18890e" title="Remove a command from the RPC server.">removeMethod</a>(<a class="code" href="XmlRpcServer_8cc.html#a456b0f8e376882650810dab71054f1c1">LIST_METHODS</a>);
<a name="l00306"></a>00306     <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a728cd389552fe8d18b4cdbfcee18890e" title="Remove a command from the RPC server.">removeMethod</a>(<a class="code" href="XmlRpcServer_8cc.html#a0decc83a880176d4179ed88636082a1a">METHOD_HELP</a>);
<a name="l00307"></a>00307   }
<a name="l00308"></a>00308 }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 <span class="keywordtype">void</span>
<a name="l00312"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#adc2af33af2e59376454d68d23986fe15">00312</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#adc2af33af2e59376454d68d23986fe15" title="Introspection support.">XmlRpcServer::listMethods</a>(<a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; result)
<a name="l00313"></a>00313 {
<a name="l00314"></a>00314   <span class="keywordtype">int</span> i = 0;
<a name="l00315"></a>00315   result.<a class="code" href="classXmlRpc_1_1XmlRpcValue.html#af411c8368c750bd8b06801a7f0693bb0" title="Specify the size for array values. Array values will grow beyond this size if needed.">setSize</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.size()+1);
<a name="l00316"></a>00316   <span class="keywordflow">for</span> (MethodMap::iterator it=<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.begin(); it != <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ab4169ac57183b3d7ce940b61f86f1322" title="Registered RPC methods.">_methods</a>.end(); ++it)
<a name="l00317"></a>00317     result[i++] = it-&gt;first;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="comment">// Multicall support is built into XmlRpcServer::executeRequest</span>
<a name="l00320"></a>00320   result[i] = <a class="code" href="XmlRpcServer_8cc.html#a9b11830d266ccec140d096e63ad8be2f">MULTICALL</a>;
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="comment">// Parse the request, run the method, generate a response string.</span>
<a name="l00326"></a>00326 std::string
<a name="l00327"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#acc3b49e20a5e1c7e360572df0752dad0">00327</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#acc3b49e20a5e1c7e360572df0752dad0" title="Parses the request xml, runs the method, generates the response (header+xml).">XmlRpcServer::executeRequest</a>(std::string <span class="keyword">const</span>&amp; request)
<a name="l00328"></a>00328 {
<a name="l00329"></a>00329   <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a> params, resultValue;
<a name="l00330"></a>00330   std::string methodName = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ac4bf126bd24170b3f2b124957a8d8156" title="Parse the methodName and parameters from the request.">parseRequest</a>(request, params);
<a name="l00331"></a>00331   <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#ac8423b781acbcbf90e5d4558591e7c61" title="Dump messages somewhere.">XmlRpcUtil::log</a>(2, <span class="stringliteral">&quot;XmlRpcServer::executeRequest: server calling method &#39;%s&#39;&quot;</span>, 
<a name="l00332"></a>00332                     methodName.c_str());
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   std::string response;
<a name="l00335"></a>00335   <span class="keywordflow">try</span> {
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <span class="keywordflow">if</span> ( ! <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#adf1ac9a438a6a7b0b055c7002663eb9b" title="Execute a named method with the specified params.">executeMethod</a>(methodName, params, resultValue) &amp;&amp;
<a name="l00338"></a>00338          ! <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ad6e8454852336798ed6c0dfed823706c" title="Execute multiple calls and return the results in an array.">executeMulticall</a>(methodName, params, resultValue))
<a name="l00339"></a>00339       response = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a3e0bf2ab2c4fd269a7b5e03ccca79475" title="Construct a fault response.">generateFaultResponse</a>(methodName + <span class="stringliteral">&quot;: unknown method name&quot;</span>);
<a name="l00340"></a>00340     <span class="keywordflow">else</span>
<a name="l00341"></a>00341       response = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a2d44940be108a33efc45b12975593b71" title="Construct a response from the result XML.">generateResponse</a>(resultValue.<a class="code" href="classXmlRpc_1_1XmlRpcValue.html#aedae94ced3a80ff37a528861bcb2a47e" title="Encode the Value in xml.">toXml</a>());
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   } <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classXmlRpc_1_1XmlRpcException.html" title="A class representing an error.">XmlRpcException</a>&amp; fault) {
<a name="l00344"></a>00344     <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#ac8423b781acbcbf90e5d4558591e7c61" title="Dump messages somewhere.">XmlRpcUtil::log</a>(2, <span class="stringliteral">&quot;XmlRpcServer::executeRequest: fault %s.&quot;</span>,
<a name="l00345"></a>00345                     fault.<a class="code" href="classXmlRpc_1_1XmlRpcException.html#a8b847167289592dc8417d35a7d464739" title="Return the error message.">getMessage</a>().c_str()); 
<a name="l00346"></a>00346     response = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a3e0bf2ab2c4fd269a7b5e03ccca79475" title="Construct a fault response.">generateFaultResponse</a>(fault.<a class="code" href="classXmlRpc_1_1XmlRpcException.html#a8b847167289592dc8417d35a7d464739" title="Return the error message.">getMessage</a>(), fault.<a class="code" href="classXmlRpc_1_1XmlRpcException.html#a0f8ae215539aa1d0124a3a0c0d7773bf" title="Return the error code.">getCode</a>());
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   <span class="keywordflow">return</span> response;
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="comment">// Parse the method name and the argument values from the request.</span>
<a name="l00353"></a>00353 std::string
<a name="l00354"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ac4bf126bd24170b3f2b124957a8d8156">00354</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ac4bf126bd24170b3f2b124957a8d8156" title="Parse the methodName and parameters from the request.">XmlRpcServer::parseRequest</a>(std::string <span class="keyword">const</span>&amp; request, <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; params)
<a name="l00355"></a>00355 {
<a name="l00356"></a>00356   <span class="keywordtype">int</span> offset = 0;   <span class="comment">// Number of chars parsed from the request</span>
<a name="l00357"></a>00357 
<a name="l00358"></a>00358   std::string methodName = <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#a31294b7282f97068a68f46995a29bcc9" title="Returns contents between &lt;tag&gt; and &lt;/tag&gt;, updates offset to char after &lt;/tag&gt;">XmlRpcUtil::parseTag</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a5bf03fd86a729904e3361293a61e9cfb">METHODNAME_TAG</a>, request, &amp;offset);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   <span class="keywordflow">if</span> (methodName.size() &gt; 0 &amp;&amp; <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#aa0a246fe28c9a5d87abd6adcdf17712a" title="Returns true if the tag is found and updates offset to the char after the tag.">XmlRpcUtil::findTag</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#aa47ed2b6fc713508d4f8045295eff34e">PARAMS_TAG</a>, request, &amp;offset))
<a name="l00361"></a>00361   {
<a name="l00362"></a>00362     <span class="keywordtype">int</span> nArgs = 0;
<a name="l00363"></a>00363     <span class="keywordflow">while</span> (<a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#a2ed1df7f98e410a4c8da054e803f3eb1" title="Returns true if the tag is found at the specified offset (modulo any whitespace) and updates offset t...">XmlRpcUtil::nextTagIs</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a795675c72586fdbd60bebfc84081b5d8">PARAM_TAG</a>, request, &amp;offset)) {
<a name="l00364"></a>00364       params[nArgs++] = <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>(request, &amp;offset);
<a name="l00365"></a>00365       (void) <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#a2ed1df7f98e410a4c8da054e803f3eb1" title="Returns true if the tag is found at the specified offset (modulo any whitespace) and updates offset t...">XmlRpcUtil::nextTagIs</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a5fc8a668f1d9766815b00707b7449d4a">PARAM_ETAG</a>, request, &amp;offset);
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     (void) <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#a2ed1df7f98e410a4c8da054e803f3eb1" title="Returns true if the tag is found at the specified offset (modulo any whitespace) and updates offset t...">XmlRpcUtil::nextTagIs</a>(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a16e93fe9e0a0f53379b082659b036c51">PARAMS_ETAG</a>, request, &amp;offset);
<a name="l00369"></a>00369   }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371   <span class="keywordflow">return</span> methodName;
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 <span class="comment">// Execute a named method with the specified params.</span>
<a name="l00375"></a>00375 <span class="keywordtype">bool</span>
<a name="l00376"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#adf1ac9a438a6a7b0b055c7002663eb9b">00376</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#adf1ac9a438a6a7b0b055c7002663eb9b" title="Execute a named method with the specified params.">XmlRpcServer::executeMethod</a>(<span class="keyword">const</span> std::string&amp; methodName, 
<a name="l00377"></a>00377                             <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; params, 
<a name="l00378"></a>00378                             <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; result)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380   <a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html" title="Abstract class representing a single RPC method.">XmlRpcServerMethod</a>* method = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a30471d5fa674f0d41f6b4f3b5f3b5e9c" title="Look up a method by name.">findMethod</a>(methodName);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382   <span class="keywordflow">if</span> ( ! method) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384   method-&gt;<a class="code" href="classXmlRpc_1_1XmlRpcServerMethod.html#a47b803c9c728d454054e5860d1228dda" title="Execute the method. Subclasses must provide a definition for this method.">execute</a>(params, result);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   <span class="comment">// Ensure a valid result value</span>
<a name="l00387"></a>00387   <span class="keywordflow">if</span> ( ! result.<a class="code" href="classXmlRpc_1_1XmlRpcValue.html#a1224dc3af0e87b928f3fea86f527f0f2" title="Return true if the value has been set to something.">isValid</a>())
<a name="l00388"></a>00388       result = std::string();
<a name="l00389"></a>00389 
<a name="l00390"></a>00390   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="comment">// Execute multiple calls and return the results in an array.</span>
<a name="l00394"></a>00394 <span class="keywordtype">bool</span>
<a name="l00395"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ad6e8454852336798ed6c0dfed823706c">00395</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ad6e8454852336798ed6c0dfed823706c" title="Execute multiple calls and return the results in an array.">XmlRpcServer::executeMulticall</a>(<span class="keyword">const</span> std::string&amp; methodName, 
<a name="l00396"></a>00396                                <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; params, 
<a name="l00397"></a>00397                                <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; result)
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399   <span class="keywordflow">if</span> (methodName != <a class="code" href="XmlRpcServer_8cc.html#a9b11830d266ccec140d096e63ad8be2f">MULTICALL</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   <span class="comment">// There ought to be 1 parameter, an array of structs</span>
<a name="l00402"></a>00402   <span class="keywordflow">if</span> (params.<a class="code" href="classXmlRpc_1_1XmlRpcValue.html#a7f3a1969a5506df8d045bb01632f9f2d" title="Return the size for string, base64, array, and struct values.">size</a>() != 1 || params[0].<a class="code" href="classXmlRpc_1_1XmlRpcValue.html#ab0b14902f264c1dbd72abea1b46f6adc" title="Return the type of the value stored.">getType</a>() != <a class="code" href="classXmlRpc_1_1XmlRpcValue.html#a39bba28bc00ed6c271f142f3bc9d21f6ab687f4227eb8a2d3e25800321fbfc5ad">XmlRpcValue::TypeArray</a>)
<a name="l00403"></a>00403     <span class="keywordflow">throw</span> <a class="code" href="classXmlRpc_1_1XmlRpcException.html" title="A class representing an error.">XmlRpcException</a>(<a class="code" href="XmlRpcServer_8cc.html#a9b11830d266ccec140d096e63ad8be2f">MULTICALL</a> + <span class="stringliteral">&quot;: Invalid argument (expected an array)&quot;</span>);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405   <span class="keywordtype">int</span> nc = params[0].<a class="code" href="classXmlRpc_1_1XmlRpcValue.html#a7f3a1969a5506df8d045bb01632f9f2d" title="Return the size for string, base64, array, and struct values.">size</a>();
<a name="l00406"></a>00406   result.<a class="code" href="classXmlRpc_1_1XmlRpcValue.html#af411c8368c750bd8b06801a7f0693bb0" title="Specify the size for array values. Array values will grow beyond this size if needed.">setSize</a>(nc);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;nc; ++i) {
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="keywordflow">if</span> ( ! params[0][i].hasMember(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#afa08aee751ae2b966a07eee6c3dc21d7">METHODNAME</a>) ||
<a name="l00411"></a>00411          ! params[0][i].hasMember(<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a52a0786fc89f8dfba149af64dcd1e816">PARAMS</a>)) {
<a name="l00412"></a>00412       result[i][<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ac21fb7ebd2c3b98aec3985fbb2c501fa">FAULTCODE</a>] = -1;
<a name="l00413"></a>00413       result[i][<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a6a206e59932cbf60268bbafb5be3b8c3">FAULTSTRING</a>] = <a class="code" href="XmlRpcServer_8cc.html#a9b11830d266ccec140d096e63ad8be2f">MULTICALL</a> +
<a name="l00414"></a>00414               <span class="stringliteral">&quot;: Invalid argument (expected a struct with members methodName and params)&quot;</span>;
<a name="l00415"></a>00415       <span class="keywordflow">continue</span>;
<a name="l00416"></a>00416     }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="keyword">const</span> std::string&amp; methodName = params[0][i][<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#afa08aee751ae2b966a07eee6c3dc21d7">METHODNAME</a>];
<a name="l00419"></a>00419     <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a>&amp; methodParams = params[0][i][<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a52a0786fc89f8dfba149af64dcd1e816">PARAMS</a>];
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a> resultValue;
<a name="l00422"></a>00422     resultValue.<a class="code" href="classXmlRpc_1_1XmlRpcValue.html#af411c8368c750bd8b06801a7f0693bb0" title="Specify the size for array values. Array values will grow beyond this size if needed.">setSize</a>(1);
<a name="l00423"></a>00423     <span class="keywordflow">try</span> {
<a name="l00424"></a>00424       <span class="keywordflow">if</span> ( ! <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#adf1ac9a438a6a7b0b055c7002663eb9b" title="Execute a named method with the specified params.">executeMethod</a>(methodName, methodParams, resultValue[0]) &amp;&amp;
<a name="l00425"></a>00425            ! <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ad6e8454852336798ed6c0dfed823706c" title="Execute multiple calls and return the results in an array.">executeMulticall</a>(methodName, params, resultValue[0]))
<a name="l00426"></a>00426       {
<a name="l00427"></a>00427         result[i][<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ac21fb7ebd2c3b98aec3985fbb2c501fa">FAULTCODE</a>] = -1;
<a name="l00428"></a>00428         result[i][<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a6a206e59932cbf60268bbafb5be3b8c3">FAULTSTRING</a>] = methodName + <span class="stringliteral">&quot;: unknown method name&quot;</span>;
<a name="l00429"></a>00429       }
<a name="l00430"></a>00430       <span class="keywordflow">else</span>
<a name="l00431"></a>00431         result[i] = resultValue;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     } <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classXmlRpc_1_1XmlRpcException.html" title="A class representing an error.">XmlRpcException</a>&amp; fault) {
<a name="l00434"></a>00434         result[i][<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ac21fb7ebd2c3b98aec3985fbb2c501fa">FAULTCODE</a>] = fault.<a class="code" href="classXmlRpc_1_1XmlRpcException.html#a0f8ae215539aa1d0124a3a0c0d7773bf" title="Return the error code.">getCode</a>();
<a name="l00435"></a>00435         result[i][<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a6a206e59932cbf60268bbafb5be3b8c3">FAULTSTRING</a>] = fault.<a class="code" href="classXmlRpc_1_1XmlRpcException.html#a8b847167289592dc8417d35a7d464739" title="Return the error message.">getMessage</a>();
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437   }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 <span class="comment">// Create a response from results xml</span>
<a name="l00444"></a>00444 std::string
<a name="l00445"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a2d44940be108a33efc45b12975593b71">00445</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a2d44940be108a33efc45b12975593b71" title="Construct a response from the result XML.">XmlRpcServer::generateResponse</a>(std::string <span class="keyword">const</span>&amp; resultXml)
<a name="l00446"></a>00446 {
<a name="l00447"></a>00447   <span class="keyword">const</span> <span class="keywordtype">char</span> RESPONSE_1[] = 
<a name="l00448"></a>00448     <span class="stringliteral">&quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;\r\n&quot;</span>
<a name="l00449"></a>00449     <span class="stringliteral">&quot;&lt;methodResponse&gt;&lt;params&gt;&lt;param&gt;\r\n\t&quot;</span>;
<a name="l00450"></a>00450   <span class="keyword">const</span> <span class="keywordtype">char</span> RESPONSE_2[] =
<a name="l00451"></a>00451     <span class="stringliteral">&quot;\r\n&lt;/param&gt;&lt;/params&gt;&lt;/methodResponse&gt;\r\n&quot;</span>;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   std::string body = RESPONSE_1 + resultXml + RESPONSE_2;
<a name="l00454"></a>00454   std::string header = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1e787a9b1c06be972ec8df70241adfef" title="Return the appropriate headers for the response.">generateHeader</a>(body);
<a name="l00455"></a>00455   std::string response = header + body;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   <a class="code" href="classXmlRpc_1_1XmlRpcUtil.html#ac8423b781acbcbf90e5d4558591e7c61" title="Dump messages somewhere.">XmlRpcUtil::log</a>(5, <span class="stringliteral">&quot;XmlRpcServer::generateResponse:\n%s\n&quot;</span>, response.c_str());
<a name="l00458"></a>00458   <span class="keywordflow">return</span> response;
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 <span class="comment">// Prepend http headers</span>
<a name="l00463"></a>00463 std::string
<a name="l00464"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1e787a9b1c06be972ec8df70241adfef">00464</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1e787a9b1c06be972ec8df70241adfef" title="Return the appropriate headers for the response.">XmlRpcServer::generateHeader</a>(std::string <span class="keyword">const</span>&amp; body)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466   std::string header = 
<a name="l00467"></a>00467     <span class="stringliteral">&quot;HTTP/1.1 200 OK\r\n&quot;</span>
<a name="l00468"></a>00468     <span class="stringliteral">&quot;Server: &quot;</span>;
<a name="l00469"></a>00469   header += <a class="code" href="namespaceXmlRpc.html#a6e869daf0be5c7c473298467413f960d" title="Version identifier.">XMLRPC_VERSION</a>;
<a name="l00470"></a>00470   header += <span class="stringliteral">&quot;\r\n&quot;</span>
<a name="l00471"></a>00471     <span class="stringliteral">&quot;Content-Type: text/xml\r\n&quot;</span>
<a name="l00472"></a>00472     <span class="stringliteral">&quot;Content-length: &quot;</span>;
<a name="l00473"></a>00473 
<a name="l00474"></a>00474   <span class="keywordtype">char</span> buffLen[40];
<a name="l00475"></a>00475   sprintf(buffLen,<span class="stringliteral">&quot;%zu\r\n\r\n&quot;</span>, body.size());
<a name="l00476"></a>00476 
<a name="l00477"></a>00477   <span class="keywordflow">return</span> header + buffLen;
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 std::string
<a name="l00482"></a><a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a3e0bf2ab2c4fd269a7b5e03ccca79475">00482</a> <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a3e0bf2ab2c4fd269a7b5e03ccca79475" title="Construct a fault response.">XmlRpcServer::generateFaultResponse</a>(std::string <span class="keyword">const</span>&amp; errorMsg, <span class="keywordtype">int</span> errorCode)
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484   <span class="keyword">const</span> <span class="keywordtype">char</span> RESPONSE_1[] = 
<a name="l00485"></a>00485     <span class="stringliteral">&quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;\r\n&quot;</span>
<a name="l00486"></a>00486     <span class="stringliteral">&quot;&lt;methodResponse&gt;&lt;fault&gt;\r\n\t&quot;</span>;
<a name="l00487"></a>00487   <span class="keyword">const</span> <span class="keywordtype">char</span> RESPONSE_2[] =
<a name="l00488"></a>00488     <span class="stringliteral">&quot;\r\n&lt;/fault&gt;&lt;/methodResponse&gt;\r\n&quot;</span>;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490   <a class="code" href="classXmlRpc_1_1XmlRpcValue.html" title="A class to represent RPC arguments and results.">XmlRpcValue</a> faultStruct;
<a name="l00491"></a>00491   faultStruct[<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#ac21fb7ebd2c3b98aec3985fbb2c501fa">FAULTCODE</a>] = errorCode;
<a name="l00492"></a>00492   faultStruct[<a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a6a206e59932cbf60268bbafb5be3b8c3">FAULTSTRING</a>] = errorMsg;
<a name="l00493"></a>00493   std::string body = RESPONSE_1 + faultStruct.<a class="code" href="classXmlRpc_1_1XmlRpcValue.html#aedae94ced3a80ff37a528861bcb2a47e" title="Encode the Value in xml.">toXml</a>() + RESPONSE_2;
<a name="l00494"></a>00494   std::string header = <a class="code" href="classXmlRpc_1_1XmlRpcServer.html#a1e787a9b1c06be972ec8df70241adfef" title="Return the appropriate headers for the response.">generateHeader</a>(body);
<a name="l00495"></a>00495 
<a name="l00496"></a>00496   <span class="keywordflow">return</span> header + body;
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="XmlRpcServer_8cc.html">XmlRpcServer.cc</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:31 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
