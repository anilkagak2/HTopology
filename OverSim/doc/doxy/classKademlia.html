<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: Kademlia Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classKademlia.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">Kademlia Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="Kademlia" --><!-- doxytag: inherits="BaseOverlay,ProxListener" -->
<p><a class="el" href="classKademlia.html" title="Kademlia overlay module.">Kademlia</a> overlay module.  
 <a href="classKademlia.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Kademlia:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classKademlia.png" usemap="#Kademlia_map" alt=""/>
  <map id="Kademlia_map" name="Kademlia_map">
<area href="classBaseOverlay.html" title="Base class for overlays." alt="BaseOverlay" shape="rect" coords="115,112,220,136"/>
<area href="classProxListener.html" alt="ProxListener" shape="rect" coords="230,112,335,136"/>
<area href="classBaseRpc.html" title="Base class for RPCs." alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classTopologyVis.html" alt="TopologyVis" shape="rect" coords="230,56,335,80"/>
<area href="classRpcListener.html" title="A Remote-Procedure-Call listener class." alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
 </div></div>

<p><a href="classKademlia-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a75d6af36c354ebd0a180eb15a392def5">Kademlia</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a76944a48a365d24b78df662970484bc5">~Kademlia</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a3230c643b585b8f0745cebb7a577349c">initializeOverlay</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes derived-class-attributes.  <a href="#a3230c643b585b8f0745cebb7a577349c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a9682b56476fa08cd0af341312d2c8186">finishOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">collects statistical data in derived class  <a href="#a9682b56476fa08cd0af341312d2c8186"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a23662900f3d17541a2b9051a3821a226">joinOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Join the overlay with a given nodeID in thisNode.key.  <a href="#a23662900f3d17541a2b9051a3821a226"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#ada80a26aba760ec53ce539d8180cf865">isSiblingFor</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, int numSiblings, bool *err)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Query if a node is among the siblings for a given key.  <a href="#ada80a26aba760ec53ce539d8180cf865"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a7253ff80d709265f6e74d3ebf4e691ad">getMaxNumSiblings</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay protocol.  <a href="#a7253ff80d709265f6e74d3ebf4e691ad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a5127b16ed36be0a202ecb7b890a7e634">getMaxNumRedundantNodes</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Query the maximum number of redundant next hop nodes that are returned by <a class="el" href="classKademlia.html#aafad68d123da52e5fefb719699ed2dc3" title="Implements the find node call.">findNode()</a>.  <a href="#a5127b16ed36be0a202ecb7b890a7e634"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a27b31a4a713eadd2c8f1a83d66dc69a7">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a82d872d3d7797e94985557d04f7c9ed5">handleRpcCall</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes Remote-Procedure-Call invocation messages.  <a href="#a82d872d3d7797e94985557d04f7c9ed5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#af1edeee0ba2c1f2fb26355076814f102">handleUDPMessage</a> (<a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes messages from underlay.  <a href="#af1edeee0ba2c1f2fb26355076814f102"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a7545cb508c37d7bf706b3e5a4950c695">proxCallback</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;node, int rpcId, cPolymorphic *contextPointer, <a class="el" href="structProx.html">Prox</a> prox)</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#aafad68d123da52e5fefb719699ed2dc3">findNode</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, int numRedundantNodes, int numSiblings, <a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements the find node call.  <a href="#aafad68d123da52e5fefb719699ed2dc3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#af8451d8dae93dbb1117574b3820af76e">handleRpcResponse</a> (<a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *msg, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC response has been received.  <a href="#af8451d8dae93dbb1117574b3820af76e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a9c237aa2447a9b2323bf34a95c852005">handleRpcTimeout</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, cPolymorphic *context, int rpcId, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;destKey)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC timeout has been reached.  <a href="#a9c237aa2447a9b2323bf34a95c852005"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a53a73a3a496d4fe37c0310b7b6eee214">handleBucketRefreshTimerExpired</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handle a expired bucket refresh timer  <a href="#a53a73a3a496d4fe37c0310b7b6eee214"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classOverlayKey.html">OverlayKey</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a8267f4c6d125a1cdd749164f6a1ee65e">distance</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;x, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;y, bool useAlternative=false) const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method should implement the distance between two keys.  <a href="#a8267f4c6d125a1cdd749164f6a1ee65e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#acd029f455e0c6150c038c69fa493696c">updateTooltip</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">updates information shown in GUI  <a href="#acd029f455e0c6150c038c69fa493696c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#adac287af3943cfcbc1a3834fa8d0c37d">lookupFinished</a> (bool isValid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#ae21a58f63a448c1b41edd84c2e5a0cb0">handleNodeGracefulLeaveNotification</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method gets call **.gracefulLeaveDelay seconds before it is killed if this node is among the gracefulLeaveProbability nodes.  <a href="#ae21a58f63a448c1b41edd84c2e5a0cb0"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#acc2f4767a1687764f2d732872511a7ad">k</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a742e20c8d232a8623f4a85c2f0cad1e4">maxStaleCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#ae7a670589ec838bbf79d684fba016185">exhaustiveRefresh</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a113faa91ed3ec564f8b61718101695c2">pingNewSiblings</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd">secureMaintenance</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">if true, ping not authenticated nodes before adding them to a bucket  <a href="#a1f28727c1a562f3e40cd315dd22dd8cd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a68e77f3b48652f19219a6c6c9a1a76d2">newMaintenance</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a151fd59bc6de940e684fbad408083ac4">enableReplacementCache</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#adc22fe7536c4bea9677ed901b95820a8">replacementCachePing</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a8ebc8abde092aad89dfa813ba640e6ef">replacementCandidates</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#ad4d31fcf8c7300404ae07523daab8cc6">siblingRefreshNodes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a5ab8d39b7c098f21d9577d5dfc82a4f4">bucketRefreshNodes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#aa83e5da5199e71427e731d4a1ad7ce9d">activePing</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#aa8b1be416dea22c671ae2774936226c5">proximityRouting</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#aa1c9d6f7ff020a8a9249f1da3d1fedbe">proximityNeighborSelection</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a53857e5e13f67a12e810db01a18400dc">altRecMode</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#ae22800e069a69a317d4906a29e4da71d">minSiblingTableRefreshInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#abda8d541b714ec855d891a2938fa8b3f">minBucketRefreshInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a99dbb3ee2302a9861a518b3d75cb3eb2">siblingPingInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a0fc8d7eadb6ed086536cbc273460d7a9">routingInit</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#ad54c5bcac7db895e0e0eec5cd0109da2">routingDeinit</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#ac281bfbd16423020b46561a0df3d28c5">routingBucketIndex</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, bool firstOnLayer=false)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the index of the bucket the key would reside with respect to <a class="el" href="classKademlia.html" title="Kademlia overlay module.">Kademlia</a> parameters.  <a href="#ac281bfbd16423020b46561a0df3d28c5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classKademliaBucket.html">KademliaBucket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a12ad26290a17accd9645415e7e8cb9d3">routingBucket</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, bool ensure)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a Bucket or <code>NULL</code> if the bucket has not yet allocated.  <a href="#a12ad26290a17accd9645415e7e8cb9d3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9">routingAdd</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;handle, bool isAlive, simtime_t rtt=MAXTIME, bool maintenanceLookup=false)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a node to the routing table.  <a href="#a9c72c87286495818109f5460a7eefea9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a21ca74bfdaf4114ca2f468935856e67b">routingTimeout</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, bool immediately=false)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes a node after a number of timeouts or immediately if immediately is true (behaves like routingRemove).  <a href="#a21ca74bfdaf4114ca2f468935856e67b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a0cf73bc94792b9be525f73fa3a4551da">refillSiblingTable</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a837fc1c137eebd1189ff401b4bd97a99">sendSiblingFindNodeCall</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a7581a168ae2e143001a7a93ff4a1779a">setBucketUsage</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a2d0f3eebfa308ff4c88831d917efa8fd">recursiveRoutingHook</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, <a class="el" href="classBaseRouteMessage.html">BaseRouteMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Hook for forwarded message in recursive lookup mode.  <a href="#a2d0f3eebfa308ff4c88831d917efa8fd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#aebd62488323d6cebf7812974114ed38b">handleFailedNode</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;failed)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a failed node.  <a href="#aebd62488323d6cebf7812974114ed38b"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a210614b1ea667d544d256a1cc5e94490">bucketRefreshCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a9b7cdab70352fcc52c0cfe55541807ef">siblingTableRefreshCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#aa1eda90d9ae7c58ff916a9d493d7c1e6">nodesReplaced</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classKeyDistanceComparator.html">KeyDistanceComparator</a><br class="typebreak"/>
&lt; <a class="el" href="classKeyXorMetric.html">KeyXorMetric</a> &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classKademliaBucket.html">KademliaBucket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classKademliaBucket.html">KademliaBucket</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a307336180b2937d77360219c9ac91c3c">numBuckets</a></td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKademlia.html#a61b072e95046f98ad49a3f5589fe9a45">KademliaLookupListener</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classKademlia.html" title="Kademlia overlay module.">Kademlia</a> overlay module. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Sebastian Mies, Ingmar Baumgart, Bernhard Heep</dd></dl>
<p>This class implements the <a class="el" href="classKademlia.html" title="Kademlia overlay module.">Kademlia</a> protocol described in P. Maymounkov and D. Mazières, "Kademlia: A Peer-to-Peer Information System
 Based on the XOR Metric", Lecture Notes in Computer Science, Peer-to-Peer Systems: First International Workshop (IPTPS 2002). Revised Papers, 2002, 2429/2002, 53-65</p>
<p>The recursive routing mode (R/Kademlia) is described in B. Heep, "R/Kademlia: Recursive and Topology-aware Overlay Routing", Proceedings of the Australasian Telecommunication Networks and Applications Conference 2010 (ATNAC 2010), Auckland, New Zealand, 2010</p>
<p>The security extensions (S/Kademlia) are described in I. Baumgart and S. Mies, "S/Kademlia: A Practicable Approach Towards
 Secure Key-Based Routing", Proceedings of the 13th International Conference on Parallel and Distributed Systems (ICPADS '07), Hsinchu, Taiwan, 2007 </p>

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00061">61</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a75d6af36c354ebd0a180eb15a392def5"></a><!-- doxytag: member="Kademlia::Kademlia" ref="a75d6af36c354ebd0a180eb15a392def5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Kademlia::Kademlia </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00162">162</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a> = NULL;
    <a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a> = NULL;
    <a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a> = NULL;
    <a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a> = NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a76944a48a365d24b78df662970484bc5"></a><!-- doxytag: member="Kademlia::~Kademlia" ref="a76944a48a365d24b78df662970484bc5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Kademlia::~Kademlia </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00170">170</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classKademlia.html#ad54c5bcac7db895e0e0eec5cd0109da2">routingDeinit</a>();

    <span class="keyword">delete</span> <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>;
    <span class="keyword">delete</span> <a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a>;
    cancelAndDelete(<a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);
    cancelAndDelete(<a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a>);
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a8267f4c6d125a1cdd749164f6a1ee65e"></a><!-- doxytag: member="Kademlia::distance" ref="a8267f4c6d125a1cdd749164f6a1ee65e" args="(const OverlayKey &amp;x, const OverlayKey &amp;y, bool useAlternative=false) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classOverlayKey.html">OverlayKey</a> Kademlia::distance </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>useAlternative</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const<code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method should implement the distance between two keys. </p>
<p>It may be overloaded to implement a new metric. The default implementation uses the standard-metric d = abs(x-y).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">x</td><td>Left-hand-side Key </td></tr>
    <tr><td class="paramname">y</td><td>Right-hand-side key </td></tr>
    <tr><td class="paramname">useAlternative</td><td>use an alternative distance metric </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><a class="el" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> Distance between x and y </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#aa12314947ef42726ec6c7066dde8d0f9">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01421">1421</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!useAlternative) <span class="keywordflow">return</span> x^y; <span class="comment">// KeyXorMetric().distance(x, y);</span>
    <span class="keywordflow">return</span> <a class="code" href="classKeyPrefixMetric.html" title="OverlayKey prefix metric.">KeyPrefixMetric</a>().<a class="code" href="classKeyPrefixMetric.html#a78d831ece61ba3e17c9200f4ad733cdb" title="calculates the distance from x to y with the prefix metric">distance</a>(x, y);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aafad68d123da52e5fefb719699ed2dc3"></a><!-- doxytag: member="Kademlia::findNode" ref="aafad68d123da52e5fefb719699ed2dc3" args="(const OverlayKey &amp;key, int numRedundantNodes, int numSiblings, BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a> * Kademlia::findNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numRedundantNodes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numSiblings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements the find node call. </p>
<p>This method simply returns the closest nodes known in the corresponding routing topology. If the node is a sibling for this key (isSiblingFor(key) = true), this method returns all numSiblings siblings, with the closest neighbor to the key first.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>The lookup key. </td></tr>
    <tr><td class="paramname">numRedundantNodes</td><td>Maximum number of next hop nodes to return. </td></tr>
    <tr><td class="paramname">numSiblings</td><td>number of siblings to return </td></tr>
    <tr><td class="paramname">msg</td><td>A pointer to the <a class="el" href="classBaseRouteMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">BaseRouteMessage</a> or <a class="el" href="classFindNodeCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">FindNodeCall</a> message of this lookup. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NodeVector with closest nodes. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a7cbdce336237331b67a3c69c4e43d489">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00969">969</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00889">recursiveRoutingHook()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (numSiblings &gt; <a class="code" href="classKademlia.html#a7253ff80d709265f6e74d3ebf4e691ad" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>()) {
        opp_error(<span class="stringliteral">&quot;(Kademlia::findNode()) numRedundantNodes or numSiblings &quot;</span>
                  <span class="stringliteral">&quot;too big!&quot;</span>);
    }

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (numRedundantNodes &lt; 2) {
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;Kademlia::findNode(): For Kademlia &quot;</span>
                                <span class="stringliteral">&quot;redundantNodes must be at least 2 &quot;</span>
                                <span class="stringliteral">&quot;and lookupMerge should be true!&quot;</span>);
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="comment">// create temporary comparator</span>
    <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>* comp =
        <span class="keyword">new</span> <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>( key );

    <span class="comment">// select result set size</span>
    <span class="keywordtype">bool</span> err;
    <span class="keywordtype">int</span> resultSize;

    <span class="keywordflow">if</span> (numSiblings &lt; 0) {
        <span class="comment">// exhaustive iterative doesn&#39;t care about siblings</span>
        resultSize = numRedundantNodes;
    } <span class="keywordflow">else</span> {
        resultSize = <a class="code" href="classKademlia.html#ada80a26aba760ec53ce539d8180cf865" title="Query if a node is among the siblings for a given key.">isSiblingFor</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>, key, numSiblings, &amp;err) ?
                (numSiblings ? numSiblings : 1) : numRedundantNodes;
    }
    assert(numSiblings || numRedundantNodes);

    <a class="code" href="classBaseKeySortedVector.html" title="A STL-vector that supports inserts sorted by an OverlayKey found somewhere in the type...">NodeVector</a>* result = <span class="keyword">new</span> <a class="code" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a>(resultSize, comp);

    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#a3aaa6426ddc7dba9d2d2f4b05cad997c" title="indicates if NodeVector holds at least one node">isEmpty</a>()) {
        result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        <span class="keyword">delete</span> comp;
        <span class="keywordflow">return</span> result;
    }

    <span class="comment">// R/Kademlia: in recursive mode just speed up route messages //TODO iterative PR</span>
    <span class="keywordtype">bool</span> returnProxNodes = <span class="keyword">false</span>;
    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#aa8b1be416dea22c671ae2774936226c5">proximityRouting</a>) {
        <span class="keywordflow">if</span> (msg &amp;&amp;
            (!dynamic_cast&lt;FindNodeCall*&gt;(msg-&gt;getEncapsulatedPacket()) &amp;&amp;
             !dynamic_cast&lt;FindNodeCall*&gt;(msg))) {
            returnProxNodes = <span class="keyword">true</span>;
        }
    }

    <a class="code" href="classBaseKeySortedVector.html" title="A STL-vector that supports inserts sorted by an OverlayKey found somewhere in the type...">ProxNodeVector</a>* resultProx = NULL;
    <a class="code" href="classKademliaPRComparator.html">KademliaPRComparator</a>* compProx = NULL;
    <span class="keywordflow">if</span> (returnProxNodes) {
        compProx = <span class="keyword">new</span> <a class="code" href="classKademliaPRComparator.html">KademliaPRComparator</a>(key);
        resultProx = <span class="keyword">new</span> <a class="code" href="NodeVector_8h.html#a4d7500584bc52e84d4b6bb26397750c2">ProxNodeVector</a>(resultSize, NULL, NULL, compProx, 0, resultSize);
    }

    <span class="comment">// add items from buckets</span>
    <span class="keywordtype">int</span> index;
    <span class="keywordtype">int</span> mainIndex = <a class="code" href="classKademlia.html#ac281bfbd16423020b46561a0df3d28c5" title="Returns the index of the bucket the key would reside with respect to Kademlia parameters.">routingBucketIndex</a>(key);
    <span class="keywordtype">int</span> startIndex = <a class="code" href="classKademlia.html#ac281bfbd16423020b46561a0df3d28c5" title="Returns the index of the bucket the key would reside with respect to Kademlia parameters.">routingBucketIndex</a>(key, <span class="keyword">true</span>);
    <span class="keywordtype">int</span> endIndex = <a class="code" href="classKademlia.html#ac281bfbd16423020b46561a0df3d28c5" title="Returns the index of the bucket the key would reside with respect to Kademlia parameters.">routingBucketIndex</a>(<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;back().getKey());

    <span class="comment">// add nodes from best fitting bucket</span>
    <span class="keywordflow">if</span> (mainIndex != -1) {
        <a class="code" href="classKademliaBucket.html">KademliaBucket</a>* bucket = <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[mainIndex];
        <span class="keywordflow">if</span> (bucket != NULL &amp;&amp; bucket-&gt;size()) {
            <span class="keywordflow">for</span> (<a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i=bucket-&gt;begin(); i!=bucket-&gt;end(); i++) {
                result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(*i);
                <span class="keywordflow">if</span> (returnProxNodes)
                    resultProx-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(*i);
                <span class="comment">//EV &lt;&lt; &quot;Kademlia::findNode(): Adding &quot;</span>
                <span class="comment">//   &lt;&lt; *i &lt;&lt; &quot; from bucket &quot; &lt;&lt; mainIndex &lt;&lt; endl;</span>
            }
        }
    }

    <span class="comment">// add most fitting buckets</span>
    <span class="keywordflow">if</span> (startIndex &gt;= endIndex || !result-&gt;<a class="code" href="classBaseKeySortedVector.html#ad96fd23183bf954e2613af5430ecb48d" title="indicates if NodeVector holds maxSize nodes">isFull</a>()) {
        <span class="keywordflow">for</span> (index = startIndex; index &gt;= endIndex; --index) {
            <span class="comment">// add bucket to result vector</span>
            <span class="keywordflow">if</span> (index == mainIndex) <span class="keywordflow">continue</span>;
            <a class="code" href="classKademliaBucket.html">KademliaBucket</a>* bucket = <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index];
            <span class="keywordflow">if</span> (bucket != NULL &amp;&amp; bucket-&gt;size()) {
                <span class="keywordflow">for</span> (<a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i=bucket-&gt;begin(); i!=bucket-&gt;end(); i++) {
                    result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(*i);
                    <span class="keywordflow">if</span> (returnProxNodes)
                        resultProx-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(*i);<span class="comment">//std::make_pair(*i, i-&gt;getRtt()));</span>
                    <span class="comment">//EV &lt;&lt; &quot;Kademlia::routingGetClosestNodes(): Adding &quot;</span>
                    <span class="comment">//   &lt;&lt; *i &lt;&lt; &quot; from bucket &quot; &lt;&lt; index &lt;&lt; endl;</span>
                }
            }
        }

        <span class="comment">// add nodes from sibling table</span>
        <span class="keywordflow">for</span> (<a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i = <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;begin();
             i != <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;end(); i++) {
            result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(*i);
            <span class="keywordflow">if</span> (returnProxNodes)
                resultProx-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(*i);
        }
        <span class="comment">// add local node</span>
        result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        <span class="keywordflow">if</span> (returnProxNodes) {
            <a class="code" href="classKademliaBucketEntry.html">KademliaBucketEntry</a> temp = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>;
            <span class="keywordflow">if</span> (!result-&gt;size() || (*result)[0] == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
                temp.<a class="code" href="classProxNodeHandle.html#a2f3e23f427dfbf4c36fef805d7fa8bc2">setProx</a>(<a class="code" href="structProx.html#ae33fb924891e14e0161708bfadf8f033">Prox::PROX_SELF</a>);
                resultProx-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(temp);
            } <span class="keywordflow">else</span> {
                temp.<a class="code" href="classProxNodeHandle.html#a2f3e23f427dfbf4c36fef805d7fa8bc2">setProx</a>(<a class="code" href="structProx.html#aa7ac832a04fe61863222d8631526647b">Prox::PROX_UNKNOWN</a>);
                resultProx-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(temp);
            }
        }
    }

    <span class="comment">// add more distant buckets</span>
    <span class="keywordflow">for</span> (index = mainIndex + 1; !result-&gt;<a class="code" href="classBaseKeySortedVector.html#ad96fd23183bf954e2613af5430ecb48d" title="indicates if NodeVector holds maxSize nodes">isFull</a>() &amp;&amp; index &lt; <a class="code" href="classKademlia.html#a307336180b2937d77360219c9ac91c3c">numBuckets</a>;
         ++index) {
        <span class="comment">// add bucket to result vector</span>
        <a class="code" href="classKademliaBucket.html">KademliaBucket</a>* bucket = <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index];
        <span class="keywordflow">if</span> (bucket != NULL &amp;&amp; bucket-&gt;size()) {
            <span class="keywordflow">for</span> (<a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i=bucket-&gt;begin(); i!=bucket-&gt;end(); i++) {
                result-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(*i);
                <span class="keywordflow">if</span> (returnProxNodes)
                    resultProx-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(*i);
                <span class="comment">//EV &lt;&lt; &quot;[Kademlia::routingGetClosestNodes()]\n&quot;</span>
                <span class="comment">//   &lt;&lt; &quot;    Adding &quot; &lt;&lt; *i &lt;&lt; &quot; from bucket &quot; &lt;&lt; index</span>
                <span class="comment">//   &lt;&lt; endl;</span>
            }
        }
    }

    <span class="keywordflow">if</span> (returnProxNodes &amp;&amp; resultProx-&gt;size() &amp;&amp; result-&gt;size() &amp;&amp;
        (<a class="code" href="classKeyPrefixMetric.html" title="OverlayKey prefix metric.">KeyPrefixMetric</a>().<a class="code" href="classKeyPrefixMetric.html#a78d831ece61ba3e17c9200f4ad733cdb" title="calculates the distance from x to y with the prefix metric">distance</a>(key, (*resultProx)[0].getKey()) &lt;
         <a class="code" href="classKeyPrefixMetric.html" title="OverlayKey prefix metric.">KeyPrefixMetric</a>().<a class="code" href="classKeyPrefixMetric.html#a78d831ece61ba3e17c9200f4ad733cdb" title="calculates the distance from x to y with the prefix metric">distance</a>(key, (*result)[0].getKey()))) {
        result-&gt;clear();
        <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; resultProx-&gt;size(); ++i) {
            result-&gt;push_back((*resultProx)[i]<span class="comment">/*.first*/</span>);
        }
    }
    <span class="keyword">delete</span> compProx;
    <span class="keyword">delete</span> resultProx;

    <span class="keyword">delete</span> comp;

    <span class="keywordflow">return</span> result;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9682b56476fa08cd0af341312d2c8186"></a><!-- doxytag: member="Kademlia::finishOverlay" ref="a9682b56476fa08cd0af341312d2c8186" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::finishOverlay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collects statistical data in derived class </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a8db85b9c706d04007154761d5a0cec16">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00180">180</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    simtime_t time = <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a610799ebfbf64696c59b811870cc8300">calcMeasuredLifetime</a>(<a class="code" href="classBaseOverlay.html#af0eebaddea732ee4ab4d247c388e62bd" title="simtime when the node has been created">creationTime</a>);
    <span class="keywordflow">if</span> (time &lt; <a class="code" href="classGlobalStatistics.html#a169810c78519b271f7e32fdc7c9fc641" title="minimum useful measured lifetime in seconds">GlobalStatistics::MIN_MEASURED</a>) <span class="keywordflow">return</span>;

    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Kademlia: Nodes replaced in buckets/s&quot;</span>,
                                <a class="code" href="classKademlia.html#aa1eda90d9ae7c58ff916a9d493d7c1e6">nodesReplaced</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Kademlia: Bucket Refreshes/s&quot;</span>,
                                <a class="code" href="classKademlia.html#a210614b1ea667d544d256a1cc5e94490">bucketRefreshCount</a> / time);
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;Kademlia: Sibling Table Refreshes/s&quot;</span>,
                                <a class="code" href="classKademlia.html#a9b7cdab70352fcc52c0cfe55541807ef">siblingTableRefreshCount</a> / time);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5127b16ed36be0a202ecb7b890a7e634"></a><!-- doxytag: member="Kademlia::getMaxNumRedundantNodes" ref="a5127b16ed36be0a202ecb7b890a7e634" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Kademlia::getMaxNumRedundantNodes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query the maximum number of redundant next hop nodes that are returned by <a class="el" href="classKademlia.html#aafad68d123da52e5fefb719699ed2dc3" title="Implements the find node call.">findNode()</a>. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>int number of redundant nodes returned by <a class="el" href="classKademlia.html#aafad68d123da52e5fefb719699ed2dc3" title="Implements the find node call.">findNode()</a>. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#ab4dadd02486560de3a58773b3a90fb41">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00280">280</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classKademlia.html#acc2f4767a1687764f2d732872511a7ad">k</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7253ff80d709265f6e74d3ebf4e691ad"></a><!-- doxytag: member="Kademlia::getMaxNumSiblings" ref="a7253ff80d709265f6e74d3ebf4e691ad" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Kademlia::getMaxNumSiblings </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay protocol. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>int number of siblings. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#acd3058ad15b470e024500dd4872e2f09">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00275">275</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00969">findNode()</a>, <a class="el" href="Kademlia_8cc_source.html#l00755">isSiblingFor()</a>, <a class="el" href="Kademlia_8cc_source.html#l00193">sendSiblingFindNodeCall()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00739">setBucketUsage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a53a73a3a496d4fe37c0310b7b6eee214"></a><!-- doxytag: member="Kademlia::handleBucketRefreshTimerExpired" ref="a53a73a3a496d4fe37c0310b7b6eee214" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::handleBucketRefreshTimerExpired </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle a expired bucket refresh timer </p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01323">1323</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01121">handleTimerEvent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// refresh buckets</span>
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a> || (((simTime() - <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classKademliaBucket.html#af0d14164aa8f871b1696245b78ad9a6d">getLastUsage</a>()) &gt;
                            <a class="code" href="classKademlia.html#ae22800e069a69a317d4906a29e4da71d">minSiblingTableRefreshInterval</a>))) {
        <span class="comment">// R/Kademlia</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a18b63fe85aa5e81cd3fca5e3c7c9df82">SEMI_RECURSIVE_ROUTING</a> ||
            <a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551aeec4ce5cac6dae9d3d59b1347a9df957">FULL_RECURSIVE_ROUTING</a> ||
            <a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ad8c4eefed3d826e5da402fe582cad2c1">RECURSIVE_SOURCE_ROUTING</a>) {
            <span class="comment">//TODO real exhaustive-recursive lookup</span>
            <a class="code" href="classBaseOverlay.html#a205a7d44401fb3d77b146e23b2904b6f" title="Creates an abstract iterative lookup instance.">createLookup</a>()-&gt;<a class="code" href="classAbstractLookup.html#aa1bda70950cbd160ea78d1fcbd8c7767" title="Lookup siblings for a key.">lookup</a>(<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().getKey() + <a class="code" href="classOverlayKey.html#a51a63dbc089143b7742d7da846a16abd" title="OverlayKey with key initialized as 1.">OverlayKey::ONE</a>,
                                   0, <a class="code" href="classBaseOverlay.html#abffe6fbd25963bc2b7542f22ba6455b9" title="maximum hop count">hopCountMax</a>, 0,
                                   <span class="keyword">new</span> <a class="code" href="classKademlia.html#a61b072e95046f98ad49a3f5589fe9a45">KademliaLookupListener</a>(<span class="keyword">this</span>));
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#ae7a670589ec838bbf79d684fba016185">exhaustiveRefresh</a>) {
            <span class="comment">//TODO config shit</span>
            <span class="keywordtype">int</span> baseRedundantNodes = <a class="code" href="classBaseOverlay.html#a32b8cfb47f3ef824dcf6ad882e6a6a9f">iterativeLookupConfig</a>.<a class="code" href="classIterativeLookupConfiguration.html#a5ffefd1d559420cc498307521ae1fac7" title="number of next hops in each step">redundantNodes</a>;
            <a class="code" href="classBaseOverlay.html#a32b8cfb47f3ef824dcf6ad882e6a6a9f">iterativeLookupConfig</a>.<a class="code" href="classIterativeLookupConfiguration.html#a5ffefd1d559420cc498307521ae1fac7" title="number of next hops in each step">redundantNodes</a> = <a class="code" href="classKademlia.html#ad4d31fcf8c7300404ae07523daab8cc6">siblingRefreshNodes</a>;
            <a class="code" href="classBaseOverlay.html#a205a7d44401fb3d77b146e23b2904b6f" title="Creates an abstract iterative lookup instance.">createLookup</a>(<a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ad60cf756d6bb24af372d7fe7c279f44d">EXHAUSTIVE_ITERATIVE_ROUTING</a>)-&gt;<a class="code" href="classAbstractLookup.html#aa1bda70950cbd160ea78d1fcbd8c7767" title="Lookup siblings for a key.">lookup</a>(
                 <a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().getKey(), <a class="code" href="classKademlia.html#ad4d31fcf8c7300404ae07523daab8cc6">siblingRefreshNodes</a>,
                 <a class="code" href="classBaseOverlay.html#abffe6fbd25963bc2b7542f22ba6455b9" title="maximum hop count">hopCountMax</a>, 0, <span class="keyword">new</span> <a class="code" href="classKademlia.html#a61b072e95046f98ad49a3f5589fe9a45">KademliaLookupListener</a>(<span class="keyword">this</span>));
            <a class="code" href="classBaseOverlay.html#a32b8cfb47f3ef824dcf6ad882e6a6a9f">iterativeLookupConfig</a>.<a class="code" href="classIterativeLookupConfiguration.html#a5ffefd1d559420cc498307521ae1fac7" title="number of next hops in each step">redundantNodes</a> = baseRedundantNodes;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a68e77f3b48652f19219a6c6c9a1a76d2">newMaintenance</a>) {
            <span class="comment">//for (KademliaBucket::iterator i = siblingTable-&gt;begin();</span>
            <span class="comment">//     i != siblingTable-&gt;end(); i++) {</span>

            <span class="comment">//    sendSiblingFindNodeCall(*i);</span>
            <span class="comment">//}</span>
            <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size()) {
                <a class="code" href="classKademlia.html#a837fc1c137eebd1189ff401b4bd97a99">sendSiblingFindNodeCall</a>(<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;at(intuniform(0,<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size()-1)));
            }
            <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>;
            <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>(<span class="keyword">true</span>);
        } <span class="keywordflow">else</span> {
            <a class="code" href="classBaseOverlay.html#a205a7d44401fb3d77b146e23b2904b6f" title="Creates an abstract iterative lookup instance.">createLookup</a>()-&gt;<a class="code" href="classAbstractLookup.html#aa1bda70950cbd160ea78d1fcbd8c7767" title="Lookup siblings for a key.">lookup</a>(<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().getKey(), <a class="code" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a>, <a class="code" href="classBaseOverlay.html#abffe6fbd25963bc2b7542f22ba6455b9" title="maximum hop count">hopCountMax</a>, 0,
                                   <span class="keyword">new</span> <a class="code" href="classKademlia.html#a61b072e95046f98ad49a3f5589fe9a45">KademliaLookupListener</a>(<span class="keyword">this</span>));
        }
        <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classKademliaBucket.html#a8b5481352d9ad3354647e5cae8c6e5fa">setLastUsage</a>(simTime());
        ++<a class="code" href="classKademlia.html#a9b7cdab70352fcc52c0cfe55541807ef">siblingTableRefreshCount</a>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size()) {
            <span class="comment">// get bit index of most significant digit that differs</span>
            <span class="comment">// from our next sibling&#39;s key to prevent us from refreshing</span>
            <span class="comment">// buckets, which can&#39;t contain any nodes</span>
            int32_t diff = <a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>*(<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().
                sharedPrefixLength(<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;front().getKey(), <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) + 1);
            <span class="keywordtype">int</span> bucketsRefreshedPerTask = 0;
            <span class="keywordflow">for</span> (int32_t i = <a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>; i &gt;= diff; i -=<a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a> ) {
                <span class="keywordflow">for</span> (int32_t d=0; d &lt; ((1 &lt;&lt; <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) - 1); d++) {
                    int32_t index = (i / <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) * ((1 &lt;&lt; <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) - 1) + d;
                    <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">continue</span>;
                    <span class="keywordflow">if</span> ((<a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index] == NULL) ||
                        ((simTime() - <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index]-&gt;getLastUsage()) &gt;
                        <a class="code" href="classKademlia.html#abda8d541b714ec855d891a2938fa8b3f">minBucketRefreshInterval</a>)) {

                        <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> refreshKey =
                            <a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() ^ (<a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a>(d+1) &lt;&lt; i);

                        <span class="comment">// R/Kademlia</span>
                        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a18b63fe85aa5e81cd3fca5e3c7c9df82">SEMI_RECURSIVE_ROUTING</a> ||
                            <a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551aeec4ce5cac6dae9d3d59b1347a9df957">FULL_RECURSIVE_ROUTING</a> ||
                            <a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ad8c4eefed3d826e5da402fe582cad2c1">RECURSIVE_SOURCE_ROUTING</a>) {
                            <span class="comment">//TODO real exhaustive-recursive lookup</span>
                            <a class="code" href="classBaseOverlay.html#a205a7d44401fb3d77b146e23b2904b6f" title="Creates an abstract iterative lookup instance.">createLookup</a>()-&gt;<a class="code" href="classAbstractLookup.html#aa1bda70950cbd160ea78d1fcbd8c7767" title="Lookup siblings for a key.">lookup</a>(refreshKey, 0,
                                                   <a class="code" href="classBaseOverlay.html#abffe6fbd25963bc2b7542f22ba6455b9" title="maximum hop count">hopCountMax</a>, 0,
                                                   <span class="keyword">new</span> <a class="code" href="classKademlia.html#a61b072e95046f98ad49a3f5589fe9a45">KademliaLookupListener</a>(<span class="keyword">this</span>));
                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#ae7a670589ec838bbf79d684fba016185">exhaustiveRefresh</a>) {
                            <span class="comment">//TODO config shit</span>
                            <span class="keywordtype">int</span> baseRedundantNodes = <a class="code" href="classBaseOverlay.html#a32b8cfb47f3ef824dcf6ad882e6a6a9f">iterativeLookupConfig</a>.<a class="code" href="classIterativeLookupConfiguration.html#a5ffefd1d559420cc498307521ae1fac7" title="number of next hops in each step">redundantNodes</a>;
                            <a class="code" href="classBaseOverlay.html#a32b8cfb47f3ef824dcf6ad882e6a6a9f">iterativeLookupConfig</a>.<a class="code" href="classIterativeLookupConfiguration.html#a5ffefd1d559420cc498307521ae1fac7" title="number of next hops in each step">redundantNodes</a> = <a class="code" href="classKademlia.html#a5ab8d39b7c098f21d9577d5dfc82a4f4">bucketRefreshNodes</a>;
                            <a class="code" href="classBaseOverlay.html#a205a7d44401fb3d77b146e23b2904b6f" title="Creates an abstract iterative lookup instance.">createLookup</a>(<a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ad60cf756d6bb24af372d7fe7c279f44d">EXHAUSTIVE_ITERATIVE_ROUTING</a>)-&gt;<a class="code" href="classAbstractLookup.html#aa1bda70950cbd160ea78d1fcbd8c7767" title="Lookup siblings for a key.">lookup</a>(
                                refreshKey, <a class="code" href="classKademlia.html#a5ab8d39b7c098f21d9577d5dfc82a4f4">bucketRefreshNodes</a>, <a class="code" href="classBaseOverlay.html#abffe6fbd25963bc2b7542f22ba6455b9" title="maximum hop count">hopCountMax</a>,
                                0, <span class="keyword">new</span> <a class="code" href="classKademlia.html#a61b072e95046f98ad49a3f5589fe9a45">KademliaLookupListener</a>(<span class="keyword">this</span>));
                            <a class="code" href="classBaseOverlay.html#a32b8cfb47f3ef824dcf6ad882e6a6a9f">iterativeLookupConfig</a>.<a class="code" href="classIterativeLookupConfiguration.html#a5ffefd1d559420cc498307521ae1fac7" title="number of next hops in each step">redundantNodes</a> = baseRedundantNodes;
                        } <span class="keywordflow">else</span> {
                            <a class="code" href="classBaseOverlay.html#a205a7d44401fb3d77b146e23b2904b6f" title="Creates an abstract iterative lookup instance.">createLookup</a>()-&gt;<a class="code" href="classAbstractLookup.html#aa1bda70950cbd160ea78d1fcbd8c7767" title="Lookup siblings for a key.">lookup</a>(refreshKey, <a class="code" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a>, <a class="code" href="classBaseOverlay.html#abffe6fbd25963bc2b7542f22ba6455b9" title="maximum hop count">hopCountMax</a>, 0,
                                             <span class="keyword">new</span> <a class="code" href="classKademlia.html#a61b072e95046f98ad49a3f5589fe9a45">KademliaLookupListener</a>(<span class="keyword">this</span>));
                        }

                        ++bucketsRefreshedPerTask;
                        ++<a class="code" href="classKademlia.html#a210614b1ea667d544d256a1cc5e94490">bucketRefreshCount</a>;
                        <a class="code" href="classKademlia.html#a7581a168ae2e143001a7a93ff4a1779a">setBucketUsage</a>(refreshKey);
                    }
                }
            }
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#aa41614baf1d51fab0904abb41b642234" title="Record a value to a global cOutVector defined by name.">recordOutVector</a>(
                                   <span class="stringliteral">&quot;Kademlia: Buckets Refreshed Per Task&quot;</span>,
                                   bucketsRefreshedPerTask));
        }
        <span class="comment">// schedule next bucket refresh process</span>
        cancelEvent(<a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);
        scheduleAt(simTime() + (std::min(<a class="code" href="classKademlia.html#ae22800e069a69a317d4906a29e4da71d">minSiblingTableRefreshInterval</a>,
                        <a class="code" href="classKademlia.html#abda8d541b714ec855d891a2938fa8b3f">minBucketRefreshInterval</a>) / 10.0), <a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aebd62488323d6cebf7812974114ed38b"></a><!-- doxytag: member="Kademlia::handleFailedNode" ref="aebd62488323d6cebf7812974114ed38b" args="(const TransportAddress &amp;failed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Kademlia::handleFailedNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>failed</em></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a failed node. </p>
<p>This method is called whenever a node given by <a class="el" href="classKademlia.html#aafad68d123da52e5fefb719699ed2dc3" title="Implements the find node call.">findNode()</a> was unreachable. The default implementation does nothing at all.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">failed</td><td>the failed node </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if lookup should retry here </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#aa53ca4e1b4720ba0d2874afe29eacbf7">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00846">846</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    assert(!failed.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>());

    <a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i;
    <span class="comment">// check sibling table</span>
    <span class="keywordflow">for</span> (i = <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;begin(); i != <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;end(); ++i) {
        <span class="keywordflow">if</span> (failed == *i) <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">if</span> (i != <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;end()) {
        <span class="comment">// remove from sibling table</span>
        <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> oldSibling = *i;
        <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;erase(i);

        <span class="comment">// call update() for removed sibling</span>
        <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(oldSibling);
        <a class="code" href="classBaseOverlay.html#a1422696a8eb138dde850390152ff88c7" title="Informs application about state changes of nodes or newly joined nodes.">callUpdate</a>(oldSibling, <span class="keyword">false</span>);

        <a class="code" href="classKademlia.html#acd029f455e0c6150c038c69fa493696c" title="updates information shown in GUI">updateTooltip</a>();

        <span class="comment">// try to refill with new closest contact</span>
        <a class="code" href="classKademlia.html#a0cf73bc94792b9be525f73fa3a4551da">refillSiblingTable</a>();
    } <span class="keywordflow">else</span> {
        <span class="comment">// check buckets</span>
        uint32_t m;
        <span class="keywordflow">for</span> (m = 0; m &lt; <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>.size(); ++m) {
            <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[m] != NULL) {
                <span class="keywordflow">for</span> (i = <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[m]-&gt;begin(); i != <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[m]-&gt;end();
                     ++i) {
                    <span class="keywordflow">if</span> (failed == *i) {
                        <span class="comment">// remove from routing table</span>
                        <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[m]-&gt;erase(i);
                        <span class="keywordflow">return</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size() != 0);
                    }
                }
            }
        }
    }
    <span class="keywordflow">return</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size() != 0);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae21a58f63a448c1b41edd84c2e5a0cb0"></a><!-- doxytag: member="Kademlia::handleNodeGracefulLeaveNotification" ref="ae21a58f63a448c1b41edd84c2e5a0cb0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::handleNodeGracefulLeaveNotification </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method gets call **.gracefulLeaveDelay seconds before it is killed if this node is among the gracefulLeaveProbability nodes. </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#aa2d70984acd164839ca92694a02e7a91">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00831">831</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// send failed node call to all siblings</span>
    <a class="code" href="classFailedNodeCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">FailedNodeCall</a>* call = <span class="keyword">new</span> <a class="code" href="classFailedNodeCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">FailedNodeCall</a>();
    call-&gt;<a class="code" href="classFailedNodeCall.html#a3aa565698093b08c3919263e197c97d4">setFailedNode</a>(<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>());
    call-&gt;setBitLength(<a class="code" href="CommonMessages__m_8h.html#a2f5fa84bc72cc769fe63a311220673cc">FAILEDNODECALL_L</a>(call));
    <span class="keywordflow">for</span> (<a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i = <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;begin();
         i != <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;end(); i++) {
        <a class="code" href="classBaseOverlay.html#a189d4d1410399ecd264b5bfe6fc85e0f">countFailedNodeCall</a>(call);
        <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(*i, call-&gt;<a class="code" href="classFailedNodeCall.html#aef0520606683586be77adef44fd4629d">dup</a>());
    }

    <span class="keyword">delete</span> call;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a82d872d3d7797e94985557d04f7c9ed5"></a><!-- doxytag: member="Kademlia::handleRpcCall" ref="a82d872d3d7797e94985557d04f7c9ed5" args="(BaseCallMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Kademlia::handleRpcCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes Remote-Procedure-Call invocation messages. </p>
<p><br/>
</p>
<p>This method should be overloaded when the overlay provides RPC functionality.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if rpc has been handled </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseRpc.html#a20e77c3e0c203762a5b582ffebe3ba4b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01159">1159</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> maintenanceLookup = (msg-&gt;<a class="code" href="classBaseOverlayMessage.html#af0a4bf31778e05a809f8d55dff5bfcc1">getStatType</a>() == <a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(Ping) {
        <span class="comment">// add active node</span>
        <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>* ctrlInfo =
            check_and_cast&lt;<a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*&gt;(msg-&gt;getControlInfo());
        <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>(), <span class="keyword">true</span>, MAXTIME, maintenanceLookup);
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(FindNode)
    {
        <span class="comment">// add active node</span>
        <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>* ctrlInfo =
            check_and_cast&lt;<a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*&gt;(msg-&gt;getControlInfo());
        <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>(), <span class="keyword">true</span>, MAXTIME, maintenanceLookup);
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()
    return false;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af8451d8dae93dbb1117574b3820af76e"></a><!-- doxytag: member="Kademlia::handleRpcResponse" ref="af8451d8dae93dbb1117574b3820af76e" args="(BaseResponseMessage *msg, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::handleRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC response has been received. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The response message. </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classKademlia.html#af8451d8dae93dbb1117574b3820af76e" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">rtt</td><td>The Round-Trip-Time of this RPC </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#a6229090a446fb649cfec3c1fb61e7167">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01183">1183</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">bool</span> maintenanceLookup = (msg-&gt;<a class="code" href="classBaseOverlayMessage.html#af0a4bf31778e05a809f8d55dff5bfcc1">getStatType</a>() == <a class="code" href="CommonMessages__m_8h.html#a25418fa818fbb01cd8c0b2c4b0732cdfad7989a419a7028d382d7b6e6d17e88c5">MAINTENANCE_STAT</a>);
    <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>* ctrlInfo =
        <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*<span class="keyword">&gt;</span>(msg-&gt;getControlInfo());
    <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> srcRoute = (ctrlInfo ? ctrlInfo-&gt;<a class="code" href="classOverlayCtrlInfo.html#ad1a712f1757d7441e1a74ad98bfd71f4">getSrcRoute</a>()
                                    : msg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>());

    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
        <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(Ping) {
            <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>) {
                <span class="comment">// schedule bucket refresh timer</span>
                cancelEvent(<a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);
                scheduleAt(simTime(), <a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);
                cancelEvent(<a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a>);
                scheduleAt(simTime() + <a class="code" href="classKademlia.html#a99dbb3ee2302a9861a518b3d75cb3eb2">siblingPingInterval</a>, <a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a>);
                <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>;
            }
        }
        <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(FindNode)
        {
            <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>) {
                <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>;

                <span class="comment">// bootstrap node is trustworthy: add all nodes immediately</span>
                <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(srcRoute, <span class="keyword">true</span>, rtt, maintenanceLookup);
                <span class="keywordflow">for</span> (uint32_t i=0; i&lt;_FindNodeResponse-&gt;getClosestNodesArraySize(); i++)
                    <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(_FindNodeResponse-&gt;getClosestNodes(i), <span class="keyword">true</span>,
                               MAXTIME-1, maintenanceLookup);

                <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a68e77f3b48652f19219a6c6c9a1a76d2">newMaintenance</a>) {
                    <a class="code" href="classBaseOverlay.html#a205a7d44401fb3d77b146e23b2904b6f" title="Creates an abstract iterative lookup instance.">createLookup</a>()-&gt;<a class="code" href="classAbstractLookup.html#aa1bda70950cbd160ea78d1fcbd8c7767" title="Lookup siblings for a key.">lookup</a>(<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().getKey(), <a class="code" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a>, <a class="code" href="classBaseOverlay.html#abffe6fbd25963bc2b7542f22ba6455b9" title="maximum hop count">hopCountMax</a>, 0,
                                       <span class="keyword">new</span> <a class="code" href="classKademlia.html#a61b072e95046f98ad49a3f5589fe9a45">KademliaLookupListener</a>(<span class="keyword">this</span>));
                } <span class="keywordflow">else</span> {
                    <span class="comment">// schedule bucket refresh timer</span>
                    cancelEvent(<a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);
                    scheduleAt(simTime(), <a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);
                    cancelEvent(<a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a>);
                    scheduleAt(simTime() + <a class="code" href="classKademlia.html#a99dbb3ee2302a9861a518b3d75cb3eb2">siblingPingInterval</a>, <a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a>);
                }

                <span class="keywordflow">break</span>;
            }

            <span class="comment">// add active node</span>
            <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a18b63fe85aa5e81cd3fca5e3c7c9df82">SEMI_RECURSIVE_ROUTING</a> ||
                <a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551aeec4ce5cac6dae9d3d59b1347a9df957">FULL_RECURSIVE_ROUTING</a> ||
                <a class="code" href="classBaseOverlay.html#a9e13844ea8090b84a90286f048cdcbf9">defaultRoutingType</a> == <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551ad8c4eefed3d826e5da402fe582cad2c1">RECURSIVE_SOURCE_ROUTING</a>) {
                rtt = MAXTIME;
            }
            <a class="code" href="classKademlia.html#a7581a168ae2e143001a7a93ff4a1779a">setBucketUsage</a>(srcRoute.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>());

            <span class="comment">// add inactive nodes</span>
            <span class="keywordflow">for</span> (uint32_t i=0; i&lt;_FindNodeResponse-&gt;getClosestNodesArraySize(); i++)
                <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(_FindNodeResponse-&gt;getClosestNodes(i), <span class="keyword">false</span>,
                           MAXTIME, maintenanceLookup);
            <span class="keywordflow">break</span>;
        }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()

    <span class="comment">// add node that responded</span>
    <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(srcRoute, true, rtt, maintenanceLookup);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9c237aa2447a9b2323bf34a95c852005"></a><!-- doxytag: member="Kademlia::handleRpcTimeout" ref="a9c237aa2447a9b2323bf34a95c852005" args="(BaseCallMessage *msg, const TransportAddress &amp;dest, cPolymorphic *context, int rpcId, const OverlayKey &amp;destKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::handleRpcTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>destKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC timeout has been reached. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The original RPC message. </td></tr>
    <tr><td class="paramname">dest</td><td>The destination node </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classKademlia.html#af8451d8dae93dbb1117574b3820af76e" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">destKey</td><td>the destination <a class="el" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#aaaf9cd362481527ed995dd159aa96b73">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01250">1250</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (dest.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) <span class="keywordflow">return</span>;
    <span class="keywordflow">try</span> {
        <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
        <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(Ping) {
            <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>) {
                <a class="code" href="classKademlia.html#a23662900f3d17541a2b9051a3821a226" title="Join the overlay with a given nodeID in thisNode.key.">joinOverlay</a>();
                <span class="keywordflow">return</span>;
            }

            <span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp; handle = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp;<span class="keyword">&gt;</span>(dest);
            <a class="code" href="classKademlia.html#a21ca74bfdaf4114ca2f468935856e67b" title="Removes a node after a number of timeouts or immediately if immediately is true (behaves like routing...">routingTimeout</a>(handle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>());
            <span class="keywordflow">break</span>;
        }
        <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(FindNode) {
            <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>) {
                <a class="code" href="classKademlia.html#a23662900f3d17541a2b9051a3821a226" title="Join the overlay with a given nodeID in thisNode.key.">joinOverlay</a>();
                <span class="keywordflow">return</span>;
            }

            <span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp; handle = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp;<span class="keyword">&gt;</span>(dest);
            <a class="code" href="classKademlia.html#a21ca74bfdaf4114ca2f468935856e67b" title="Removes a node after a number of timeouts or immediately if immediately is true (behaves like routing...">routingTimeout</a>(handle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>());
            <a class="code" href="classKademlia.html#a7581a168ae2e143001a7a93ff4a1779a">setBucketUsage</a>(handle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>());
            <span class="keywordflow">break</span>;
        }
        <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()
    } <span class="keywordflow">catch</span> (...) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia:handleRpcTimout() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    ERROR: RPC timeout without key (&quot;</span>
           &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; dest &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
        <span class="keywordflow">return</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a27b31a4a713eadd2c8f1a83d66dc69a7"></a><!-- doxytag: member="Kademlia::handleTimerEvent" ref="a27b31a4a713eadd2c8f1a83d66dc69a7" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ab893c156412e38caa62fe058b229899b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01121">1121</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg == <a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>) {
        <a class="code" href="classKademlia.html#a53a73a3a496d4fe37c0310b7b6eee214" title="handle a expired bucket refresh timer">handleBucketRefreshTimerExpired</a>();
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == <a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a>) {
        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a99dbb3ee2302a9861a518b3d75cb3eb2">siblingPingInterval</a> == 0) {
            <span class="keywordflow">return</span>;
        }

        <span class="keywordflow">for</span> (<a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i = <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;begin();
             i != <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;end(); i++) {
            <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(*i);
        }
        scheduleAt(simTime() + <a class="code" href="classKademlia.html#a99dbb3ee2302a9861a518b3d75cb3eb2">siblingPingInterval</a>, msg);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="af1edeee0ba2c1f2fb26355076814f102"></a><!-- doxytag: member="Kademlia::handleUDPMessage" ref="af1edeee0ba2c1f2fb26355076814f102" args="(BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::handleUDPMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes messages from underlay. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Message from UDP </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a31d7dd39ddc9e62ad92f69f6d7210344">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01139">1139</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// only used for recursive Kademlia</span>
    <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>* ctrlInfo =
            check_and_cast&lt;<a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*&gt;(msg-&gt;removeControlInfo());
    <a class="code" href="classKademliaRoutingInfoMessage.html" title="Class generated from overlay/kademlia/KademliaMessage.msg by opp_msgc.">KademliaRoutingInfoMessage</a>* kadRoutingInfoMsg =
            check_and_cast&lt;<a class="code" href="classKademliaRoutingInfoMessage.html" title="Class generated from overlay/kademlia/KademliaMessage.msg by opp_msgc.">KademliaRoutingInfoMessage</a>*&gt;(msg);

    <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(kadRoutingInfoMsg-&gt;getSrcNode(), <span class="keyword">true</span>);

    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; kadRoutingInfoMsg-&gt;getNextHopsArraySize(); i++) {
        <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(kadRoutingInfoMsg-&gt;getNextHops(i),
                   kadRoutingInfoMsg-&gt;getNextHops(i).getIsAlive());
    }

    <span class="keyword">delete</span> ctrlInfo;
    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3230c643b585b8f0745cebb7a577349c"></a><!-- doxytag: member="Kademlia::initializeOverlay" ref="a3230c643b585b8f0745cebb7a577349c" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::initializeOverlay </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes derived-class-attributes. </p>
<p><br/>
</p>
<p>Initializes derived-class-attributes, called by <a class="el" href="classBaseOverlay.html#a9738ba6065b0f699f1921bbe82ab97be" title="initializes base-class-attributes">BaseOverlay::initialize()</a>. By default this method is called once. If more stages are needed one can overload <a class="el" href="classBaseOverlay.html#a3234dfcf81463984e88a42432734a615" title="Sets init stage.">numInitStages()</a> and add more stages.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a41f88dfbea856a2b38319ff52c758c96">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00095">95</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a58e83c497c7c8495e9c592ff3148b6b9" title="first stage for overlay modules (Tier 0 / KBR)">MIN_STAGE_OVERLAY</a>)
        <span class="keywordflow">return</span>;

    <span class="comment">// Kademlia provides KBR services</span>
    <a class="code" href="classBaseOverlay.html#a53389ea3326d2e8ad53f02b388487d0b" title="set this to true, if the overlay provides KBR services">kbr</a> = <span class="keyword">true</span>;

    <span class="comment">// setup kademlia parameters</span>
    <a class="code" href="classKademlia.html#ae22800e069a69a317d4906a29e4da71d">minSiblingTableRefreshInterval</a> = par(<span class="stringliteral">&quot;minSiblingTableRefreshInterval&quot;</span>);
    <a class="code" href="classKademlia.html#abda8d541b714ec855d891a2938fa8b3f">minBucketRefreshInterval</a> = par(<span class="stringliteral">&quot;minBucketRefreshInterval&quot;</span>);
    <a class="code" href="classKademlia.html#a99dbb3ee2302a9861a518b3d75cb3eb2">siblingPingInterval</a> = par(<span class="stringliteral">&quot;siblingPingInterval&quot;</span>);
    <a class="code" href="classKademlia.html#ae7a670589ec838bbf79d684fba016185">exhaustiveRefresh</a> = par(<span class="stringliteral">&quot;exhaustiveRefresh&quot;</span>);
    <a class="code" href="classKademlia.html#a742e20c8d232a8623f4a85c2f0cad1e4">maxStaleCount</a> = par(<span class="stringliteral">&quot;maxStaleCount&quot;</span>);
    <a class="code" href="classKademlia.html#a113faa91ed3ec564f8b61718101695c2">pingNewSiblings</a> = par(<span class="stringliteral">&quot;pingNewSiblings&quot;</span>);
    <a class="code" href="classKademlia.html#a151fd59bc6de940e684fbad408083ac4">enableReplacementCache</a> = par(<span class="stringliteral">&quot;enableReplacementCache&quot;</span>);
    <a class="code" href="classKademlia.html#adc22fe7536c4bea9677ed901b95820a8">replacementCachePing</a> = par(<span class="stringliteral">&quot;replacementCachePing&quot;</span>);
    <a class="code" href="classKademlia.html#a8ebc8abde092aad89dfa813ba640e6ef">replacementCandidates</a> = par(<span class="stringliteral">&quot;replacementCandidates&quot;</span>);
    <a class="code" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd" title="if true, ping not authenticated nodes before adding them to a bucket">secureMaintenance</a> = par(<span class="stringliteral">&quot;secureMaintenance&quot;</span>);
    <a class="code" href="classKademlia.html#a68e77f3b48652f19219a6c6c9a1a76d2">newMaintenance</a> = par(<span class="stringliteral">&quot;newMaintenance&quot;</span>);

    <span class="comment">// R/Kademlia</span>
    <a class="code" href="classKademlia.html#aa83e5da5199e71427e731d4a1ad7ce9d">activePing</a> = par(<span class="stringliteral">&quot;activePing&quot;</span>);
    <a class="code" href="classKademlia.html#aa8b1be416dea22c671ae2774936226c5">proximityRouting</a> = par(<span class="stringliteral">&quot;proximityRouting&quot;</span>);
    <a class="code" href="classKademlia.html#aa1c9d6f7ff020a8a9249f1da3d1fedbe">proximityNeighborSelection</a> = par(<span class="stringliteral">&quot;proximityNeighborSelection&quot;</span>);
    <a class="code" href="classKademlia.html#a53857e5e13f67a12e810db01a18400dc">altRecMode</a> = <a class="code" href="classBaseOverlay.html#a61186fd8bd7368c8a91a63ecc9c62a89" title="record visited hops on route">recordRoute</a> = par(<span class="stringliteral">&quot;altRecMode&quot;</span>);

    <a class="code" href="classKademlia.html#acc2f4767a1687764f2d732872511a7ad">k</a> = par(<span class="stringliteral">&quot;k&quot;</span>);
    <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a> = par(<span class="stringliteral">&quot;b&quot;</span>);
    <a class="code" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a> = par(<span class="stringliteral">&quot;s&quot;</span>);

    <a class="code" href="classKademlia.html#ad4d31fcf8c7300404ae07523daab8cc6">siblingRefreshNodes</a> = par(<span class="stringliteral">&quot;siblingRefreshNodes&quot;</span>);

    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#ad4d31fcf8c7300404ae07523daab8cc6">siblingRefreshNodes</a> &lt;= 0) {
        <a class="code" href="classKademlia.html#ad4d31fcf8c7300404ae07523daab8cc6">siblingRefreshNodes</a> = 5 * <a class="code" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a>;
    }

    <a class="code" href="classKademlia.html#a5ab8d39b7c098f21d9577d5dfc82a4f4">bucketRefreshNodes</a> = par(<span class="stringliteral">&quot;bucketRefreshNodes&quot;</span>);

    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a5ab8d39b7c098f21d9577d5dfc82a4f4">bucketRefreshNodes</a> &lt;= 0) {
        <a class="code" href="classKademlia.html#a5ab8d39b7c098f21d9577d5dfc82a4f4">bucketRefreshNodes</a> = <a class="code" href="classBaseOverlay.html#a32b8cfb47f3ef824dcf6ad882e6a6a9f">iterativeLookupConfig</a>.<a class="code" href="classIterativeLookupConfiguration.html#a5ffefd1d559420cc498307521ae1fac7" title="number of next hops in each step">redundantNodes</a>;
    }

    <span class="comment">// calculate number of buckets: ( (2^b)-1 ) * ( keylength / b )</span>
    <a class="code" href="classKademlia.html#a307336180b2937d77360219c9ac91c3c">numBuckets</a> = ((1L &lt;&lt; <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) - 1L) * (<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() / <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>);

    <span class="comment">// init routing and sibling table</span>
    <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a> = <span class="keyword">new</span> <a class="code" href="classKademliaBucket.html">KademliaBucket</a>(<a class="code" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a> * 5, NULL);

    <span class="comment">// initialize pointers</span>
    <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>.assign(<a class="code" href="classKademlia.html#a307336180b2937d77360219c9ac91c3c">numBuckets</a>, (<a class="code" href="classKademliaBucket.html">KademliaBucket</a>*)NULL);

    WATCH_VECTOR(*<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>);
    WATCH_VECTOR(<a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>);

    <span class="comment">// self-message</span>
    <a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;bucketRefreshTimer&quot;</span>);
    <a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;siblingPingTimer&quot;</span>);

    <span class="comment">// statistics</span>
    <a class="code" href="classKademlia.html#a210614b1ea667d544d256a1cc5e94490">bucketRefreshCount</a> = 0;
    <a class="code" href="classKademlia.html#a9b7cdab70352fcc52c0cfe55541807ef">siblingTableRefreshCount</a> = 0;
    <a class="code" href="classKademlia.html#aa1eda90d9ae7c58ff916a9d493d7c1e6">nodesReplaced</a> = 0;

    <a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a> = NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ada80a26aba760ec53ce539d8180cf865"></a><!-- doxytag: member="Kademlia::isSiblingFor" ref="ada80a26aba760ec53ce539d8180cf865" args="(const NodeHandle &amp;node, const OverlayKey &amp;key, int numSiblings, bool *err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Kademlia::isSiblingFor </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numSiblings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query if a node is among the siblings for a given key. </p>
<p>Query if a node is among the siblings for a given key. This means, that the nodeId of this node is among the closest numSiblings nodes to the key and that by a local <a class="el" href="classKademlia.html#aafad68d123da52e5fefb719699ed2dc3" title="Implements the find node call.">findNode()</a> call all other siblings to this key can be retrieved.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>the <a class="el" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> </td></tr>
    <tr><td class="paramname">key</td><td>destination key </td></tr>
    <tr><td class="paramname">numSiblings</td><td>The nodes knows all numSiblings nodes close to this key </td></tr>
    <tr><td class="paramname">err</td><td>return false if the range could not be determined </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>bool true, if the node is responsible for the key. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#ab5887b89ba9da5973068e834feb69ce7">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00755">755</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00969">findNode()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (key.<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>())
        <a class="code" href="yang_8cc.html#adb989392f8aada21b0f7ec2f7a41dc00">error</a>(<span class="stringliteral">&quot;Kademlia::isSiblingFor(): key is unspecified!&quot;</span>);

    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::isSiblingFor()] @ &quot;</span>
           &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    state != READY&quot;</span>
           &lt;&lt; endl;
        *err = <span class="keyword">true</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (numSiblings &gt; <a class="code" href="classKademlia.html#a7253ff80d709265f6e74d3ebf4e691ad" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>()) {
        opp_error(<span class="stringliteral">&quot;Kademlia::isSiblingFor(): numSiblings too big!&quot;</span>);
    }

    <span class="comment">// set default number of siblings to consider</span>
    <span class="keywordflow">if</span> (numSiblings == -1) {
        numSiblings = <a class="code" href="classKademlia.html#a7253ff80d709265f6e74d3ebf4e691ad" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>();
    }

    <span class="keywordflow">if</span> (numSiblings == 0) {
        *err = <span class="keyword">false</span>;
        <span class="keywordflow">return</span> (node.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() == key);
    }

    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size() &lt; (uint)numSiblings) {
        *err = <span class="keyword">false</span>;
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#ad96fd23183bf954e2613af5430ecb48d" title="indicates if NodeVector holds maxSize nodes">isFull</a>() &amp;&amp;
        ((<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() ^ key) &gt;
         (<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() ^ <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;back().getKey()))) {
        EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::isSiblingFor()] @ &quot;</span>
           &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Not sure if I am sibling for &quot;</span> &lt;&lt; key &lt;&lt; <span class="stringliteral">&quot; !\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    (&quot;</span> &lt;&lt; key &lt;&lt; <span class="stringliteral">&quot; is not closer to me than &quot;</span>
           &lt;&lt; <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;back().getKey() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>
           &lt;&lt; endl;
        *err = <span class="keyword">true</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>* comp =
        <span class="keyword">new</span> <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>(key);

    <span class="comment">// create result vector</span>
    <a class="code" href="classBaseKeySortedVector.html" title="A STL-vector that supports inserts sorted by an OverlayKey found somewhere in the type...">NodeVector</a>* result = <span class="keyword">new</span> <a class="code" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a>(numSiblings, comp);

    <span class="keywordflow">for</span> (<a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i=<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;begin();
         i != <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;end(); i++) {
        result-&gt;add( *i);
    }

    <span class="comment">// add local node</span>
    result-&gt;add(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);

    *err = <span class="keyword">false</span>;
    <span class="keyword">delete</span> comp;

    <span class="keywordflow">if</span> (result-&gt;contains(node.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>())) {
        <span class="keyword">delete</span> result;
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    } <span class="keywordflow">else</span> {
        <span class="keyword">delete</span> result;
        assert(!(numSiblings == 1 &amp;&amp; key == node.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>()));
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a23662900f3d17541a2b9051a3821a226"></a><!-- doxytag: member="Kademlia::joinOverlay" ref="a23662900f3d17541a2b9051a3821a226" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::joinOverlay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Join the overlay with a given nodeID in thisNode.key. </p>
<p>Join the overlay with a given nodeID in thisNode.key. This method may be called by an application to join the overlay with a specific nodeID. It is also called if the node's IP address changes. </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a3eefb56c2396601373c89d21b5b58110">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00204">204</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01250">handleRpcTimeout()</a>, and <a class="el" href="Kademlia_8cc_source.html#l01302">lookupFinished()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// remove current node handle from the bootstrap list</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>()) {
        <a class="code" href="classBaseOverlay.html#abe4dea93564123116c97d5c4721f0504" title="pointer to the BootstrapList module">bootstrapList</a>-&gt;<a class="code" href="classBootstrapList.html#a918cbbc5c592fb9069abba47a50af7c0">removeBootstrapNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    }

    <span class="comment">// initialize routing</span>
    <a class="code" href="classKademlia.html#ad54c5bcac7db895e0e0eec5cd0109da2">routingDeinit</a>();
    <a class="code" href="classKademlia.html#a0fc8d7eadb6ed086536cbc273460d7a9">routingInit</a>();

    <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> handle = <a class="code" href="classBaseOverlay.html#abe4dea93564123116c97d5c4721f0504" title="pointer to the BootstrapList module">bootstrapList</a>-&gt;<a class="code" href="classBootstrapList.html#ac351433be1d43bbf8cbb871e9f9e1f69" title="Get a bootstrap node from the bootstrap list.">getBootstrapNode</a>();

    <span class="keywordflow">if</span> (!handle.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>()) {
        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd" title="if true, ping not authenticated nodes before adding them to a bucket">secureMaintenance</a>) {
            <a class="code" href="classKademlia.html#a837fc1c137eebd1189ff401b4bd97a99">sendSiblingFindNodeCall</a>(handle);
        } <span class="keywordflow">else</span> {
            <span class="comment">// ping the bootstrap node to start bootstrapping</span>
            <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(handle);
        }
    } <span class="keywordflow">else</span> {
        <span class="comment">// we&#39;re the only node in the network</span>
        <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>;
        <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>(<span class="keyword">true</span>);

        <span class="comment">// schedule bucket refresh timer</span>
        cancelEvent(<a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);
        scheduleAt(simTime(), <a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);
        cancelEvent(<a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a>);
        scheduleAt(simTime() + <a class="code" href="classKademlia.html#a99dbb3ee2302a9861a518b3d75cb3eb2">siblingPingInterval</a>, <a class="code" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">siblingPingTimer</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="adac287af3943cfcbc1a3834fa8d0c37d"></a><!-- doxytag: member="Kademlia::lookupFinished" ref="adac287af3943cfcbc1a3834fa8d0c37d" args="(bool isValid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::lookupFinished </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isValid</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01302">1302</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00086">KademliaLookupListener::lookupFinished()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>) {
        cancelEvent(<a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);

        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size() == 0) {
            <span class="comment">// initial lookup failed - get new bootstrap node</span>
            <a class="code" href="classKademlia.html#a23662900f3d17541a2b9051a3821a226" title="Join the overlay with a given nodeID in thisNode.key.">joinOverlay</a>();
            <span class="keywordflow">return</span>;
        }

        scheduleAt(simTime(), <a class="code" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">bucketRefreshTimer</a>);

        <span class="keywordflow">if</span> (!<a class="code" href="classKademlia.html#a68e77f3b48652f19219a6c6c9a1a76d2">newMaintenance</a>) {
            <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>;
            <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>(<span class="keyword">true</span>);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7545cb508c37d7bf706b3e5a4950c695"></a><!-- doxytag: member="Kademlia::proxCallback" ref="a7545cb508c37d7bf706b3e5a4950c695" args="(const TransportAddress &amp;node, int rpcId, cPolymorphic *contextPointer, Prox prox)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::proxCallback </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>contextPointer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structProx.html">Prox</a>&#160;</td>
          <td class="paramname"><em>prox</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="classProxListener.html#a9bf3b6acf121217a24a44cc2accfeeb3">ProxListener</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01290">1290</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    Enter_Method_Silent();

    <span class="keywordflow">if</span> (prox != <a class="code" href="structProx.html#a5ded765f6344797ea0e9c35c85cd61af">Prox::PROX_TIMEOUT</a>) {
        <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>((<span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp;)node, <span class="keyword">true</span>, prox.<a class="code" href="structProx.html#aeb8eca3cac2c681c5e7f1060fcbd7b6f">proximity</a>);
    } <span class="keywordflow">else</span> {
        <a class="code" href="classKademlia.html#a21ca74bfdaf4114ca2f468935856e67b" title="Removes a node after a number of timeouts or immediately if immediately is true (behaves like routing...">routingTimeout</a>(((<span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp;)node).getKey());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2d0f3eebfa308ff4c88831d917efa8fd"></a><!-- doxytag: member="Kademlia::recursiveRoutingHook" ref="a2d0f3eebfa308ff4c88831d917efa8fd" args="(const TransportAddress &amp;dest, BaseRouteMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Kademlia::recursiveRoutingHook </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseRouteMessage.html">BaseRouteMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Hook for forwarded message in recursive lookup mode. </p>
<p>This hook is called just before a message is forwarded to a next hop or if the message is at its destination just before it is sent to the app. Default implementation just returns true. This hook can for example be used to detect failed nodes and call <a class="el" href="classKademlia.html#aebd62488323d6cebf7812974114ed38b" title="Handles a failed node.">handleFailedNode()</a> before the actual forwarding takes place.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">dest</td><td>destination node </td></tr>
    <tr><td class="paramname">msg</td><td>message to send </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if message should be forwarded; false, if message will be forwarded later by an other function or message has been discarded </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a42f4c08f6408d155a9907957ecf12d79">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00889">889</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classBaseRouteMessage.html#af9787d89915f01a2055e920148015e17">getSrcNode</a>() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) {
        <span class="keywordflow">if</span> (!msg-&gt;<a class="code" href="classBaseRouteMessage.html#ad983641a05758bc9d25070f1659b2f34">getDestKey</a>().<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>()) {
            <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(msg-&gt;<a class="code" href="classBaseRouteMessage.html#af9787d89915f01a2055e920148015e17">getSrcNode</a>(), <span class="keyword">true</span>);

            <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a53857e5e13f67a12e810db01a18400dc">altRecMode</a> &amp;&amp; dest != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>) <span class="keywordflow">return</span> <span class="keyword">true</span>;

            <a class="code" href="classBaseKeySortedVector.html" title="A STL-vector that supports inserts sorted by an OverlayKey found somewhere in the type...">NodeVector</a>* nextHops = <a class="code" href="classKademlia.html#aafad68d123da52e5fefb719699ed2dc3" title="Implements the find node call.">findNode</a>(msg-&gt;<a class="code" href="classBaseRouteMessage.html#ad983641a05758bc9d25070f1659b2f34">getDestKey</a>(), <span class="comment">/*recursiveLookupConfig.redundantNodes*/</span> <a class="code" href="classKademlia.html#acc2f4767a1687764f2d732872511a7ad">k</a>, <a class="code" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a>, msg);
            <a class="code" href="classKademliaRoutingInfoMessage.html" title="Class generated from overlay/kademlia/KademliaMessage.msg by opp_msgc.">KademliaRoutingInfoMessage</a>* kadRoutingInfoMsg =
                <span class="keyword">new</span> <a class="code" href="classKademliaRoutingInfoMessage.html" title="Class generated from overlay/kademlia/KademliaMessage.msg by opp_msgc.">KademliaRoutingInfoMessage</a>();

            kadRoutingInfoMsg-&gt;setSrcNode(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
            kadRoutingInfoMsg-&gt;setDestKey(msg-&gt;<a class="code" href="classBaseRouteMessage.html#ad983641a05758bc9d25070f1659b2f34">getDestKey</a>());
            kadRoutingInfoMsg-&gt;setNextHopsArraySize(nextHops-&gt;size());
            kadRoutingInfoMsg-&gt;setName(<span class="stringliteral">&quot;KadRoutingInfoMsg&quot;</span>);
            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; nextHops-&gt;size(); i++) {
                kadRoutingInfoMsg-&gt;setNextHops(i, (*nextHops)[i]);
                <span class="keywordflow">if</span> (<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> == kadRoutingInfoMsg-&gt;getNextHops(i)) {
                    kadRoutingInfoMsg-&gt;getNextHops(i).setIsAlive(<span class="keyword">true</span>);
                }
            }
            kadRoutingInfoMsg-&gt;setBitLength(<a class="code" href="KademliaMessage__m_8h.html#ae7646d8e6e9aab79d12e8d5b9aff15ee">KADEMLIAROUTINGINFO_L</a>(kadRoutingInfoMsg));

            <span class="keyword">delete</span> nextHops;

            <span class="keywordflow">if</span> (!<a class="code" href="classKademlia.html#a53857e5e13f67a12e810db01a18400dc">altRecMode</a>) {
                <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>(msg-&gt;<a class="code" href="classBaseRouteMessage.html#af9787d89915f01a2055e920148015e17">getSrcNode</a>(), kadRoutingInfoMsg, 0.000001);
            } <span class="keywordflow">else</span> {
                <span class="comment">// alternative maintenance mode</span>
                std::vector&lt;TransportAddress&gt; sourceRoute;
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = msg-&gt;<a class="code" href="classBaseRouteMessage.html#a4d937e983eb4887400e41749b55ebecb">getVisitedHopsArraySize</a>() - 1<span class="comment">/*2*/</span>; i &gt;= 0; i--) {
                    <span class="comment">//TODO remove loops</span>
                    sourceRoute.push_back(msg-&gt;<a class="code" href="classBaseRouteMessage.html#a5e4624df761b01f0df433ef0ace1c597">getVisitedHops</a>(i));
                }
                <span class="comment">//sourceRoute.push_back(msg-&gt;getSrcNode());</span>
                <a class="code" href="classBaseOverlay.html#a6f2c598f5d3989a63a8cc7220f1aaf76" title="Sends a message to an overlay node, with the generic routing algorithm.">sendToKey</a>(<a class="code" href="classOverlayKey.html#ac0d4135dff2985e3582fdbed2a37eb75" title="OverlayKey without defined key.">OverlayKey::UNSPECIFIED_KEY</a>, kadRoutingInfoMsg, 0,
                          sourceRoute, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551aec961f27dcdb3050f97033fbd88b89b3">NO_OVERLAY_ROUTING</a>);
            }
            <span class="comment">//TODO should be sent after baseroutemsg</span>
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a53857e5e13f67a12e810db01a18400dc">altRecMode</a> &amp;&amp;
                   dynamic_cast&lt;KademliaRoutingInfoMessage*&gt;(msg-&gt;
                           <a class="code" href="OverSimMessage__m_8h.html#a43f96a0a4abd079ab2402d8e74ad414f">getEncapsulatedPacket</a>())) {
            <span class="comment">// alternative mode: infoMsg on its way back</span>
            <a class="code" href="classKademliaRoutingInfoMessage.html" title="Class generated from overlay/kademlia/KademliaMessage.msg by opp_msgc.">KademliaRoutingInfoMessage</a>* infoMsg =
                <span class="keyword">static_cast&lt;</span><a class="code" href="classKademliaRoutingInfoMessage.html" title="Class generated from overlay/kademlia/KademliaMessage.msg by opp_msgc.">KademliaRoutingInfoMessage</a>*<span class="keyword">&gt;</span>(msg-&gt;decapsulate());
            <a class="code" href="classBaseKeySortedVector.html" title="A STL-vector that supports inserts sorted by an OverlayKey found somewhere in the type...">NodeVector</a>* nextHops = <a class="code" href="classKademlia.html#aafad68d123da52e5fefb719699ed2dc3" title="Implements the find node call.">findNode</a>(infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#aec43d7ac961b5007e034e4d37f5ab23e">getDestKey</a>(), <a class="code" href="classKademlia.html#acc2f4767a1687764f2d732872511a7ad">k</a>, <a class="code" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">s</a>, msg);

            <span class="comment">// merge vectors</span>
            <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a> comp(infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#aec43d7ac961b5007e034e4d37f5ab23e">getDestKey</a>());
            <a class="code" href="classBaseKeySortedVector.html" title="A STL-vector that supports inserts sorted by an OverlayKey found somewhere in the type...">MarkedNodeVector</a> temp(UINT16_MAX, &amp;comp);

            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; nextHops-&gt;size(); i++) {
                temp.push_back((*nextHops)[i]);
            }
            <span class="keyword">delete</span> nextHops;

            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#afc9c8f14e031dafada5cdad66e856f5d">getNextHopsArraySize</a>(); i++) {
                <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#a5f6910bf47ee3bbafb38db67c3a712f2">getNextHops</a>(i),
                           infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#a5f6910bf47ee3bbafb38db67c3a712f2">getNextHops</a>(i).<a class="code" href="classMarkedNodeHandle.html#ae98d974c4b3edc4c3e37a2a5546d25d2">getIsAlive</a>());
                temp.add(infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#a5f6910bf47ee3bbafb38db67c3a712f2">getNextHops</a>(i));
            }

            infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#a50d02e3579322c7ed1aae9a8d1e27d6f">setNextHopsArraySize</a>(temp.size());
            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; temp.size(); ++i) {
                infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#a710682e457400a471e846ca06e45a56a">setNextHops</a>(i, temp[i]);
                <span class="keywordflow">if</span> (<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> == infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#a5f6910bf47ee3bbafb38db67c3a712f2">getNextHops</a>(i)) {
                    infoMsg-&gt;<a class="code" href="classKademliaRoutingInfoMessage.html#a5f6910bf47ee3bbafb38db67c3a712f2">getNextHops</a>(i).<a class="code" href="classMarkedNodeHandle.html#a873307d5a571c71924b6e348a9ec994b">setIsAlive</a>(<span class="keyword">true</span>);
                }
            }
            infoMsg-&gt;setBitLength(<a class="code" href="KademliaMessage__m_8h.html#ae7646d8e6e9aab79d12e8d5b9aff15ee">KADEMLIAROUTINGINFO_L</a>(infoMsg));

            msg-&gt;encapsulate(infoMsg);
        }
    }
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0cf73bc94792b9be525f73fa3a4551da"></a><!-- doxytag: member="Kademlia::refillSiblingTable" ref="a0cf73bc94792b9be525f73fa3a4551da" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::refillSiblingTable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00700">700</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00846">handleFailedNode()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00630">routingTimeout()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size() == 0 ||
        <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#ad96fd23183bf954e2613af5430ecb48d" title="indicates if NodeVector holds maxSize nodes">isFull</a>())
        <span class="keywordflow">return</span>;

    <span class="keywordtype">int</span> index = <a class="code" href="classKademlia.html#ac281bfbd16423020b46561a0df3d28c5" title="Returns the index of the bucket the key would reside with respect to Kademlia parameters.">routingBucketIndex</a>(<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;back().getKey()) - 1;
    assert(index &gt; 0);

    <span class="keywordflow">while</span> ((<a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index] == NULL ||
            <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index]-&gt;empty()) &amp;&amp;
            index &lt; (<span class="keywordtype">int</span>)(<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() - 1)) {
        index++;
    }
    <span class="keywordflow">if</span> (index &lt; (<span class="keywordtype">int</span>)<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">OverlayKey::getLength</a>() &amp;&amp;
            <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index] != NULL &amp;&amp; <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index]-&gt;size()) {

        <a class="code" href="classKademliaBucket.html">KademliaBucket</a> sortedBucket(<a class="code" href="classKademlia.html#acc2f4767a1687764f2d732872511a7ad">k</a>, <a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a>);
        <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index]-&gt;size(); ++i) {
            sortedBucket.add(<a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index]-&gt;at(i));
        }

        <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(sortedBucket.front());

        <span class="comment">// call update() for new sibling</span>
        <span class="keywordflow">if</span> (!<a class="code" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd" title="if true, ping not authenticated nodes before adding them to a bucket">secureMaintenance</a>) {
            <a class="code" href="classTopologyVis.html#a4fe67c060004c8ca76658c7b41514a4a" title="Draws an arrow from this node to neighbor.">showOverlayNeighborArrow</a>(sortedBucket.front(), <span class="keyword">false</span>,
                                     <span class="stringliteral">&quot;m=m,50,100,50,100;ls=green,1&quot;</span>);
            <a class="code" href="classBaseOverlay.html#a1422696a8eb138dde850390152ff88c7" title="Informs application about state changes of nodes or newly joined nodes.">callUpdate</a>(sortedBucket.front(), <span class="keyword">true</span>);
        }

        <span class="comment">// remove node from bucket</span>
        <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index]-&gt;erase(<a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[index]-&gt;
              findIterator(sortedBucket.front().getKey()));
        assert(<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#ad96fd23183bf954e2613af5430ecb48d" title="indicates if NodeVector holds maxSize nodes">isFull</a>());
        <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a21ca74bfdaf4114ca2f468935856e67b" title="Removes a node after a number of timeouts or immediately if immediately is true (behaves like routing...">routingTimeout</a>: end <a class="code" href="classKademlia.html#a0cf73bc94792b9be525f73fa3a4551da">refillSiblingTable</a>());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9c72c87286495818109f5460a7eefea9"></a><!-- doxytag: member="Kademlia::routingAdd" ref="a9c72c87286495818109f5460a7eefea9" args="(const NodeHandle &amp;handle, bool isAlive, simtime_t rtt=MAXTIME, bool maintenanceLookup=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Kademlia::routingAdd </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isAlive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em> = <code>MAXTIME</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>maintenanceLookup</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a node to the routing table. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>handle to add </td></tr>
    <tr><td class="paramname">isAlive</td><td>true, if it is known that the node is alive </td></tr>
    <tr><td class="paramname">rtt</td><td>measured round-trip-time to node </td></tr>
    <tr><td class="paramname">maintenanceLookup</td><td>true, if this node was learned from a maintenance lookup </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if the node was known or has been added </dd></dl>
<p>maintenanceLookup || </p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00320">320</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01159">handleRpcCall()</a>, <a class="el" href="Kademlia_8cc_source.html#l01183">handleRpcResponse()</a>, <a class="el" href="Kademlia_8cc_source.html#l01139">handleUDPMessage()</a>, <a class="el" href="Kademlia_8cc_source.html#l01290">proxCallback()</a>, <a class="el" href="Kademlia_8cc_source.html#l00889">recursiveRoutingHook()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00630">routingTimeout()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>: start);
    <span class="comment">// never add unspecified node handles</span>
    <span class="keywordflow">if</span> (handle.<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>() || handle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() == <a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>()) {
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::routingAdd()] @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    inserting node &quot;</span> &lt;&lt; handle &lt;&lt; <span class="stringliteral">&quot; (rtt = &quot;</span>;
    <span class="keywordflow">if</span> (rtt == MAXTIME) {
        EV &lt;&lt; <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;
    } <span class="keywordflow">else</span> {
        EV &lt;&lt; SIMTIME_DBL(rtt);
    }
    EV &lt;&lt; <span class="stringliteral">&quot;, isAlive = &quot;</span> &lt;&lt; (isAlive?<span class="stringliteral">&quot;true&quot;</span>:<span class="stringliteral">&quot;false&quot;</span>)
       &lt;&lt; <span class="stringliteral">&quot;) ...&quot;</span> &lt;&lt; endl;

    <span class="comment">// bucket index</span>
    <a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i;
    <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> authenticated = (isAlive &amp;&amp; (rtt != MAXTIME));

    <span class="keywordtype">bool</span> needsRtt = (<a class="code" href="classKademlia.html#aa83e5da5199e71427e731d4a1ad7ce9d">activePing</a> &amp;&amp; ((rtt == MAXTIME) ? <span class="keyword">true</span> : <span class="keyword">false</span>));

    <span class="comment">// convert node handle</span>
    <a class="code" href="classKademliaBucketEntry.html">KademliaBucketEntry</a> kadHandle = handle;
    kadHandle.<a class="code" href="classKademliaBucketEntry.html#a9e29a141071d1dcfb9b6a5ef8151aebd">setRtt</a>(rtt);
    kadHandle.<a class="code" href="classKademliaBucketEntry.html#a7dcf9a1bf9e8f22d2f23bdee614e1dac">setLastSeen</a>(simTime());

    <span class="comment">/* check if node is already a sibling -----------------------------------*/</span>
    <span class="keywordflow">if</span> ((i = <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#a5f7a2df11ab0a0b3c4c505b5d932c2aa" title="Searches for an OberlayKey in a NodeVector and returns an appropriate iterator.">findIterator</a>(kadHandle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>()))
         != <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;end()) {
        <span class="comment">// not alive? -&gt; do not change routing information</span>
        <span class="keywordflow">if</span> (isAlive) {
            <span class="keywordflow">if</span> (!<a class="code" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd" title="if true, ping not authenticated nodes before adding them to a bucket">secureMaintenance</a> || authenticated) {
                <span class="keywordflow">if</span> (kadHandle.<a class="code" href="classKademliaBucketEntry.html#a9f844940589695ff73900586247e47bb">getRtt</a>() == MAXTIME) {
                    kadHandle.<a class="code" href="classKademliaBucketEntry.html#a9e29a141071d1dcfb9b6a5ef8151aebd">setRtt</a>(i-&gt;getRtt());
                }
                <span class="comment">// refresh sibling</span>
                (*i) = kadHandle;
            } <span class="keywordflow">else</span> {
                <span class="keywordflow">if</span> (maintenanceLookup) {
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }

                <span class="keywordflow">if</span> ((i-&gt;getIp() != kadHandle.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()) ||
                    (i-&gt;getPort() != kadHandle.<a class="code" href="classTransportAddress.html#a4cf99c434c5110935683624dc3702e0f" title="returns port">getPort</a>())) {
                    <span class="comment">// sibling could have changed transport address</span>
                    <span class="comment">// ping new address for authentication</span>
                    <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(kadHandle);
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
            }
        }
        <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>: node is sibling);
        EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::routingAdd()] @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    ... node is already in the sibling table.&quot;</span> &lt;&lt; endl;
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <span class="comment">/* check if node is already in a bucket ---------------------------------*/</span>
    <a class="code" href="classKademliaBucket.html">KademliaBucket</a>* bucket = <a class="code" href="classKademlia.html#a12ad26290a17accd9645415e7e8cb9d3" title="Returns a Bucket or NULL if the bucket has not yet allocated.">routingBucket</a>(kadHandle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(), <span class="keyword">false</span>);
    <span class="keywordflow">if</span> (bucket != NULL &amp;&amp; (i = bucket-&gt;<a class="code" href="classBaseKeySortedVector.html#a5f7a2df11ab0a0b3c4c505b5d932c2aa" title="Searches for an OberlayKey in a NodeVector and returns an appropriate iterator.">findIterator</a>(kadHandle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() ) )
            != bucket-&gt;end() ) {
        <span class="comment">// not alive? -&gt; do not change routing information</span>
        <span class="keywordflow">if</span> (isAlive) {
            <span class="keywordflow">if</span> (!<a class="code" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd" title="if true, ping not authenticated nodes before adding them to a bucket">secureMaintenance</a> || authenticated) {
                <span class="keywordflow">if</span> (kadHandle.<a class="code" href="classKademliaBucketEntry.html#a9f844940589695ff73900586247e47bb">getRtt</a>() == MAXTIME) {
                    kadHandle.<a class="code" href="classKademliaBucketEntry.html#a9e29a141071d1dcfb9b6a5ef8151aebd">setRtt</a>(i-&gt;getRtt());
                }

                <span class="comment">// R/Kademlia</span>
                <span class="keywordflow">if</span> (needsRtt &amp;&amp; (kadHandle.<a class="code" href="classKademliaBucketEntry.html#a9f844940589695ff73900586247e47bb">getRtt</a>() == MAXTIME)) {
                    <a class="code" href="structProx.html">Prox</a> prox =
                        <a class="code" href="classBaseRpc.html#ad80237130dc2316d0d76ac6757c50f4f" title="pointer to the neighbor cache">neighborCache</a>-&gt;<a class="code" href="classNeighborCache.html#ab934be8fb503f9629cf6eb83e7d1b576" title="Gets the proximity of a node.">getProx</a>(kadHandle, <a class="code" href="NeighborCache_8h.html#ada3b7deab861ead8c817d583da336ccba751bede7ee708c74811f4bd49ee74cea">NEIGHBORCACHE_DEFAULT</a>, -1,
                                               <span class="keyword">this</span>, NULL);
                    <span class="keywordflow">if</span> (prox != <a class="code" href="structProx.html#ae33fb924891e14e0161708bfadf8f033">Prox::PROX_SELF</a> &amp;&amp;
                        prox != <a class="code" href="structProx.html#aa7ac832a04fe61863222d8631526647b">Prox::PROX_UNKNOWN</a> &amp;&amp;
                        prox != <a class="code" href="structProx.html#abf2f5f92914e5e617c5ef157ea5ffc86">Prox::PROX_WAITING</a> &amp;&amp;
                        prox != <a class="code" href="structProx.html#a5ded765f6344797ea0e9c35c85cd61af">Prox::PROX_TIMEOUT</a>) {
                        kadHandle.<a class="code" href="classProxNodeHandle.html#a2f3e23f427dfbf4c36fef805d7fa8bc2">setProx</a>(prox);
                        <span class="comment">//routingAdd(handle, true, prox.proximity);//ctrlInfo-&gt;getSrcRoute() //TODO</span>
                    } <span class="comment">/*else if (prox == Prox::PROX_TIMEOUT) {</span>
<span class="comment">                        // remove from bucket</span>
<span class="comment">                        bucket-&gt;erase(i);</span>
<span class="comment">                        return false;</span>
<span class="comment">                    }*/</span> <span class="comment">//TODO inform NC that node is alive</span>
                    <span class="keywordflow">else</span> {
                        EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::routingAdd()] @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                           <span class="stringliteral">&quot;    ... node not added, but ping sent.&quot;</span> &lt;&lt; endl;
                        <span class="keywordflow">return</span> <span class="keyword">false</span>;
                    }
                }

                <span class="comment">// remove old handle</span>
                bucket-&gt;erase(i);
                <span class="comment">// re-add to tail</span>
                bucket-&gt;push_back(kadHandle);
            } <span class="keywordflow">else</span> {
                <span class="keywordflow">if</span> (maintenanceLookup) {
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }

                <span class="keywordflow">if</span> ((i-&gt;getIp() != kadHandle.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()) ||
                    (i-&gt;getPort() != kadHandle.<a class="code" href="classTransportAddress.html#a4cf99c434c5110935683624dc3702e0f" title="returns port">getPort</a>())) {
                    <span class="comment">// sibling could have changed transport address</span>
                    <span class="comment">// ping new address for authentication</span>
                    <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(kadHandle);
                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
                }
            }
        }
        <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>: node is in bucket);
        EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::routingAdd()] @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    ... node is already in bucket &quot;</span>
           &lt;&lt; <a class="code" href="classKademlia.html#ac281bfbd16423020b46561a0df3d28c5" title="Returns the index of the bucket the key would reside with respect to Kademlia parameters.">routingBucketIndex</a>(kadHandle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>()) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <span class="comment">/* check if node can be added to the sibling list -----------------------*/</span>
    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#ad640b8320ebc32c8ef574109273bb44f" title="indicates if an object of type T can be added to the NodeVector">isAddable</a>(kadHandle) ) {
        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd" title="if true, ping not authenticated nodes before adding them to a bucket">secureMaintenance</a> &amp;&amp; !authenticated) {
            <span class="keywordflow">if</span> (!maintenanceLookup || (isAlive &amp;&amp; (rtt == MAXTIME))) {
                <span class="comment">// received a FindNodeCall or PingCall from a potential sibling</span>
                <span class="comment">// or new nodes from a FindNodeResponse app lookup</span>
                <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(kadHandle);
            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a68e77f3b48652f19219a6c6c9a1a76d2">newMaintenance</a>) {
                <span class="comment">// new node from sibling table refresh</span>
                <span class="comment">//sendSiblingFindNodeCall(kadHandle);</span>
                <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(kadHandle);
            }
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">// ping new siblings</span>
        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a113faa91ed3ec564f8b61718101695c2">pingNewSiblings</a> &amp;&amp; !isAlive) {
            <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(kadHandle);
        }

        <span class="comment">// R/Kademlia</span>
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (needsRtt) {
            <span class="comment">// old version: pingNode(), now:</span>
            <a class="code" href="structProx.html">Prox</a> prox =
                    <a class="code" href="classBaseRpc.html#ad80237130dc2316d0d76ac6757c50f4f" title="pointer to the neighbor cache">neighborCache</a>-&gt;<a class="code" href="classNeighborCache.html#ab934be8fb503f9629cf6eb83e7d1b576" title="Gets the proximity of a node.">getProx</a>(kadHandle, <a class="code" href="NeighborCache_8h.html#ada3b7deab861ead8c817d583da336ccba751bede7ee708c74811f4bd49ee74cea">NEIGHBORCACHE_DEFAULT</a>, -1,
                                           <span class="keyword">this</span>, NULL);
            <span class="keywordflow">if</span> (prox != <a class="code" href="structProx.html#ae33fb924891e14e0161708bfadf8f033">Prox::PROX_SELF</a> &amp;&amp;
                prox != <a class="code" href="structProx.html#aa7ac832a04fe61863222d8631526647b">Prox::PROX_UNKNOWN</a> &amp;&amp;
                prox != <a class="code" href="structProx.html#a5ded765f6344797ea0e9c35c85cd61af">Prox::PROX_TIMEOUT</a>) {
                kadHandle.<a class="code" href="classProxNodeHandle.html#a2f3e23f427dfbf4c36fef805d7fa8bc2">setProx</a>(prox);
            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prox == <a class="code" href="structProx.html#a5ded765f6344797ea0e9c35c85cd61af">Prox::PROX_TIMEOUT</a>) {
                <span class="comment">// do not put handle into sibling table</span>
                EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::routingAdd()] @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    ... node not added (node timeout).&quot;</span> &lt;&lt; endl;
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }

        <span class="keywordtype">bool</span> finished = <span class="keyword">false</span>;
        <span class="keywordtype">int</span> siblingPos = -1;

        <span class="comment">// check if sibling list is full so a handle is preemted from the list</span>
        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#ad96fd23183bf954e2613af5430ecb48d" title="indicates if NodeVector holds maxSize nodes">isFull</a>()) {
            <span class="comment">// get handle thats about to be preempted</span>
            <a class="code" href="classKademliaBucketEntry.html">KademliaBucketEntry</a> oldHandle = <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;back();
            assert(oldHandle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() != kadHandle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>());

            <span class="comment">// add handle to the sibling list</span>
            siblingPos = <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(kadHandle);
            EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::routingAdd()] @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    ... node added to sibling table, replacing &quot;</span>
               &lt;&lt; (<a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>)oldHandle &lt;&lt; endl;

            <span class="comment">// change, so that the preempted handle is added to a bucket</span>
            kadHandle = oldHandle;

            <span class="comment">// call update() for removed sibling</span>
            <span class="keywordflow">if</span> (!<a class="code" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd" title="if true, ping not authenticated nodes before adding them to a bucket">secureMaintenance</a>) {
                <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(oldHandle);
                <a class="code" href="classBaseOverlay.html#a1422696a8eb138dde850390152ff88c7" title="Informs application about state changes of nodes or newly joined nodes.">callUpdate</a>(oldHandle, <span class="keyword">false</span>);
            }

            <span class="comment">// return always true, since the handle has been added</span>
            result = <span class="keyword">true</span>;
        } <span class="keywordflow">else</span> {
            <span class="comment">// simply add the handle and stop</span>
            siblingPos = <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(kadHandle);
            EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::routingAdd()] @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
               &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    ... node added to sibling table.&quot;</span> &lt;&lt; endl;

            <span class="comment">// don&#39;t need to add kadHandle also to regular buckets</span>
            finished = <span class="keyword">true</span>;
        }
        assert(siblingPos &gt; -1);

        <a class="code" href="classKademlia.html#acd029f455e0c6150c038c69fa493696c" title="updates information shown in GUI">updateTooltip</a>();

        <span class="comment">// call update() for new sibling</span>
        <a class="code" href="classTopologyVis.html#a4fe67c060004c8ca76658c7b41514a4a" title="Draws an arrow from this node to neighbor.">showOverlayNeighborArrow</a>(<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;at(siblingPos), <span class="keyword">false</span>,
                                 <span class="stringliteral">&quot;m=m,50,100,50,100;ls=green,1&quot;</span>);
        <a class="code" href="classBaseOverlay.html#a1422696a8eb138dde850390152ff88c7" title="Informs application about state changes of nodes or newly joined nodes.">callUpdate</a>(<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;at(siblingPos), <span class="keyword">true</span>);

        <span class="keywordflow">if</span> (finished) {
            <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>: node is now sibling);
            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }
    }

    <span class="comment">/* add node to the appropriate bucket, if not full ---------------------*/</span>
    bucket = <a class="code" href="classKademlia.html#a12ad26290a17accd9645415e7e8cb9d3" title="Returns a Bucket or NULL if the bucket has not yet allocated.">routingBucket</a>(kadHandle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(), <span class="keyword">true</span>);
    <span class="keywordflow">if</span> (!bucket-&gt;<a class="code" href="classBaseKeySortedVector.html#ad96fd23183bf954e2613af5430ecb48d" title="indicates if NodeVector holds maxSize nodes">isFull</a>()) {
        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd" title="if true, ping not authenticated nodes before adding them to a bucket">secureMaintenance</a> &amp;&amp; !authenticated) {
            <span class="keywordflow">if</span> ((isAlive &amp;&amp; (rtt == MAXTIME))) {
                <span class="comment">// received a FindNodeCall or PingCall from a potential new bucket entry</span>
                <span class="comment">// or new nodes from a FindNodeReponse app lookup</span>
                <span class="comment">// optimization: don&#39;t send a ping for nodes from FindNodeResponse for app lookups</span>
                <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(kadHandle);
            }
            <span class="keywordflow">return</span> <span class="keyword">false</span>;
        }

        <span class="comment">//EV &lt;&lt; &quot;[Kademlia::routingAdd()]\n&quot;</span>
        <span class="comment">//   &lt;&lt; &quot;    Adding new node &quot; &lt;&lt; kadHandle</span>
        <span class="comment">//   &lt;&lt; &quot; to bucket &quot; &lt;&lt; routingBucketIndex(kadHandle.getKey())</span>
        <span class="comment">//   &lt;&lt; endl;</span>

        <span class="comment">// PNS</span>
        <span class="keywordflow">if</span> (needsRtt || <a class="code" href="classKademlia.html#aa1c9d6f7ff020a8a9249f1da3d1fedbe">proximityNeighborSelection</a>) {
             <span class="comment">//pingNode(handle, -1, 0, NULL, NULL, NULL, -1, UDP_TRANSPORT, false);</span>
             <a class="code" href="structProx.html">Prox</a> prox =
                 <a class="code" href="classBaseRpc.html#ad80237130dc2316d0d76ac6757c50f4f" title="pointer to the neighbor cache">neighborCache</a>-&gt;<a class="code" href="classNeighborCache.html#ab934be8fb503f9629cf6eb83e7d1b576" title="Gets the proximity of a node.">getProx</a>(kadHandle, <a class="code" href="NeighborCache_8h.html#ada3b7deab861ead8c817d583da336ccba751bede7ee708c74811f4bd49ee74cea">NEIGHBORCACHE_DEFAULT</a>, -1,
                                        <span class="keyword">this</span>, NULL);
             <span class="keywordflow">if</span> (prox != <a class="code" href="structProx.html#ae33fb924891e14e0161708bfadf8f033">Prox::PROX_SELF</a> &amp;&amp;
                 prox != <a class="code" href="structProx.html#aa7ac832a04fe61863222d8631526647b">Prox::PROX_UNKNOWN</a> &amp;&amp;
                 prox != <a class="code" href="structProx.html#a5ded765f6344797ea0e9c35c85cd61af">Prox::PROX_TIMEOUT</a>) {
                 <span class="comment">//routingAdd(handle, true, prox.proximity);//ctrlInfo-&gt;getSrcRoute() //TODO</span>
                 kadHandle.<a class="code" href="classProxNodeHandle.html#a2f3e23f427dfbf4c36fef805d7fa8bc2">setProx</a>(prox);
             }
         }

        bucket-&gt;push_back(kadHandle);
        result = <span class="keyword">true</span>;
        EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::routingAdd()] @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    ... node added to bucket &quot;</span>
           &lt;&lt; <a class="code" href="classKademlia.html#ac281bfbd16423020b46561a0df3d28c5" title="Returns the index of the bucket the key would reside with respect to Kademlia parameters.">routingBucketIndex</a>(kadHandle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>())
           &lt;&lt; <span class="stringliteral">&quot; which was not yet full.&quot;</span> &lt;&lt; endl;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isAlive) {
        <span class="comment">//PNS node replacement</span>
        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#aa1c9d6f7ff020a8a9249f1da3d1fedbe">proximityNeighborSelection</a> &amp;&amp;
            kadHandle.<a class="code" href="classProxNodeHandle.html#a98f9354f8b28218eee5b30febb485b43">getProx</a>() != <a class="code" href="structProx.html#aa7ac832a04fe61863222d8631526647b">Prox::PROX_UNKNOWN</a>) {
            <a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> kickHim, it;
            kickHim = it = bucket-&gt;begin();
            ++it;
            <span class="keywordflow">while</span> (it != bucket-&gt;end()) {
                <span class="keywordflow">if</span> (it-&gt;getRtt() &gt; kickHim-&gt;getRtt()) {
                    kickHim = it;
                }
                ++it;
            }
            <span class="keywordflow">if</span> (kickHim-&gt;getRtt() &gt; kadHandle.<a class="code" href="classKademliaBucketEntry.html#a9f844940589695ff73900586247e47bb">getRtt</a>()) {
                <a class="code" href="classKademliaBucketEntry.html">KademliaBucketEntry</a> temp = *kickHim;
                bucket-&gt;erase(kickHim);
                bucket-&gt;push_back(kadHandle);
                kadHandle = temp;
                EV &lt;&lt; <span class="stringliteral">&quot;[Kademlia::routingAdd()] @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                   &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;    ... added to bucket &quot;</span>
                   &lt;&lt; <a class="code" href="classKademlia.html#ac281bfbd16423020b46561a0df3d28c5" title="Returns the index of the bucket the key would reside with respect to Kademlia parameters.">routingBucketIndex</a>(kadHandle.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>())
                   &lt;&lt; <span class="stringliteral">&quot; (PNS: replacing another node).&quot;</span> &lt;&lt; endl;
            }
        }

        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a151fd59bc6de940e684fbad408083ac4">enableReplacementCache</a> &amp;&amp; (!<a class="code" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd" title="if true, ping not authenticated nodes before adding them to a bucket">secureMaintenance</a> || authenticated)) {
            bucket-&gt;<a class="code" href="classKademliaBucket.html#a6b0dc39d58d9d8ba705d37c89529c16a">replacementCache</a>.push_front(kadHandle);
            <span class="keywordflow">if</span> (bucket-&gt;<a class="code" href="classKademliaBucket.html#a6b0dc39d58d9d8ba705d37c89529c16a">replacementCache</a>.size() &gt; <a class="code" href="classKademlia.html#a8ebc8abde092aad89dfa813ba640e6ef">replacementCandidates</a>) {
                bucket-&gt;<a class="code" href="classKademliaBucket.html#a6b0dc39d58d9d8ba705d37c89529c16a">replacementCache</a>.pop_back();
            }

            <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#adc22fe7536c4bea9677ed901b95820a8">replacementCachePing</a>) {
                <a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> it = bucket-&gt;begin();
                <span class="keywordflow">while</span> (it != bucket-&gt;end() &amp;&amp; (it-&gt;getPingSent() == <span class="keyword">true</span>)) {
                    it++;
                }
                <span class="keywordflow">if</span> (it != bucket-&gt;end()) {
                    <a class="code" href="classBaseRpc.html#a421904b1b501580efed12e6490d3324a" title="ping a node by its TransportAddress">pingNode</a>(*it);
                    it-&gt;setPingSent(<span class="keyword">true</span>);
                }
            }
        }
    }

    <span class="comment">// PNS</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#aa1c9d6f7ff020a8a9249f1da3d1fedbe">proximityNeighborSelection</a>) {
        <a class="code" href="classBaseRpc.html#ad80237130dc2316d0d76ac6757c50f4f" title="pointer to the neighbor cache">neighborCache</a>-&gt;<a class="code" href="classNeighborCache.html#ab934be8fb503f9629cf6eb83e7d1b576" title="Gets the proximity of a node.">getProx</a>(kadHandle, <a class="code" href="NeighborCache_8h.html#ada3b7deab861ead8c817d583da336ccba46557811e0915cca5028188f13edf357">NEIGHBORCACHE_QUERY</a>, -1, <span class="keyword">this</span>, NULL);
        <span class="comment">//pingNode(kadHandle);</span>
    }

    <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>: end);
    <span class="keywordflow">return</span> result;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a12ad26290a17accd9645415e7e8cb9d3"></a><!-- doxytag: member="Kademlia::routingBucket" ref="a12ad26290a17accd9645415e7e8cb9d3" args="(const OverlayKey &amp;key, bool ensure)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classKademliaBucket.html">KademliaBucket</a> * Kademlia::routingBucket </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>ensure</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns a Bucket or <code>NULL</code> if the bucket has not yet allocated. </p>
<p>If ensure is true, the bucket allocation is ensured.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>The key of the node </td></tr>
    <tr><td class="paramname">ensure</td><td>If true, the bucket allocation is ensured</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Bucket* The Bucket </dd></dl>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00304">304</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>, <a class="el" href="Kademlia_8cc_source.html#l00630">routingTimeout()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00739">setBucketUsage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// get bucket index</span>
    <span class="keywordtype">int</span> num = <a class="code" href="classKademlia.html#ac281bfbd16423020b46561a0df3d28c5" title="Returns the index of the bucket the key would reside with respect to Kademlia parameters.">routingBucketIndex</a>(key);
    <span class="keywordflow">if</span> (num &lt; 0)
        <span class="keywordflow">return</span> NULL;

    <span class="comment">// get bucket and allocate if necessary</span>
    <a class="code" href="classKademliaBucket.html">KademliaBucket</a>* bucket = <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[ num ];
    <span class="keywordflow">if</span> (bucket == NULL &amp;&amp; ensure)
        bucket = <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[ num ] = <span class="keyword">new</span> <a class="code" href="classKademliaBucket.html">KademliaBucket</a>( <a class="code" href="classKademlia.html#acc2f4767a1687764f2d732872511a7ad">k</a>, <a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a> );

    <span class="comment">// return bucket</span>
    <span class="keywordflow">return</span> bucket;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac281bfbd16423020b46561a0df3d28c5"></a><!-- doxytag: member="Kademlia::routingBucketIndex" ref="ac281bfbd16423020b46561a0df3d28c5" args="(const OverlayKey &amp;key, bool firstOnLayer=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Kademlia::routingBucketIndex </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>firstOnLayer</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the index of the bucket the key would reside with respect to <a class="el" href="classKademlia.html" title="Kademlia overlay module.">Kademlia</a> parameters. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>The key of the node </td></tr>
    <tr><td class="paramname">firstOnLayer</td><td>If true bucket with smallest index on same layer is returned </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>int The index of the bucket </dd></dl>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00285">285</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00969">findNode()</a>, <a class="el" href="Kademlia_8cc_source.html#l00700">refillSiblingTable()</a>, <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00304">routingBucket()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// calculate XOR distance</span>
    <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> delta = key ^ <a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>();

    <span class="comment">// find first subinteger that is not zero...</span>
    <span class="keywordtype">int</span> i;
    <span class="keywordflow">for</span> (i = key.<a class="code" href="classOverlayKey.html#af855a4dfc0e5dc0d2afc6b87fa1d7426" title="Returns the length in number of bits.">getLength</a>() - <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>; i &gt;= 0 &amp;&amp; delta.<a class="code" href="classOverlayKey.html#a25b2a67642f29fe2035a0abf74de3dd1" title="Returns a sub integer at position p with n-bits.">getBitRange</a>(i, <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) == 0;
         i -= <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>);

    <span class="keywordflow">if</span> (i &lt; 0)
        <span class="keywordflow">return</span> -1;

    <span class="keywordflow">if</span> (!firstOnLayer)
        <span class="keywordflow">return</span> (i / <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) * ((1 &lt;&lt; <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) - 1) + (delta.<a class="code" href="classOverlayKey.html#a25b2a67642f29fe2035a0abf74de3dd1" title="Returns a sub integer at position p with n-bits.">getBitRange</a>(i, <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) - 1);
    <span class="keywordflow">else</span>
        <span class="keywordflow">return</span> (i / <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) * ((1 &lt;&lt; <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) - 1) + (pow(2, <a class="code" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">b</a>) - 2);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad54c5bcac7db895e0e0eec5cd0109da2"></a><!-- doxytag: member="Kademlia::routingDeinit" ref="ad54c5bcac7db895e0e0eec5cd0109da2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::routingDeinit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00255">255</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00204">joinOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00170">~Kademlia()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// delete buckets</span>
    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>.size(); i++) {
        <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[i] != NULL) {
            <span class="keyword">delete</span> <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[i];
            <a class="code" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">routingTable</a>[i] = NULL;
        }
    }

    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a> != NULL) {
        <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;clear();
    }

    <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a> != NULL) {
        <span class="keyword">delete</span> <a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a>;
        <a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a> = NULL;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0fc8d7eadb6ed086536cbc273460d7a9"></a><!-- doxytag: member="Kademlia::routingInit" ref="a0fc8d7eadb6ed086536cbc273460d7a9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::routingInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00239">239</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00204">joinOverlay()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// set join state</span>
    <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>;

    <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>(<span class="keyword">false</span>);

    <span class="comment">// setup comparator</span>
    <a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a> = <span class="keyword">new</span> <a class="code" href="classKeyDistanceComparator.html">KeyDistanceComparator&lt;KeyXorMetric&gt;</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>());

    <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#ac509494faf9fa46ca1d11964a21c8247">setComparator</a>(<a class="code" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">comparator</a>);

    <a class="code" href="classKademlia.html#acd029f455e0c6150c038c69fa493696c" title="updates information shown in GUI">updateTooltip</a>();
    <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a0fc8d7eadb6ed086536cbc273460d7a9">routingInit</a>: end);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a21ca74bfdaf4114ca2f468935856e67b"></a><!-- doxytag: member="Kademlia::routingTimeout" ref="a21ca74bfdaf4114ca2f468935856e67b" args="(const OverlayKey &amp;key, bool immediately=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Kademlia::routingTimeout </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>immediately</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Removes a node after a number of timeouts or immediately if immediately is true (behaves like routingRemove). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>Node's key to remove </td></tr>
    <tr><td class="paramname">immediately</td><td>If true, the node is removed immediately </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if the node has been removed </dd></dl>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00630">630</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01250">handleRpcTimeout()</a>, <a class="el" href="Kademlia_8cc_source.html#l01290">proxCallback()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00700">refillSiblingTable()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a21ca74bfdaf4114ca2f468935856e67b" title="Removes a node after a number of timeouts or immediately if immediately is true (behaves like routing...">routingTimeout</a>: start);
    <span class="comment">// key unspecified? yes -&gt; ignore</span>
    <span class="keywordflow">if</span> (key.<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>())
        <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="comment">// bucket index</span>
    <a class="code" href="classBaseKeySortedVector.html#adda2ae09639f7600c0f7ab759f4c9c0c" title="iterator for this vector">KademliaBucket::iterator</a> i;

    <span class="comment">/* check if the node is one of the siblings -----------------------------*/</span>
    <span class="keywordflow">if</span> ((i = <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classBaseKeySortedVector.html#a5f7a2df11ab0a0b3c4c505b5d932c2aa" title="Searches for an OberlayKey in a NodeVector and returns an appropriate iterator.">findIterator</a>(key)) != <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;end()) {

        i-&gt;incStaleCount();
        i-&gt;setPingSent(<span class="keyword">false</span>);

        <span class="keywordflow">if</span> (i-&gt;getStaleCount() &gt; <a class="code" href="classKademlia.html#a742e20c8d232a8623f4a85c2f0cad1e4">maxStaleCount</a> || immediately) {
            <span class="comment">// remove from sibling table</span>
            <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> oldSibling = *i;
            <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;erase(i);

            <span class="comment">// lost last sibling?</span>
            <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size() == 0) {
                <a class="code" href="classBaseOverlay.html#acb8855faa86247ae37ab894891d9f4dd" title="Join the overlay with a given nodeID.">join</a>();
                <span class="keywordflow">return</span> <span class="keyword">true</span>;
            }

            <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a21ca74bfdaf4114ca2f468935856e67b" title="Removes a node after a number of timeouts or immediately if immediately is true (behaves like routing...">routingTimeout</a>: is sibling);

            <span class="comment">// try to refill with new closest contact</span>
            <a class="code" href="classKademlia.html#a0cf73bc94792b9be525f73fa3a4551da">refillSiblingTable</a>();

            <span class="comment">// call update() for removed sibling</span>
            <a class="code" href="classTopologyVis.html#ae9629882d5f3bb7865f9c9501b23a172" title="Removes an arrow from this node to neighbor.">deleteOverlayNeighborArrow</a>(oldSibling);
            <a class="code" href="classBaseOverlay.html#a1422696a8eb138dde850390152ff88c7" title="Informs application about state changes of nodes or newly joined nodes.">callUpdate</a>(oldSibling, <span class="keyword">false</span>);

            <a class="code" href="classKademlia.html#acd029f455e0c6150c038c69fa493696c" title="updates information shown in GUI">updateTooltip</a>();

            <span class="keywordflow">return</span> <span class="keyword">true</span>;
        }
    }

    <span class="comment">/* check if node is already in a bucket ---------------------------------*/</span>
    <a class="code" href="classKademliaBucket.html">KademliaBucket</a>* bucket = <a class="code" href="classKademlia.html#a12ad26290a17accd9645415e7e8cb9d3" title="Returns a Bucket or NULL if the bucket has not yet allocated.">routingBucket</a>(key, <span class="keyword">false</span>);
    <span class="keywordflow">if</span> (bucket != NULL &amp;&amp; (i = bucket-&gt;<a class="code" href="classBaseKeySortedVector.html#a5f7a2df11ab0a0b3c4c505b5d932c2aa" title="Searches for an OberlayKey in a NodeVector and returns an appropriate iterator.">findIterator</a>(key) ) != bucket-&gt;end() ) {

        i-&gt;incStaleCount();
        i-&gt;setPingSent(<span class="keyword">false</span>);

        <span class="keywordflow">if</span> (i-&gt;getStaleCount() &gt; <a class="code" href="classKademlia.html#a742e20c8d232a8623f4a85c2f0cad1e4">maxStaleCount</a> || immediately) {
            <span class="comment">// remove from routing table</span>
            bucket-&gt;erase(i);

            <span class="keywordflow">if</span> (<a class="code" href="classKademlia.html#a151fd59bc6de940e684fbad408083ac4">enableReplacementCache</a>) {
                <span class="keywordflow">if</span> (bucket-&gt;<a class="code" href="classKademliaBucket.html#a6b0dc39d58d9d8ba705d37c89529c16a">replacementCache</a>.size()) {
                    <a class="code" href="classKademlia.html#a9c72c87286495818109f5460a7eefea9" title="Adds a node to the routing table.">routingAdd</a>(bucket-&gt;<a class="code" href="classKademliaBucket.html#a6b0dc39d58d9d8ba705d37c89529c16a">replacementCache</a>.front(), <span class="keyword">true</span>,
                               bucket-&gt;<a class="code" href="classKademliaBucket.html#a6b0dc39d58d9d8ba705d37c89529c16a">replacementCache</a>.front().getRtt());
                    bucket-&gt;<a class="code" href="classKademliaBucket.html#a6b0dc39d58d9d8ba705d37c89529c16a">replacementCache</a>.pop_front();
                    <a class="code" href="classKademlia.html#aa1eda90d9ae7c58ff916a9d493d7c1e6">nodesReplaced</a>++;
                }
            }
        }

        <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a21ca74bfdaf4114ca2f468935856e67b" title="Removes a node after a number of timeouts or immediately if immediately is true (behaves like routing...">routingTimeout</a>: is in bucket);
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <a class="code" href="Kademlia_8cc.html#aac1dc1d1f35365a3858fb0480153a467">BUCKET_CONSISTENCY</a>(<a class="code" href="classKademlia.html#a21ca74bfdaf4114ca2f468935856e67b" title="Removes a node after a number of timeouts or immediately if immediately is true (behaves like routing...">routingTimeout</a>: end);
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a837fc1c137eebd1189ff401b4bd97a99"></a><!-- doxytag: member="Kademlia::sendSiblingFindNodeCall" ref="a837fc1c137eebd1189ff401b4bd97a99" args="(const TransportAddress &amp;dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::sendSiblingFindNodeCall </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00193">193</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00204">joinOverlay()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classFindNodeCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">FindNodeCall</a>* call = <span class="keyword">new</span> <a class="code" href="classFindNodeCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">FindNodeCall</a>(<span class="stringliteral">&quot;FindNodeCall&quot;</span>);
    call-&gt;<a class="code" href="classFindNodeCall.html#a23d81e4dffecd7b5ba72dce892af2159">setExhaustiveIterative</a>(<span class="keyword">true</span>);
    call-&gt;<a class="code" href="classFindNodeCall.html#a2abda290bf29528fddc71c5b2e89b4ad">setLookupKey</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>());
    call-&gt;<a class="code" href="classFindNodeCall.html#a59d13e29485b5f38b1d105cb6016cf98">setNumRedundantNodes</a>(<a class="code" href="classKademlia.html#ad4d31fcf8c7300404ae07523daab8cc6">siblingRefreshNodes</a>);
    call-&gt;<a class="code" href="classFindNodeCall.html#a743e7a1901266a50953eb276c4420f67">setNumSiblings</a>(<a class="code" href="classKademlia.html#a7253ff80d709265f6e74d3ebf4e691ad" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>());
    call-&gt;setBitLength(<a class="code" href="CommonMessages__m_8h.html#aac2b8db2e1b70d585c2262cb346130e4">FINDNODECALL_L</a>(call));
    <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>(dest, call);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7581a168ae2e143001a7a93ff4a1779a"></a><!-- doxytag: member="Kademlia::setBucketUsage" ref="a7581a168ae2e143001a7a93ff4a1779a" args="(const OverlayKey &amp;key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::setBucketUsage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l00739">739</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, <a class="el" href="Kademlia_8cc_source.html#l01183">handleRpcResponse()</a>, and <a class="el" href="Kademlia_8cc_source.html#l01250">handleRpcTimeout()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classKademliaBucket.html">KademliaBucket</a>* bucket = <a class="code" href="classKademlia.html#a12ad26290a17accd9645415e7e8cb9d3" title="Returns a Bucket or NULL if the bucket has not yet allocated.">routingBucket</a>(key, <span class="keyword">true</span>);

    <span class="keywordflow">if</span> (bucket) {
        bucket-&gt;<a class="code" href="classKademliaBucket.html#a8b5481352d9ad3354647e5cae8c6e5fa">setLastUsage</a>(simTime());
    }

    <span class="keywordflow">if</span> ((<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size() &lt; (uint32_t)<a class="code" href="classKademlia.html#a7253ff80d709265f6e74d3ebf4e691ad" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>())
        || ((<a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;at(<a class="code" href="classKademlia.html#a7253ff80d709265f6e74d3ebf4e691ad" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>() - 1).getKey() ^ <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>())
                &gt;= (key ^ <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>()))) {
        <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;<a class="code" href="classKademliaBucket.html#a8b5481352d9ad3354647e5cae8c6e5fa">setLastUsage</a>(simTime());
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="acd029f455e0c6150c038c69fa493696c"></a><!-- doxytag: member="Kademlia::updateTooltip" ref="acd029f455e0c6150c038c69fa493696c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Kademlia::updateTooltip </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>updates information shown in GUI </p>

<p>Definition at line <a class="el" href="Kademlia_8cc_source.html#l01429">1429</a> of file <a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00846">handleFailedNode()</a>, <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>, <a class="el" href="Kademlia_8cc_source.html#l00239">routingInit()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00630">routingTimeout()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (ev.isGUI()) {
        std::stringstream ttString;

        <span class="comment">// show our nodeId in a tooltip</span>
        ttString &lt;&lt; <span class="stringliteral">&quot;This: &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> &lt;&lt; endl &lt;&lt; <span class="stringliteral">&quot;Siblings: &quot;</span>
                 &lt;&lt; <a class="code" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">siblingTable</a>-&gt;size();

        getParentModule()-&gt;getParentModule()-&gt;getDisplayString().
        setTagArg(<span class="stringliteral">&quot;tt&quot;</span>, 0, ttString.str().c_str());
        getParentModule()-&gt;getDisplayString().
        setTagArg(<span class="stringliteral">&quot;tt&quot;</span>, 0, ttString.str().c_str());
        getDisplayString().setTagArg(<span class="stringliteral">&quot;tt&quot;</span>, 0, ttString.str().c_str());
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="a61b072e95046f98ad49a3f5589fe9a45"></a><!-- doxytag: member="Kademlia::KademliaLookupListener" ref="a61b072e95046f98ad49a3f5589fe9a45" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classKademliaLookupListener.html">KademliaLookupListener</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00155">155</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, and <a class="el" href="Kademlia_8cc_source.html#l01183">handleRpcResponse()</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aa83e5da5199e71427e731d4a1ad7ce9d"></a><!-- doxytag: member="Kademlia::activePing" ref="aa83e5da5199e71427e731d4a1ad7ce9d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#aa83e5da5199e71427e731d4a1ad7ce9d">Kademlia::activePing</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00084">84</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>.</p>

</div>
</div>
<a class="anchor" id="a53857e5e13f67a12e810db01a18400dc"></a><!-- doxytag: member="Kademlia::altRecMode" ref="a53857e5e13f67a12e810db01a18400dc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#a53857e5e13f67a12e810db01a18400dc">Kademlia::altRecMode</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00087">87</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00889">recursiveRoutingHook()</a>.</p>

</div>
</div>
<a class="anchor" id="a13735e80816c965e135d6a686d5e4713"></a><!-- doxytag: member="Kademlia::b" ref="a13735e80816c965e135d6a686d5e4713" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classKademlia.html#a13735e80816c965e135d6a686d5e4713">Kademlia::b</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00066">66</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00285">routingBucketIndex()</a>.</p>

</div>
</div>
<a class="anchor" id="a210614b1ea667d544d256a1cc5e94490"></a><!-- doxytag: member="Kademlia::bucketRefreshCount" ref="a210614b1ea667d544d256a1cc5e94490" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classKademlia.html#a210614b1ea667d544d256a1cc5e94490">Kademlia::bucketRefreshCount</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00165">165</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00180">finishOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a5ab8d39b7c098f21d9577d5dfc82a4f4"></a><!-- doxytag: member="Kademlia::bucketRefreshNodes" ref="a5ab8d39b7c098f21d9577d5dfc82a4f4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classKademlia.html#a5ab8d39b7c098f21d9577d5dfc82a4f4">Kademlia::bucketRefreshNodes</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00081">81</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="aba4bc00b985d8a3758cb2b1b9e4a74b4"></a><!-- doxytag: member="Kademlia::bucketRefreshTimer" ref="aba4bc00b985d8a3758cb2b1b9e4a74b4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classKademlia.html#aba4bc00b985d8a3758cb2b1b9e4a74b4">Kademlia::bucketRefreshTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00093">93</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, <a class="el" href="Kademlia_8cc_source.html#l01183">handleRpcResponse()</a>, <a class="el" href="Kademlia_8cc_source.html#l01121">handleTimerEvent()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00204">joinOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00162">Kademlia()</a>, <a class="el" href="Kademlia_8cc_source.html#l01302">lookupFinished()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00170">~Kademlia()</a>.</p>

</div>
</div>
<a class="anchor" id="a2121cb9b6da909626b69a2253923ae11"></a><!-- doxytag: member="Kademlia::comparator" ref="a2121cb9b6da909626b69a2253923ae11" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classKeyDistanceComparator.html">KeyDistanceComparator</a>&lt;<a class="el" href="classKeyXorMetric.html">KeyXorMetric</a>&gt;* <a class="el" href="classKademlia.html#a2121cb9b6da909626b69a2253923ae11">Kademlia::comparator</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00169">169</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00162">Kademlia()</a>, <a class="el" href="Kademlia_8cc_source.html#l00700">refillSiblingTable()</a>, <a class="el" href="Kademlia_8cc_source.html#l00304">routingBucket()</a>, <a class="el" href="Kademlia_8cc_source.html#l00255">routingDeinit()</a>, <a class="el" href="Kademlia_8cc_source.html#l00239">routingInit()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00170">~Kademlia()</a>.</p>

</div>
</div>
<a class="anchor" id="a151fd59bc6de940e684fbad408083ac4"></a><!-- doxytag: member="Kademlia::enableReplacementCache" ref="a151fd59bc6de940e684fbad408083ac4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#a151fd59bc6de940e684fbad408083ac4">Kademlia::enableReplacementCache</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00077">77</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00630">routingTimeout()</a>.</p>

</div>
</div>
<a class="anchor" id="ae7a670589ec838bbf79d684fba016185"></a><!-- doxytag: member="Kademlia::exhaustiveRefresh" ref="ae7a670589ec838bbf79d684fba016185" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#ae7a670589ec838bbf79d684fba016185">Kademlia::exhaustiveRefresh</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00072">72</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="acc2f4767a1687764f2d732872511a7ad"></a><!-- doxytag: member="Kademlia::k" ref="acc2f4767a1687764f2d732872511a7ad" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classKademlia.html#acc2f4767a1687764f2d732872511a7ad">Kademlia::k</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00065">65</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00280">getMaxNumRedundantNodes()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00889">recursiveRoutingHook()</a>, <a class="el" href="Kademlia_8cc_source.html#l00700">refillSiblingTable()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00304">routingBucket()</a>.</p>

</div>
</div>
<a class="anchor" id="a742e20c8d232a8623f4a85c2f0cad1e4"></a><!-- doxytag: member="Kademlia::maxStaleCount" ref="a742e20c8d232a8623f4a85c2f0cad1e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classKademlia.html#a742e20c8d232a8623f4a85c2f0cad1e4">Kademlia::maxStaleCount</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00069">69</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00630">routingTimeout()</a>.</p>

</div>
</div>
<a class="anchor" id="abda8d541b714ec855d891a2938fa8b3f"></a><!-- doxytag: member="Kademlia::minBucketRefreshInterval" ref="abda8d541b714ec855d891a2938fa8b3f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classKademlia.html#abda8d541b714ec855d891a2938fa8b3f">Kademlia::minBucketRefreshInterval</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00090">90</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="ae22800e069a69a317d4906a29e4da71d"></a><!-- doxytag: member="Kademlia::minSiblingTableRefreshInterval" ref="ae22800e069a69a317d4906a29e4da71d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classKademlia.html#ae22800e069a69a317d4906a29e4da71d">Kademlia::minSiblingTableRefreshInterval</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00089">89</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a68e77f3b48652f19219a6c6c9a1a76d2"></a><!-- doxytag: member="Kademlia::newMaintenance" ref="a68e77f3b48652f19219a6c6c9a1a76d2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#a68e77f3b48652f19219a6c6c9a1a76d2">Kademlia::newMaintenance</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00075">75</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, <a class="el" href="Kademlia_8cc_source.html#l01183">handleRpcResponse()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l01302">lookupFinished()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>.</p>

</div>
</div>
<a class="anchor" id="aa1eda90d9ae7c58ff916a9d493d7c1e6"></a><!-- doxytag: member="Kademlia::nodesReplaced" ref="aa1eda90d9ae7c58ff916a9d493d7c1e6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classKademlia.html#aa1eda90d9ae7c58ff916a9d493d7c1e6">Kademlia::nodesReplaced</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00167">167</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00180">finishOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00630">routingTimeout()</a>.</p>

</div>
</div>
<a class="anchor" id="a307336180b2937d77360219c9ac91c3c"></a><!-- doxytag: member="Kademlia::numBuckets" ref="a307336180b2937d77360219c9ac91c3c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classKademlia.html#a307336180b2937d77360219c9ac91c3c">Kademlia::numBuckets</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00173">173</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00969">findNode()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a113faa91ed3ec564f8b61718101695c2"></a><!-- doxytag: member="Kademlia::pingNewSiblings" ref="a113faa91ed3ec564f8b61718101695c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#a113faa91ed3ec564f8b61718101695c2">Kademlia::pingNewSiblings</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00073">73</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>.</p>

</div>
</div>
<a class="anchor" id="aa1c9d6f7ff020a8a9249f1da3d1fedbe"></a><!-- doxytag: member="Kademlia::proximityNeighborSelection" ref="aa1c9d6f7ff020a8a9249f1da3d1fedbe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#aa1c9d6f7ff020a8a9249f1da3d1fedbe">Kademlia::proximityNeighborSelection</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00086">86</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>.</p>

</div>
</div>
<a class="anchor" id="aa8b1be416dea22c671ae2774936226c5"></a><!-- doxytag: member="Kademlia::proximityRouting" ref="aa8b1be416dea22c671ae2774936226c5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#aa8b1be416dea22c671ae2774936226c5">Kademlia::proximityRouting</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00085">85</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00969">findNode()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="adc22fe7536c4bea9677ed901b95820a8"></a><!-- doxytag: member="Kademlia::replacementCachePing" ref="adc22fe7536c4bea9677ed901b95820a8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#adc22fe7536c4bea9677ed901b95820a8">Kademlia::replacementCachePing</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00078">78</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>.</p>

</div>
</div>
<a class="anchor" id="a8ebc8abde092aad89dfa813ba640e6ef"></a><!-- doxytag: member="Kademlia::replacementCandidates" ref="a8ebc8abde092aad89dfa813ba640e6ef" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint <a class="el" href="classKademlia.html#a8ebc8abde092aad89dfa813ba640e6ef">Kademlia::replacementCandidates</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00079">79</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>.</p>

</div>
</div>
<a class="anchor" id="a326e44556787c7708ff8b252caff5ad1"></a><!-- doxytag: member="Kademlia::routingTable" ref="a326e44556787c7708ff8b252caff5ad1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classKademliaBucket.html">KademliaBucket</a>*&gt; <a class="el" href="classKademlia.html#a326e44556787c7708ff8b252caff5ad1">Kademlia::routingTable</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00172">172</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00969">findNode()</a>, <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, <a class="el" href="Kademlia_8cc_source.html#l00846">handleFailedNode()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00700">refillSiblingTable()</a>, <a class="el" href="Kademlia_8cc_source.html#l00304">routingBucket()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00255">routingDeinit()</a>.</p>

</div>
</div>
<a class="anchor" id="aa10a75cebe4964a98840643b84063548"></a><!-- doxytag: member="Kademlia::s" ref="aa10a75cebe4964a98840643b84063548" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classKademlia.html#aa10a75cebe4964a98840643b84063548">Kademlia::s</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00067">67</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00275">getMaxNumSiblings()</a>, <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, <a class="el" href="Kademlia_8cc_source.html#l01183">handleRpcResponse()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00889">recursiveRoutingHook()</a>.</p>

</div>
</div>
<a class="anchor" id="a1f28727c1a562f3e40cd315dd22dd8cd"></a><!-- doxytag: member="Kademlia::secureMaintenance" ref="a1f28727c1a562f3e40cd315dd22dd8cd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classKademlia.html#a1f28727c1a562f3e40cd315dd22dd8cd">Kademlia::secureMaintenance</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>if true, ping not authenticated nodes before adding them to a bucket </p>

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00074">74</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00204">joinOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00700">refillSiblingTable()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>.</p>

</div>
</div>
<a class="anchor" id="a99dbb3ee2302a9861a518b3d75cb3eb2"></a><!-- doxytag: member="Kademlia::siblingPingInterval" ref="a99dbb3ee2302a9861a518b3d75cb3eb2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classKademlia.html#a99dbb3ee2302a9861a518b3d75cb3eb2">Kademlia::siblingPingInterval</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00091">91</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01183">handleRpcResponse()</a>, <a class="el" href="Kademlia_8cc_source.html#l01121">handleTimerEvent()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00204">joinOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a683327ac98618e38b3dd1dfe5850ab09"></a><!-- doxytag: member="Kademlia::siblingPingTimer" ref="a683327ac98618e38b3dd1dfe5850ab09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classKademlia.html#a683327ac98618e38b3dd1dfe5850ab09">Kademlia::siblingPingTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00094">94</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01183">handleRpcResponse()</a>, <a class="el" href="Kademlia_8cc_source.html#l01121">handleTimerEvent()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00204">joinOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00162">Kademlia()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00170">~Kademlia()</a>.</p>

</div>
</div>
<a class="anchor" id="ad4d31fcf8c7300404ae07523daab8cc6"></a><!-- doxytag: member="Kademlia::siblingRefreshNodes" ref="ad4d31fcf8c7300404ae07523daab8cc6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classKademlia.html#ad4d31fcf8c7300404ae07523daab8cc6">Kademlia::siblingRefreshNodes</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00080">80</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00193">sendSiblingFindNodeCall()</a>.</p>

</div>
</div>
<a class="anchor" id="a12d33f20db6e3709117f9894e73c6534"></a><!-- doxytag: member="Kademlia::siblingTable" ref="a12d33f20db6e3709117f9894e73c6534" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classKademliaBucket.html">KademliaBucket</a>* <a class="el" href="classKademlia.html#a12d33f20db6e3709117f9894e73c6534">Kademlia::siblingTable</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00171">171</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00969">findNode()</a>, <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, <a class="el" href="Kademlia_8cc_source.html#l00846">handleFailedNode()</a>, <a class="el" href="Kademlia_8cc_source.html#l00831">handleNodeGracefulLeaveNotification()</a>, <a class="el" href="Kademlia_8cc_source.html#l01121">handleTimerEvent()</a>, <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l00755">isSiblingFor()</a>, <a class="el" href="Kademlia_8cc_source.html#l00162">Kademlia()</a>, <a class="el" href="Kademlia_8cc_source.html#l01302">lookupFinished()</a>, <a class="el" href="Kademlia_8cc_source.html#l00700">refillSiblingTable()</a>, <a class="el" href="Kademlia_8cc_source.html#l00320">routingAdd()</a>, <a class="el" href="Kademlia_8cc_source.html#l00255">routingDeinit()</a>, <a class="el" href="Kademlia_8cc_source.html#l00239">routingInit()</a>, <a class="el" href="Kademlia_8cc_source.html#l00630">routingTimeout()</a>, <a class="el" href="Kademlia_8cc_source.html#l00739">setBucketUsage()</a>, <a class="el" href="Kademlia_8cc_source.html#l01429">updateTooltip()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00170">~Kademlia()</a>.</p>

</div>
</div>
<a class="anchor" id="a9b7cdab70352fcc52c0cfe55541807ef"></a><!-- doxytag: member="Kademlia::siblingTableRefreshCount" ref="a9b7cdab70352fcc52c0cfe55541807ef" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classKademlia.html#a9b7cdab70352fcc52c0cfe55541807ef">Kademlia::siblingTableRefreshCount</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="Kademlia_8h_source.html#l00166">166</a> of file <a class="el" href="Kademlia_8h_source.html">Kademlia.h</a>.</p>

<p>Referenced by <a class="el" href="Kademlia_8cc_source.html#l00180">finishOverlay()</a>, <a class="el" href="Kademlia_8cc_source.html#l01323">handleBucketRefreshTimerExpired()</a>, and <a class="el" href="Kademlia_8cc_source.html#l00095">initializeOverlay()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Kademlia_8h_source.html">Kademlia.h</a></li>
<li><a class="el" href="Kademlia_8cc_source.html">Kademlia.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classKademlia.html">Kademlia</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:52 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
