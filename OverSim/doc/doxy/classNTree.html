<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: NTree Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classNTree.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">NTree Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="NTree" --><!-- doxytag: inherits="BaseOverlay" -->
<p>A p2p protocol for MMOGs and virtual worlds.  
 <a href="classNTree.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="NTree_8h_source.html">NTree.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for NTree:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classNTree.png" usemap="#NTree_map" alt=""/>
  <map id="NTree_map" name="NTree_map">
<area href="classBaseOverlay.html" title="Base class for overlays." alt="BaseOverlay" shape="rect" coords="115,112,220,136"/>
<area href="classBaseRpc.html" title="Base class for RPCs." alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classTopologyVis.html" alt="TopologyVis" shape="rect" coords="230,56,335,80"/>
<area href="classRpcListener.html" title="A Remote-Procedure-Call listener class." alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
 </div></div>

<p><a href="classNTree-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#af4c3ba1929e03044a8f409768852843b">~NTree</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a563a4902066ebc3ec43d62dffc6ee83a">initializeOverlay</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes derived-class-attributes.  <a href="#a563a4902066ebc3ec43d62dffc6ee83a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#afd127335c6ff83e01ce7b93b24df2f29">finishOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">collects statistical data in derived class  <a href="#afd127335c6ff83e01ce7b93b24df2f29"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a419c6ad3063b42119ebd8afa64c2a14d">handleUDPMessage</a> (<a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes messages from underlay.  <a href="#a419c6ad3063b42119ebd8afa64c2a14d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ab9a8563095fe0b7cbd95eb98a166d0b4">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#aa40977b963b16f3c26043ccd193fcd43">handleAppMessage</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes "timer" self-messages.  <a href="#aa40977b963b16f3c26043ccd193fcd43"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#afab904983c5e838f3c1993112456d904">handleRpcCall</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes Remote-Procedure-Call invocation messages.  <a href="#afab904983c5e838f3c1993112456d904"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a45a9ef8e451f451193fa58c3d55a9a12">handleRpcResponse</a> (<a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *msg, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC response has been received.  <a href="#a45a9ef8e451f451193fa58c3d55a9a12"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a0c8624383f26bf380a33ca0db3bc953d">handleRpcTimeout</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, cPolymorphic *context, int rpcId, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;destKey)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC timeout has been reached.  <a href="#a0c8624383f26bf380a33ca0db3bc953d"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ac58d1280a59c72c46e182e70d7346d1e">setBootstrapedIcon</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a328fb159dd4e5986df6797967a7e01b4">handleMove</a> (<a class="el" href="classGameAPIPositionMessage.html">GameAPIPositionMessage</a> *posMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a move message from the application.  <a href="#a328fb159dd4e5986df6797967a7e01b4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ad6e4730c994e5a50d6e4ee3000ede68c">handleMoveMessage</a> (<a class="el" href="classNTreeMoveMessage.html">NTreeMoveMessage</a> *moveMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a move message from the network.  <a href="#ad6e4730c994e5a50d6e4ee3000ede68c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ab1357ccccb3b19730656d07c24057c7f">handleJoinCall</a> (<a class="el" href="classNTreeJoinCall.html">NTreeJoinCall</a> *joinCall)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles request to join a group.  <a href="#ab1357ccccb3b19730656d07c24057c7f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a440cba3647cd293e27bb75748beaed24">handleJoinResponse</a> (<a class="el" href="classNTreeJoinResponse.html">NTreeJoinResponse</a> *joinResp)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the acknowledgement to join a group.  <a href="#a440cba3647cd293e27bb75748beaed24"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a3a34f900e9368b2fed5f579a6977edca">handleJoinCallTimeout</a> (<a class="el" href="classNTreeJoinCall.html">NTreeJoinCall</a> *joinCall, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;oldNode)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets called if a join call times out Well try to re-join if needed.  <a href="#a3a34f900e9368b2fed5f579a6977edca"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a1e4512d83b5aa11f2772ba2803594d5d">handlePingCall</a> (<a class="el" href="classNTreePingCall.html">NTreePingCall</a> *pingCall)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a ping If the ping was send to a node in the n-tree, it is answered with information about the satte of that n-tree node (children, aggregated size)  <a href="#a1e4512d83b5aa11f2772ba2803594d5d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a926f95b00396cea01351a56291b23fef">handlePingResponse</a> (<a class="el" href="classNTreePingResponse.html">NTreePingResponse</a> *pingResp, <a class="el" href="classNTreePingContext.html">NTreePingContext</a> *context)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a ping response.  <a href="#a926f95b00396cea01351a56291b23fef"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a81a94103e0a86b5eca7e9e22f5c7a0ba">handlePingCallTimeout</a> (<a class="el" href="classNTreePingCall.html">NTreePingCall</a> *pingCall, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;oldNode, <a class="el" href="classNTreePingContext.html">NTreePingContext</a> *context)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a ping timeout Inform others about the failed node, replace it if needed.  <a href="#a81a94103e0a86b5eca7e9e22f5c7a0ba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ad6ce1ce06e0f80aec4dd1fbfaf1f8b57">handleDivideCall</a> (<a class="el" href="classNTreeDivideCall.html">NTreeDivideCall</a> *divideCall)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a request to divide a group.  <a href="#ad6ce1ce06e0f80aec4dd1fbfaf1f8b57"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#aca06c9a1d0f65ec2c600345d421c41ce">handleDivideResponse</a> (<a class="el" href="classNTreeDivideResponse.html">NTreeDivideResponse</a> *divideResp, <a class="el" href="classNTreeGroupDivideContext.html">NTreeGroupDivideContext</a> *context)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles an acknowledgement that a group was divided as requested.  <a href="#aca06c9a1d0f65ec2c600345d421c41ce"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ac99ce2807f3329dd7f26491f185b4f1d">handleDivideCallTimeout</a> (<a class="el" href="classNTreeDivideCall.html">NTreeDivideCall</a> *divideCall, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;oldNode, <a class="el" href="classNTreeGroupDivideContext.html">NTreeGroupDivideContext</a> *context)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets called if a divide call times out Re-send the request to a different node.  <a href="#ac99ce2807f3329dd7f26491f185b4f1d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#afd11bbeb64f1fe8a67e4f271fae1332c">handleAddMessage</a> (<a class="el" href="classNTreeGroupAddMessage.html">NTreeGroupAddMessage</a> *addMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles an information message that somebody joined a group we are a member of.  <a href="#afd11bbeb64f1fe8a67e4f271fae1332c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a69d251a5a8f5d631acaf2d7143048aa0">handleDeleteMessage</a> (<a class="el" href="classNTreeGroupDeleteMessage.html">NTreeGroupDeleteMessage</a> *deleteMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles an information message that a group we are a member of is going to be deleted.  <a href="#a69d251a5a8f5d631acaf2d7143048aa0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#aee2ae5399ed3496cc337e0775c447148">handleLeaveMessage</a> (<a class="el" href="classNTreeLeaveMessage.html">NTreeLeaveMessage</a> *leaveMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles an information message that somebody left a group we are a member of.  <a href="#aee2ae5399ed3496cc337e0775c447148"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#aaec0db408144067a78e2bdde717977ff">handleCollapseMessage</a> (<a class="el" href="classNTreeCollapseMessage.html">NTreeCollapseMessage</a> *collapseMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles an information message that a subtree we are part of is collapsed.  <a href="#aaec0db408144067a78e2bdde717977ff"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#abef2dca9bfb4329bc8d9a457571ea114">handleReplaceMessage</a> (<a class="el" href="classNTreeReplaceNodeMessage.html">NTreeReplaceNodeMessage</a> *replaceMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a request to replace a failed or leaving node.  <a href="#abef2dca9bfb4329bc8d9a457571ea114"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a00d94425ef726e748f806cf633fad05d">handleTakeOverMessage</a> (<a class="el" href="classNTreeTakeOverMessage.html">NTreeTakeOverMessage</a> *takeMsg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles an information message that a node took over the responsibilities of a failed or leaving node.  <a href="#a00d94425ef726e748f806cf633fad05d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#abb9c7820c6ca91e38cc686cb3aa51e58">handleNodeGracefulLeaveNotification</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method gets call **.gracefulLeaveDelay seconds before it is killed if this node is among the gracefulLeaveProbability nodes.  <a href="#abb9c7820c6ca91e38cc686cb3aa51e58"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a8144ddca854304bb21c31af09cbac6a8">divideNode</a> (<a class="el" href="classNTreeGroupDivideContext.html">NTreeGroupDivideContext</a> *context)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Divide a group that has gotten to large into four subgroups.  <a href="#a8144ddca854304bb21c31af09cbac6a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a44605b29655eb6167049f6f97ec92bf0">collapseTree</a> (std::map&lt; <a class="el" href="classNTreeScope.html">NTreeScope</a>, <a class="el" href="classNTreeNode.html">NTreeNode</a> &gt;::iterator node)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Collapse a subtree that has too few children.  <a href="#a44605b29655eb6167049f6f97ec92bf0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b">joinGroup</a> (<a class="el" href="classVector2D.html">Vector2D</a> <a class="el" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Joins the group that is responsible for a given position.  <a href="#ab4b84494578c721a26da4bbb5eefde6b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8">leaveGroup</a> (<a class="el" href="classVector2D.html">Vector2D</a> <a class="el" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a>, bool force=false)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Leaves a group for a given position.  <a href="#ad436b21004c209ceb44915dbacbcd8a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#afdd8948ebfcc9effd60b92f23583ff90">pingNodes</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Ping all children of all groups.  <a href="#afdd8948ebfcc9effd60b92f23583ff90"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a20f801c3c702c715fdeb9be9b84b10e6">checkParentTimeout</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a parent failed to send a ping for a longer time.  <a href="#a20f801c3c702c715fdeb9be9b84b10e6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#abd8783c5f0fcc92cc600e8d34481f4aa">routeViaNTree</a> (const <a class="el" href="classVector2D.html">Vector2D</a> &amp;pos, cPacket *msg, bool forward=false)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Route a message through the N-Tree to the closest know node to the given position.  <a href="#abd8783c5f0fcc92cc600e8d34481f4aa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#acf8d3d65329f72b0634351a496b77283">sendToGroup</a> (const <a class="el" href="classNTreeGroup.html">NTreeGroup</a> &amp;grp, cPacket *msg, bool keepMsg=false)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a message to all members of a group.  <a href="#acf8d3d65329f72b0634351a496b77283"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#acde7b902252e272ff2323316e88d7197">sendToGroup</a> (const std::set&lt; <a class="el" href="classNodeHandle.html">NodeHandle</a> &gt; &amp;grp, cPacket *msg, bool keepMsg=false)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a message to all members of a group.  <a href="#acde7b902252e272ff2323316e88d7197"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798">sendMessage</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, cPacket *msg, bool forward=false)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a message to a host.  <a href="#ad8afe52a993c199a72b1db93b4ab8798"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a6a09bf192a3c340e9d8f43c90d0b3169">changeState</a> (int <a class="el" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Change the internal state of the protocol.  <a href="#a6a09bf192a3c340e9d8f43c90d0b3169"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::list&lt; <a class="el" href="classNTreeGroup.html">NTreeGroup</a> &gt;::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0">findGroup</a> (const <a class="el" href="classVector2D.html">Vector2D</a> &amp;pos)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find a group that is responsible for the given position from the local list of groups.  <a href="#acb73a69af1f6fd5eba00bcebfd1949e0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::list&lt; <a class="el" href="classNTreeGroup.html">NTreeGroup</a> &gt;::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a7ed8946b8363adf863f68be85f02cffb">findGroup</a> (const <a class="el" href="classVector2D.html">Vector2D</a> &amp;pos, double size)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find a group that is responsible for the given position from the local list of groups Only return a group if it maches the exact scope given.  <a href="#a7ed8946b8363adf863f68be85f02cffb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classNTreeScope.html">NTreeScope</a>, <br class="typebreak"/>
<a class="el" href="classNTreeNode.html">NTreeNode</a> &gt;::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#af7b0930b4ab5d2536fd2af2386e890b4">findNTreeNode</a> (const <a class="el" href="classVector2D.html">Vector2D</a> &amp;pos)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the lowest ntree node that contains the given position.  <a href="#af7b0930b4ab5d2536fd2af2386e890b4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classNTreeScope.html">NTreeScope</a>, <br class="typebreak"/>
<a class="el" href="classNTreeNode.html">NTreeNode</a> &gt;::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#af905e11df66e90e9e64a589877ab7209">findNTreeNode</a> (const <a class="el" href="classVector2D.html">Vector2D</a> &amp;pos, double size)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the group that matches the given scope.  <a href="#af905e11df66e90e9e64a589877ab7209"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classNodeHandle.html">NodeHandle</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a4812f1429860a8d280ff4b90935e6667">getRandomNode</a> (std::set&lt; <a class="el" href="classNodeHandle.html">NodeHandle</a> &gt; invalidNodes=std::set&lt; <a class="el" href="classNodeHandle.html">NodeHandle</a> &gt;())</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a random node.  <a href="#a4812f1429860a8d280ff4b90935e6667"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a58564a7bbd7caaba33078388d34e89f1">AOIWidth</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a428051b8c6fd60c5f39db5fa552db8af">maxChildren</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classVector2D.html">Vector2D</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classNTreeGroup.html">NTreeGroup</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a888ebb36f7aaddb1887f31de28677765">pingInterval</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ae5b5dd01d0dd2c4ed1aa6938f2b5b553">joinTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a052e0c7016d6b7ac197cda112e3f26bc">pingTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::list&lt; <a class="el" href="classNTreeGroup.html">NTreeGroup</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classNTreeScope.html">NTreeScope</a>, <a class="el" href="classNTreeNode.html">NTreeNode</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a9d6f4c163375dc88ec52926708f87674">joinsSend</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a3254edf37eb3771820f257155a62d771">joinBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ac93cb62c57a09fda499e80996d2328a0">joinTimeout</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a41bffa6f701ff383b666ff9edf903ad6">divideCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a0bbe607c5d094d3b33026dfd948b7f22">collapseCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#a5c50f4d4ce98b68b32f0a4de8ec88443">movesSend</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classNTree.html#ac4b0f8e2026da537e51672847a9ab590">moveBytes</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>A p2p protocol for MMOGs and virtual worlds. </p>
<p>Provides the GameAPI interface Based upon: GauthierDickey, C., Lo, V., and Zappala, D. 2005. "Using n-trees for scalable
 event ordering in peer-to-peer games". In Proceedings of the international Workshop on Network and Operating Systems Support For Digital Audio and Video (Stevenson, Washington, USA, June 13 - 14, 2005). NOSSDAV '05. ACM, New York, NY, 87-92. DOI= <a href="http://doi.acm.org/10.1145/1065983.1066005">http://doi.acm.org/10.1145/1065983.1066005</a></p>
<dl class="author"><dt><b>Author:</b></dt><dd>STephan Krause </dd></dl>

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00045">45</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="af4c3ba1929e03044a8f409768852843b"></a><!-- doxytag: member="NTree::~NTree" ref="af4c3ba1929e03044a8f409768852843b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NTree::~NTree </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01439">1439</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    cancelAndDelete(<a class="code" href="classNTree.html#ae5b5dd01d0dd2c4ed1aa6938f2b5b553">joinTimer</a>);
    cancelAndDelete(<a class="code" href="classNTree.html#a052e0c7016d6b7ac197cda112e3f26bc">pingTimer</a>);
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a6a09bf192a3c340e9d8f43c90d0b3169"></a><!-- doxytag: member="NTree::changeState" ref="a6a09bf192a3c340e9d8f43c90d0b3169" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::changeState </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Change the internal state of the protocol. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>the state (see enum States in <a class="el" href="BaseOverlay_8h.html">BaseOverlay.h</a>) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01323">1323</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                      {
    <span class="keywordflow">switch</span>( newState ){
        <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>:
            <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a>;
            <span class="keywordflow">if</span>( !<a class="code" href="classNTree.html#ae5b5dd01d0dd2c4ed1aa6938f2b5b553">joinTimer</a>-&gt;isScheduled() ) {
                scheduleAt( ceil(simTime() + (simtime_t) par(<span class="stringliteral">&quot;joinDelay&quot;</span>)), <a class="code" href="classNTree.html#ae5b5dd01d0dd2c4ed1aa6938f2b5b553">joinTimer</a> );
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>:
            <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>;
            <a class="code" href="classNTree.html#ac58d1280a59c72c46e182e70d7346d1e">setBootstrapedIcon</a>();
            <span class="keywordflow">if</span>( !<a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> &amp;&amp; <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.size() ) <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = &amp;<a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.front();
            <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>( <span class="keyword">true</span> );
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>:
            <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>;
            <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>( <span class="keyword">false</span> );
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faad4c4f4f3bddd311d8c11b20c1c6d00f">SHUTDOWN</a>:
            <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> = <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faad4c4f4f3bddd311d8c11b20c1c6d00f">SHUTDOWN</a>;
            cancelAndDelete( <a class="code" href="classNTree.html#a052e0c7016d6b7ac197cda112e3f26bc">pingTimer</a> );
            <a class="code" href="classNTree.html#a052e0c7016d6b7ac197cda112e3f26bc">pingTimer</a> = NULL;
            <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>( <span class="keyword">false</span> );
            <span class="keywordflow">break</span>;
    }
    <a class="code" href="classNTree.html#ac58d1280a59c72c46e182e70d7346d1e">setBootstrapedIcon</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a20f801c3c702c715fdeb9be9b84b10e6"></a><!-- doxytag: member="NTree::checkParentTimeout" ref="a20f801c3c702c715fdeb9be9b84b10e6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::checkParentTimeout </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check if a parent failed to send a ping for a longer time. </p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01070">1070</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Go throup all nodes. iterator is incremented in-loop to allow deletion</span>
    <span class="keywordflow">for</span>(std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.begin(); it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end(); ){
        <span class="keywordflow">if</span>( it-&gt;second.parent.isUnspecified() || (it-&gt;second.lastPing == 0) ) {
            ++it;
            <span class="keywordflow">continue</span>;
        }
        <span class="keywordflow">if</span>( it-&gt;second.lastPing + <a class="code" href="classNTree.html#a888ebb36f7aaddb1887f31de28677765">pingInterval</a> + <a class="code" href="classNTree.html#a888ebb36f7aaddb1887f31de28677765">pingInterval</a> &lt; simTime() ){
            <span class="comment">// Parent timed out</span>
            EV &lt;&lt; <span class="stringliteral">&quot;[NTree::checkParentTimeout() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;    Parent for node&quot;</span> &lt;&lt; it-&gt;second &lt;&lt; <span class="stringliteral">&quot; timed out\n&quot;</span>;
            <span class="comment">// Replace parent if parent is root. Other parents will be replaced by their parents</span>
            <span class="comment">// Also, only sibling[0] does the replacing to avoid conflicts.</span>
            <span class="keywordflow">if</span>( it-&gt;second.parentIsRoot ) {
                <span class="keywordflow">if</span>( it-&gt;second.siblings[0] == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> ){
                    EV &lt;&lt; <span class="stringliteral">&quot;    Parent was root. Replacing him\n&quot;</span>;
                    <a class="code" href="classNTreeReplaceNodeMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeReplaceNodeMessage</a>* replaceMsg = <span class="keyword">new</span> <a class="code" href="classNTreeReplaceNodeMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeReplaceNodeMessage</a>(<span class="stringliteral">&quot;Replace failed ROOT.&quot;</span>);
                    replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#af977d45900282ba491453bdd774aaed9">setOrigin</a>( <a class="code" href="classVector2D.html">Vector2D</a>(<a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>/2.0, <a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>/2.0) );
                    replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#aa0c5ac6818f77708e35c75747eca10e3">setSize</a>( <a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a> );
                    replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a33b5baf77becd981daf1237947eff504">setIsLeaf</a>( <span class="keyword">false</span> );
                    replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#aafad2da57f24946d4909e4c0ac1cb272">setChildrenArraySize</a>( 4 );
                    replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a9a3665f3aaa005dec901a23baf176e21">setOldNode</a>( it-&gt;second.parent );

                    std::set&lt;NodeHandle&gt; invalidNodes;
                    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                        replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a92a12934f4e35d4be42f687acbaf6ad9">setChildren</a>( i, it-&gt;second.siblings[i] );
                        invalidNodes.insert( replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#abd0787cc60bf364e75fd974fa2f781d6">getChildren</a>(i) );
                    }
                    replaceMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a8a6a66791389fce3829c25b21bb7f3ab">NTREEREPLACE_L</a>(replaceMsg) );

                    <span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp; dest = <a class="code" href="classNTree.html#a4812f1429860a8d280ff4b90935e6667" title="Return a random node.">getRandomNode</a>( invalidNodes );
                    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                            <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>++;
                            <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += replaceMsg-&gt;getByteLength();
                    );
                    <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>(dest, replaceMsg );
                }
                ++it;
            } <span class="keywordflow">else</span> {
                <span class="comment">// else drop node</span>
                <span class="keywordflow">if</span>( it-&gt;second.group ){
                    <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> &amp;&amp; *<a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> == *it-&gt;second.group ){
                        <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = NULL;
                    }
                    <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.remove( *it-&gt;second.group );
                }
                <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.erase( it++ );
            }
        } <span class="keywordflow">else</span> {
            ++it;
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a44605b29655eb6167049f6f97ec92bf0"></a><!-- doxytag: member="NTree::collapseTree" ref="a44605b29655eb6167049f6f97ec92bf0" args="(std::map&lt; NTreeScope, NTreeNode &gt;::iterator node)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::collapseTree </td>
          <td>(</td>
          <td class="paramtype">std::map&lt; <a class="el" href="classNTreeScope.html">NTreeScope</a>, <a class="el" href="classNTreeNode.html">NTreeNode</a> &gt;::iterator&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Collapse a subtree that has too few children. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>the new leaf of the subtree </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01168">1168</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[NTree::CollapseTree() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Collapsing tree&quot;</span> &lt;&lt; node-&gt;second &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="comment">// Inform children</span>
    <a class="code" href="classNTreeCollapseMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeCollapseMessage</a>* collapseMsg = <span class="keyword">new</span> <a class="code" href="classNTreeCollapseMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeCollapseMessage</a>(<span class="stringliteral">&quot;Collapse Tree&quot;</span>);
    collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#ad9bd222ea866fe3bf4c5b9dc2327d1f1">setPlayer</a>( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
    collapseMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a05bb26b012bd4dc826f86714cfa0659b">NTREECOLLAPSE_L</a>(collapseMsg) );

    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
        collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#ac7a4749148bd9e2ab0b3d960f3f86561">setOrigin</a>( node-&gt;second.scope.getSubScope(i).origin );
        collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#a2f339ba66e78b8c9144d066e88dc4819">setSize</a>( node-&gt;second.scope.getSubScope(i).size );
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>++;
                <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += collapseMsg-&gt;getByteLength();
                <a class="code" href="classNTree.html#a0bbe607c5d094d3b33026dfd948b7f22">collapseCount</a> ++;
        );
        <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>( node-&gt;second.children[i], collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#a349310262352370210cbab0313e98211">dup</a>() );
        <span class="comment">// and update node</span>
        node-&gt;second.children[i] = <a class="code" href="classNodeHandle.html#a79bf2c5e29c969cbd0b2581cb188d8a6" title="the unspecified NodeHandle">NodeHandle::UNSPECIFIED_NODE</a>;
        node-&gt;second.childChildren[i].clear();
        node-&gt;second.aggChildCount[i] = 0;
    }
    <span class="keyword">delete</span> collapseMsg;

    <span class="comment">// create group for node</span>
    <a class="code" href="classNTreeGroup.html">NTreeGroup</a> newGroup( node-&gt;second.scope );
    newGroup.leader = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>;
    newGroup.members.insert( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
    <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.push_front( newGroup );

    node-&gt;second.group = &amp;(<a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.front());
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8144ddca854304bb21c31af09cbac6a8"></a><!-- doxytag: member="NTree::divideNode" ref="a8144ddca854304bb21c31af09cbac6a8" args="(NTreeGroupDivideContext *context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::divideNode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeGroupDivideContext.html">NTreeGroupDivideContext</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Divide a group that has gotten to large into four subgroups. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>A context pointer to coordinate the four new children </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01126">1126</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[NTree::divideNode() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Trying to divide node &quot;</span> &lt;&lt; context-&gt;<a class="code" href="classNTreeGroupDivideContext.html#a52f9e9bc7d7edfe42b7e74e6a420477e">nodeScope</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.find( context-&gt;<a class="code" href="classNTreeGroupDivideContext.html#a52f9e9bc7d7edfe42b7e74e6a420477e">nodeScope</a> );
    <span class="keywordflow">if</span>( it == <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end() ){
        EV &lt;&lt; <span class="stringliteral">&quot;    However, node is not in the list of known nodes\n&quot;</span>;
        <span class="keywordflow">return</span>;
    }
    <span class="keywordflow">if</span>( !it-&gt;second.group ){
        EV &lt;&lt; <span class="stringliteral">&quot;    However, node has no known group attached\n&quot;</span>;
        <span class="keywordflow">return</span>;
    }
    <span class="comment">// Inform group members</span>
    <a class="code" href="classNTreeGroupDeleteMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeGroupDeleteMessage</a>* delMsg = <span class="keyword">new</span> <a class="code" href="classNTreeGroupDeleteMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeGroupDeleteMessage</a>(<span class="stringliteral">&quot;Delete Group due to divide&quot;</span>);
    delMsg-&gt;<a class="code" href="classNTreeGroupDeleteMessage.html#a7acf10df30c6a0237c89904c11342393">setOrigin</a>( context-&gt;<a class="code" href="classNTreeGroupDivideContext.html#a52f9e9bc7d7edfe42b7e74e6a420477e">nodeScope</a>.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> );
    delMsg-&gt;<a class="code" href="classNTreeGroupDeleteMessage.html#a1fac3b5b518649ba234dcb152ecdd19f">setSize</a>( context-&gt;<a class="code" href="classNTreeGroupDivideContext.html#a52f9e9bc7d7edfe42b7e74e6a420477e">nodeScope</a>.<a class="code" href="classNTreeScope.html#a3988c5bd6a66a74ffb1fcc5ea91fc653">size</a> );
    delMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#aeffb22c9e19bad188fcac7ecf3b7f93b">NTREEDELETE_L</a>(delMsg) );
    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
        delMsg-&gt;<a class="code" href="classNTreeGroupDeleteMessage.html#a4d5f5d64c3010a06b2b4e30c37010070">setNewChild</a>(i, context-&gt;<a class="code" href="classNTreeGroupDivideContext.html#a954a02069a13d844e49d9c92c00ab61d">newChild</a>[i] );
    }
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
            <a class="code" href="classNTree.html#a41bffa6f701ff383b666ff9edf903ad6">divideCount</a> ++;
            <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>+= it-&gt;second.group-&gt;members.size();
            <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += it-&gt;second.group-&gt;members.size()*delMsg-&gt;getByteLength();
    );
    <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">sendToGroup</a>( *it-&gt;second.group, delMsg );

    <span class="comment">// delete group</span>
    <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> &amp;&amp; *<a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> == *it-&gt;second.group ){
        <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = NULL;
    }
    <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.remove( *it-&gt;second.group );
    it-&gt;second.group= NULL;

    <span class="comment">// add children to ntreeNode</span>
    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
        it-&gt;second.children[i] = context-&gt;<a class="code" href="classNTreeGroupDivideContext.html#a954a02069a13d844e49d9c92c00ab61d">newChild</a>[i];
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="acb73a69af1f6fd5eba00bcebfd1949e0"></a><!-- doxytag: member="NTree::findGroup" ref="acb73a69af1f6fd5eba00bcebfd1949e0" args="(const Vector2D &amp;pos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::list&lt; <a class="el" href="classNTreeGroup.html">NTreeGroup</a> &gt;::iterator NTree::findGroup </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classVector2D.html">Vector2D</a> &amp;&#160;</td>
          <td class="paramname"><em>pos</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find a group that is responsible for the given position from the local list of groups. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pos</td><td>the position </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01372">1372</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span>( std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.begin(); it != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end(); ++it ){
        <span class="keywordflow">if</span>( it-&gt;isInScope( pos ) ) <span class="keywordflow">return</span> it;
    }
    <span class="keywordflow">return</span> <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7ed8946b8363adf863f68be85f02cffb"></a><!-- doxytag: member="NTree::findGroup" ref="a7ed8946b8363adf863f68be85f02cffb" args="(const Vector2D &amp;pos, double size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::list&lt; <a class="el" href="classNTreeGroup.html">NTreeGroup</a> &gt;::iterator NTree::findGroup </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classVector2D.html">Vector2D</a> &amp;&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find a group that is responsible for the given position from the local list of groups Only return a group if it maches the exact scope given. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pos</td><td>the origin of the group </td></tr>
    <tr><td class="paramname">size</td><td>the size of the group </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01380">1380</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span>( std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.begin(); it != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end(); ++it ){
        <span class="keywordflow">if</span>( it-&gt;scope.origin == pos &amp;&amp; it-&gt;scope.size == size ) <span class="keywordflow">return</span> it;
    }
    <span class="keywordflow">return</span> <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end();
}
</pre></div>
</div>
</div>
<a class="anchor" id="af7b0930b4ab5d2536fd2af2386e890b4"></a><!-- doxytag: member="NTree::findNTreeNode" ref="af7b0930b4ab5d2536fd2af2386e890b4" args="(const Vector2D &amp;pos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt; <a class="el" href="classNTreeScope.html">NTreeScope</a>, <a class="el" href="classNTreeNode.html">NTreeNode</a> &gt;::iterator NTree::findNTreeNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classVector2D.html">Vector2D</a> &amp;&#160;</td>
          <td class="paramname"><em>pos</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the lowest ntree node that contains the given position. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pos</td><td>the position </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01388">1388</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">double</span> size = <a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a> + 1;
    std::map&lt;NTreeScope,NTreeNode&gt;::iterator bestNode = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end();
    <span class="keywordflow">for</span>( std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.begin(); it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end(); ++it ){
        <span class="keywordflow">if</span>( it-&gt;second.isInScope( pos ) &amp;&amp; it-&gt;second.scope.size &lt; size ){
            bestNode = it;
            size = bestNode-&gt;second.scope.size;
        }
    }
    <span class="keywordflow">return</span> bestNode;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af905e11df66e90e9e64a589877ab7209"></a><!-- doxytag: member="NTree::findNTreeNode" ref="af905e11df66e90e9e64a589877ab7209" args="(const Vector2D &amp;pos, double size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt; <a class="el" href="classNTreeScope.html">NTreeScope</a>, <a class="el" href="classNTreeNode.html">NTreeNode</a> &gt;::iterator NTree::findNTreeNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classVector2D.html">Vector2D</a> &amp;&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the group that matches the given scope. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pos</td><td>the origin of the node </td></tr>
    <tr><td class="paramname">size</td><td>the size of the scope </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01401">1401</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.find( <a class="code" href="classNTreeScope.html">NTreeScope</a>( pos, size ) );
}
</pre></div>
</div>
</div>
<a class="anchor" id="afd127335c6ff83e01ce7b93b24df2f29"></a><!-- doxytag: member="NTree::finishOverlay" ref="afd127335c6ff83e01ce7b93b24df2f29" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::finishOverlay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collects statistical data in derived class </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a8db85b9c706d04007154761d5a0cec16">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01424">1424</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    simtime_t time = <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a610799ebfbf64696c59b811870cc8300">calcMeasuredLifetime</a>(<a class="code" href="classBaseOverlay.html#af0eebaddea732ee4ab4d247c388e62bd" title="simtime when the node has been created">creationTime</a>);
    <span class="keywordflow">if</span> (time &lt; <a class="code" href="classGlobalStatistics.html#a169810c78519b271f7e32fdc7c9fc641" title="minimum useful measured lifetime in seconds">GlobalStatistics::MIN_MEASURED</a>) <span class="keywordflow">return</span>;
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;NTree: Joins send per second&quot;</span>, <a class="code" href="classNTree.html#a9d6f4c163375dc88ec52926708f87674">joinsSend</a> / time );
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;NTree: Join bytes send per second&quot;</span>, <a class="code" href="classNTree.html#a3254edf37eb3771820f257155a62d771">joinBytes</a> / time );
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;NTree: Join timeouts per second&quot;</span>, <a class="code" href="classNTree.html#ac93cb62c57a09fda499e80996d2328a0">joinTimeout</a> / time );
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;NTree: Tree maintenance messages send per second&quot;</span>, <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a> / time );
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;NTree: Tree maintenance bytes send per second&quot;</span>, <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> / time );
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;NTree: Move messages send per second&quot;</span>, <a class="code" href="classNTree.html#a5c50f4d4ce98b68b32f0a4de8ec88443">movesSend</a> / time );
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;NTree: Move bytes send per second&quot;</span>, <a class="code" href="classNTree.html#ac4b0f8e2026da537e51672847a9ab590">moveBytes</a> / time );
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;NTree: Tree collapsed per second&quot;</span>, <a class="code" href="classNTree.html#a0bbe607c5d094d3b33026dfd948b7f22">collapseCount</a> / time );
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;NTree: Tree divides per second&quot;</span>, <a class="code" href="classNTree.html#a41bffa6f701ff383b666ff9edf903ad6">divideCount</a> / time );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4812f1429860a8d280ff4b90935e6667"></a><!-- doxytag: member="NTree::getRandomNode" ref="a4812f1429860a8d280ff4b90935e6667" args="(std::set&lt; NodeHandle &gt; invalidNodes=std::set&lt; NodeHandle &gt;())" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classNodeHandle.html">NodeHandle</a> NTree::getRandomNode </td>
          <td>(</td>
          <td class="paramtype">std::set&lt; <a class="el" href="classNodeHandle.html">NodeHandle</a> &gt;&#160;</td>
          <td class="paramname"><em>invalidNodes</em> = <code>std::set&lt;<a class="el" href="classNodeHandle.html">NodeHandle</a>&gt;()</code></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return a random node. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">invalidNodes</td><td>a list of nodes that should not be returned </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01406">1406</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// FIXME: This is cheating...</span>
    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
    <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> dest;
    <span class="keywordflow">while</span>( !found ){
        dest = <a class="code" href="classBaseOverlay.html#a933e505ea77cae4ab0c8edcb77ade2c7" title="pointer to GlobalNodeList in this node">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a4a52b6c813beb1e42e882da2451e623e" title="Returns a random NodeHandle.">getRandomNode</a>();
        found = <span class="keyword">true</span>;
        <span class="keywordflow">for</span>( std::set&lt;NodeHandle&gt;::iterator it = invalidNodes.begin(); it != invalidNodes.end(); ++it ){
            <span class="keywordflow">if</span>( dest == *it ){
                found = <span class="keyword">false</span>;
                <span class="keywordflow">break</span>;
            }
        }
    }
    <span class="keywordflow">return</span> dest;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afd11bbeb64f1fe8a67e4f271fae1332c"></a><!-- doxytag: member="NTree::handleAddMessage" ref="afd11bbeb64f1fe8a67e4f271fae1332c" args="(NTreeGroupAddMessage *addMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleAddMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeGroupAddMessage.html">NTreeGroupAddMessage</a> *&#160;</td>
          <td class="paramname"><em>addMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles an information message that somebody joined a group we are a member of. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">addMsg</td><td>the information message </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00514">514</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( addMsg-&gt;<a class="code" href="classNTreeGroupAddMessage.html#a1f9bf335690b64fbb1abccc62420b009">getOrigin</a>() );
    <span class="keywordflow">if</span>( it == <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ){
        EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleAddMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    Received add message for unknown group scope=&quot;</span> &lt;&lt; addMsg-&gt;<a class="code" href="classNTreeGroupAddMessage.html#a1f9bf335690b64fbb1abccc62420b009">getOrigin</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        <span class="keywordflow">return</span>;
    }
    EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleAddMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Received add message for group scope=&quot;</span> &lt;&lt; addMsg-&gt;<a class="code" href="classNTreeGroupAddMessage.html#a1f9bf335690b64fbb1abccc62420b009">getOrigin</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Player=&quot;</span> &lt;&lt; addMsg-&gt;<a class="code" href="classNTreeGroupAddMessage.html#a5eadf9c93a2a6eaf7565c09143a187b1">getPlayer</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    it-&gt;members.insert( addMsg-&gt;<a class="code" href="classNTreeGroupAddMessage.html#a5eadf9c93a2a6eaf7565c09143a187b1">getPlayer</a>() );
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa40977b963b16f3c26043ccd193fcd43"></a><!-- doxytag: member="NTree::handleAppMessage" ref="aa40977b963b16f3c26043ccd193fcd43" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleAppMessage </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes "timer" self-messages. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>A self-message Processes non-commonAPI messages</td></tr>
    <tr><td class="paramname">msg</td><td>non-commonAPIMessage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#aef92d042c22b47c123e59a831acb7033">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00238">238</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classGameAPIPositionMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">GameAPIPositionMessage</a> *posMsg = dynamic_cast&lt;GameAPIPositionMessage*&gt;(msg) ) {
        <span class="keywordflow">if</span>( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a> ) {
            <a class="code" href="classNTree.html#a328fb159dd4e5986df6797967a7e01b4" title="Handles a move message from the application.">handleMove</a>( posMsg );
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a> ) {
            <span class="comment">// We are not connected to the overlay, inform app</span>
            <a class="code" href="classCompReadyMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">CompReadyMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classCompReadyMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">CompReadyMessage</a>(<span class="stringliteral">&quot;Overlay not READY!&quot;</span>);
            msg-&gt;<a class="code" href="classCompReadyMessage.html#a07d2b2a15889728c23ed4d80730de2cf">setReady</a>(<span class="keyword">false</span>);
            msg-&gt;<a class="code" href="classCompReadyMessage.html#a77640d7f3566804064921b2520ed51b6">setComp</a>(<a class="code" href="classBaseOverlay.html#a92e0d3f96a5716245465e05da60ef487" title="Return the component type of this module.">getThisCompType</a>());
            send( msg, <span class="stringliteral">&quot;appOut&quot;</span>);
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a> ) {
            <span class="comment">// This is only called for the first MOVE message</span>
            <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a> bootstrapNode = <a class="code" href="classBaseOverlay.html#abe4dea93564123116c97d5c4721f0504" title="pointer to the BootstrapList module">bootstrapList</a>-&gt;<a class="code" href="classBootstrapList.html#ac351433be1d43bbf8cbb871e9f9e1f69" title="Get a bootstrap node from the bootstrap list.">getBootstrapNode</a>();
            <span class="keywordflow">if</span>( bootstrapNode.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() ){
                <a class="code" href="classNTreeGroup.html">NTreeGroup</a> grp(<a class="code" href="classVector2D.html">Vector2D</a>(<a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>/2,<a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>/2), <a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>);
                grp.leader = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>;
                grp.members.insert(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
                <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.push_front(grp);

                <a class="code" href="classNTreeScope.html">NTreeScope</a> initialScope(<a class="code" href="classVector2D.html">Vector2D</a>(<a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>/2,<a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>/2), <a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>);
                <a class="code" href="classNTreeNode.html">NTreeNode</a> root(initialScope);
                root.group = &amp;<a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.front();
                <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.insert(make_pair(initialScope,root));
                <a class="code" href="classNTree.html#a6a09bf192a3c340e9d8f43c90d0b3169" title="Change the internal state of the protocol.">changeState</a>( <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a> );
            } <span class="keywordflow">else</span> {
                <span class="comment">// Trigger login</span>
                <a class="code" href="classNTree.html#a6a09bf192a3c340e9d8f43c90d0b3169" title="Change the internal state of the protocol.">changeState</a>( <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a> );
                <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> = posMsg-&gt;getPosition();
                <a class="code" href="classNTreeJoinCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeJoinCall</a>* joinMsg = <span class="keyword">new</span> <a class="code" href="classNTreeJoinCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeJoinCall</a>(<span class="stringliteral">&quot;Login&quot;</span>);
                joinMsg-&gt;<a class="code" href="classNTreeJoinCall.html#a9cfa615d030b211ed66f130f6fccc488">setPosition</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> );
                joinMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a1f34eb76183d177f52cbf91168b9f553">NTREEJOINCALL_L</a>(joinMsg) );
                <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>( bootstrapNode, joinMsg );
            }

            <a class="code" href="classNTree.html#ac58d1280a59c72c46e182e70d7346d1e">setBootstrapedIcon</a>();

        }
        <span class="keyword">delete</span> msg;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aaec0db408144067a78e2bdde717977ff"></a><!-- doxytag: member="NTree::handleCollapseMessage" ref="aaec0db408144067a78e2bdde717977ff" args="(NTreeCollapseMessage *collapseMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleCollapseMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeCollapseMessage.html">NTreeCollapseMessage</a> *&#160;</td>
          <td class="paramname"><em>collapseMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles an information message that a subtree we are part of is collapsed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">collapseMsg</td><td>the information message </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00579">579</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleCollapseMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Got collapse message for group &quot;</span> &lt;&lt; collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#a9e63260de84d3991d2aadb4afbc623a0">getOrigin</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#af7b0930b4ab5d2536fd2af2386e890b4" title="Find the lowest ntree node that contains the given position.">findNTreeNode</a>( collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#a9e63260de84d3991d2aadb4afbc623a0">getOrigin</a>(), collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#afc090a2e2a05e92a0f27ccf9b73ced05">getSize</a>() );
    <span class="keywordflow">if</span>( it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end() ){
        <span class="keywordflow">if</span>( it-&gt;second.group ){
            EV &lt;&lt; <span class="stringliteral">&quot;    Informing group\n&quot;</span>;
            <span class="comment">// leaf, inform group</span>
            <a class="code" href="classNTreeGroupDeleteMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeGroupDeleteMessage</a>* delMsg = <span class="keyword">new</span> <a class="code" href="classNTreeGroupDeleteMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeGroupDeleteMessage</a>(<span class="stringliteral">&quot;Delete Group due to collapse&quot;</span>);
            delMsg-&gt;<a class="code" href="classNTreeGroupDeleteMessage.html#a7acf10df30c6a0237c89904c11342393">setOrigin</a>( collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#a9e63260de84d3991d2aadb4afbc623a0">getOrigin</a>() );
            delMsg-&gt;<a class="code" href="classNTreeGroupDeleteMessage.html#a1fac3b5b518649ba234dcb152ecdd19f">setSize</a>( collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#afc090a2e2a05e92a0f27ccf9b73ced05">getSize</a>() );
            <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                delMsg-&gt;<a class="code" href="classNTreeGroupDeleteMessage.html#a4d5f5d64c3010a06b2b4e30c37010070">setNewChild</a>( i, collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#ab0cff3e7c406705bdc1600249ef556bf">getPlayer</a>() );
            }
            delMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#aeffb22c9e19bad188fcac7ecf3b7f93b">NTREEDELETE_L</a>(delMsg) );
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                    <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a> += it-&gt;second.group-&gt;members.size();
                    <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += it-&gt;second.group-&gt;members.size()*delMsg-&gt;getByteLength();
            );
            <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">sendToGroup</a>( *it-&gt;second.group, delMsg );
            <span class="comment">// delete group</span>
            <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> &amp;&amp; *<a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> == *it-&gt;second.group ){
                <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = NULL;
            }
            <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.remove( *it-&gt;second.group );

        } <span class="keywordflow">else</span> {
            <span class="comment">// node, inform children</span>
            EV &lt;&lt; <span class="stringliteral">&quot;    Informing children\n&quot;</span>;
            <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                EV &lt;&lt; <span class="stringliteral">&quot;    ==&gt; &quot;</span> &lt;&lt; it-&gt;second.children[i] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
                collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#ac7a4749148bd9e2ab0b3d960f3f86561">setOrigin</a>( it-&gt;second.scope.getSubScope(i).origin );
                collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#a2f339ba66e78b8c9144d066e88dc4819">setSize</a>( it-&gt;second.scope.getSubScope(i).size );
                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                        <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>++;
                        <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += collapseMsg-&gt;getByteLength();
                );
                <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>( it-&gt;second.children[i], collapseMsg-&gt;<a class="code" href="classNTreeCollapseMessage.html#a349310262352370210cbab0313e98211">dup</a>() );
            }
        }
        <span class="comment">// delete node</span>
        <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.erase( it );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a69d251a5a8f5d631acaf2d7143048aa0"></a><!-- doxytag: member="NTree::handleDeleteMessage" ref="a69d251a5a8f5d631acaf2d7143048aa0" args="(NTreeGroupDeleteMessage *deleteMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleDeleteMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeGroupDeleteMessage.html">NTreeGroupDeleteMessage</a> *&#160;</td>
          <td class="paramname"><em>deleteMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles an information message that a group we are a member of is going to be deleted. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">deleteMsg</td><td>the information message </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00530">530</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( deleteMsg-&gt;<a class="code" href="classNTreeGroupDeleteMessage.html#ab6d5b1a4368dd0664e83628bf54e88d4">getOrigin</a>(), deleteMsg-&gt;<a class="code" href="classNTreeGroupDeleteMessage.html#a877f4dc1ba60092ff3cfa601a92870d0">getSize</a>() );
    <span class="comment">// Group already deleted</span>
    <span class="keywordflow">if</span>( it == <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ) <span class="keywordflow">return</span>;

    <span class="comment">// Check if I believe to own the group</span>
    <span class="comment">// In that case, delete the corresponding node</span>
    <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.erase( it-&gt;scope );

    <span class="comment">// Join new sub-group</span>
    <span class="keywordflow">if</span>( it-&gt;isInScope(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a>) ){
        <a class="code" href="classNTreeJoinCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeJoinCall</a>* joinCall = <span class="keyword">new</span> <a class="code" href="classNTreeJoinCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeJoinCall</a>(<span class="stringliteral">&quot;JOIN GROUP&quot;</span>);
        joinCall-&gt;<a class="code" href="classNTreeJoinCall.html#a9cfa615d030b211ed66f130f6fccc488">setPosition</a>(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a>);
        joinCall-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a1f34eb76183d177f52cbf91168b9f553">NTREEJOINCALL_L</a>(joinCall) );
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                <a class="code" href="classNTree.html#a9d6f4c163375dc88ec52926708f87674">joinsSend</a>++;
                <a class="code" href="classNTree.html#a3254edf37eb3771820f257155a62d771">joinBytes</a> += joinCall-&gt;getByteLength();
        );
        <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>( deleteMsg-&gt;<a class="code" href="classNTreeGroupDeleteMessage.html#a1bc236622072aa9133661219a924ab5c">getNewChild</a>( it-&gt;scope.origin.getQuadrant( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> )), joinCall);
    }

    <span class="comment">// delete group</span>
    <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> == &amp;(*it) ) <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = NULL;
    <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.erase( it );
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad6ce1ce06e0f80aec4dd1fbfaf1f8b57"></a><!-- doxytag: member="NTree::handleDivideCall" ref="ad6ce1ce06e0f80aec4dd1fbfaf1f8b57" args="(NTreeDivideCall *divideCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleDivideCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeDivideCall.html">NTreeDivideCall</a> *&#160;</td>
          <td class="paramname"><em>divideCall</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a request to divide a group. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">divideCall</td><td>the request </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00806">806</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleDivide() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>;
    std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a61d312fe120533531f112ba51fa176f8">getOrigin</a>(), divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a1537d41863d17cf64ecde223f666de28">getSize</a>() );
    <span class="keywordflow">if</span>( it == <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ){
        EV &lt;&lt; <span class="stringliteral">&quot;    Received divide message for unknown group scope=&quot;</span> &lt;&lt; divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a61d312fe120533531f112ba51fa176f8">getOrigin</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    } <span class="keywordflow">else</span> {
        EV &lt;&lt; <span class="stringliteral">&quot;    Divide group &quot;</span> &lt;&lt; it-&gt;scope &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    }

    <span class="comment">// Calculate new scope</span>
    <a class="code" href="classNTreeScope.html">NTreeScope</a> oldScope(divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a61d312fe120533531f112ba51fa176f8">getOrigin</a>(), divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a1537d41863d17cf64ecde223f666de28">getSize</a>() );
    <a class="code" href="classNTreeScope.html">NTreeScope</a> newScope = oldScope.<a class="code" href="classNTreeScope.html#aecb6a6e39493200fb0557bd5e26cc22b">getSubScope</a>( divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a312970e24d3686aa2879c37b3e7280b2">getQuadrant</a>() );

    <span class="comment">// If we own the node that is beeing divided, something went wrong</span>
    <span class="comment">// However, ther is nothing we can do about it except removing the offending node</span>
    <span class="comment">// Sombody obviously took over without us noticing</span>
    <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.erase( oldScope );

    <span class="comment">// Create new group, delete old group</span>
    <a class="code" href="classNTreeGroup.html">NTreeGroup</a> newGroup(newScope);
    newGroup.leader = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>;
    newGroup.members.insert(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.push_front(newGroup);
    <span class="keywordflow">if</span>( it != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ){
        <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> == &amp;(*it) ){
            <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = &amp;<a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.front();
        }
        <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.erase( it );
    }

    <span class="comment">// Create new ntreeNode</span>
    <a class="code" href="classNTreeNode.html">NTreeNode</a> newNode(newScope);
    newNode.parent = divideCall-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>();
    newNode.group = &amp;<a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.front();
    <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.insert(make_pair(newScope,newNode));

    <span class="comment">// Acknowledge Divide</span>
    <a class="code" href="classNTreeDivideResponse.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeDivideResponse</a>* divideResp = <span class="keyword">new</span> <a class="code" href="classNTreeDivideResponse.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeDivideResponse</a>(<span class="stringliteral">&quot;Divide ACK&quot;</span>);
    divideResp-&gt;<a class="code" href="classNTreeDivideResponse.html#a748fbcc627e551c1abefa9feb5c3b5e1">setQuadrant</a>( divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a312970e24d3686aa2879c37b3e7280b2">getQuadrant</a>() );
    divideResp-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a6e8e0ec1b0354f923c9daaf205537106">NTREEDIVIDERESPONSE_L</a>(divideResp) );
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
            <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>++;
            <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += divideResp-&gt;getByteLength();
    );
    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>( divideCall, divideResp );
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac99ce2807f3329dd7f26491f185b4f1d"></a><!-- doxytag: member="NTree::handleDivideCallTimeout" ref="ac99ce2807f3329dd7f26491f185b4f1d" args="(NTreeDivideCall *divideCall, const TransportAddress &amp;oldNode, NTreeGroupDivideContext *context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleDivideCallTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeDivideCall.html">NTreeDivideCall</a> *&#160;</td>
          <td class="paramname"><em>divideCall</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>oldNode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classNTreeGroupDivideContext.html">NTreeGroupDivideContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gets called if a divide call times out Re-send the request to a different node. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">divideCall</td><td>the original request </td></tr>
    <tr><td class="paramname">oldNode</td><td>the host the original request was send to </td></tr>
    <tr><td class="paramname">context</td><td>a context pointer to correlate answers to the group that is to be divided </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00868">868</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::set&lt;NodeHandle&gt; invalidNodes;
    invalidNodes.insert( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
    <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> dest = <a class="code" href="classNTree.html#a4812f1429860a8d280ff4b90935e6667" title="Return a random node.">getRandomNode</a>( invalidNodes );
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
            <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>++;
            <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += divideCall-&gt;getByteLength();
    );
    <a class="code" href="classNTreeGroupDivideContextPtr.html">NTreeGroupDivideContextPtr</a>* contextPtr = <span class="keyword">new</span> <a class="code" href="classNTreeGroupDivideContextPtr.html">NTreeGroupDivideContextPtr</a>;
    contextPtr-&gt;<a class="code" href="classNTreeGroupDivideContextPtr.html#ac8587c36e32ecb8198c93ac46233e399">ptr</a> = context;
    <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>( dest, divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a3cfce98fd5ad6c0e1dcfec3e3d089d32">dup</a>(), contextPtr );
}
</pre></div>
</div>
</div>
<a class="anchor" id="aca06c9a1d0f65ec2c600345d421c41ce"></a><!-- doxytag: member="NTree::handleDivideResponse" ref="aca06c9a1d0f65ec2c600345d421c41ce" args="(NTreeDivideResponse *divideResp, NTreeGroupDivideContext *context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleDivideResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeDivideResponse.html">NTreeDivideResponse</a> *&#160;</td>
          <td class="paramname"><em>divideResp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classNTreeGroupDivideContext.html">NTreeGroupDivideContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles an acknowledgement that a group was divided as requested. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">divideResp</td><td>the acknowledgement </td></tr>
    <tr><td class="paramname">context</td><td>a context pointer to correlate answers to the group that is to be divided </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00855">855</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    context-&gt;<a class="code" href="classNTreeGroupDivideContext.html#a954a02069a13d844e49d9c92c00ab61d">newChild</a>[ divideResp-&gt;<a class="code" href="classNTreeDivideResponse.html#a651bb2efb3305e36e6355ce341bb0649">getQuadrant</a>() ] = divideResp-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>();
    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
        <span class="keywordflow">if</span>( context-&gt;<a class="code" href="classNTreeGroupDivideContext.html#a954a02069a13d844e49d9c92c00ab61d">newChild</a>[i].<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>() ){
            <span class="comment">// Some responses still missing</span>
            <span class="keywordflow">return</span>;
        }
    }
    <a class="code" href="classNTree.html#a8144ddca854304bb21c31af09cbac6a8" title="Divide a group that has gotten to large into four subgroups.">divideNode</a>( context );
    <span class="keyword">delete</span> context;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab1357ccccb3b19730656d07c24057c7f"></a><!-- doxytag: member="NTree::handleJoinCall" ref="ab1357ccccb3b19730656d07c24057c7f" args="(NTreeJoinCall *joinCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleJoinCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeJoinCall.html">NTreeJoinCall</a> *&#160;</td>
          <td class="paramname"><em>joinCall</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles request to join a group. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">joinCall</td><td>the request </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00281">281</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Check if we know the group</span>
    std::list&lt;NTreeGroup&gt;::iterator grpIt = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( joinCall-&gt;<a class="code" href="classNTreeJoinCall.html#a6fc581736ec13e9c2ec053539e741948">getPosition</a>() );
    <span class="keywordflow">if</span>( grpIt != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ) {
        <span class="comment">// If we are leader, acknowlede Join</span>
        <span class="keywordflow">if</span>( grpIt-&gt;leader == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> ) {
            <span class="comment">// Inform group about new member</span>
            <a class="code" href="classNTreeGroupAddMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeGroupAddMessage</a>* grpAdd = <span class="keyword">new</span> <a class="code" href="classNTreeGroupAddMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeGroupAddMessage</a>(<span class="stringliteral">&quot;New group member&quot;</span>);
            grpAdd-&gt;<a class="code" href="classNTreeGroupAddMessage.html#a76913e1fbc6e911803122f05d2674d26">setPlayer</a>( joinCall-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>() );
            grpAdd-&gt;<a class="code" href="classNTreeGroupAddMessage.html#a8226e34d595ef1c0e90c0a99620cd919">setOrigin</a>( grpIt-&gt;scope.origin );
            grpAdd-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#af7c80d54a47233a2a89c6b7b692f3363">NTREEADD_L</a>(grpAdd) );

            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                    <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a> += grpIt-&gt;members.size();
                    <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += grpIt-&gt;members.size()*grpAdd-&gt;getByteLength();
            );
            <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">sendToGroup</a>( *grpIt, grpAdd );

            grpIt-&gt;members.insert( joinCall-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>() );
            <span class="comment">// Acknowledge Join, send information about group</span>
            <a class="code" href="classNTreeJoinResponse.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeJoinResponse</a>* joinResp = <span class="keyword">new</span> <a class="code" href="classNTreeJoinResponse.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeJoinResponse</a>(<span class="stringliteral">&quot;Join ACK&quot;</span>);
            joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#ae28beef557faa706b1dc354846f53189">setOrigin</a>( grpIt-&gt;scope.origin );
            joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#a8813b78b71c4a4c4065b368e317d2f82">setSize</a>( grpIt-&gt;scope.size );
            joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#a8daa4aae69c07060106a9e1e58a1519e">setMembersArraySize</a>( grpIt-&gt;members.size() );
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
            <span class="keywordflow">for</span>( std::set&lt;NodeHandle&gt;::iterator it = grpIt-&gt;members.begin(); it != grpIt-&gt;members.end(); ++it ) {
                joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#a0ede18f7ec17f3c3f6eddbeaa135ab4c">setMembers</a>( i, *it );
                ++i;
            }
            joinResp-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a7f658bb71823007780729523f8b4b5e5">NTREEJOINRESPONSE_L</a>(joinResp) );
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>( joinCall, joinResp );

            <span class="comment">// If group is to big, divide group</span>
            <span class="keywordflow">if</span>( grpIt-&gt;members.size() &gt; <a class="code" href="classNTree.html#a428051b8c6fd60c5f39db5fa552db8af">maxChildren</a> &amp;&amp; !grpIt-&gt;dividePending &amp;&amp; grpIt-&gt;scope.size &gt; 2*<a class="code" href="classNTree.html#a58564a7bbd7caaba33078388d34e89f1">AOIWidth</a> ){
                EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleJoinCall() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                    &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    Group got too big. Trying to divide group\n&quot;</span>;
                grpIt-&gt;dividePending = <span class="keyword">true</span>;
                std::map&lt;NTreeScope,NTreeNode&gt;::iterator nit = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.find( grpIt-&gt;scope );
                <span class="keywordflow">if</span>( nit == <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end() ){
                    EV &lt;&lt; <span class="stringliteral">&quot;    Host is leader of a group, but not NTreeNode of that group.\n&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;    This should not happen. Dropping group\n&quot;</span>;
                    <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> == &amp;(*grpIt) ){
                        <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = NULL;
                    }
                    <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.erase( grpIt );
                    <span class="keywordflow">return</span>;
                }
                EV &lt;&lt; <span class="stringliteral">&quot;    Sending divide calls\n&quot;</span>;
                <a class="code" href="classNTreeDivideCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeDivideCall</a>* divideCall = <span class="keyword">new</span> <a class="code" href="classNTreeDivideCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeDivideCall</a>(<span class="stringliteral">&quot;Divide Group&quot;</span>);
                divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#ad2ac114ae084e6585650d4df9bbaece4">setOrigin</a>( nit-&gt;second.scope.origin );
                divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a573f952fbe80a16997385ea0710d522a">setSize</a>( nit-&gt;second.scope.size );
                divideCall-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a9f8f3e06980b0a46881afcbb783482e3">NTREEDIVIDECALL_L</a>(divideCall) );

                <a class="code" href="classNTreeGroupDivideContext.html">NTreeGroupDivideContext</a>* divideContext = <span class="keyword">new</span> <a class="code" href="classNTreeGroupDivideContext.html">NTreeGroupDivideContext</a>;
                divideContext-&gt;<a class="code" href="classNTreeGroupDivideContext.html#a52f9e9bc7d7edfe42b7e74e6a420477e">nodeScope</a> = nit-&gt;second.scope;

                <span class="comment">// select 4 random members of the group to become leader of subgroup</span>
                <span class="comment">// &quot;lotto&quot; algoritm so nobody gets elected twice</span>
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numMembers = grpIt-&gt;members.<a class="code" href="classNTreeScope.html#a3988c5bd6a66a74ffb1fcc5ea91fc653">size</a>();
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numbers[numMembers];
                <span class="keywordflow">for</span>( i = 0; i &lt; numMembers; ++i ) numbers[i] = i;
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> upperbound = numMembers;
                <span class="keywordflow">for</span> (i = 0; i &lt; 4; ++i)
                {
                    upperbound--;
                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = intuniform(0, upperbound);
                    std::set&lt;NodeHandle&gt;::iterator newChild = grpIt-&gt;members.begin();
                    std::advance( newChild, numbers[index] );

                    <span class="keywordflow">if</span>( *newChild == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> ) { <span class="comment">// don&#39;t select myself</span>
                        --i;
                    } <span class="keywordflow">else</span> {
                        <a class="code" href="classNTreeDivideCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeDivideCall</a>* msg = divideCall-&gt;<a class="code" href="classNTreeDivideCall.html#a3cfce98fd5ad6c0e1dcfec3e3d089d32">dup</a>();
                        msg-&gt;<a class="code" href="classNTreeDivideCall.html#a27000251e8867c7d57a0eb72ba006e32">setQuadrant</a>( i );
                        EV &lt;&lt; <span class="stringliteral">&quot;    ==&gt; &quot;</span> &lt;&lt; (<a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>) *newChild &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
                        <a class="code" href="classNTreeGroupDivideContextPtr.html">NTreeGroupDivideContextPtr</a>* contextPtr = <span class="keyword">new</span> <a class="code" href="classNTreeGroupDivideContextPtr.html">NTreeGroupDivideContextPtr</a>;
                        contextPtr-&gt;<a class="code" href="classNTreeGroupDivideContextPtr.html#ac8587c36e32ecb8198c93ac46233e399">ptr</a> = divideContext;
                        <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>( *newChild, msg, contextPtr);
                        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                                <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>++;
                                <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += msg-&gt;getByteLength();
                        );
                    }

                    swap(numbers[index], numbers[upperbound]);
                }
                <span class="keyword">delete</span> divideCall;
            }

        } <span class="keywordflow">else</span> {
            <span class="comment">// forward join to leader</span>
            <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>( grpIt-&gt;leader, joinCall );
        }
        <span class="keywordflow">return</span>;
    }
    <span class="comment">// We don&#39;t know the group, forward join via the NTree</span>
    <a class="code" href="classNTree.html#abd8783c5f0fcc92cc600e8d34481f4aa" title="Route a message through the N-Tree to the closest know node to the given position.">routeViaNTree</a>( joinCall-&gt;<a class="code" href="classNTreeJoinCall.html#a6fc581736ec13e9c2ec053539e741948">getPosition</a>(), joinCall, true );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3a34f900e9368b2fed5f579a6977edca"></a><!-- doxytag: member="NTree::handleJoinCallTimeout" ref="a3a34f900e9368b2fed5f579a6977edca" args="(NTreeJoinCall *joinCall, const TransportAddress &amp;oldNode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleJoinCallTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeJoinCall.html">NTreeJoinCall</a> *&#160;</td>
          <td class="paramname"><em>joinCall</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>oldNode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Gets called if a join call times out Well try to re-join if needed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">joinCall</td><td>the original call </td></tr>
    <tr><td class="paramname">oldNode</td><td>the host the original call was send to </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00436">436</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a> ){
        EV &lt;&lt; <span class="stringliteral">&quot;    Overlay not ready. Trying to re-join overlay\n&quot;</span>;
        <a class="code" href="classNTree.html#a6a09bf192a3c340e9d8f43c90d0b3169" title="Change the internal state of the protocol.">changeState</a>( <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a> );
    }
    <a class="code" href="classNTree.html#ac93cb62c57a09fda499e80996d2328a0">joinTimeout</a>++;
    <span class="comment">// TODO: Other cases when re-try is useful?</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a440cba3647cd293e27bb75748beaed24"></a><!-- doxytag: member="NTree::handleJoinResponse" ref="a440cba3647cd293e27bb75748beaed24" args="(NTreeJoinResponse *joinResp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleJoinResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeJoinResponse.html">NTreeJoinResponse</a> *&#160;</td>
          <td class="paramname"><em>joinResp</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles the acknowledgement to join a group. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">joinResp</td><td>the acknowledgement (also holds information about the group) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00382">382</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleJoinResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    JOIN ACK for group &quot;</span> &lt;&lt; joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#a0c744719ab8b981b8aa2e7f847b3ae19">getOrigin</a>()
        &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#ae9ff2ee3eefce8a94b2a8cee5a15eac1">getSize</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    std::list&lt;NTreeGroup&gt;::iterator git = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#a0c744719ab8b981b8aa2e7f847b3ae19">getOrigin</a>(), joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#ae9ff2ee3eefce8a94b2a8cee5a15eac1">getSize</a>() );
    <span class="comment">// Check for conflicting groups</span>
    <a class="code" href="classNTreeScope.html">NTreeScope</a> groupScope( joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#a0c744719ab8b981b8aa2e7f847b3ae19">getOrigin</a>(), joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#ae9ff2ee3eefce8a94b2a8cee5a15eac1">getSize</a>() );
    <span class="keywordflow">for</span>( std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.begin(); it != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end(); ++it ){
        <span class="keywordflow">if</span>( it != git &amp;&amp; (it-&gt;isInScope( groupScope.origin ) || groupScope.contains( it-&gt;scope.origin ) )){
            <span class="comment">// Oops, conflicting group found. joinResp is probably outdated</span>
            EV &lt;&lt; <span class="stringliteral">&quot;    Conflicting group found. Ignoring JOIN ACK\n&quot;</span>;

            <span class="comment">// if our login resulted in a divide, and we got the divide earlier that the ack,</span>
            <span class="comment">// we missed to update our state. fixing.</span>
            <span class="keywordflow">if</span>( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a> ){
                <a class="code" href="classNTree.html#a6a09bf192a3c340e9d8f43c90d0b3169" title="Change the internal state of the protocol.">changeState</a>( <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a> );
            }
            <span class="keywordflow">return</span>;
        }
    }

    <span class="comment">// if group already known, clear member list (new member list will be taken from message)</span>
    <span class="keywordflow">if</span>( git != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ){
        <span class="keywordflow">if</span>( git-&gt;leader != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> ) {
            EV &lt;&lt; <span class="stringliteral">&quot;    Group already known. Refreshing member list\n&quot;</span>;
            git-&gt;members.clear();
        } <span class="keywordflow">else</span> {
            <span class="comment">// We are leader of the already known group. Something&#39;s fishy, ignore join</span>
            EV &lt;&lt; <span class="stringliteral">&quot;    Group already known; and I&#39;m leader of that group. Ignoring ACK\n&quot;</span>;
            <span class="keywordflow">return</span>;
        }

    } <span class="keywordflow">else</span> {
        <span class="comment">// Else create new group</span>
        <a class="code" href="classNTreeGroup.html">NTreeGroup</a> grp(joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#a0c744719ab8b981b8aa2e7f847b3ae19">getOrigin</a>(), joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#ae9ff2ee3eefce8a94b2a8cee5a15eac1">getSize</a>());
        <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.push_front(grp);
        git = <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.begin();
    }

    <span class="comment">// Fill in member list and leader of the group from message</span>
    git-&gt;leader = joinResp-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>();
    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#a6b8a2f0c3311cad4d30ab70e39c816e3">getMembersArraySize</a>(); ++i ){
        git-&gt;members.insert( joinResp-&gt;<a class="code" href="classNTreeJoinResponse.html#a83090f0a8aee9cf3e373543d1c69c60a">getMembers</a>(i) );
    }

    <span class="comment">// If we were still joining the overlay, we are now ready to go</span>
    <span class="keywordflow">if</span>( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> != <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a> ){
        <a class="code" href="classNTree.html#a6a09bf192a3c340e9d8f43c90d0b3169" title="Change the internal state of the protocol.">changeState</a>( <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a> );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aee2ae5399ed3496cc337e0775c447148"></a><!-- doxytag: member="NTree::handleLeaveMessage" ref="aee2ae5399ed3496cc337e0775c447148" args="(NTreeLeaveMessage *leaveMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleLeaveMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeLeaveMessage.html">NTreeLeaveMessage</a> *&#160;</td>
          <td class="paramname"><em>leaveMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles an information message that somebody left a group we are a member of. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">leaveMsg</td><td>the information message </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00557">557</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( leaveMsg-&gt;<a class="code" href="classNTreeLeaveMessage.html#a04c832413797fcf98427777d541e3174">getPosition</a>() );
    <span class="keywordflow">if</span>( it != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ){
        it-&gt;members.erase( leaveMsg-&gt;<a class="code" href="classNTreeLeaveMessage.html#ada634c8c3471d02e084de71349186759">getPlayer</a>() );
    }

    <span class="comment">// If player not otherwise known</span>
    <span class="keywordflow">for</span>( it = <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.begin(); it != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end(); ++it ){
        <span class="keywordflow">if</span>( it-&gt;members.find( leaveMsg-&gt;<a class="code" href="classNTreeLeaveMessage.html#ada634c8c3471d02e084de71349186759">getPlayer</a>() ) != it-&gt;members.end() ){
            <span class="keywordflow">return</span>;
        }
    }

    <span class="comment">// Inform app</span>
    <a class="code" href="classGameAPIListMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">GameAPIListMessage</a>* gameMsg = <span class="keyword">new</span> <a class="code" href="classGameAPIListMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">GameAPIListMessage</a>(<span class="stringliteral">&quot;NEIGHBOR_DELETE&quot;</span>);
    gameMsg-&gt;<a class="code" href="classGameAPIMessage.html#a3fe3071c66623191477b903527280ddc">setCommand</a>(<a class="code" href="CommonMessages__m_8h.html#ac76e82bc37e4b2b364247c7cff8f7b6ba360dbdf5c7f61a4d26263e2a010057d7">NEIGHBOR_UPDATE</a>);
    gameMsg-&gt;<a class="code" href="classGameAPIListMessage.html#a6cc71a3065a72e5636753f4e0904ad38">setRemoveNeighborArraySize</a>(1);
    gameMsg-&gt;<a class="code" href="classGameAPIListMessage.html#a8b48a0c0f6661b7adf07221130be2685">setRemoveNeighbor</a>(0, leaveMsg-&gt;<a class="code" href="classNTreeLeaveMessage.html#ada634c8c3471d02e084de71349186759">getPlayer</a>() );
    send(gameMsg, <span class="stringliteral">&quot;appOut&quot;</span>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a328fb159dd4e5986df6797967a7e01b4"></a><!-- doxytag: member="NTree::handleMove" ref="a328fb159dd4e5986df6797967a7e01b4" args="(GameAPIPositionMessage *posMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleMove </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classGameAPIPositionMessage.html">GameAPIPositionMessage</a> *&#160;</td>
          <td class="paramname"><em>posMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a move message from the application. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">posMsg</td><td>the move message </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00446">446</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> = posMsg-&gt;<a class="code" href="classGameAPIPositionMessage.html#a62cb5e229193a2e0118e240de2494d53">getPosition</a>();
    <a class="code" href="classNTreeMoveMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeMoveMessage</a>* moveMsg = <span class="keyword">new</span> <a class="code" href="classNTreeMoveMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeMoveMessage</a>(<span class="stringliteral">&quot;MOVE&quot;</span>);
    moveMsg-&gt;<a class="code" href="classNTreeMoveMessage.html#a7079ac3b1429cce4912896a55153de39">setPlayer</a>( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
    moveMsg-&gt;<a class="code" href="classNTreeMoveMessage.html#a7663e4628350b8cc8d3a165903350c93">setPosition</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> );
    moveMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a1eefe5aa69aded13f3640d5ca69ab154">NTREEMOVE_L</a>(moveMsg) );

    <span class="comment">// Send to old group</span>
    <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> ){
        <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">sendToGroup</a>( *<a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a>, moveMsg, <span class="keyword">true</span>);
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                <a class="code" href="classNTree.html#a5c50f4d4ce98b68b32f0a4de8ec88443">movesSend</a> += <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a>-&gt;<a class="code" href="classNTreeGroup.html#a8504cdb0167bd77af831a55f0a6c6fe9">members</a>.size();
                <a class="code" href="classNTree.html#ac4b0f8e2026da537e51672847a9ab590">moveBytes</a> += moveMsg-&gt;getByteLength() * <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a>-&gt;<a class="code" href="classNTreeGroup.html#a8504cdb0167bd77af831a55f0a6c6fe9">members</a>.size();
                <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>( <span class="stringliteral">&quot;NTree: Area size&quot;</span>, <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a>-&gt;<a class="code" href="classNTreeGroup.html#a874afab14b9e4704bd3022565264e2e8">scope</a>.<a class="code" href="classNTreeScope.html#a3988c5bd6a66a74ffb1fcc5ea91fc653">size</a> );
        );
    }

    <span class="comment">// Find group for new position</span>
    <span class="keywordflow">if</span>( !<a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> || !<a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a>-&gt;<a class="code" href="classNTreeGroup.html#a06b81ada0700bc8faca287da1bd437ec">isInScope</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> ) ){
        std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> );
        <span class="keywordflow">if</span>( it != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ) {
            <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">sendToGroup</a>( *it, moveMsg, <span class="keyword">true</span> );
            <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = &amp;(*it);
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                    <a class="code" href="classNTree.html#a5c50f4d4ce98b68b32f0a4de8ec88443">movesSend</a> += <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a>-&gt;<a class="code" href="classNTreeGroup.html#a8504cdb0167bd77af831a55f0a6c6fe9">members</a>.size();
                    <a class="code" href="classNTree.html#ac4b0f8e2026da537e51672847a9ab590">moveBytes</a> += moveMsg-&gt;getByteLength() * <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a>-&gt;<a class="code" href="classNTreeGroup.html#a8504cdb0167bd77af831a55f0a6c6fe9">members</a>.size();
            );
        } <span class="keywordflow">else</span> {
            EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleMove() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;WARNING: no group for new position. Some updates may get lost!\n&quot;</span>;
            <a class="code" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b" title="Joins the group that is responsible for a given position.">joinGroup</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> );
        }
    }

    <span class="keyword">delete</span> moveMsg;

    <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> ){
        <span class="comment">// Join new groups in our AoI and leave groups outside the AoI</span>
        <a class="code" href="classNTreeScope.html">NTreeScope</a>&amp; scope = <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a>-&gt;<a class="code" href="classNTreeGroup.html#a874afab14b9e4704bd3022565264e2e8">scope</a>;
        <a class="code" href="classNTreeScope.html">NTreeScope</a> area(<a class="code" href="classVector2D.html">Vector2D</a>(<a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>/2.0,<a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>/2.0),<a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a>);
        <a class="code" href="classVector2D.html">Vector2D</a> aoiRight(<a class="code" href="classNTree.html#a58564a7bbd7caaba33078388d34e89f1">AOIWidth</a>/2.0, 0);
        <a class="code" href="classVector2D.html">Vector2D</a> aoiTop(0, <a class="code" href="classNTree.html#a58564a7bbd7caaba33078388d34e89f1">AOIWidth</a>/2.0);

        <a class="code" href="classVector2D.html">Vector2D</a> groupRight(scope.<a class="code" href="classNTreeScope.html#a3988c5bd6a66a74ffb1fcc5ea91fc653">size</a>/2.0 +1, 0);
        <a class="code" href="classVector2D.html">Vector2D</a> groupTop(0, scope.<a class="code" href="classNTreeScope.html#a3988c5bd6a66a74ffb1fcc5ea91fc653">size</a>/2.0 +1);

        <span class="keywordflow">if</span>(area.contains( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + aoiRight )) <a class="code" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b" title="Joins the group that is responsible for a given position.">joinGroup</a>(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + aoiRight);
        <span class="keywordflow">if</span>(area.contains( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - aoiRight )) <a class="code" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b" title="Joins the group that is responsible for a given position.">joinGroup</a>(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - aoiRight);
        <span class="keywordflow">if</span>(area.contains( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + aoiTop )) <a class="code" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b" title="Joins the group that is responsible for a given position.">joinGroup</a>(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + aoiTop);
        <span class="keywordflow">if</span>(area.contains( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - aoiTop )) <a class="code" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b" title="Joins the group that is responsible for a given position.">joinGroup</a>(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - aoiTop);
        <span class="keywordflow">if</span>(area.contains( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + (aoiRight + aoiTop)/sqrt(2))) <a class="code" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b" title="Joins the group that is responsible for a given position.">joinGroup</a>(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + (aoiRight + aoiTop)/sqrt(2));
        <span class="keywordflow">if</span>(area.contains( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + (aoiRight - aoiTop)/sqrt(2))) <a class="code" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b" title="Joins the group that is responsible for a given position.">joinGroup</a>(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + (aoiRight - aoiTop)/sqrt(2));
        <span class="keywordflow">if</span>(area.contains( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - (aoiRight + aoiTop)/sqrt(2))) <a class="code" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b" title="Joins the group that is responsible for a given position.">joinGroup</a>(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - (aoiRight + aoiTop)/sqrt(2));
        <span class="keywordflow">if</span>(area.contains( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - (aoiRight - aoiTop)/sqrt(2))) <a class="code" href="classNTree.html#ab4b84494578c721a26da4bbb5eefde6b" title="Joins the group that is responsible for a given position.">joinGroup</a>(<a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - (aoiRight - aoiTop)/sqrt(2));

        <span class="keywordflow">if</span>( scope.<a class="code" href="classNTreeScope.html#aac57ba40a168b06623a63c0e20c7c56d">contains</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + aoiRight )) <a class="code" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8" title="Leaves a group for a given position.">leaveGroup</a>( scope.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> + groupRight );
        <span class="keywordflow">if</span>( scope.<a class="code" href="classNTreeScope.html#aac57ba40a168b06623a63c0e20c7c56d">contains</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - aoiRight )) <a class="code" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8" title="Leaves a group for a given position.">leaveGroup</a>( scope.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> - groupRight );
        <span class="keywordflow">if</span>( scope.<a class="code" href="classNTreeScope.html#aac57ba40a168b06623a63c0e20c7c56d">contains</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + aoiTop )) <a class="code" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8" title="Leaves a group for a given position.">leaveGroup</a>( scope.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> + groupTop );
        <span class="keywordflow">if</span>( scope.<a class="code" href="classNTreeScope.html#aac57ba40a168b06623a63c0e20c7c56d">contains</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - aoiTop )) <a class="code" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8" title="Leaves a group for a given position.">leaveGroup</a>( scope.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> - groupTop );
        <span class="keywordflow">if</span>( scope.<a class="code" href="classNTreeScope.html#aac57ba40a168b06623a63c0e20c7c56d">contains</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + (aoiRight + aoiTop)/sqrt(2))) <a class="code" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8" title="Leaves a group for a given position.">leaveGroup</a>( scope.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> + groupRight + groupTop);
        <span class="keywordflow">if</span>( scope.<a class="code" href="classNTreeScope.html#aac57ba40a168b06623a63c0e20c7c56d">contains</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> + (aoiRight - aoiTop)/sqrt(2))) <a class="code" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8" title="Leaves a group for a given position.">leaveGroup</a>( scope.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> + groupRight - groupTop);
        <span class="keywordflow">if</span>( scope.<a class="code" href="classNTreeScope.html#aac57ba40a168b06623a63c0e20c7c56d">contains</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - (aoiRight + aoiTop)/sqrt(2))) <a class="code" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8" title="Leaves a group for a given position.">leaveGroup</a>( scope.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> - groupRight + groupTop);
        <span class="keywordflow">if</span>( scope.<a class="code" href="classNTreeScope.html#aac57ba40a168b06623a63c0e20c7c56d">contains</a>( <a class="code" href="classNTree.html#af054361942e02791f76643b3886a1c6a">position</a> - (aoiRight - aoiTop)/sqrt(2))) <a class="code" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8" title="Leaves a group for a given position.">leaveGroup</a>( scope.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> - groupRight - groupTop);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad6e4730c994e5a50d6e4ee3000ede68c"></a><!-- doxytag: member="NTree::handleMoveMessage" ref="ad6e4730c994e5a50d6e4ee3000ede68c" args="(NTreeMoveMessage *moveMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleMoveMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeMoveMessage.html">NTreeMoveMessage</a> *&#160;</td>
          <td class="paramname"><em>moveMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a move message from the network. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">moveMsg</td><td>the move message </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00627">627</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Inform app</span>
    <a class="code" href="classGameAPIListMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">GameAPIListMessage</a>* gameMsg = <span class="keyword">new</span> <a class="code" href="classGameAPIListMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">GameAPIListMessage</a>(<span class="stringliteral">&quot;NEIGHBOR_UPDATE&quot;</span>);
    gameMsg-&gt;<a class="code" href="classGameAPIMessage.html#a3fe3071c66623191477b903527280ddc">setCommand</a>(<a class="code" href="CommonMessages__m_8h.html#ac76e82bc37e4b2b364247c7cff8f7b6ba360dbdf5c7f61a4d26263e2a010057d7">NEIGHBOR_UPDATE</a>);

    gameMsg-&gt;<a class="code" href="classGameAPIListMessage.html#a6bac1604abbdf9c0ec959343b7b64834">setAddNeighborArraySize</a>(1);
    gameMsg-&gt;<a class="code" href="classGameAPIListMessage.html#a81292ede7c0903f5982efcc7625024f1">setNeighborPositionArraySize</a>(1);

    gameMsg-&gt;<a class="code" href="classGameAPIListMessage.html#a6fdd2736b4eaabac3e90a623f0e8e130">setAddNeighbor</a>(0, moveMsg-&gt;<a class="code" href="classNTreeMoveMessage.html#abd403ee717bfe57668daa9a997b3b585">getPlayer</a>() );
    gameMsg-&gt;<a class="code" href="classGameAPIListMessage.html#ad91052c0577545e987bf5b08244ece9e">setNeighborPosition</a>(0, moveMsg-&gt;<a class="code" href="classNTreeMoveMessage.html#a9ac7dc6a3a765bd4d6503fee68c3a957">getPosition</a>() );
    send(gameMsg, <span class="stringliteral">&quot;appOut&quot;</span>);
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
            <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(
                <span class="stringliteral">&quot;NTree: MoveDelay&quot;</span>,
                SIMTIME_DBL(simTime()) - SIMTIME_DBL(moveMsg-&gt;getCreationTime())
                );
            );
}
</pre></div>
</div>
</div>
<a class="anchor" id="abb9c7820c6ca91e38cc686cb3aa51e58"></a><!-- doxytag: member="NTree::handleNodeGracefulLeaveNotification" ref="abb9c7820c6ca91e38cc686cb3aa51e58" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleNodeGracefulLeaveNotification </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method gets call **.gracefulLeaveDelay seconds before it is killed if this node is among the gracefulLeaveProbability nodes. </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#aa2d70984acd164839ca92694a02e7a91">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00980">980</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span>(std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.begin(); it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end(); ++it ){
        <span class="comment">// Replace me on all nodes</span>
        <a class="code" href="classNTreeReplaceNodeMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeReplaceNodeMessage</a>* replaceMsg = <span class="keyword">new</span> <a class="code" href="classNTreeReplaceNodeMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeReplaceNodeMessage</a>(<span class="stringliteral">&quot;Replace me&quot;</span>);
        replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#af977d45900282ba491453bdd774aaed9">setOrigin</a>( it-&gt;second.scope.origin );
        replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#aa0c5ac6818f77708e35c75747eca10e3">setSize</a>( it-&gt;second.scope.size );
        replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a76755e23859f97952a88d3f8969f1577">setParent</a>( it-&gt;second.parent );
        <span class="keywordflow">if</span>( it-&gt;second.group ){
            replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a33b5baf77becd981daf1237947eff504">setIsLeaf</a>( <span class="keyword">true</span> );
            replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#aafad2da57f24946d4909e4c0ac1cb272">setChildrenArraySize</a>( it-&gt;second.group-&gt;members.size() );
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
            <span class="keywordflow">for</span>( std::set&lt;NodeHandle&gt;::iterator mit = it-&gt;second.group-&gt;members.begin(); mit != it-&gt;second.group-&gt;members.end(); ++mit ){
                replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a92a12934f4e35d4be42f687acbaf6ad9">setChildren</a>(i, *mit );
                ++i;
            }
        } <span class="keywordflow">else</span> {
            replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a33b5baf77becd981daf1237947eff504">setIsLeaf</a>( <span class="keyword">false</span> );
            replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#aafad2da57f24946d4909e4c0ac1cb272">setChildrenArraySize</a>( 4 );
            <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a92a12934f4e35d4be42f687acbaf6ad9">setChildren</a>(i, it-&gt;second.children[i] );
            }
        }
        replaceMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a8a6a66791389fce3829c25b21bb7f3ab">NTREEREPLACE_L</a>(replaceMsg) );

        <span class="comment">// Search random node to replace me</span>
        std::set&lt;NodeHandle&gt; invalidNodes;
        invalidNodes.insert( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
        <span class="keywordflow">if</span>( !it-&gt;second.parent.isUnspecified() ){
            invalidNodes.insert( it-&gt;second.parent );
        }
        <span class="keywordflow">if</span>( !it-&gt;second.group ) {
            <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                invalidNodes.insert( it-&gt;second.children[i] );
            }
        }
        <span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp; dest = <a class="code" href="classNTree.html#a4812f1429860a8d280ff4b90935e6667" title="Return a random node.">getRandomNode</a>( invalidNodes );

        <span class="comment">// Inform node of his new responsabilities</span>
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>++;
                <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += replaceMsg-&gt;getByteLength();
        );
        <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>( dest, replaceMsg );
    }
    <span class="keywordflow">while</span>( <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.size() ){
        <span class="comment">// Leave all groups</span>
        <a class="code" href="classNTree.html#ad436b21004c209ceb44915dbacbcd8a8" title="Leaves a group for a given position.">leaveGroup</a>( <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.begin()-&gt;scope.origin, true );
    }
    <span class="comment">// clear ntree</span>
    <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.clear();

    <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = NULL;
    <a class="code" href="classNTree.html#a6a09bf192a3c340e9d8f43c90d0b3169" title="Change the internal state of the protocol.">changeState</a>( <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faad4c4f4f3bddd311d8c11b20c1c6d00f">SHUTDOWN</a> );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1e4512d83b5aa11f2772ba2803594d5d"></a><!-- doxytag: member="NTree::handlePingCall" ref="a1e4512d83b5aa11f2772ba2803594d5d" args="(NTreePingCall *pingCall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handlePingCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreePingCall.html">NTreePingCall</a> *&#160;</td>
          <td class="paramname"><em>pingCall</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a ping If the ping was send to a node in the n-tree, it is answered with information about the satte of that n-tree node (children, aggregated size) </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pingCall</td><td>the ping request </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00647">647</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classNTreeNodePingCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeNodePingCall</a>* nodePing = dynamic_cast&lt;NTreeNodePingCall*&gt;(pingCall) ){
        <span class="comment">// node Ping</span>
        <span class="comment">// compute my scope</span>
        <a class="code" href="classNTreeScope.html">NTreeScope</a> origScope( pingCall-&gt;<a class="code" href="classNTreePingCall.html#adb4e2eddcf36b68636bd48ac6219a7d5">getOrigin</a>(), pingCall-&gt;<a class="code" href="classNTreePingCall.html#aed2ed9b76abdd52062d5b81ae556acb8">getSize</a>() );
        <a class="code" href="classNTreeScope.html">NTreeScope</a> myScope;
        myScope = origScope.<a class="code" href="classNTreeScope.html#aecb6a6e39493200fb0557bd5e26cc22b">getSubScope</a>( nodePing-&gt;getQuadrant() );

        std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.find( myScope );
        <span class="keywordflow">if</span>( it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end() ){
            <span class="comment">// TODO: save parentParent?</span>

            <span class="keywordflow">if</span>( nodePing-&gt;getParent().isUnspecified() ) it-&gt;second.parentIsRoot = <span class="keyword">true</span>;
            <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                it-&gt;second.siblings[i] = nodePing-&gt;getSiblings(i);
            }
            it-&gt;second.lastPing = simTime();

            <span class="comment">// Answer ping</span>
            <a class="code" href="classNTreeNodePingResponse.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeNodePingResponse</a>* nodeResp = <span class="keyword">new</span> <a class="code" href="classNTreeNodePingResponse.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeNodePingResponse</a>(<span class="stringliteral">&quot;PONG&quot;</span>);
            <span class="keywordflow">if</span>( it-&gt;second.group ){
                <span class="comment">// leaf</span>
                nodeResp-&gt;<a class="code" href="classNTreeNodePingResponse.html#a9fa9f5edc29141c919066de892ce95be">setAggChildCount</a>( it-&gt;second.group-&gt;members.size() );
                nodeResp-&gt;<a class="code" href="classNTreeNodePingResponse.html#abcde803c907c803230509142da29036e">setMembersArraySize</a>( it-&gt;second.group-&gt;members.size() );
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
                <span class="keywordflow">for</span>( std::set&lt;NodeHandle&gt;::iterator childIt = it-&gt;second.group-&gt;members.begin();
                        childIt != it-&gt;second.group-&gt;members.end(); ++childIt ){

                    nodeResp-&gt;<a class="code" href="classNTreeNodePingResponse.html#a5421f8da94292b63100331d6f2ad81c4">setMembers</a>( i++, *childIt );
                }
            } <span class="keywordflow">else</span> {
                <span class="comment">// ordinary node</span>
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> aggChildCount = 0;
                nodeResp-&gt;<a class="code" href="classNTreeNodePingResponse.html#abcde803c907c803230509142da29036e">setMembersArraySize</a>( 4 );
                <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                    aggChildCount += it-&gt;second.aggChildCount[i];
                    nodeResp-&gt;<a class="code" href="classNTreeNodePingResponse.html#a5421f8da94292b63100331d6f2ad81c4">setMembers</a>( i, it-&gt;second.children[i] );
                }
                nodeResp-&gt;<a class="code" href="classNTreeNodePingResponse.html#a9fa9f5edc29141c919066de892ce95be">setAggChildCount</a>( aggChildCount );
            }
            nodeResp-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#af7e1044ad69b4f9420a3e9e579b1753c">NTREENODEPINGRESPONSE_L</a>(nodeResp) );
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>( nodePing, nodeResp );
        } <span class="keywordflow">else</span> {
            <span class="keyword">delete</span> pingCall;
        }
    } <span class="keywordflow">else</span> {
        <span class="comment">// Group ping</span>
        std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( pingCall-&gt;<a class="code" href="classNTreePingCall.html#adb4e2eddcf36b68636bd48ac6219a7d5">getOrigin</a>(), pingCall-&gt;<a class="code" href="classNTreePingCall.html#aed2ed9b76abdd52062d5b81ae556acb8">getSize</a>() );
        <span class="keywordflow">if</span>( it != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ){
            <span class="comment">// TODO: save parentParent</span>

        }
        <span class="comment">// Answer ping</span>
        <a class="code" href="classNTreePingResponse.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreePingResponse</a>* pingResp = <span class="keyword">new</span> <a class="code" href="classNTreePingResponse.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreePingResponse</a>(<span class="stringliteral">&quot;PONG&quot;</span>);
        pingResp-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a92af2f21f40c63100bfc85b1fb3cd3b8">NTREEPINGRESPONSE_L</a>(pingResp) );
        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>( pingCall, pingResp );
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="a81a94103e0a86b5eca7e9e22f5c7a0ba"></a><!-- doxytag: member="NTree::handlePingCallTimeout" ref="a81a94103e0a86b5eca7e9e22f5c7a0ba" args="(NTreePingCall *pingCall, const TransportAddress &amp;oldNode, NTreePingContext *context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handlePingCallTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreePingCall.html">NTreePingCall</a> *&#160;</td>
          <td class="paramname"><em>pingCall</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>oldNode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classNTreePingContext.html">NTreePingContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a ping timeout Inform others about the failed node, replace it if needed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pingCall</td><td>the original ping call </td></tr>
    <tr><td class="paramname">oldNode</td><td>the (failed) host the ping was send to </td></tr>
    <tr><td class="paramname">context</td><td>a context which allows to correlate the response to a gertain node in the n-tree </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00743">743</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( context ){
        std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.find( context-&gt;<a class="code" href="classNTreePingContext.html#aef2916d4be2f8f87ec3ce48acacb8b4d">nodeScope</a> );
        <span class="keywordflow">if</span>( it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end() &amp;&amp; !it-&gt;second.group){
            <span class="comment">// If child found, replace it</span>
            <span class="keywordflow">if</span>( oldNode == it-&gt;second.children[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a> ]){
                <a class="code" href="classNTreeReplaceNodeMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeReplaceNodeMessage</a>* replaceMsg = <span class="keyword">new</span> <a class="code" href="classNTreeReplaceNodeMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeReplaceNodeMessage</a>(<span class="stringliteral">&quot;Replace failed node&quot;</span>);
                replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#af977d45900282ba491453bdd774aaed9">setOrigin</a>( context-&gt;<a class="code" href="classNTreePingContext.html#aef2916d4be2f8f87ec3ce48acacb8b4d">nodeScope</a>.<a class="code" href="classNTreeScope.html#aecb6a6e39493200fb0557bd5e26cc22b">getSubScope</a>(context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>).<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> );
                replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#aa0c5ac6818f77708e35c75747eca10e3">setSize</a>( context-&gt;<a class="code" href="classNTreePingContext.html#aef2916d4be2f8f87ec3ce48acacb8b4d">nodeScope</a>.<a class="code" href="classNTreeScope.html#aecb6a6e39493200fb0557bd5e26cc22b">getSubScope</a>(context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>).<a class="code" href="classNTreeScope.html#a3988c5bd6a66a74ffb1fcc5ea91fc653">size</a> );
                replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a76755e23859f97952a88d3f8969f1577">setParent</a>( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
                replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a9a3665f3aaa005dec901a23baf176e21">setOldNode</a>( oldNode );
                replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a33b5baf77becd981daf1237947eff504">setIsLeaf</a>( it-&gt;second.childChildren[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>].size() != 4 ||
                        (it-&gt;second.childChildren[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>].size() == it-&gt;second.aggChildCount[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>]) );
                replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#aafad2da57f24946d4909e4c0ac1cb272">setChildrenArraySize</a>( it-&gt;second.childChildren[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>].size() );
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
                <span class="keywordflow">for</span>( std::set&lt;NodeHandle&gt;::iterator cit = it-&gt;second.childChildren[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>].begin();
                        cit != it-&gt;second.childChildren[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>].end(); ++cit ){
                    replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a92a12934f4e35d4be42f687acbaf6ad9">setChildren</a>( i, *cit );
                    ++i;
                }
                replaceMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a8a6a66791389fce3829c25b21bb7f3ab">NTREEREPLACE_L</a>(replaceMsg) );

                <span class="comment">// Find node to replace failed node</span>
                std::set&lt;NodeHandle&gt; invalidNodes;
                invalidNodes.insert( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
                <span class="keywordflow">if</span>( !it-&gt;second.parent.isUnspecified() ){
                    invalidNodes.insert( it-&gt;second.parent );
                }
                <span class="keywordflow">if</span>( !replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#acf64a04a001904eb5a8893b70dc3cfe6">getIsLeaf</a>() ) {
                    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                        invalidNodes.insert( replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#abd0787cc60bf364e75fd974fa2f781d6">getChildren</a>(i) );
                    }
                }
                <span class="keyword">const</span> <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a>&amp; dest = <a class="code" href="classNTree.html#a4812f1429860a8d280ff4b90935e6667" title="Return a random node.">getRandomNode</a>( invalidNodes );
                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                        <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>++;
                        <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += replaceMsg-&gt;getByteLength();
                );
                <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>(dest, replaceMsg );
            }
        }
        <span class="keyword">delete</span> context;
    } <span class="keywordflow">else</span> {
        <span class="comment">// Group ping. Simple delete node from all groups</span>
        <span class="keywordflow">for</span>( std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.begin(); it != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end(); ++it ){
            <span class="comment">// we have to search the group members manually, as we only have a TransportAddress to compare</span>
            <span class="keywordflow">for</span>( std::set&lt;NodeHandle&gt;::iterator mit = it-&gt;members.begin(); mit != it-&gt;members.end(); ++mit ){
                <span class="keywordflow">if</span>( oldNode == *mit ){
                    <a class="code" href="classNTreeLeaveMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeLeaveMessage</a>* leaveMsg = <span class="keyword">new</span> <a class="code" href="classNTreeLeaveMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeLeaveMessage</a>(<span class="stringliteral">&quot;Failed member&quot;</span>);
                    leaveMsg-&gt;<a class="code" href="classNTreeLeaveMessage.html#a68adc3af805f4b63db776d2df7535505">setPlayer</a>( *mit );
                    leaveMsg-&gt;<a class="code" href="classNTreeLeaveMessage.html#a487bef67ad686c58a013eb1f77e13703">setPosition</a>( it-&gt;scope.origin );
                    leaveMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#af39a49959213a6c7812e8c69a95c1ae3">NTREELEAVE_L</a>(leaveMsg) );
                    <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">sendToGroup</a>( *it, leaveMsg );

                    it-&gt;members.erase( mit );
                    <span class="keywordflow">break</span>;
                }
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a926f95b00396cea01351a56291b23fef"></a><!-- doxytag: member="NTree::handlePingResponse" ref="a926f95b00396cea01351a56291b23fef" args="(NTreePingResponse *pingResp, NTreePingContext *context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handlePingResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreePingResponse.html">NTreePingResponse</a> *&#160;</td>
          <td class="paramname"><em>pingResp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classNTreePingContext.html">NTreePingContext</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a ping response. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pingResp</td><td>the ping response </td></tr>
    <tr><td class="paramname">context</td><td>a context which allows to correlate the response to a gertain node in the n-tree </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00708">708</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classNTreeNodePingResponse.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeNodePingResponse</a>* nodePing = dynamic_cast&lt;NTreeNodePingResponse*&gt;(pingResp) ){
        std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.find( context-&gt;<a class="code" href="classNTreePingContext.html#aef2916d4be2f8f87ec3ce48acacb8b4d">nodeScope</a> );
        <span class="keywordflow">if</span>( it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end() &amp;&amp; !it-&gt;second.group){
            <span class="comment">// If child found, update children info in node</span>
            <span class="keywordflow">if</span>( it-&gt;second.children[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>] == nodePing-&gt;getSrcNode() ){
                it-&gt;second.aggChildCount[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>] = nodePing-&gt;getAggChildCount();
                it-&gt;second.childChildren[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>].clear();
                <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ii = 0; ii &lt; nodePing-&gt;getMembersArraySize(); ++ii ){
                    it-&gt;second.childChildren[context-&gt;<a class="code" href="classNTreePingContext.html#aeec1d353fa3367f8574ac38caf1180d9">quadrant</a>].insert( nodePing-&gt;getMembers( ii ) );
                }

                <span class="comment">// Collapse tree if aggChildCount is too low</span>
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> aggChildCount = 0;
                <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                    <span class="keywordflow">if</span>( !it-&gt;second.aggChildCount[i] ) {
                        aggChildCount = <a class="code" href="classNTree.html#a428051b8c6fd60c5f39db5fa552db8af">maxChildren</a>;
                        <span class="keywordflow">break</span>;
                    }

                    aggChildCount += it-&gt;second.aggChildCount[i];
                }
                <span class="keywordflow">if</span>( aggChildCount*2 &lt; <a class="code" href="classNTree.html#a428051b8c6fd60c5f39db5fa552db8af">maxChildren</a> ){
                    <a class="code" href="classNTree.html#a44605b29655eb6167049f6f97ec92bf0" title="Collapse a subtree that has too few children.">collapseTree</a>( it );
                }
            } <span class="keywordflow">else</span> {
                <span class="comment">// child not found</span>
                <span class="comment">// TODO: what to do now?</span>
            }
        }
    }
    <span class="keyword">delete</span> context;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abef2dca9bfb4329bc8d9a457571ea114"></a><!-- doxytag: member="NTree::handleReplaceMessage" ref="abef2dca9bfb4329bc8d9a457571ea114" args="(NTreeReplaceNodeMessage *replaceMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleReplaceMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeReplaceNodeMessage.html">NTreeReplaceNodeMessage</a> *&#160;</td>
          <td class="paramname"><em>replaceMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles a request to replace a failed or leaving node. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">replaceMsg</td><td>the replacement request </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00882">882</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleReplaceMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Was asked to replace &quot;</span> &lt;&lt; replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a1923d9e58b375f82705d13ce16be5d60">getOldNode</a>() &lt;&lt; <span class="stringliteral">&quot; for group &quot;</span> &lt;&lt; replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#ae8e07624f0b58b71136aab3d93d63cc3">getOrigin</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="comment">// Create new ntreeNode</span>
    <a class="code" href="classNTreeScope.html">NTreeScope</a> newScope( replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#ae8e07624f0b58b71136aab3d93d63cc3">getOrigin</a>(), replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#ac94d284124db0a31c06eb3e0cec1bb5e">getSize</a>() );
    <a class="code" href="classNTreeNode.html">NTreeNode</a> newNode(newScope);
    newNode.parent = replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#aafde1525f58a367f5bb1b312375c224e">getParent</a>();

    <span class="keywordflow">if</span>( replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#acf64a04a001904eb5a8893b70dc3cfe6">getIsLeaf</a>() ){
        std::list&lt;NTreeGroup&gt;::iterator it = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#ae8e07624f0b58b71136aab3d93d63cc3">getOrigin</a>(), replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#ac94d284124db0a31c06eb3e0cec1bb5e">getSize</a>() );
        <span class="keywordflow">if</span>( it == <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ){
            <a class="code" href="classNTreeGroup.html">NTreeGroup</a> newGrp( newScope );
            <span class="comment">// TODO: check for conflicting groups?</span>
            <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.push_front( newGrp );
            it = <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.begin();
        }
        it-&gt;leader = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>;
        it-&gt;members.insert( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
        <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#ae18cdb7819f6615e07f8cbe770890e2e">getChildrenArraySize</a>(); ++i ){
            it-&gt;members.insert( replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#abd0787cc60bf364e75fd974fa2f781d6">getChildren</a>(i) );
        }
        newNode.group = &amp;(*it);
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
            newNode.children[i] = replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#abd0787cc60bf364e75fd974fa2f781d6">getChildren</a>(i);
        }
    }

    <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.insert(make_pair(newScope,newNode));

    <span class="comment">// Inform parent+children</span>
    <a class="code" href="classNTreeTakeOverMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeTakeOverMessage</a>* takeMsg = <span class="keyword">new</span> <a class="code" href="classNTreeTakeOverMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeTakeOverMessage</a>(<span class="stringliteral">&quot;I took over&quot;</span>);
    takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a84210770652cfd71e9c17fa897170639">setPlayer</a>( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
    takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a9441f6e9338a7124f86f16c5bfe814fe">setOrigin</a>( newScope.origin );
    takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#af946adffe8cc743800643fb4191635e7">setSize</a>( newScope.size );
    takeMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a06df47ba22ca8e6b285d3128f4bb9fee">NTREETAKEOVER_L</a>(takeMsg) );

    <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>( newNode.parent, takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a16ecb43126e99dfae1d00423ed838d77">dup</a>() );
    <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>( replaceMsg-&gt;<a class="code" href="classNTreeReplaceNodeMessage.html#a1923d9e58b375f82705d13ce16be5d60">getOldNode</a>(), takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a16ecb43126e99dfae1d00423ed838d77">dup</a>() ); <span class="comment">// also inform old node if is is (against expectations) still alive</span>
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
            <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>+=2;
            <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> += 2*takeMsg-&gt;getByteLength();
    );
    <span class="keywordflow">if</span>( newNode.group ){
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a> += newNode.group-&gt;members.size();
                treeMaintenanceBytes += newNode.group-&gt;members.size()*takeMsg-&gt;getByteLength();
        );
        <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">sendToGroup</a>( *newNode.group, takeMsg );
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                    <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a>++;
                    treeMaintenanceBytes += takeMsg-&gt;getByteLength();
            );
            <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>( newNode.children[i], takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a16ecb43126e99dfae1d00423ed838d77">dup</a>() );
        }
        <span class="keyword">delete</span> takeMsg;
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="afab904983c5e838f3c1993112456d904"></a><!-- doxytag: member="NTree::handleRpcCall" ref="afab904983c5e838f3c1993112456d904" args="(BaseCallMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool NTree::handleRpcCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes Remote-Procedure-Call invocation messages. </p>
<p><br/>
</p>
<p>This method should be overloaded when the overlay provides RPC functionality.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if rpc has been handled </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseRpc.html#a20e77c3e0c203762a5b582ffebe3ba4b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00086">86</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faad4c4f4f3bddd311d8c11b20c1c6d00f">SHUTDOWN</a> ){
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">// delegate messages</span>
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>( msg )
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( NTreeJoin, <a class="code" href="classNTree.html#ab1357ccccb3b19730656d07c24057c7f" title="Handles request to join a group.">handleJoinCall</a> );
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( NTreePing, <a class="code" href="classNTree.html#a1e4512d83b5aa11f2772ba2803594d5d" title="Handles a ping If the ping was send to a node in the n-tree, it is answered with information about th...">handlePingCall</a> );
    <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>( NTreeDivide, <a class="code" href="classNTree.html#ad6ce1ce06e0f80aec4dd1fbfaf1f8b57" title="Handles a request to divide a group.">handleDivideCall</a> );
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( )

    return <a class="code" href="RpcMacros_8h.html#aa5e964b7c7129c0943237a786e455e9a">RPC_HANDLED</a>;

}
</pre></div>
</div>
</div>
<a class="anchor" id="a45a9ef8e451f451193fa58c3d55a9a12"></a><!-- doxytag: member="NTree::handleRpcResponse" ref="a45a9ef8e451f451193fa58c3d55a9a12" args="(BaseResponseMessage *msg, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC response has been received. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The response message. </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classNTree.html#a45a9ef8e451f451193fa58c3d55a9a12" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">rtt</td><td>The Round-Trip-Time of this RPC </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#a6229090a446fb649cfec3c1fb61e7167">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00102">102</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faad4c4f4f3bddd311d8c11b20c1c6d00f">SHUTDOWN</a> ){
        <span class="keywordflow">return</span>;
    }
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg);
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( NTreeJoin ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    Received a NTreeJoin RPC Response: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_NTreeJoinResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
            &lt;&lt; endl;
        <a class="code" href="classNTree.html#a440cba3647cd293e27bb75748beaed24" title="Handles the acknowledgement to join a group.">handleJoinResponse</a>( _NTreeJoinResponse );
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( NTreePing ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    Received a NTreePing RPC Response: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_NTreePingResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
            &lt;&lt; endl;
        <a class="code" href="classNTree.html#a926f95b00396cea01351a56291b23fef" title="Handles a ping response.">handlePingResponse</a>( _NTreePingResponse, dynamic_cast&lt;NTreePingContext*&gt;(context) );
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>( NTreeDivide ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleRpcResponse() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    Received a NTreeDivide RPC Response: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_NTreeDivideResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
            &lt;&lt; endl;
        <a class="code" href="classNTree.html#aca06c9a1d0f65ec2c600345d421c41ce" title="Handles an acknowledgement that a group was divided as requested.">handleDivideResponse</a>( _NTreeDivideResponse, check_and_cast&lt;NTreeGroupDivideContextPtr*&gt;(context)-&gt;ptr );
        <span class="keyword">delete</span> context;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0c8624383f26bf380a33ca0db3bc953d"></a><!-- doxytag: member="NTree::handleRpcTimeout" ref="a0c8624383f26bf380a33ca0db3bc953d" args="(BaseCallMessage *msg, const TransportAddress &amp;dest, cPolymorphic *context, int rpcId, const OverlayKey &amp;destKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleRpcTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>destKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC timeout has been reached. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The original RPC message. </td></tr>
    <tr><td class="paramname">dest</td><td>The destination node </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classNTree.html#a45a9ef8e451f451193fa58c3d55a9a12" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">destKey</td><td>the destination <a class="el" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#aaaf9cd362481527ed995dd159aa96b73">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00141">141</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faad4c4f4f3bddd311d8c11b20c1c6d00f">SHUTDOWN</a> ){
        <span class="keywordflow">return</span>;
    }
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>( NTreePing ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleRpcTimeout() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Ping RPC Call timed out: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_NTreePingCall
           &lt;&lt; <span class="stringliteral">&quot;    oldNode=&quot;</span> &lt;&lt; dest
           &lt;&lt; endl;
        <a class="code" href="classNTree.html#a81a94103e0a86b5eca7e9e22f5c7a0ba" title="Handles a ping timeout Inform others about the failed node, replace it if needed.">handlePingCallTimeout</a>( _NTreePingCall, dest, dynamic_cast&lt;NTreePingContext*&gt;(context) );
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>( NTreeJoin ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleRpcTimeout() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Join RPC Call timed out: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_NTreeJoinCall
           &lt;&lt; <span class="stringliteral">&quot;    oldNode=&quot;</span> &lt;&lt; dest
           &lt;&lt; endl;
        <a class="code" href="classNTree.html#a3a34f900e9368b2fed5f579a6977edca" title="Gets called if a join call times out Well try to re-join if needed.">handleJoinCallTimeout</a>( _NTreeJoinCall, dest );
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>( NTreeDivide ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[NTree::handleRpcTimeout() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
           &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Ping RPC Call timed out: id=&quot;</span> &lt;&lt; rpcId &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    msg=&quot;</span> &lt;&lt; *_NTreeDivideCall
           &lt;&lt; <span class="stringliteral">&quot;    oldNode=&quot;</span> &lt;&lt; dest
           &lt;&lt; endl;
        <a class="code" href="classNTree.html#ac99ce2807f3329dd7f26491f185b4f1d" title="Gets called if a divide call times out Re-send the request to a different node.">handleDivideCallTimeout</a>( _NTreeDivideCall, dest, check_and_cast&lt;NTreeGroupDivideContextPtr*&gt;(context)-&gt;ptr );
        <span class="keyword">delete</span> context;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( )

}
</pre></div>
</div>
</div>
<a class="anchor" id="a00d94425ef726e748f806cf633fad05d"></a><!-- doxytag: member="NTree::handleTakeOverMessage" ref="a00d94425ef726e748f806cf633fad05d" args="(NTreeTakeOverMessage *takeMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleTakeOverMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classNTreeTakeOverMessage.html">NTreeTakeOverMessage</a> *&#160;</td>
          <td class="paramname"><em>takeMsg</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handles an information message that a node took over the responsibilities of a failed or leaving node. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">takeMsg</td><td>the information message </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00946">946</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// CHeck if group leader gets replaced</span>
    std::list&lt;NTreeGroup&gt;::iterator git = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a290a1f3b9b443e9e56cdc7e3b3643cf7">getOrigin</a>(), takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a68538c416413d00eda2370afe7910f4f">getSize</a>() );
    <span class="keywordflow">if</span>( git != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ){
        git-&gt;leader = takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#aad4b17e14e9e4d0e772ae319ace3cfea">getPlayer</a>();
    }

    <span class="comment">// Check if a node gets replaced</span>
    <a class="code" href="classNTreeScope.html">NTreeScope</a> takeScope( takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a290a1f3b9b443e9e56cdc7e3b3643cf7">getOrigin</a>(), takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a68538c416413d00eda2370afe7910f4f">getSize</a>() );
    <span class="keywordflow">for</span>(std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.begin(); it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end(); ++it ){
        <span class="comment">// Check if parent is replaced</span>
        <span class="keywordflow">if</span>( takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a68538c416413d00eda2370afe7910f4f">getSize</a>() == it-&gt;second.scope.size*2.0 ){
            <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                <span class="keywordflow">if</span>( takeScope.getSubScope(i) == it-&gt;first ){
                    it-&gt;second.parent = takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#aad4b17e14e9e4d0e772ae319ace3cfea">getPlayer</a>();
                }
            }
            <span class="comment">// Else check if child is replaced</span>
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#a68538c416413d00eda2370afe7910f4f">getSize</a>()*2.0 == it-&gt;second.scope.size &amp;&amp; !it-&gt;second.group ){
            <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++i ){
                <span class="keywordflow">if</span>( it-&gt;first.getSubScope(i) == takeScope ){
                    it-&gt;second.children[i] = takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#aad4b17e14e9e4d0e772ae319ace3cfea">getPlayer</a>();
                }
            }
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it-&gt;second.scope == takeScope &amp;&amp; takeMsg-&gt;<a class="code" href="classNTreeTakeOverMessage.html#aad4b17e14e9e4d0e772ae319ace3cfea">getPlayer</a>() != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> ){
            <span class="comment">// Uh-oh. Somebody replaced me. Yield ownership</span>
            <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.erase( it );
            <span class="keywordflow">return</span>;
        }
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="ab9a8563095fe0b7cbd95eb98a166d0b4"></a><!-- doxytag: member="NTree::handleTimerEvent" ref="ab9a8563095fe0b7cbd95eb98a166d0b4" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ab893c156412e38caa62fe058b229899b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00215">215</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faad4c4f4f3bddd311d8c11b20c1c6d00f">SHUTDOWN</a> ){
        <span class="keywordflow">return</span>;
    }
    <span class="keywordflow">if</span>( msg == <a class="code" href="classNTree.html#ae5b5dd01d0dd2c4ed1aa6938f2b5b553">joinTimer</a> ) {
        <span class="comment">// send a fake ready message to app to get initial position</span>
        <a class="code" href="classCompReadyMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">CompReadyMessage</a>* msg = <span class="keyword">new</span> <a class="code" href="classCompReadyMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">CompReadyMessage</a>(<span class="stringliteral">&quot;fake READY&quot;</span>);
        msg-&gt;<a class="code" href="classCompReadyMessage.html#a07d2b2a15889728c23ed4d80730de2cf">setReady</a>(<span class="keyword">true</span>);
        msg-&gt;<a class="code" href="classCompReadyMessage.html#a77640d7f3566804064921b2520ed51b6">setComp</a>(<a class="code" href="classBaseOverlay.html#a92e0d3f96a5716245465e05da60ef487" title="Return the component type of this module.">getThisCompType</a>());
        send( msg, <span class="stringliteral">&quot;appOut&quot;</span>);
        <span class="comment">// send initial AOI size to the application</span>
        <a class="code" href="classGameAPIResizeAOIMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">GameAPIResizeAOIMessage</a>* gameMsg = <span class="keyword">new</span> <a class="code" href="classGameAPIResizeAOIMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">GameAPIResizeAOIMessage</a>(<span class="stringliteral">&quot;RESIZE_AOI&quot;</span>);
        gameMsg-&gt;<a class="code" href="classGameAPIMessage.html#a3fe3071c66623191477b903527280ddc">setCommand</a>(<a class="code" href="CommonMessages__m_8h.html#ac76e82bc37e4b2b364247c7cff8f7b6ba04223e5523bbf330b2553e5ba3e320d1">RESIZE_AOI</a>);
        gameMsg-&gt;<a class="code" href="classGameAPIResizeAOIMessage.html#ae8df0a2a6adc664d2dc8a5c0291f9f49">setAOIsize</a>(<a class="code" href="classNTree.html#a58564a7bbd7caaba33078388d34e89f1">AOIWidth</a>);
        send( gameMsg, <span class="stringliteral">&quot;appOut&quot;</span>);
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( msg == <a class="code" href="classNTree.html#a052e0c7016d6b7ac197cda112e3f26bc">pingTimer</a> ){
        <a class="code" href="classNTree.html#afdd8948ebfcc9effd60b92f23583ff90" title="Ping all children of all groups.">pingNodes</a>();
        <a class="code" href="classNTree.html#a20f801c3c702c715fdeb9be9b84b10e6" title="Check if a parent failed to send a ping for a longer time.">checkParentTimeout</a>();
        scheduleAt( simTime() + <a class="code" href="classNTree.html#a888ebb36f7aaddb1887f31de28677765">pingInterval</a>, <a class="code" href="classNTree.html#a052e0c7016d6b7ac197cda112e3f26bc">pingTimer</a> );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a419c6ad3063b42119ebd8afa64c2a14d"></a><!-- doxytag: member="NTree::handleUDPMessage" ref="a419c6ad3063b42119ebd8afa64c2a14d" args="(BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::handleUDPMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes messages from underlay. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>Message from UDP </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a31d7dd39ddc9e62ad92f69f6d7210344">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00185">185</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( <a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40faad4c4f4f3bddd311d8c11b20c1c6d00f">SHUTDOWN</a> ){
        <span class="keyword">delete</span> msg;
        <span class="keywordflow">return</span>;
    }
    <span class="keywordflow">if</span>( <a class="code" href="classNTreeMoveMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeMoveMessage</a>* moveMsg = dynamic_cast&lt;NTreeMoveMessage*&gt;(msg) ){
        <a class="code" href="classNTree.html#ad6e4730c994e5a50d6e4ee3000ede68c" title="Handles a move message from the network.">handleMoveMessage</a>( moveMsg );
        <span class="keyword">delete</span> moveMsg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classNTreeGroupAddMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeGroupAddMessage</a>* addMsg = dynamic_cast&lt;NTreeGroupAddMessage*&gt;(msg) ){
        <a class="code" href="classNTree.html#afd11bbeb64f1fe8a67e4f271fae1332c" title="Handles an information message that somebody joined a group we are a member of.">handleAddMessage</a>( addMsg );
        <span class="keyword">delete</span> addMsg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classNTreeGroupDeleteMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeGroupDeleteMessage</a>* deleteMsg = dynamic_cast&lt;NTreeGroupDeleteMessage*&gt;(msg) ){
        <a class="code" href="classNTree.html#a69d251a5a8f5d631acaf2d7143048aa0" title="Handles an information message that a group we are a member of is going to be deleted.">handleDeleteMessage</a>( deleteMsg );
        <span class="keyword">delete</span> deleteMsg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classNTreeLeaveMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeLeaveMessage</a>* leaveMsg = dynamic_cast&lt;NTreeLeaveMessage*&gt;(msg) ){
        <a class="code" href="classNTree.html#aee2ae5399ed3496cc337e0775c447148" title="Handles an information message that somebody left a group we are a member of.">handleLeaveMessage</a>( leaveMsg );
        <span class="keyword">delete</span> leaveMsg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classNTreeCollapseMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeCollapseMessage</a>* collapseMsg = dynamic_cast&lt;NTreeCollapseMessage*&gt;(msg) ){
        <a class="code" href="classNTree.html#aaec0db408144067a78e2bdde717977ff" title="Handles an information message that a subtree we are part of is collapsed.">handleCollapseMessage</a>( collapseMsg );
        <span class="keyword">delete</span> collapseMsg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classNTreeReplaceNodeMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeReplaceNodeMessage</a>* replaceMsg = dynamic_cast&lt;NTreeReplaceNodeMessage*&gt;(msg) ){
        <a class="code" href="classNTree.html#abef2dca9bfb4329bc8d9a457571ea114" title="Handles a request to replace a failed or leaving node.">handleReplaceMessage</a>( replaceMsg );
        <span class="keyword">delete</span> replaceMsg;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classNTreeTakeOverMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeTakeOverMessage</a>* takeMsg = dynamic_cast&lt;NTreeTakeOverMessage*&gt;(msg) ){
        <a class="code" href="classNTree.html#a00d94425ef726e748f806cf633fad05d" title="Handles an information message that a node took over the responsibilities of a failed or leaving node...">handleTakeOverMessage</a>( takeMsg );
        <span class="keyword">delete</span> takeMsg;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a563a4902066ebc3ec43d62dffc6ee83a"></a><!-- doxytag: member="NTree::initializeOverlay" ref="a563a4902066ebc3ec43d62dffc6ee83a" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::initializeOverlay </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes derived-class-attributes. </p>
<p><br/>
</p>
<p>Initializes derived-class-attributes, called by <a class="el" href="classBaseOverlay.html#a9738ba6065b0f699f1921bbe82ab97be" title="initializes base-class-attributes">BaseOverlay::initialize()</a>. By default this method is called once. If more stages are needed one can overload <a class="el" href="classBaseOverlay.html#a3234dfcf81463984e88a42432734a615" title="Sets init stage.">numInitStages()</a> and add more stages.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a41f88dfbea856a2b38319ff52c758c96">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l00043">43</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// because of IPAddressResolver, we need to wait until interfaces are registered,</span>
    <span class="comment">// address auto-assignment takes place etc.</span>
    <span class="keywordflow">if</span>(stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a58e83c497c7c8495e9c592ff3148b6b9" title="first stage for overlay modules (Tier 0 / KBR)">MIN_STAGE_OVERLAY</a>) <span class="keywordflow">return</span>;

    <a class="code" href="classNTree.html#a428051b8c6fd60c5f39db5fa552db8af">maxChildren</a> = par(<span class="stringliteral">&quot;maxChildren&quot;</span>);
    <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#a428051b8c6fd60c5f39db5fa552db8af">maxChildren</a> &lt; 5 ){
        <span class="keywordflow">throw</span> <span class="keyword">new</span> cRuntimeError(<span class="stringliteral">&quot;To allow a proper quad-tree, maxChildren has to be 5 or bigger&quot;</span>);
    }
    <a class="code" href="classNTree.html#a58564a7bbd7caaba33078388d34e89f1">AOIWidth</a> = par(<span class="stringliteral">&quot;AOIWidth&quot;</span>);

    <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#af3992f1fda9ea42dc10bf4739e47700a" title="saves given key to NodeHandle::key">setKey</a>(<a class="code" href="classOverlayKey.html#a1983e1b47e32783f8ccd5e59fe725290" title="Returns a random key.">OverlayKey::random</a>());

    <a class="code" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">areaDimension</a> = par(<span class="stringliteral">&quot;areaDimension&quot;</span>);
    <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = NULL;

    <a class="code" href="classNTree.html#ae5b5dd01d0dd2c4ed1aa6938f2b5b553">joinTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;joinTimer&quot;</span>);
    <a class="code" href="classNTree.html#a052e0c7016d6b7ac197cda112e3f26bc">pingTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;pingTimer&quot;</span>);
    <a class="code" href="classNTree.html#a888ebb36f7aaddb1887f31de28677765">pingInterval</a> = par(<span class="stringliteral">&quot;pingInterval&quot;</span>);
    scheduleAt( simTime() + <a class="code" href="classNTree.html#a888ebb36f7aaddb1887f31de28677765">pingInterval</a>, <a class="code" href="classNTree.html#a052e0c7016d6b7ac197cda112e3f26bc">pingTimer</a> );

    <span class="comment">// FIXME: Use standard baseOverlay::join()</span>
    <a class="code" href="classNTree.html#a6a09bf192a3c340e9d8f43c90d0b3169" title="Change the internal state of the protocol.">changeState</a>( <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a> );

    <span class="comment">// statistics</span>
    <a class="code" href="classNTree.html#a9d6f4c163375dc88ec52926708f87674">joinsSend</a> = 0;
    <a class="code" href="classNTree.html#a3254edf37eb3771820f257155a62d771">joinBytes</a> = 0;
    <a class="code" href="classNTree.html#ac93cb62c57a09fda499e80996d2328a0">joinTimeout</a> = 0;

    <a class="code" href="classNTree.html#a41bffa6f701ff383b666ff9edf903ad6">divideCount</a> = 0;
    <a class="code" href="classNTree.html#a0bbe607c5d094d3b33026dfd948b7f22">collapseCount</a> = 0;

    <a class="code" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">treeMaintenanceMessages</a> = 0;
    <a class="code" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">treeMaintenanceBytes</a> = 0;

    <a class="code" href="classNTree.html#a5c50f4d4ce98b68b32f0a4de8ec88443">movesSend</a> = 0;
    <a class="code" href="classNTree.html#ac4b0f8e2026da537e51672847a9ab590">moveBytes</a> = 0;

    WATCH_MAP( <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a> );
    WATCH_LIST( <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a> );
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab4b84494578c721a26da4bbb5eefde6b"></a><!-- doxytag: member="NTree::joinGroup" ref="ab4b84494578c721a26da4bbb5eefde6b" args="(Vector2D position)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::joinGroup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classVector2D.html">Vector2D</a>&#160;</td>
          <td class="paramname"><em>position</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Joins the group that is responsible for a given position. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">position</td><td>the position </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01203">1203</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::list&lt;NTreeGroup&gt;::iterator grpIt = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( position );
    <span class="keywordflow">if</span>( grpIt == <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() ) {
        <a class="code" href="classNTreeJoinCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeJoinCall</a>* joinCall = <span class="keyword">new</span> <a class="code" href="classNTreeJoinCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeJoinCall</a>(<span class="stringliteral">&quot;JOIN GROUP&quot;</span>);
        joinCall-&gt;<a class="code" href="classNTreeJoinCall.html#a9cfa615d030b211ed66f130f6fccc488">setPosition</a>( position );
        joinCall-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a1f34eb76183d177f52cbf91168b9f553">NTREEJOINCALL_L</a>(joinCall) );
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(
                <a class="code" href="classNTree.html#a9d6f4c163375dc88ec52926708f87674">joinsSend</a>++;
                <a class="code" href="classNTree.html#a3254edf37eb3771820f257155a62d771">joinBytes</a> += joinCall-&gt;getByteLength();
        );
        <a class="code" href="classNTree.html#abd8783c5f0fcc92cc600e8d34481f4aa" title="Route a message through the N-Tree to the closest know node to the given position.">routeViaNTree</a>( position, joinCall );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad436b21004c209ceb44915dbacbcd8a8"></a><!-- doxytag: member="NTree::leaveGroup" ref="ad436b21004c209ceb44915dbacbcd8a8" args="(Vector2D position, bool force=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::leaveGroup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classVector2D.html">Vector2D</a>&#160;</td>
          <td class="paramname"><em>position</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>force</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Leaves a group for a given position. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">position</td><td>the position </td></tr>
    <tr><td class="paramname">force</td><td>if set to true, leave group even if I'm leader of that group </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01218">1218</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::list&lt;NTreeGroup&gt;::iterator grpIt = <a class="code" href="classNTree.html#acb73a69af1f6fd5eba00bcebfd1949e0" title="Find a group that is responsible for the given position from the local list of groups.">findGroup</a>( position );
    <span class="comment">// Don&#39;t leave group if I&#39;m leader of that group (except if forced)</span>
    <span class="keywordflow">if</span>( grpIt != <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.end() &amp;&amp; (grpIt-&gt;leader != <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> || force) ) {
        <a class="code" href="classNTreeLeaveMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeLeaveMessage</a>* leaveMsg = <span class="keyword">new</span> <a class="code" href="classNTreeLeaveMessage.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeLeaveMessage</a>(<span class="stringliteral">&quot;Leave Group&quot;</span>);
        leaveMsg-&gt;<a class="code" href="classNTreeLeaveMessage.html#a68adc3af805f4b63db776d2df7535505">setPlayer</a>( <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> );
        leaveMsg-&gt;<a class="code" href="classNTreeLeaveMessage.html#a487bef67ad686c58a013eb1f77e13703">setPosition</a>( position );
        leaveMsg-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#af39a49959213a6c7812e8c69a95c1ae3">NTREELEAVE_L</a>(leaveMsg) );
        <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">sendToGroup</a>( *grpIt, leaveMsg );

        <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> == &amp;(*grpIt) ){
            EV &lt;&lt; <span class="stringliteral">&quot;[NTree::leaveGroup() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;    WARNING: Leaving group &quot;</span> &lt;&lt; position &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;    This group is marked as current group!\n&quot;</span>;
            <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> = NULL;
        }
        <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.erase( grpIt );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="afdd8948ebfcc9effd60b92f23583ff90"></a><!-- doxytag: member="NTree::pingNodes" ref="afdd8948ebfcc9effd60b92f23583ff90" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::pingNodes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Ping all children of all groups. </p>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01036">1036</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span>(std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.begin(); it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end(); ++it ){

        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
        <span class="keywordflow">if</span>( it-&gt;second.group ){
            <span class="comment">// Leaf</span>
            <a class="code" href="classNTreePingCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreePingCall</a>* pingCall = <span class="keyword">new</span> <a class="code" href="classNTreePingCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreePingCall</a>(<span class="stringliteral">&quot;PING&quot;</span>);
            pingCall-&gt;<a class="code" href="classNTreePingCall.html#a6c6fe1dd97fc51353057ff1e03ed1e65">setOrigin</a>( it-&gt;second.scope.origin );
            pingCall-&gt;<a class="code" href="classNTreePingCall.html#a8586b060fdb16a77aeb8a18101ef9fc6">setSize</a>( it-&gt;second.scope.size );
            pingCall-&gt;<a class="code" href="classNTreePingCall.html#a1f86139ce3de91e4d902a18c2a6c5175">setParent</a>( it-&gt;second.parent );
            pingCall-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#a41827f99ffb6af1fd2dcb3cac2ed85d6">NTREEPINGCALL_L</a>(pingCall) );
            <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">sendToGroup</a>( *it-&gt;second.group, pingCall );
        } <span class="keywordflow">else</span> {
            <a class="code" href="classNTreeNodePingCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeNodePingCall</a>* pingCall = <span class="keyword">new</span> <a class="code" href="classNTreeNodePingCall.html" title="Class generated from overlay/ntree/NTree.msg by opp_msgc.">NTreeNodePingCall</a>(<span class="stringliteral">&quot;PING&quot;</span>);
            pingCall-&gt;<a class="code" href="classNTreePingCall.html#a6c6fe1dd97fc51353057ff1e03ed1e65">setOrigin</a>( it-&gt;second.scope.origin );
            pingCall-&gt;<a class="code" href="classNTreePingCall.html#a8586b060fdb16a77aeb8a18101ef9fc6">setSize</a>( it-&gt;second.scope.size );
            pingCall-&gt;<a class="code" href="classNTreePingCall.html#a1f86139ce3de91e4d902a18c2a6c5175">setParent</a>( it-&gt;second.parent );

            <span class="keywordflow">for</span>( i = 0; i &lt; 4; ++i ){
                pingCall-&gt;<a class="code" href="classNTreeNodePingCall.html#a5812dc7b05a535b84623016ea1b72c1f">setSiblings</a>(i, it-&gt;second.children[i] );
            }
            pingCall-&gt;setBitLength( <a class="code" href="NTree__m_8h.html#ad201f4a44cdad4712c6b92cbceab8751">NTREENODEPINGCALL_L</a>(pingCall) );

            <span class="keywordflow">for</span>( i = 0; i &lt; 4; ++i ){
                pingCall-&gt;<a class="code" href="classNTreeNodePingCall.html#a21cd296310cde3208d6a0349b959eb3f">setQuadrant</a>( i );
                <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>( it-&gt;second.children[i], pingCall-&gt;<a class="code" href="classNTreeNodePingCall.html#a2eb7921a71acfb091c5b764bfcfc12c4">dup</a>(), <span class="keyword">new</span> <a class="code" href="classNTreePingContext.html">NTreePingContext</a>(it-&gt;second.scope, i) );
            }
            <span class="keyword">delete</span> pingCall;
        }

    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="abd8783c5f0fcc92cc600e8d34481f4aa"></a><!-- doxytag: member="NTree::routeViaNTree" ref="abd8783c5f0fcc92cc600e8d34481f4aa" args="(const Vector2D &amp;pos, cPacket *msg, bool forward=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::routeViaNTree </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classVector2D.html">Vector2D</a> &amp;&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPacket *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>forward</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Route a message through the N-Tree to the closest know node to the given position. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pos</td><td>the position </td></tr>
    <tr><td class="paramname">msg</td><td>the message </td></tr>
    <tr><td class="paramname">forward</td><td>Should be set to true if the message was not created by the local node </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01240">1240</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> dest;
    <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.size() ) {
        <span class="comment">// Check if pos is in scope of one ntree node</span>
        std::map&lt;NTreeScope,NTreeNode&gt;::iterator it = <a class="code" href="classNTree.html#af7b0930b4ab5d2536fd2af2386e890b4" title="Find the lowest ntree node that contains the given position.">findNTreeNode</a>( pos );
        <span class="keywordflow">if</span>( it != <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.end() ){
            <span class="comment">// Forward message to appropriate child</span>
            dest = it-&gt;second.getChildForPos( pos );
        } <span class="keywordflow">else</span> {
            <span class="comment">// else send to parent of highest ntreeNode</span>
            dest = <a class="code" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">ntreeNodes</a>.begin()-&gt;second.parent;
        }
    } <span class="keywordflow">else</span> {
        <span class="comment">// No Ntree known. Send to group leader</span>
        <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a> ){
            dest = <a class="code" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">currentGroup</a>-&gt;<a class="code" href="classNTreeGroup.html#a64104ecd73ab3d6cb7deba940d32edf3">leader</a>;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.size() ){
            dest = <a class="code" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">groups</a>.begin()-&gt;leader;
        } <span class="keywordflow">else</span> { <span class="comment">// No group known. We have to re-join. (Even though a JOIN might still be in progress)</span>
            EV &lt;&lt; <span class="stringliteral">&quot;[NTree::routeViaNTree() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;    No ntree node and no group known. Dropping message &amp; re-join!\n&quot;</span>;
            <a class="code" href="classNTree.html#a6a09bf192a3c340e9d8f43c90d0b3169" title="Change the internal state of the protocol.">changeState</a>( <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa4c1b397f6c4682baf7db280e7f15520a">INIT</a> );
            <span class="keyword">delete</span> msg;
            <span class="keywordflow">return</span>;
        }
    }
    <span class="keywordflow">if</span>( forward &amp;&amp; dest == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[NTree::routeViaNTree() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    Trying to route message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; to myself\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    This will result in a loop. Dropping message\n&quot;</span>;
        <span class="keyword">delete</span> msg;
    } <span class="keywordflow">else</span> {
        <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>( dest, msg, forward );
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="ad8afe52a993c199a72b1db93b4ab8798"></a><!-- doxytag: member="NTree::sendMessage" ref="ad8afe52a993c199a72b1db93b4ab8798" args="(const TransportAddress &amp;dest, cPacket *msg, bool forward=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::sendMessage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPacket *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>forward</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends a message to a host. </p>
<p>Silently discards the message if the destination is unspecified</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">dest</td><td>the destination address </td></tr>
    <tr><td class="paramname">msg</td><td>the message </td></tr>
    <tr><td class="paramname">forward</td><td>should be set to true if the message was not created by the local node </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01298">1298</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>( dest.<a class="code" href="classTransportAddress.html#a026e777c423ff2a0280edd2fa5472e74" title="indicates if TransportAddress is specified">isUnspecified</a>() ) {
        EV &lt;&lt; <span class="stringliteral">&quot;[NTree::sendMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
            &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    WARNING: Trying to send message &quot;</span> &lt;&lt; msg
            &lt;&lt; <span class="stringliteral">&quot;    to unspecified destination. Dropping packet!\n&quot;</span>;
        <span class="keyword">delete</span> msg;
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// TODO: statistics?</span>
    <a class="code" href="classBaseCallMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">BaseCallMessage</a>* rpc = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classBaseCallMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">BaseCallMessage</a>*<span class="keyword">&gt;</span>(msg);
    <span class="keywordflow">if</span>( rpc &amp;&amp; !forward ){
        <span class="comment">// Slightly evil: If an OverlayKey is set, the RPC response</span>
        <span class="comment">// may get dropped if it was forwarded (because OverSim expects</span>
        <span class="comment">// frowarding to be done with BaseRoutMessages. Which we can&#39;t do,</span>
        <span class="comment">// because we are not routing to overlay keys but to positions.</span>
        <span class="comment">// Thus, we cast the OverlayKey away.</span>
        <a class="code" href="classBaseRpc.html#ac128e0ff0d09f81b652f7d3e00ce9441" title="Sends a Remote-Procedure-Call message to the underlay ">sendUdpRpcCall</a>( <a class="code" href="classTransportAddress.html" title="This class implements a common transport address.">TransportAddress</a>(dest), rpc );
    } <span class="keywordflow">else</span> {
        <a class="code" href="classBaseOverlay.html#a10189697bd95f3de66c27c1ecf07e323" title="Sends message to underlay.">sendMessageToUDP</a>( dest, msg );
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="acf8d3d65329f72b0634351a496b77283"></a><!-- doxytag: member="NTree::sendToGroup" ref="acf8d3d65329f72b0634351a496b77283" args="(const NTreeGroup &amp;grp, cPacket *msg, bool keepMsg=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::sendToGroup </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNTreeGroup.html">NTreeGroup</a> &amp;&#160;</td>
          <td class="paramname"><em>grp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPacket *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>keepMsg</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends a message to all members of a group. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">grp</td><td>the group </td></tr>
    <tr><td class="paramname">msg</td><td>the message </td></tr>
    <tr><td class="paramname">keepMsg</td><td>do not free the memory occupied by msg after sending </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01280">1280</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <span class="stringliteral">&quot;[NTree::sendToGroup() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
        &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    Send message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
        &lt;&lt; <span class="stringliteral">&quot;    to group scope=&quot;</span> &lt;&lt; grp.<a class="code" href="classNTreeGroup.html#a874afab14b9e4704bd3022565264e2e8">scope</a>.<a class="code" href="classNTreeScope.html#a8c3432b5d17f08b586e20113bad02428">origin</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <a class="code" href="classNTree.html#acf8d3d65329f72b0634351a496b77283" title="Sends a message to all members of a group.">NTree::sendToGroup</a>( grp.<a class="code" href="classNTreeGroup.html#a8504cdb0167bd77af831a55f0a6c6fe9">members</a>, msg, keepMsg );
}
</pre></div>
</div>
</div>
<a class="anchor" id="acde7b902252e272ff2323316e88d7197"></a><!-- doxytag: member="NTree::sendToGroup" ref="acde7b902252e272ff2323316e88d7197" args="(const std::set&lt; NodeHandle &gt; &amp;grp, cPacket *msg, bool keepMsg=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::sendToGroup </td>
          <td>(</td>
          <td class="paramtype">const std::set&lt; <a class="el" href="classNodeHandle.html">NodeHandle</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>grp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPacket *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>keepMsg</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends a message to all members of a group. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">grp</td><td>the group </td></tr>
    <tr><td class="paramname">msg</td><td>the message </td></tr>
    <tr><td class="paramname">keepMsg</td><td>do not free the memory occupied by msg after sending </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01289">1289</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span>( std::set&lt;NodeHandle&gt;::iterator it = grp.begin(); it != grp.end(); ++it ){
        <a class="code" href="classNTree.html#ad8afe52a993c199a72b1db93b4ab8798" title="Sends a message to a host.">sendMessage</a>( *it, msg-&gt;dup(), false );
    }
    <span class="keywordflow">if</span> (!keepMsg) <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac58d1280a59c72c46e182e70d7346d1e"></a><!-- doxytag: member="NTree::setBootstrapedIcon" ref="ac58d1280a59c72c46e182e70d7346d1e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NTree::setBootstrapedIcon </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8cc_source.html#l01354">1354</a> of file <a class="el" href="NTree_8cc_source.html">NTree.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>(ev.isGUI()) {
        <span class="keywordflow">if</span>(<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fab3a263fb274a58d63b15cd61ba910335">READY</a>) {
            getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 1, <span class="stringliteral">&quot;green&quot;</span>);
            getDisplayString().setTagArg(<span class="stringliteral">&quot;i&quot;</span>, 1, <span class="stringliteral">&quot;green&quot;</span>);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classBaseOverlay.html#ab4be6d88417117fbf33a445d56af2655">state</a> == <a class="code" href="classBaseOverlay.html#a0ad4b12b0c9949661f66db7fbbf7d40fa40c37f1f56c6ed8e40ae467e67e61cab">JOIN</a>) {
            getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 1, <span class="stringliteral">&quot;yellow&quot;</span>);
            getDisplayString().setTagArg(<span class="stringliteral">&quot;i&quot;</span>, 1, <span class="stringliteral">&quot;yellow&quot;</span>);
        }
        <span class="keywordflow">else</span> {
            getParentModule()-&gt;getParentModule()-&gt;getDisplayString().setTagArg(<span class="stringliteral">&quot;i2&quot;</span>, 1, <span class="stringliteral">&quot;red&quot;</span>);
            getDisplayString().setTagArg(<span class="stringliteral">&quot;i&quot;</span>, 1, <span class="stringliteral">&quot;red&quot;</span>);
        }
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a58564a7bbd7caaba33078388d34e89f1"></a><!-- doxytag: member="NTree::AOIWidth" ref="a58564a7bbd7caaba33078388d34e89f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#a58564a7bbd7caaba33078388d34e89f1">NTree::AOIWidth</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00266">266</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac5c9fa88d26b40bf670278a0e006f4d4"></a><!-- doxytag: member="NTree::areaDimension" ref="ac5c9fa88d26b40bf670278a0e006f4d4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classNTree.html#ac5c9fa88d26b40bf670278a0e006f4d4">NTree::areaDimension</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00268">268</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0bbe607c5d094d3b33026dfd948b7f22"></a><!-- doxytag: member="NTree::collapseCount" ref="a0bbe607c5d094d3b33026dfd948b7f22" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#a0bbe607c5d094d3b33026dfd948b7f22">NTree::collapseCount</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00321">321</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa27f0728fa443cfe13042ab40c45144e"></a><!-- doxytag: member="NTree::currentGroup" ref="aa27f0728fa443cfe13042ab40c45144e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classNTreeGroup.html">NTreeGroup</a>* <a class="el" href="classNTree.html#aa27f0728fa443cfe13042ab40c45144e">NTree::currentGroup</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00270">270</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="a41bffa6f701ff383b666ff9edf903ad6"></a><!-- doxytag: member="NTree::divideCount" ref="a41bffa6f701ff383b666ff9edf903ad6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#a41bffa6f701ff383b666ff9edf903ad6">NTree::divideCount</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00320">320</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0b04f9e1fb204dc5b7c4123fb6041c98"></a><!-- doxytag: member="NTree::groups" ref="a0b04f9e1fb204dc5b7c4123fb6041c98" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::list&lt;<a class="el" href="classNTreeGroup.html">NTreeGroup</a>&gt; <a class="el" href="classNTree.html#a0b04f9e1fb204dc5b7c4123fb6041c98">NTree::groups</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00277">277</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3254edf37eb3771820f257155a62d771"></a><!-- doxytag: member="NTree::joinBytes" ref="a3254edf37eb3771820f257155a62d771" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#a3254edf37eb3771820f257155a62d771">NTree::joinBytes</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00317">317</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9d6f4c163375dc88ec52926708f87674"></a><!-- doxytag: member="NTree::joinsSend" ref="a9d6f4c163375dc88ec52926708f87674" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#a9d6f4c163375dc88ec52926708f87674">NTree::joinsSend</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00316">316</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac93cb62c57a09fda499e80996d2328a0"></a><!-- doxytag: member="NTree::joinTimeout" ref="ac93cb62c57a09fda499e80996d2328a0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#ac93cb62c57a09fda499e80996d2328a0">NTree::joinTimeout</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00318">318</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae5b5dd01d0dd2c4ed1aa6938f2b5b553"></a><!-- doxytag: member="NTree::joinTimer" ref="ae5b5dd01d0dd2c4ed1aa6938f2b5b553" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classNTree.html#ae5b5dd01d0dd2c4ed1aa6938f2b5b553">NTree::joinTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00274">274</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="a428051b8c6fd60c5f39db5fa552db8af"></a><!-- doxytag: member="NTree::maxChildren" ref="a428051b8c6fd60c5f39db5fa552db8af" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#a428051b8c6fd60c5f39db5fa552db8af">NTree::maxChildren</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00267">267</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac4b0f8e2026da537e51672847a9ab590"></a><!-- doxytag: member="NTree::moveBytes" ref="ac4b0f8e2026da537e51672847a9ab590" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#ac4b0f8e2026da537e51672847a9ab590">NTree::moveBytes</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00327">327</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5c50f4d4ce98b68b32f0a4de8ec88443"></a><!-- doxytag: member="NTree::movesSend" ref="a5c50f4d4ce98b68b32f0a4de8ec88443" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#a5c50f4d4ce98b68b32f0a4de8ec88443">NTree::movesSend</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00326">326</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac9abbb19900b1e6999bea9657ab98a1e"></a><!-- doxytag: member="NTree::ntreeNodes" ref="ac9abbb19900b1e6999bea9657ab98a1e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classNTreeScope.html">NTreeScope</a>,<a class="el" href="classNTreeNode.html">NTreeNode</a>&gt; <a class="el" href="classNTree.html#ac9abbb19900b1e6999bea9657ab98a1e">NTree::ntreeNodes</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00278">278</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="a888ebb36f7aaddb1887f31de28677765"></a><!-- doxytag: member="NTree::pingInterval" ref="a888ebb36f7aaddb1887f31de28677765" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t <a class="el" href="classNTree.html#a888ebb36f7aaddb1887f31de28677765">NTree::pingInterval</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00272">272</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="a052e0c7016d6b7ac197cda112e3f26bc"></a><!-- doxytag: member="NTree::pingTimer" ref="a052e0c7016d6b7ac197cda112e3f26bc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classNTree.html#a052e0c7016d6b7ac197cda112e3f26bc">NTree::pingTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00275">275</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="af054361942e02791f76643b3886a1c6a"></a><!-- doxytag: member="NTree::position" ref="af054361942e02791f76643b3886a1c6a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classVector2D.html">Vector2D</a> <a class="el" href="classNTree.html#af054361942e02791f76643b3886a1c6a">NTree::position</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00269">269</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="afa451d4f41ac8cc7ab357d146d842cc4"></a><!-- doxytag: member="NTree::treeMaintenanceBytes" ref="afa451d4f41ac8cc7ab357d146d842cc4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#afa451d4f41ac8cc7ab357d146d842cc4">NTree::treeMaintenanceBytes</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00324">324</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa61dcc50338beb91b9b7f10f3c093015"></a><!-- doxytag: member="NTree::treeMaintenanceMessages" ref="aa61dcc50338beb91b9b7f10f3c093015" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="classNTree.html#aa61dcc50338beb91b9b7f10f3c093015">NTree::treeMaintenanceMessages</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NTree_8h_source.html#l00323">323</a> of file <a class="el" href="NTree_8h_source.html">NTree.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="NTree_8h_source.html">NTree.h</a></li>
<li><a class="el" href="NTree_8cc_source.html">NTree.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classNTree.html">NTree</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:54 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
