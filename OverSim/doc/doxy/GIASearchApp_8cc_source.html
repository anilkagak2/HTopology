<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: GIASearchApp.cc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('GIASearchApp_8cc.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">GIASearchApp.cc</div>  </div>
</div>
<div class="contents">
<a href="GIASearchApp_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// Copyright (C) 2006 Institut fuer Telematik, Universitaet Karlsruhe (TH)</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment">// modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment">// as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment">// of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 <span class="comment">// This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment">// GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment">//</span>
<a name="l00014"></a>00014 <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment">// along with this program; if not, write to the Free Software</span>
<a name="l00016"></a>00016 <span class="comment">// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;IPAddressResolver.h&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="InitStages_8h.html">InitStages.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="CommonMessages__m_8h.html">CommonMessages_m.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="ExtAPIMessages__m_8h.html">ExtAPIMessages_m.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="GiaMessage__m_8h.html">GiaMessage_m.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="GlobalStatistics_8h.html">GlobalStatistics.h</a>&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="GIASearchApp_8h.html">GIASearchApp.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <a class="code" href="ALMTest_8cc.html#a3b5014f410c7989e8bad4b467ecc94cd">Define_Module</a>(<a class="code" href="classGIASearchApp.html" title="Gia search test application.">GIASearchApp</a>);
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="classGIASearchApp.html#af378dd97e800fd37fa4642c263aab805">00037</a> <a class="code" href="classGIASearchApp.html#af378dd97e800fd37fa4642c263aab805">GIASearchApp::GIASearchApp</a>()
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039     <a class="code" href="classGIASearchApp.html#a6592fab2348b7c497003957585cec6b1" title="timer for search messages">search_timer</a> = <a class="code" href="classGIASearchApp.html#aa23ea2f0b98010e88a94f2909eec06ae" title="timer for initial key list packet to overlay">keyList_timer</a> = NULL;
<a name="l00040"></a>00040     <a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a> = NULL;
<a name="l00041"></a>00041 }
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="classGIASearchApp.html#a52adc8a46e26010ccdb62563a1a4ff61">00043</a> <a class="code" href="classGIASearchApp.html#a52adc8a46e26010ccdb62563a1a4ff61">GIASearchApp::~GIASearchApp</a>()
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045     cancelAndDelete(<a class="code" href="classGIASearchApp.html#a6592fab2348b7c497003957585cec6b1" title="timer for search messages">search_timer</a>);
<a name="l00046"></a>00046     cancelAndDelete(<a class="code" href="classGIASearchApp.html#aa23ea2f0b98010e88a94f2909eec06ae" title="timer for initial key list packet to overlay">keyList_timer</a>);
<a name="l00047"></a>00047     <span class="keywordflow">if</span> (<a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a> != NULL) {
<a name="l00048"></a>00048         <span class="keyword">delete</span> <a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a>;
<a name="l00049"></a>00049         <a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a> = NULL;
<a name="l00050"></a>00050     }
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classGIASearchApp.html#a097428b58c1abf9282821680c5dc6991">00053</a> <span class="keywordtype">void</span> <a class="code" href="classGIASearchApp.html#a097428b58c1abf9282821680c5dc6991" title="initializes base class-attributes">GIASearchApp::initializeApp</a>(<span class="keywordtype">int</span> stage)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055     <span class="keywordflow">if</span> (stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532ad9afa81d0184c5f0649fa111f7a821bc" title="deprecated">MIN_STAGE_APP</a>)
<a name="l00056"></a>00056         <span class="keywordflow">return</span>;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058     <span class="comment">// fetch parameters</span>
<a name="l00059"></a>00059     <a class="code" href="classGIASearchApp.html#aaa9bd76f26aa300f0458bcb4ca143f77" title="mean interval for next message">mean</a> = par(<span class="stringliteral">&quot;messageDelay&quot;</span>);
<a name="l00060"></a>00060     <a class="code" href="classGIASearchApp.html#aa8749477d8db75611667074f2f7cec77" title="deviation of mean interval">deviation</a> = <a class="code" href="classGIASearchApp.html#aaa9bd76f26aa300f0458bcb4ca143f77" title="mean interval for next message">mean</a> / 3;
<a name="l00061"></a>00061     <a class="code" href="classGIASearchApp.html#a3570d458370a137ab1a71e1841e3ede4" title="use random destination nodes or only nodes from GlobalNodeList?">randomNodes</a> = par(<span class="stringliteral">&quot;randomNodes&quot;</span>);
<a name="l00062"></a>00062     <a class="code" href="classGIASearchApp.html#ae8d1b331f3250137e39545a92deea328" title="maximum number of responses per search message">maxResponses</a> = par(<span class="stringliteral">&quot;maxResponses&quot;</span>);
<a name="l00063"></a>00063 
<a name="l00064"></a>00064     <a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a> = <span class="keyword">new</span> <a class="code" href="classSearchMsgBookkeeping.html" title="Class for bookkeeping sent SEARCH-Messages to gather statistical data.">SearchMsgBookkeeping</a>();
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="comment">// statistics</span>
<a name="l00067"></a>00067     <a class="code" href="classGIASearchApp.html#aa5bd3e59c4313f6bba5b38c42576dd66" title="number of keyList-Messages sent">stat_keyListMessagesSent</a> = 0;
<a name="l00068"></a>00068     <a class="code" href="classGIASearchApp.html#ae7cebe442a63f55b4c90cadc0beb5a29" title="number of keyList-Bytes sent">stat_keyListBytesSent</a> = 0;
<a name="l00069"></a>00069     <a class="code" href="classGIASearchApp.html#a084a484607853fca6a08244c8307ac80" title="number of search-Messages sent">stat_searchMessagesSent</a> = 0;
<a name="l00070"></a>00070     <a class="code" href="classGIASearchApp.html#a250fe0d635c647055f1d4d4583de5c95" title="number of search-Messages-Bytes sent">stat_searchBytesSent</a> = 0;
<a name="l00071"></a>00071     <a class="code" href="classGIASearchApp.html#a7aac11f63657c1dcf66770272abcb62e" title="number of received search-Response-Messages">stat_searchResponseMessages</a> = 0;
<a name="l00072"></a>00072     <a class="code" href="classGIASearchApp.html#ac31f7331289a21522adced2203828a69" title="number of received search-Response-Messages-Bytes">stat_searchResponseBytes</a> = 0;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     <span class="comment">// initiate test message emision</span>
<a name="l00075"></a>00075     <a class="code" href="classGIASearchApp.html#a6592fab2348b7c497003957585cec6b1" title="timer for search messages">search_timer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;search_timer&quot;</span>);
<a name="l00076"></a>00076     scheduleAt(simTime() + truncnormal(<a class="code" href="classGIASearchApp.html#aaa9bd76f26aa300f0458bcb4ca143f77" title="mean interval for next message">mean</a>, <a class="code" href="classGIASearchApp.html#aa8749477d8db75611667074f2f7cec77" title="deviation of mean interval">deviation</a>),
<a name="l00077"></a>00077                <a class="code" href="classGIASearchApp.html#a6592fab2348b7c497003957585cec6b1" title="timer for search messages">search_timer</a>);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <a class="code" href="classGIASearchApp.html#aa23ea2f0b98010e88a94f2909eec06ae" title="timer for initial key list packet to overlay">keyList_timer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;keyList_timer&quot;</span>);
<a name="l00080"></a>00080     scheduleAt(simTime() + uniform(0.0, 10.0), <a class="code" href="classGIASearchApp.html#aa23ea2f0b98010e88a94f2909eec06ae" title="timer for initial key list packet to overlay">keyList_timer</a>);
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="classGIASearchApp.html#afa0920c5aeca3cb9e0c949fed5d8833c">00083</a> <span class="keywordtype">void</span> <a class="code" href="classGIASearchApp.html#afa0920c5aeca3cb9e0c949fed5d8833c">GIASearchApp::handleTimerEvent</a>(cMessage *msg)
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085     <span class="keywordflow">if</span>(msg == <a class="code" href="classGIASearchApp.html#aa23ea2f0b98010e88a94f2909eec06ae" title="timer for initial key list packet to overlay">keyList_timer</a>) {
<a name="l00086"></a>00086         <a class="code" href="classGIASearchApp.html#ac913c88fac4ffe29f2f42b75b1dbb02b" title="list of all maintained key of this application">keyList</a> = <a class="code" href="classBaseApp.html#ac8a54fad527bfd03a05ee6aed434243e" title="pointer to GlobalNodeList in this node">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#addbb881d8eb1b7a6ab3fbed3fd7c019e" title="Returns a keylist.">getKeyList</a>(par(<span class="stringliteral">&quot;maximumKeys&quot;</span>));
<a name="l00087"></a>00087         WATCH_VECTOR(*<a class="code" href="classGIASearchApp.html#ac913c88fac4ffe29f2f42b75b1dbb02b" title="list of all maintained key of this application">keyList</a>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="comment">// create message</span>
<a name="l00090"></a>00090         <a class="code" href="classGIAput.html" title="Class generated from common/ExtAPIMessages.msg by opp_msgc.">GIAput</a>* putMsg = <span class="keyword">new</span> <a class="code" href="classGIAput.html" title="Class generated from common/ExtAPIMessages.msg by opp_msgc.">GIAput</a>(<span class="stringliteral">&quot;GIA-Keylist&quot;</span>);
<a name="l00091"></a>00091         putMsg-&gt;<a class="code" href="classGIASearchAppMessage.html#a0bb9a13bf28291e57db3e95d8c3e1589">setCommand</a>(<a class="code" href="ExtAPIMessages__m_8h.html#a682fe177714e5c2639d8d79f943b9bd9a74a5c8dd1e956ef0227a08d6b0e41b24">GIA_PUT</a>);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         putMsg-&gt;<a class="code" href="classGIAput.html#a39ab97fdd40e1906f8652c81b337a729">setKeysArraySize</a>(<a class="code" href="classGIASearchApp.html#ac913c88fac4ffe29f2f42b75b1dbb02b" title="list of all maintained key of this application">keyList</a>-&gt;size());
<a name="l00094"></a>00094 
<a name="l00095"></a>00095         std::vector&lt;OverlayKey&gt;::iterator it;
<a name="l00096"></a>00096         <span class="keywordtype">int</span> k;
<a name="l00097"></a>00097         <span class="keywordflow">for</span>(it = <a class="code" href="classGIASearchApp.html#ac913c88fac4ffe29f2f42b75b1dbb02b" title="list of all maintained key of this application">keyList</a>-&gt;begin(), k = 0; it != <a class="code" href="classGIASearchApp.html#ac913c88fac4ffe29f2f42b75b1dbb02b" title="list of all maintained key of this application">keyList</a>-&gt;end(); it++, k++)
<a name="l00098"></a>00098             putMsg-&gt;<a class="code" href="classGIAput.html#a0f40eae13e7ff316e28f6ae2636d1ab7">setKeys</a>(k, *it);
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         putMsg-&gt;setBitLength(<a class="code" href="ExtAPIMessages__m_8h.html#a7bf9ffae2fd53edf227131524232668c">GIAPUT_L</a>(putMsg));
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         <a class="code" href="classBaseApp.html#a9757b716a23dcd65d43f4fd704243ad2" title="sends non-commonAPI message to the lower tier">sendMessageToLowerTier</a>(putMsg);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="keywordflow">if</span> (<a class="code" href="classBaseApp.html#afbdeb4fb8c437056bb934cca461e89b4" title="debug output yes/no?">debugOutput</a>)
<a name="l00105"></a>00105            EV &lt;&lt; <span class="stringliteral">&quot;[GIASearchApp::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()&lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00106"></a>00106               &lt;&lt; <span class="stringliteral">&quot;    Node sent keylist to overlay.&quot;</span>
<a name="l00107"></a>00107               &lt;&lt; endl;
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         <a class="code" href="classGIASearchApp.html#aa5bd3e59c4313f6bba5b38c42576dd66" title="number of keyList-Messages sent">stat_keyListMessagesSent</a>++;
<a name="l00110"></a>00110         <a class="code" href="classGIASearchApp.html#ae7cebe442a63f55b4c90cadc0beb5a29" title="number of keyList-Bytes sent">stat_keyListBytesSent</a> += putMsg-&gt;getByteLength();
<a name="l00111"></a>00111     }
<a name="l00112"></a>00112     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(msg == <a class="code" href="classGIASearchApp.html#a6592fab2348b7c497003957585cec6b1" title="timer for search messages">search_timer</a>) {
<a name="l00113"></a>00113         <span class="comment">// schedule next search-message</span>
<a name="l00114"></a>00114         scheduleAt(simTime() + truncnormal(<a class="code" href="classGIASearchApp.html#aaa9bd76f26aa300f0458bcb4ca143f77" title="mean interval for next message">mean</a>, <a class="code" href="classGIASearchApp.html#aa8749477d8db75611667074f2f7cec77" title="deviation of mean interval">deviation</a>), msg);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116         <span class="comment">// do nothing, if the network is still in the initiaization phase</span>
<a name="l00117"></a>00117         <span class="keywordflow">if</span>((!par(<span class="stringliteral">&quot;activeNetwInitPhase&quot;</span>)) &amp;&amp; (<a class="code" href="classBaseApp.html#a0587e13700e8641eec8143628dfd34cd" title="pointer to UnderlayConfigurator in this node">underlayConfigurator</a>-&gt;<a class="code" href="classUnderlayConfigurator.html#a00c2e85286a38799c7a04edb52ae6e76" title="still in initialization phase?">isInInitPhase</a>()))
<a name="l00118"></a>00118             <span class="keywordflow">return</span>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120         <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> keyListItem;
<a name="l00121"></a>00121         uint32_t maximumTries = 20;
<a name="l00122"></a>00122         <span class="comment">// pic a search key we are not already searching</span>
<a name="l00123"></a>00123         <span class="keywordflow">do</span> {
<a name="l00124"></a>00124             <span class="keywordflow">if</span> (maximumTries-- == 0)
<a name="l00125"></a>00125                 <span class="keywordflow">break</span>;
<a name="l00126"></a>00126             keyListItem = <a class="code" href="classBaseApp.html#ac8a54fad527bfd03a05ee6aed434243e" title="pointer to GlobalNodeList in this node">globalNodeList</a>-&gt;<a class="code" href="classGlobalNodeList.html#a3f0f5fadca707a4702a15ad5f46b3502" title="Returns random key from list.">getRandomKeyListItem</a>();
<a name="l00127"></a>00127         } <span class="keywordflow">while</span> ((keyListItem.<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>())
<a name="l00128"></a>00128                  &amp;&amp; ((<a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a>-&gt;<a class="code" href="classSearchMsgBookkeeping.html#a219d034f498b60d4239d6c12a5b8648b" title="checks if Search-Message-Bookkeeping-List contains a specified key">contains</a>(keyListItem))));
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keywordflow">if</span> (!keyListItem.<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>()) {
<a name="l00131"></a>00131             <span class="comment">// create message</span>
<a name="l00132"></a>00132             <a class="code" href="classGIAsearch.html" title="Class generated from common/ExtAPIMessages.msg by opp_msgc.">GIAsearch</a>* getMsg = <span class="keyword">new</span> <a class="code" href="classGIAsearch.html" title="Class generated from common/ExtAPIMessages.msg by opp_msgc.">GIAsearch</a>(<span class="stringliteral">&quot;GIA-Search&quot;</span>);
<a name="l00133"></a>00133             getMsg-&gt;<a class="code" href="classGIASearchAppMessage.html#a0bb9a13bf28291e57db3e95d8c3e1589">setCommand</a>(<a class="code" href="ExtAPIMessages__m_8h.html#a682fe177714e5c2639d8d79f943b9bd9a45a10c8ce4e9f59500b40cff0f8e89f6">GIA_SEARCH</a>);
<a name="l00134"></a>00134             getMsg-&gt;<a class="code" href="classGIAsearch.html#a98632c52470d8864ee0b49caab65f369">setSearchKey</a>(keyListItem);
<a name="l00135"></a>00135             getMsg-&gt;<a class="code" href="classGIAsearch.html#a73de6ac81661e9c05ffcf9f618e7cf5f">setMaxResponses</a>(<a class="code" href="classGIASearchApp.html#ae8d1b331f3250137e39545a92deea328" title="maximum number of responses per search message">maxResponses</a>);
<a name="l00136"></a>00136             getMsg-&gt;setBitLength(<a class="code" href="ExtAPIMessages__m_8h.html#abd649ca5d2dd3fc482850b5fbc25c984">GIAGET_L</a>(getMsg));
<a name="l00137"></a>00137 
<a name="l00138"></a>00138             <a class="code" href="classBaseApp.html#a9757b716a23dcd65d43f4fd704243ad2" title="sends non-commonAPI message to the lower tier">sendMessageToLowerTier</a>(getMsg);
<a name="l00139"></a>00139 
<a name="l00140"></a>00140             <span class="comment">// add search key to our bookkeeping list</span>
<a name="l00141"></a>00141             <a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a>-&gt;<a class="code" href="classSearchMsgBookkeeping.html#acbf4f716346c769de6c873f3f2c22b76" title="Add SearchMessage to SearchMsgBookkeeping.">addMessage</a>(keyListItem);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143             <span class="keywordflow">if</span> (<a class="code" href="classBaseApp.html#afbdeb4fb8c437056bb934cca461e89b4" title="debug output yes/no?">debugOutput</a>)
<a name="l00144"></a>00144                 EV &lt;&lt; <span class="stringliteral">&quot;[GIASearchApp::handleTimerEvent() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()&lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00145"></a>00145                    &lt;&lt; <span class="stringliteral">&quot;    Node sent get-message to overlay.&quot;</span>
<a name="l00146"></a>00146                    &lt;&lt; endl;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148             <a class="code" href="classGIASearchApp.html#a084a484607853fca6a08244c8307ac80" title="number of search-Messages sent">stat_searchMessagesSent</a>++;
<a name="l00149"></a>00149             <a class="code" href="classGIASearchApp.html#a250fe0d635c647055f1d4d4583de5c95" title="number of search-Messages-Bytes sent">stat_searchBytesSent</a> += getMsg-&gt;getByteLength();
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="classGIASearchApp.html#a0a0abd0bf69111c0619e1c33977734d9">00154</a> <span class="keywordtype">void</span> <a class="code" href="classGIASearchApp.html#a0a0abd0bf69111c0619e1c33977734d9" title="processes self-messages">GIASearchApp::handleLowerMessage</a>(cMessage* msg)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156     <a class="code" href="classGIAanswer.html" title="Class generated from common/ExtAPIMessages.msg by opp_msgc.">GIAanswer</a>* answer = check_and_cast&lt;<a class="code" href="classGIAanswer.html" title="Class generated from common/ExtAPIMessages.msg by opp_msgc.">GIAanswer</a>*&gt;(msg);
<a name="l00157"></a>00157     <a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>* overlayCtrlInfo =
<a name="l00158"></a>00158         check_and_cast&lt;<a class="code" href="classOverlayCtrlInfo.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">OverlayCtrlInfo</a>*&gt;(answer-&gt;removeControlInfo());
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> searchKey = answer-&gt;<a class="code" href="classGIAanswer.html#aa6aa9ecc628ab6eb128a2648155b673f">getSearchKey</a>();
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (<a class="code" href="classBaseApp.html#afbdeb4fb8c437056bb934cca461e89b4" title="debug output yes/no?">debugOutput</a>)
<a name="l00163"></a>00163         EV &lt;&lt; <span class="stringliteral">&quot;[GIASearchApp::handleLowerMessage() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()&lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00164"></a>00164            &lt;&lt; <span class="stringliteral">&quot;    Node received answer-message from overlay:&quot;</span>
<a name="l00165"></a>00165            &lt;&lt; <span class="stringliteral">&quot; (key: &quot;</span> &lt;&lt; searchKey
<a name="l00166"></a>00166            &lt;&lt; <span class="stringliteral">&quot; at node &quot;</span> &lt;&lt; answer-&gt;<a class="code" href="classGIAanswer.html#a04c6fe7c8e29695c62949f048ac78bcc">getNode</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>
<a name="l00167"></a>00167            &lt;&lt; endl;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <a class="code" href="classGIASearchApp.html#a7aac11f63657c1dcf66770272abcb62e" title="number of received search-Response-Messages">stat_searchResponseMessages</a>++;
<a name="l00170"></a>00170     <a class="code" href="classGIASearchApp.html#ac31f7331289a21522adced2203828a69" title="number of received search-Response-Messages-Bytes">stat_searchResponseBytes</a> += answer-&gt;getByteLength();
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (<a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a>-&gt;<a class="code" href="classSearchMsgBookkeeping.html#a219d034f498b60d4239d6c12a5b8648b" title="checks if Search-Message-Bookkeeping-List contains a specified key">contains</a>(searchKey))
<a name="l00173"></a>00173         <a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a>-&gt;<a class="code" href="classSearchMsgBookkeeping.html#a093876a9d25e0ebf5198f14b8b6c30e8" title="Updates hop-count, min-response-delay, max-response-delay of given searchMessage.">updateItem</a>(searchKey, overlayCtrlInfo-&gt;getHopCount());
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="keyword">delete</span> answer;
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="classGIASearchApp.html#ab83936cef7f46a42574258a74d843abc">00178</a> <span class="keywordtype">void</span> <a class="code" href="classGIASearchApp.html#ab83936cef7f46a42574258a74d843abc" title="collects statistical data">GIASearchApp::finishApp</a>()
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180     <span class="comment">// record scalar data</span>
<a name="l00181"></a>00181     <a class="code" href="structGiaSearchStats.html" title="struct for average statistical values of search messages and responses">GiaSearchStats</a> <a class="code" href="I3LatencyStretch_8cc.html#a7ed8351ae8a180bc15f7755236dc19b0">stats</a> = <a class="code" href="classGIASearchApp.html#a49bce56857b0e1de7e23ea5f3497d92b" title="pointer to Search-Message-Bookkeeping-List in this node">srMsgBook</a>-&gt;<a class="code" href="classSearchMsgBookkeeping.html#a403f96d3c12039a462cbeb8701fdc8e8" title="Returns statistical data.">getStatisticalData</a>();
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (stats.<a class="code" href="structGiaSearchStats.html#a8a61425ca81150ccb07068823ae2b1eb" title="average minimum delay of all response messages">minDelay</a> == 0 &amp;&amp;
<a name="l00184"></a>00184         stats.<a class="code" href="structGiaSearchStats.html#a48b98e853d4ec223ded974f104d3317e" title="average maximum delay of all response messages">maxDelay</a> == 0 &amp;&amp;
<a name="l00185"></a>00185         stats.<a class="code" href="structGiaSearchStats.html#af1179ea604e203bad24c61941e85321e" title="average minimum hop count of all response messages">minHopCount</a> == 0 &amp;&amp;
<a name="l00186"></a>00186         stats.<a class="code" href="structGiaSearchStats.html#a53ff21a1bb09949ecd26d85810f59478" title="average maximum hop count of all response messages">maxHopCount</a> == 0 &amp;&amp;
<a name="l00187"></a>00187         stats.<a class="code" href="structGiaSearchStats.html#abede1724efeff8bbdfbc03eb1da5d7d3" title="average number of response messages for all search messages">responseCount</a> == 0) <span class="keywordflow">return</span>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189         <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;GIASearchApp: SearchMsg avg. min delay&quot;</span>,
<a name="l00190"></a>00190                                     stats.<a class="code" href="structGiaSearchStats.html#a8a61425ca81150ccb07068823ae2b1eb" title="average minimum delay of all response messages">minDelay</a>);
<a name="l00191"></a>00191     <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;GIASearchApp: SearchMsg avg. max delay&quot;</span>,
<a name="l00192"></a>00192                                 stats.<a class="code" href="structGiaSearchStats.html#a48b98e853d4ec223ded974f104d3317e" title="average maximum delay of all response messages">maxDelay</a>);
<a name="l00193"></a>00193     <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;GIASearchApp: SearchMsg avg. min hops&quot;</span>,
<a name="l00194"></a>00194                                 stats.<a class="code" href="structGiaSearchStats.html#af1179ea604e203bad24c61941e85321e" title="average minimum hop count of all response messages">minHopCount</a>);
<a name="l00195"></a>00195     <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;GIASearchApp: SearchMsg avg. max hops&quot;</span>,
<a name="l00196"></a>00196                                 stats.<a class="code" href="structGiaSearchStats.html#a53ff21a1bb09949ecd26d85810f59478" title="average maximum hop count of all response messages">maxHopCount</a>);
<a name="l00197"></a>00197     <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;GIASearchApp: SearchMsg avg. response count&quot;</span>,
<a name="l00198"></a>00198                                 stats.<a class="code" href="structGiaSearchStats.html#abede1724efeff8bbdfbc03eb1da5d7d3" title="average number of response messages for all search messages">responseCount</a>);
<a name="l00199"></a>00199 }
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="GIASearchApp_8cc.html">GIASearchApp.cc</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:27 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
