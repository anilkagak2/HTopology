<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: DHT Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OverSim
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classDHT.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">DHT Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="DHT" --><!-- doxytag: inherits="BaseApp" -->
<p>A Distributed Hash Table (<a class="el" href="classDHT.html" title="A Distributed Hash Table (DHT) for KBR protocols.">DHT</a>) for KBR protocols.  
 <a href="classDHT.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="DHT_8h_source.html">DHT.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for DHT:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classDHT.png" usemap="#DHT_map" alt=""/>
  <map id="DHT_map" name="DHT_map">
<area href="classBaseApp.html" title="Base class for applications." alt="BaseApp" shape="rect" coords="57,112,162,136"/>
<area href="classBaseRpc.html" title="Base class for RPCs." alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classRpcListener.html" title="A Remote-Procedure-Call listener class." alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
 </div></div>

<p><a href="classDHT-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT_1_1PendingRpcsEntry.html">PendingRpcsEntry</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#addc81efbe31ac923b054636f675a2d8b">DHT</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#aa3034e0207490f85b581a7700547d225">~DHT</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7">PendingRpcsStates</a> { <br/>
&#160;&#160;<a class="el" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7af7d775be403b3cddf528a88b080a4713">INIT</a> =  0, 
<a class="el" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7ac78fe45a5d659c6f0b23cc3fe56e8e1d">LOOKUP_STARTED</a> =  1, 
<a class="el" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a88f599ef4e7b453e944009ebf52dfee5">GET_HASH_SENT</a> =  2, 
<a class="el" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a473a1789e01de139a5504ffa3ed03031">GET_VALUE_SENT</a> =  3, 
<br/>
&#160;&#160;<a class="el" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a3407ec6201483d0a27baf97d14e43db1">PUT_SENT</a> =  4
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef std::map&lt; uint32_t, <br class="typebreak"/>
<a class="el" href="classDHT_1_1PendingRpcsEntry.html">PendingRpcsEntry</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#ae5497677deb08feaaad5ccd5ce35e997">PendingRpcs</a></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a4f00d82a6ffb8c07887443d9f713e93e">initializeApp</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">initializes derived class-attributes  <a href="#a4f00d82a6ffb8c07887443d9f713e93e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#afaa8018480ec48e5fe531e6b7405e816">finishApp</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">collects statistical data of derived app  <a href="#afaa8018480ec48e5fe531e6b7405e816"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a6ae0227d1adcc58e0cc6a8a08222d39f">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a1be3042a36d8f9bd6986effd9599da70">handleRpcCall</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes Remote-Procedure-Call invocation messages.  <a href="#a1be3042a36d8f9bd6986effd9599da70"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a372f6f5fd02b9fa01cce1d9a158dcc4b">handleRpcResponse</a> (<a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *msg, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC response has been received.  <a href="#a372f6f5fd02b9fa01cce1d9a158dcc4b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a909b3678f0097e4b33811c7a30042e8d">handleRpcTimeout</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, cPolymorphic *context, int rpcId, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;destKey)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called if an RPC timeout has been reached.  <a href="#a909b3678f0097e4b33811c7a30042e8d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#aa6b15162da48bb0c982ee87aa1ae1c8a">handlePutRequest</a> (<a class="el" href="classDHTPutCall.html">DHTPutCall</a> *dhtMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a3d75f9feb24018644f778d5b34af6b48">handleGetRequest</a> (<a class="el" href="classDHTGetCall.html">DHTGetCall</a> *dhtMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#af1537f9c596e0d55c35ca8dcb7c17ba6">handlePutResponse</a> (<a class="el" href="classDHTPutResponse.html">DHTPutResponse</a> *dhtMsg, int rpcId)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#ad799b7d64e238b4224409d6fe3a18b14">handleGetResponse</a> (<a class="el" href="classDHTGetResponse.html">DHTGetResponse</a> *dhtMsg, int rpcId)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a700a39d93f2e46ecf7e1e26e43a137bd">handlePutCAPIRequest</a> (<a class="el" href="classDHTputCAPICall.html">DHTputCAPICall</a> *capiPutMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#adcb133efa64eda79fe4f0d569c124e8f">handleGetCAPIRequest</a> (<a class="el" href="classDHTgetCAPICall.html">DHTgetCAPICall</a> *capiPutMsg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#aa52a4a6fa8dd6604d5be1cec488ec434">handleDumpDhtRequest</a> (<a class="el" href="classDHTdumpCall.html">DHTdumpCall</a> *call)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a556af7f1688e60e7bf5bc0116ea0beee">update</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node, bool joined)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Common API function: informs application about neighbors and own nodeID.  <a href="#a556af7f1688e60e7bf5bc0116ea0beee"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a33ea03bbf62bf2c7c0278e3da90e4576">handleLookupResponse</a> (<a class="el" href="classLookupResponse.html">LookupResponse</a> *lookupMsg, int rpcId)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a054905e16db8c3d5d0b1d8176596c08c">sendMaintenancePutCall</a> (const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, const <a class="el" href="structDhtDataEntry.html">DhtDataEntry</a> &amp;entry)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#ae3ad9322668ae87b0c194d9c63d08ff6">resultValuesBitLength</a> (<a class="el" href="classDHTGetResponse.html">DHTGetResponse</a> *msg)</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a21217d399a3e2f94569c794da5004421">numReplica</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#ab7bfedf297279702d3f5c4a936eb0f72">numGetRequests</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a28445696afa54db8a4794b797c424036">ratioIdentical</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#ad595de501119a833c0c4bbeb9c487f3e">maintenanceMessages</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#af9266b896acc3c51884ba59ae9d70ddd">numBytesMaintenance</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">numBytesNormal</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a6591add2e5cbc7ec8d203013cb110d04">secureMaintenance</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">use a secure maintenance algorithm based on majority decisions  <a href="#a6591add2e5cbc7ec8d203013cb110d04"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#aa4de4acb0b1da732f694a264a0d39f0f">invalidDataAttack</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">if node is malicious, it tries a invalidData attack  <a href="#aa4de4acb0b1da732f694a264a0d39f0f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a00089eecdb5a795e06d659fec0b80e28">maintenanceAttack</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">if node is malicious, it tries a maintenanceData attack  <a href="#a00089eecdb5a795e06d659fec0b80e28"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDHT.html#ae5497677deb08feaaad5ccd5ce35e997">PendingRpcs</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e">pendingRpcs</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">a map of all pending RPC operations  <a href="#a4dca98dd57d5bce189c6dc81a9ddb24e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDHTDataStorage.html">DHTDataStorage</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc">dataStorage</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pointer to the dht data storage  <a href="#ab4d69aef76faee2c8f456605e1fac5bc"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classDHT.html#ab7c8797381ca1362bb552d1535f50d1d">operator&lt;&lt;</a> (std::ostream &amp;Stream, const <a class="el" href="classDHT_1_1PendingRpcsEntry.html">PendingRpcsEntry</a> &amp;entry)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>A Distributed Hash Table (<a class="el" href="classDHT.html" title="A Distributed Hash Table (DHT) for KBR protocols.">DHT</a>) for KBR protocols. </p>
<p>A Distributed Hash Table (<a class="el" href="classDHT.html" title="A Distributed Hash Table (DHT) for KBR protocols.">DHT</a>) for KBR protocols </p>

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00044">44</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>
</div><hr/><h2>Member Typedef Documentation</h2>
<a class="anchor" id="ae5497677deb08feaaad5ccd5ce35e997"></a><!-- doxytag: member="DHT::PendingRpcs" ref="ae5497677deb08feaaad5ccd5ce35e997" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::map&lt;uint32_t, <a class="el" href="classDHT_1_1PendingRpcsEntry.html">PendingRpcsEntry</a>&gt; <a class="el" href="classDHT.html#ae5497677deb08feaaad5ccd5ce35e997">DHT::PendingRpcs</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00125">125</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="a63fbad6b0540beae9d4bd8b3cce7abb7"></a><!-- doxytag: member="DHT::PendingRpcsStates" ref="a63fbad6b0540beae9d4bd8b3cce7abb7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7">DHT::PendingRpcsStates</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a63fbad6b0540beae9d4bd8b3cce7abb7af7d775be403b3cddf528a88b080a4713"></a><!-- doxytag: member="INIT" ref="a63fbad6b0540beae9d4bd8b3cce7abb7af7d775be403b3cddf528a88b080a4713" args="" -->INIT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a63fbad6b0540beae9d4bd8b3cce7abb7ac78fe45a5d659c6f0b23cc3fe56e8e1d"></a><!-- doxytag: member="LOOKUP_STARTED" ref="a63fbad6b0540beae9d4bd8b3cce7abb7ac78fe45a5d659c6f0b23cc3fe56e8e1d" args="" -->LOOKUP_STARTED</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a63fbad6b0540beae9d4bd8b3cce7abb7a88f599ef4e7b453e944009ebf52dfee5"></a><!-- doxytag: member="GET_HASH_SENT" ref="a63fbad6b0540beae9d4bd8b3cce7abb7a88f599ef4e7b453e944009ebf52dfee5" args="" -->GET_HASH_SENT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a63fbad6b0540beae9d4bd8b3cce7abb7a473a1789e01de139a5504ffa3ed03031"></a><!-- doxytag: member="GET_VALUE_SENT" ref="a63fbad6b0540beae9d4bd8b3cce7abb7a473a1789e01de139a5504ffa3ed03031" args="" -->GET_VALUE_SENT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a63fbad6b0540beae9d4bd8b3cce7abb7a3407ec6201483d0a27baf97d14e43db1"></a><!-- doxytag: member="PUT_SENT" ref="a63fbad6b0540beae9d4bd8b3cce7abb7a3407ec6201483d0a27baf97d14e43db1" args="" -->PUT_SENT</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00051">51</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>
<div class="fragment"><pre class="fragment">                           {
        <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7af7d775be403b3cddf528a88b080a4713">INIT</a> = 0,
        <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7ac78fe45a5d659c6f0b23cc3fe56e8e1d">LOOKUP_STARTED</a> = 1,
        <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a88f599ef4e7b453e944009ebf52dfee5">GET_HASH_SENT</a> = 2,
        <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a473a1789e01de139a5504ffa3ed03031">GET_VALUE_SENT</a> = 3,
        <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a3407ec6201483d0a27baf97d14e43db1">PUT_SENT</a> = 4
    };
</pre></div>
</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="addc81efbe31ac923b054636f675a2d8b"></a><!-- doxytag: member="DHT::DHT" ref="addc81efbe31ac923b054636f675a2d8b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DHT::DHT </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00036">36</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a> = NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa3034e0207490f85b581a7700547d225"></a><!-- doxytag: member="DHT::~DHT" ref="aa3034e0207490f85b581a7700547d225" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DHT::~DHT </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00041">41</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    PendingRpcs::iterator it;

    <span class="keywordflow">for</span> (it = <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.begin(); it != <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.end(); it++) {
        <span class="keyword">delete</span>(it-&gt;second.putCallMsg);
        <span class="keyword">delete</span>(it-&gt;second.getCallMsg);
    }

    <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.clear();

    <span class="keywordflow">if</span> (<a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a> != NULL) {
        <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a8b9558b53b6c7d64aa82bed6662a74b2" title="Clears all stored data items.">clear</a>();
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="afaa8018480ec48e5fe531e6b7405e816"></a><!-- doxytag: member="DHT::finishApp" ref="afaa8018480ec48e5fe531e6b7405e816" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::finishApp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collects statistical data of derived app </p>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a9702f80de642a3e090aaf5bedea8e4a6">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00927">927</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    simtime_t time = <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a610799ebfbf64696c59b811870cc8300">calcMeasuredLifetime</a>(<a class="code" href="classBaseApp.html#ac365b8c1cb45fb1e37f95535936a0f31" title="simTime when the App has been created">creationTime</a>);

    <span class="keywordflow">if</span> (time &gt;= <a class="code" href="classGlobalStatistics.html#a169810c78519b271f7e32fdc7c9fc641" title="minimum useful measured lifetime in seconds">GlobalStatistics::MIN_MEASURED</a>) {
        <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;DHT: Sent Maintenance Messages/s&quot;</span>,
                                    <a class="code" href="classDHT.html#ad595de501119a833c0c4bbeb9c487f3e">maintenanceMessages</a> / time);
        <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;DHT: Sent Normal Messages/s&quot;</span>,
                                    <a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a> / time);
        <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;DHT: Sent Maintenance Bytes/s&quot;</span>,
                                    <a class="code" href="classDHT.html#af9266b896acc3c51884ba59ae9d70ddd">numBytesMaintenance</a> / time);
        <a class="code" href="classBaseApp.html#a70bdab2d4ea3553205115f057194f692" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;DHT: Sent Normal Bytes/s&quot;</span>,
                                    <a class="code" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">numBytesNormal</a> / time);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa52a4a6fa8dd6604d5be1cec488ec434"></a><!-- doxytag: member="DHT::handleDumpDhtRequest" ref="aa52a4a6fa8dd6604d5be1cec488ec434" args="(DHTdumpCall *call)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handleDumpDhtRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTdumpCall.html">DHTdumpCall</a> *&#160;</td>
          <td class="paramname"><em>call</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00515">515</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classDHTdumpResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTdumpResponse</a>* response = <span class="keyword">new</span> <a class="code" href="classDHTdumpResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTdumpResponse</a>();
    <a class="code" href="DHTDataStorage_8h.html#ae1791efbd50a05f79354e7b6444044ff">DhtDumpVector</a>* dumpVector = <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#ab8425aa4123fc352970c78f1890c08c4" title="Dump filtered local data records into a vector.">dumpDht</a>();

    response-&gt;<a class="code" href="classDHTdumpResponse.html#a8f1afdbe3bd1ec96597a35d97cb0b338">setRecordArraySize</a>(dumpVector-&gt;size());

    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; dumpVector-&gt;size(); i++) {
        response-&gt;<a class="code" href="classDHTdumpResponse.html#adf0d878708681db4e8108b64ee4146b1">setRecord</a>(i, (*dumpVector)[i]);
    }

    <span class="keyword">delete</span> dumpVector;

    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(call, response);
}
</pre></div>
</div>
</div>
<a class="anchor" id="adcb133efa64eda79fe4f0d569c124e8f"></a><!-- doxytag: member="DHT::handleGetCAPIRequest" ref="adcb133efa64eda79fe4f0d569c124e8f" args="(DHTgetCAPICall *capiPutMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handleGetCAPIRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTgetCAPICall.html">DHTgetCAPICall</a> *&#160;</td>
          <td class="paramname"><em>capiPutMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00501">501</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>* lookupCall = <span class="keyword">new</span> <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>();
    lookupCall-&gt;<a class="code" href="classLookupCall.html#ac9cfcf7fe5298270b6b3898b65541a4b">setKey</a>(capiGetMsg-&gt;getKey());
    lookupCall-&gt;<a class="code" href="classLookupCall.html#a1a365b8c947e000203e7fdc144715c2b">setNumSiblings</a>(<a class="code" href="classDHT.html#a21217d399a3e2f94569c794da5004421">numReplica</a>);
    <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, lookupCall, NULL, -1, 0,
                        capiGetMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());

    PendingRpcsEntry entry;
    entry.getCallMsg = capiGetMsg;
    entry.state = <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7ac78fe45a5d659c6f0b23cc3fe56e8e1d">LOOKUP_STARTED</a>;
    <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.insert(make_pair(capiGetMsg-&gt;getNonce(), entry));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3d75f9feb24018644f778d5b34af6b48"></a><!-- doxytag: member="DHT::handleGetRequest" ref="a3d75f9feb24018644f778d5b34af6b48" args="(DHTGetCall *dhtMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handleGetRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTGetCall.html">DHTGetCall</a> *&#160;</td>
          <td class="paramname"><em>dhtMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00417">417</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::string tempString = <span class="stringliteral">&quot;GET_REQUEST received: &quot;</span>
            + std::string(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16));

    getParentModule()-&gt;getParentModule()-&gt;bubble(tempString.c_str());

    <span class="keywordflow">if</span> (dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>().<a class="code" href="classOverlayKey.html#abe357a4d1babcf7d30598a61cbc0f5c2" title="Returns true, if the key is unspecified.">isUnspecified</a>()) {
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;DHT::handleGetRequest: Unspecified key!&quot;</span>);
    }

    <a class="code" href="DHTDataStorage_8h.html#ae1791efbd50a05f79354e7b6444044ff">DhtDumpVector</a>* dataVect = <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#ab8425aa4123fc352970c78f1890c08c4" title="Dump filtered local data records into a vector.">dumpDht</a>(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>(),
                                                   dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a8b8cd67ab10816f8b9ab698eaec7e0b6">getKind</a>(),
                                                   dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#aa58e5076f3a81740ba7c2e3fc0d32600">getId</a>());

    <span class="keywordflow">if</span> (<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#a234b046348574d37d811638f0b27a89e" title="Returns true, if node is malicious.">isMalicious</a>() &amp;&amp; <a class="code" href="classDHT.html#aa4de4acb0b1da732f694a264a0d39f0f" title="if node is malicious, it tries a invalidData attack">invalidDataAttack</a>) {
        dataVect-&gt;resize(1);
        dataVect-&gt;at(0).setKey(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>());
        dataVect-&gt;at(0).setKind(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a8b8cd67ab10816f8b9ab698eaec7e0b6">getKind</a>());
        dataVect-&gt;at(0).setId(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#aa58e5076f3a81740ba7c2e3fc0d32600">getId</a>());
        dataVect-&gt;at(0).setValue(<span class="stringliteral">&quot;Modified Data&quot;</span>);
        dataVect-&gt;at(0).setTtl(3600*24*365);
        dataVect-&gt;at(0).setOwnerNode(<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>());
        dataVect-&gt;at(0).setIs_modifiable(<span class="keyword">false</span>);
        dataVect-&gt;at(0).setResponsible(<span class="keyword">true</span>);
    }

    <span class="comment">// send back</span>
    <a class="code" href="classDHTGetResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetResponse</a>* responseMsg = <span class="keyword">new</span> <a class="code" href="classDHTGetResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetResponse</a>();
    responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#aee599fbcfde0d48bd33c3d05c3691311">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ae7300c27dba6548b319891576ba898b4">getKey</a>());
    responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#a5b5e75da024693e50e01f6947e39f44d">setIsHash</a>(dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ac52e61dc1d12527bd7d069f43337caf3">getIsHash</a>());

    <span class="keywordflow">if</span> (dataVect-&gt;size() == 0) {
        responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#a38d5430b7f4a4c8eb1ad0df0e48a78f9">setHashValue</a>(<a class="code" href="classBinaryValue.html#a895c82622c044fbc70da7c18e3ce87b9">BinaryValue::UNSPECIFIED_VALUE</a>);
        responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#ad2917319ae1b35ef9ba01959a544278e">setResultArraySize</a>(0);
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">if</span> (dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#ac52e61dc1d12527bd7d069f43337caf3">getIsHash</a>()) {
            <span class="comment">// TODO: verify this</span>
            <a class="code" href="classBinaryValue.html">BinaryValue</a> resultValues;
            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; dataVect-&gt;size(); i++) {
                resultValues += (*dataVect)[i].getValue();
            }

            <a class="code" href="classCSHA1.html">CSHA1</a> sha1;
            <a class="code" href="classBinaryValue.html">BinaryValue</a> hashValue(20);
            sha1.<a class="code" href="classCSHA1.html#a2473fd69604fc762000247867830c2a0">Reset</a>();
            sha1.<a class="code" href="classCSHA1.html#a59536022ba64be584aed79c28f78d84c">Update</a>((uint8_t*) (&amp;(*resultValues.begin())),
                        resultValues.size());
            sha1.<a class="code" href="classCSHA1.html#afbdaab3f2a2946d26a6144af3fec5fd8">Final</a>();
            sha1.<a class="code" href="classCSHA1.html#a736d60c74d29c605c5e62b3095ab7405">GetHash</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)&amp;hashValue[0]);

            responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#a38d5430b7f4a4c8eb1ad0df0e48a78f9">setHashValue</a>(hashValue);
        } <span class="keywordflow">else</span> {
            responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#ad2917319ae1b35ef9ba01959a544278e">setResultArraySize</a>(dataVect-&gt;size());

            <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; dataVect-&gt;size(); i++) {
                responseMsg-&gt;<a class="code" href="classDHTGetResponse.html#a1fd72ab9b816511ddc04852a98f440ea">setResult</a>(i, (*dataVect)[i]);
            }

        }
    }
    <span class="keyword">delete</span> dataVect;

    responseMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#a4d1e9bd925aefbe37e7efbc528004a78">GETRESPONSE_L</a>(responseMsg));
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++;
                 <a class="code" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">numBytesNormal</a> += responseMsg-&gt;getByteLength());
    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(dhtMsg, responseMsg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad799b7d64e238b4224409d6fe3a18b14"></a><!-- doxytag: member="DHT::handleGetResponse" ref="ad799b7d64e238b4224409d6fe3a18b14" args="(DHTGetResponse *dhtMsg, int rpcId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handleGetResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTGetResponse.html">DHTGetResponse</a> *&#160;</td>
          <td class="paramname"><em>dhtMsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00555">555</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classBaseKeySortedVector.html">NodeVector</a>* hashVector = NULL;
    PendingRpcs::iterator it = <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.find(rpcId);

    <span class="keywordflow">if</span> (it == <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.end()) <span class="comment">// unknown request</span>
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (it-&gt;second.state == <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a473a1789e01de139a5504ffa3ed03031">GET_VALUE_SENT</a>) {
        <span class="comment">// we have sent a &#39;real&#39; get request</span>
        <span class="keywordflow">if</span> (!dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#aca5249d6e9d6701d4c33ac69abff0775">getIsHash</a>()) {
            <span class="comment">// TODO verify hash</span>
            <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#a4c40ba014acb1bc5a2f4cdfca0893159">setResultArraySize</a>(dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a81808e33769d67b6ae7e6d99ae77d87f">getResultArraySize</a>());
            <span class="keywordflow">for</span> (uint i = 0; i &lt; dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a81808e33769d67b6ae7e6d99ae77d87f">getResultArraySize</a>(); i++) {
                capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#aa3180b2feb0fba62d21832932d7dd03d">setResult</a>(i, dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a96e395ff8f99931e27815f6d6c33ce00">getResult</a>(i));
            }
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#ab11c85724ad974880150524aa8ecd777">setIsSuccess</a>(<span class="keyword">true</span>);
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it-&gt;second.getCallMsg, capiGetRespMsg);
            <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.erase(rpcId);
            <span class="keywordflow">return</span>;
        }
    }

    <span class="keywordflow">if</span> (dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#aca5249d6e9d6701d4c33ac69abff0775">getIsHash</a>()) {
        std::map&lt;BinaryValue, NodeVector&gt;::iterator itHashes =
            it-&gt;second.hashes.find(dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a41a43da2058b0dba9eebfa42f89b9b8f">getHashValue</a>());

        <span class="keywordflow">if</span> (itHashes == it-&gt;second.hashes.end()) {
            <span class="comment">// new hash</span>
            <a class="code" href="classBaseKeySortedVector.html">NodeVector</a> vect;
            vect.push_back(dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>());
            it-&gt;second.hashes.insert(make_pair(dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a41a43da2058b0dba9eebfa42f89b9b8f">getHashValue</a>(),
                                               vect));
        } <span class="keywordflow">else</span> {
            itHashes-&gt;second.push_back(dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>());
        }

        it-&gt;second.numResponses++;

        <span class="keywordflow">if</span> (it-&gt;second.state == <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a473a1789e01de139a5504ffa3ed03031">GET_VALUE_SENT</a>) {
            <span class="comment">// we have already sent a real get request</span>
            <span class="keywordflow">return</span>;
        }

        <span class="comment">// count the maximum number of equal hash values received so far</span>
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxCount = 0;


        <span class="keywordflow">for</span> (itHashes = it-&gt;second.hashes.begin();
        itHashes != it-&gt;second.hashes.end(); itHashes++) {

            <span class="keywordflow">if</span> (itHashes-&gt;second.size() &gt; maxCount) {
                maxCount = itHashes-&gt;second.size();
                hashVector = &amp;(itHashes-&gt;second);
            }
        }

        <span class="keywordflow">if</span> ((<span class="keywordtype">double</span>) maxCount / (double) it-&gt;second.numAvailableReplica
                &gt;= <a class="code" href="classDHT.html#a28445696afa54db8a4794b797c424036">ratioIdentical</a>) {
            it-&gt;second.hashVector = hashVector;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it-&gt;second.numResponses &gt;= <a class="code" href="classDHT.html#ab7bfedf297279702d3f5c4a936eb0f72">numGetRequests</a>) {
            <span class="comment">// we&#39;ll try to ask some other nodes</span>
            <span class="keywordflow">if</span> (it-&gt;second.replica.size() &gt; 0) {
                <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>* getCall = <span class="keyword">new</span> <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>();
                getCall-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(it-&gt;second.getCallMsg-&gt;getKey());
                getCall-&gt;<a class="code" href="classDHTGetCall.html#a1f1372d79e99d1b20a5b3e5bddecefba">setKind</a>(it-&gt;second.getCallMsg-&gt;getKind());
                getCall-&gt;<a class="code" href="classDHTGetCall.html#af169c73b1cd80f669a2f20aace5e8ed0">setId</a>(it-&gt;second.getCallMsg-&gt;getId());
                getCall-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">true</span>);
                getCall-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(getCall));
                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++;
                <a class="code" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">numBytesNormal</a> += getCall-&gt;getByteLength());
                <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>,
                                 it-&gt;second.replica.back(), getCall,
                                 NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1, 0, rpcId);
                it-&gt;second.replica.pop_back();
                it-&gt;second.state = <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a88f599ef4e7b453e944009ebf52dfee5">GET_HASH_SENT</a>;
            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hashVector == NULL) {
                <span class="comment">// we don&#39;t have anyone else to ask and no hash</span>
                <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg =
                    <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
                <a class="code" href="classDhtDumpEntry.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DhtDumpEntry</a> result;
                result.<a class="code" href="classDhtDumpEntry.html#a05c7cf256b17d3736505ab9c67b6f45a">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTGetResponse.html#a37506a19478fa27760f4e4b5a8869101">getKey</a>());
                result.<a class="code" href="classDhtDumpEntry.html#a2683c4e8c0b12acfd3cb342c6f0e0412">setValue</a>(<a class="code" href="classBinaryValue.html#a895c82622c044fbc70da7c18e3ce87b9">BinaryValue::UNSPECIFIED_VALUE</a>);
                capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#a4c40ba014acb1bc5a2f4cdfca0893159">setResultArraySize</a>(1);
                capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#aa3180b2feb0fba62d21832932d7dd03d">setResult</a>(0, result);
                capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#ab11c85724ad974880150524aa8ecd777">setIsSuccess</a>(<span class="keyword">false</span>);
                <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it-&gt;second.getCallMsg, capiGetRespMsg);
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>                cout &lt;&lt; <span class="stringliteral">&quot;DHT: GET failed: hash (no one else)&quot;</span> &lt;&lt; endl;
                cout &lt;&lt; <span class="stringliteral">&quot;numResponses: &quot;</span> &lt;&lt; it-&gt;second.numResponses
                     &lt;&lt; <span class="stringliteral">&quot; numAvailableReplica: &quot;</span> &lt;&lt; it-&gt;second.numAvailableReplica &lt;&lt; endl;

                <span class="keywordflow">for</span> (itHashes = it-&gt;second.hashes.begin();
                     itHashes != it-&gt;second.hashes.end(); itHashes++) {
                    cout &lt;&lt; <span class="stringliteral">&quot;   - &quot;</span> &lt;&lt; itHashes-&gt;first &lt;&lt; <span class="stringliteral">&quot; (&quot;</span>
                         &lt;&lt; itHashes-&gt;second.size() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
                }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
                <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.erase(rpcId);
                <span class="keywordflow">return</span>;
            } <span class="keywordflow">else</span> {
                <span class="comment">// we don&#39;t have anyone else to ask =&gt; take what we&#39;ve got</span>
                it-&gt;second.hashVector = hashVector;
            }
        }
    }

    <span class="keywordflow">if</span> ((it-&gt;second.state != <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a473a1789e01de139a5504ffa3ed03031">GET_VALUE_SENT</a>) &amp;&amp;
            (it-&gt;second.hashVector != NULL)) {
        <span class="comment">// we have already received all the response and chosen a hash</span>
        <span class="keywordflow">if</span> (it-&gt;second.hashVector-&gt;size() &gt; 0) {
            <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>* getCall = <span class="keyword">new</span> <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>();
            getCall-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(it-&gt;second.getCallMsg-&gt;getKey());
            getCall-&gt;<a class="code" href="classDHTGetCall.html#a1f1372d79e99d1b20a5b3e5bddecefba">setKind</a>(it-&gt;second.getCallMsg-&gt;getKind());
            getCall-&gt;<a class="code" href="classDHTGetCall.html#af169c73b1cd80f669a2f20aace5e8ed0">setId</a>(it-&gt;second.getCallMsg-&gt;getId());
            getCall-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">false</span>);
            getCall-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(getCall));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++;
                         numBytesNormal += getCall-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, it-&gt;second.hashVector-&gt;back(),
                             getCall, NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1, 0, rpcId);
            it-&gt;second.hashVector-&gt;pop_back();
            it-&gt;second.state = <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a473a1789e01de139a5504ffa3ed03031">GET_VALUE_SENT</a>;
        } <span class="keywordflow">else</span> { <span class="comment">// we don&#39;t have anyone else to ask</span>
            <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#a4c40ba014acb1bc5a2f4cdfca0893159">setResultArraySize</a>(0);
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it-&gt;second.getCallMsg, capiGetRespMsg);
            <span class="comment">//cout &lt;&lt; &quot;DHT: GET failed: hash2 (no one else)&quot; &lt;&lt; endl;</span>
            <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.erase(rpcId);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a33ea03bbf62bf2c7c0278e3da90e4576"></a><!-- doxytag: member="DHT::handleLookupResponse" ref="a33ea03bbf62bf2c7c0278e3da90e4576" args="(LookupResponse *lookupMsg, int rpcId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handleLookupResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classLookupResponse.html">LookupResponse</a> *&#160;</td>
          <td class="paramname"><em>lookupMsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00805">805</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    PendingRpcs::iterator it = <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.find(rpcId);

    <span class="keywordflow">if</span> (it == <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.end()) {
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (it-&gt;second.putCallMsg != NULL) {

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>        cout &lt;&lt; <span class="stringliteral">&quot;DHT::handleLookupResponse(): PUT &quot;</span>
             &lt;&lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span>
             &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>(); i++) {
            cout &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i) &lt;&lt; endl;
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        <span class="keywordflow">if</span> ((lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a86a9d5fd7849c18b989f2e5260cfbf12">getIsValid</a>() == <span class="keyword">false</span>)
                || (lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>() == 0)) {

            EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleLookupResponse()]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Unable to get replica list : invalid lookup&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>* capiPutRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>();
            capiPutRespMsg-&gt;<a class="code" href="classDHTputCAPIResponse.html#a2ad17ddcf6ecc8a47d5a8e3b7083cbce">setIsSuccess</a>(<span class="keyword">false</span>);
            <span class="comment">//cout &lt;&lt; &quot;DHT::lookup failed&quot; &lt;&lt; endl;</span>
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it-&gt;second.putCallMsg, capiPutRespMsg);
            <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.erase(rpcId);
            <span class="keywordflow">return</span>;
        }

        <span class="keywordflow">if</span> ((it-&gt;second.putCallMsg-&gt;getId() == 0) &amp;&amp;
                (it-&gt;second.putCallMsg-&gt;getValue().size() &gt; 0)) {
            <span class="comment">// pick a random id before replication of the data item</span>
            <span class="comment">// id 0 is kept for delete requests (i.e. a put with empty value)</span>
            it-&gt;second.putCallMsg-&gt;setId(intuniform(1, 2147483647));
        }

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>(); i++) {
            <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>* dhtMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>();
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#abccc8395b7208b7ac33ba1f03f78ddfe">setKey</a>(it-&gt;second.putCallMsg-&gt;getKey());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a627e5cb4626dd10d21b4e9ab6e044ec1">setKind</a>(it-&gt;second.putCallMsg-&gt;getKind());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a265b86acab1f9dfb5038e30b0f6f72d7">setId</a>(it-&gt;second.putCallMsg-&gt;getId());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aaf331ce0bc75e6f4bdd9a4f0453f44ed">setValue</a>(it-&gt;second.putCallMsg-&gt;getValue());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#ad477378656a109b12f08cda5d9ac59c1">setTtl</a>(it-&gt;second.putCallMsg-&gt;getTtl());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a4a7d0ab79090ca61a4afac26dd74b10d">setIsModifiable</a>(it-&gt;second.putCallMsg-&gt;getIsModifiable());
            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a37f2793eb1f6d4a666a79cbeef8e26ed">setMaintenance</a>(<span class="keyword">false</span>);
            dhtMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#add3d32552f5e0954f907fc1ece9d476d">PUTCALL_L</a>(dhtMsg));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++;
                         <a class="code" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">numBytesNormal</a> += dhtMsg-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i),
                             dhtMsg, NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1,
                             0, rpcId);
        }

        it-&gt;second.state = <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a3407ec6201483d0a27baf97d14e43db1">PUT_SENT</a>;
        it-&gt;second.numResponses = 0;
        it-&gt;second.numFailed = 0;
        it-&gt;second.numSent = lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>();
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it-&gt;second.getCallMsg != NULL) {

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>        cout &lt;&lt; <span class="stringliteral">&quot;DHT::handleLookupResponse(): GET &quot;</span>
             &lt;&lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span>
             &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>(); i++) {
            cout &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i) &lt;&lt; endl;
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        <span class="keywordflow">if</span> ((lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a86a9d5fd7849c18b989f2e5260cfbf12">getIsValid</a>() == <span class="keyword">false</span>)
                || (lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>() == 0)) {

            EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleLookupResponse()]\n&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;    Unable to get replica list : invalid lookup&quot;</span>
               &lt;&lt; endl;
            <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
            <a class="code" href="classDhtDumpEntry.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DhtDumpEntry</a> result;
            result.<a class="code" href="classDhtDumpEntry.html#a05c7cf256b17d3736505ab9c67b6f45a">setKey</a>(lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a0eb7ae69a84948251e35be07be9e3911">getKey</a>());
            result.<a class="code" href="classDhtDumpEntry.html#a2683c4e8c0b12acfd3cb342c6f0e0412">setValue</a>(<a class="code" href="classBinaryValue.html#a895c82622c044fbc70da7c18e3ce87b9">BinaryValue::UNSPECIFIED_VALUE</a>);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#a4c40ba014acb1bc5a2f4cdfca0893159">setResultArraySize</a>(1);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#aa3180b2feb0fba62d21832932d7dd03d">setResult</a>(0, result);
            capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#ab11c85724ad974880150524aa8ecd777">setIsSuccess</a>(<span class="keyword">false</span>);
            <span class="comment">//cout &lt;&lt; &quot;DHT: lookup failed 2&quot; &lt;&lt; endl;</span>
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it-&gt;second.getCallMsg, capiGetRespMsg);
            <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.erase(rpcId);
            <span class="keywordflow">return</span>;
        }

        it-&gt;second.numSent = 0;

        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>(); i++) {
            <span class="keywordflow">if</span> (i &lt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="classDHT.html#ab7bfedf297279702d3f5c4a936eb0f72">numGetRequests</a>) {
                <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>* dhtMsg = <span class="keyword">new</span> <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>();
                dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(it-&gt;second.getCallMsg-&gt;getKey());
                dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a1f1372d79e99d1b20a5b3e5bddecefba">setKind</a>(it-&gt;second.getCallMsg-&gt;getKind());
                dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#af169c73b1cd80f669a2f20aace5e8ed0">setId</a>(it-&gt;second.getCallMsg-&gt;getId());
                dhtMsg-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">true</span>);
                dhtMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(dhtMsg));
                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++;
                             numBytesNormal += dhtMsg-&gt;getByteLength());
                <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i), dhtMsg,
                                 NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1, 0, rpcId);
                it-&gt;second.numSent++;
            } <span class="keywordflow">else</span> {
                <span class="comment">// we don&#39;t send, we just store the remaining keys</span>
                it-&gt;second.replica.push_back(lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a4c0f21b5ab1a7865cd23d8f6e3a1640c">getSiblings</a>(i));
            }
        }

        it-&gt;second.numAvailableReplica = lookupMsg-&gt;<a class="code" href="classLookupResponse.html#a294d30cb0b365a24c1b1bff9478f45ef">getSiblingsArraySize</a>();
        it-&gt;second.numResponses = 0;
        it-&gt;second.hashVector = NULL;
        it-&gt;second.state = <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a88f599ef4e7b453e944009ebf52dfee5">GET_HASH_SENT</a>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a700a39d93f2e46ecf7e1e26e43a137bd"></a><!-- doxytag: member="DHT::handlePutCAPIRequest" ref="a700a39d93f2e46ecf7e1e26e43a137bd" args="(DHTputCAPICall *capiPutMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handlePutCAPIRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTputCAPICall.html">DHTputCAPICall</a> *&#160;</td>
          <td class="paramname"><em>capiPutMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00486">486</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// asks the replica list</span>
    <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>* lookupCall = <span class="keyword">new</span> <a class="code" href="classLookupCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">LookupCall</a>();
    lookupCall-&gt;<a class="code" href="classLookupCall.html#ac9cfcf7fe5298270b6b3898b65541a4b">setKey</a>(capiPutMsg-&gt;<a class="code" href="classDHTputCAPICall.html#a83ea3738377de538517b65e7d5dfed19">getKey</a>());
    lookupCall-&gt;<a class="code" href="classLookupCall.html#a1a365b8c947e000203e7fdc144715c2b">setNumSiblings</a>(<a class="code" href="classDHT.html#a21217d399a3e2f94569c794da5004421">numReplica</a>);
    <a class="code" href="classBaseRpc.html#a0dea7eed103c0e97176576d6642f7bfa" title="Sends an internal Remote-Procedure-Call between two tiers ">sendInternalRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, lookupCall, NULL, -1, 0,
                        capiPutMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>());

    PendingRpcsEntry entry;
    entry.putCallMsg = capiPutMsg;
    entry.state = <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7ac78fe45a5d659c6f0b23cc3fe56e8e1d">LOOKUP_STARTED</a>;
    <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.insert(make_pair(capiPutMsg-&gt;<a class="code" href="classBaseRpcMessage.html#a79f78c32aa4461025a89e8de3bc35702">getNonce</a>(), entry));
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa6b15162da48bb0c982ee87aa1ae1c8a"></a><!-- doxytag: member="DHT::handlePutRequest" ref="aa6b15162da48bb0c982ee87aa1ae1c8a" args="(DHTPutCall *dhtMsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handlePutRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTPutCall.html">DHTPutCall</a> *&#160;</td>
          <td class="paramname"><em>dhtMsg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00292">292</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    std::string tempString = <span class="stringliteral">&quot;PUT_REQUEST received: &quot;</span>
            + std::string(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16));
    getParentModule()-&gt;getParentModule()-&gt;bubble(tempString.c_str());

    <span class="keywordtype">bool</span> err;
    <span class="keywordtype">bool</span> isSibling = <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#ab5887b89ba9da5973068e834feb69ce7" title="Query if a node is among the siblings for a given key.">isSiblingFor</a>(<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>(),
                  dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(), <a class="code" href="classDHT.html#a6591add2e5cbc7ec8d203013cb110d04" title="use a secure maintenance algorithm based on majority decisions">secureMaintenance</a> ? <a class="code" href="classDHT.html#a21217d399a3e2f94569c794da5004421">numReplica</a> : 1, &amp;err);
    <span class="keywordflow">if</span> (err) {
        isSibling = <span class="keyword">true</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="classDHT.html#a6591add2e5cbc7ec8d203013cb110d04" title="use a secure maintenance algorithm based on majority decisions">secureMaintenance</a> &amp;&amp; dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a813b96e27699123d6f50fd20b4973248">getMaintenance</a>()) {
        <a class="code" href="structDhtDataEntry.html">DhtDataEntry</a>* entry = <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a59ed0b3b3970dbf1057636f4c7cb2c17" title="Returns a pointer to the requested stored data item.">getDataEntry</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(),
                                                        dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(),
                                                        dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>());
        <span class="keywordflow">if</span> (entry == NULL) {
            <span class="comment">// add ttl timer</span>
            <a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a> *timerMsg = <span class="keyword">new</span> <a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a>(<span class="stringliteral">&quot;ttl_timer&quot;</span>);
            timerMsg-&gt;<a class="code" href="classDHTTtlTimer.html#abd0c245f818e4a67033275d5058d9fed">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>());
            timerMsg-&gt;<a class="code" href="classDHTTtlTimer.html#aa627ca85709b20db15a5e862a9560669">setKind</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>());
            timerMsg-&gt;<a class="code" href="classDHTTtlTimer.html#a0fd41184fb52479bed7d24a848e4c2a3">setId</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>());
            scheduleAt(simTime() + dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#ad33da3c1f52a586e4175e407e5f98fc7">getTtl</a>(), timerMsg);

            entry = <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a1fab63fa3bb75248a4118fdbb50c95f5" title="Store a new data item in the map.">addData</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(),
                                 dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a07c6946f5546b7b64c4df52374bba55c">getValue</a>(), timerMsg,
                                 dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a96a50b9f789b3834b2d2cf97b488658d">getIsModifiable</a>(), dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(),
                                 isSibling);
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((entry-&gt;siblingVote.size() == 0) &amp;&amp; isSibling) {
            <span class="comment">// we already have a verified entry with this key and are</span>
            <span class="comment">// still responsible =&gt; ignore maintenance calls</span>
            <span class="keyword">delete</span> dhtMsg;
            <span class="keywordflow">return</span>;
        }

        SiblingVoteMap::iterator it = entry-&gt;siblingVote.find(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a07c6946f5546b7b64c4df52374bba55c">getValue</a>());
        <span class="keywordflow">if</span> (it == entry-&gt;siblingVote.end()) {
            <span class="comment">// new hash</span>
            <a class="code" href="classBaseKeySortedVector.html">NodeVector</a> vect;
            vect.<a class="code" href="classBaseKeySortedVector.html#afbcdfbd9680a475cceb48ccc841140cd" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>());
            entry-&gt;siblingVote.insert(make_pair(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a07c6946f5546b7b64c4df52374bba55c">getValue</a>(),
                                                vect));
        } <span class="keywordflow">else</span> {
            it-&gt;second.add(dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>());
        }

        <span class="keywordtype">size_t</span> maxCount = 0;
        SiblingVoteMap::iterator majorityIt;

        <span class="keywordflow">for</span> (it = entry-&gt;siblingVote.begin(); it != entry-&gt;siblingVote.end(); it++) {
            <span class="keywordflow">if</span> (it-&gt;second.size() &gt; maxCount) {
                maxCount = it-&gt;second.size();
                majorityIt = it;
            }
        }

        entry-&gt;value = majorityIt-&gt;first;
        entry-&gt;responsible = <span class="keyword">true</span>;

        <span class="keywordflow">if</span> (maxCount &gt; <a class="code" href="classDHT.html#a21217d399a3e2f94569c794da5004421">numReplica</a>) {
            entry-&gt;siblingVote.clear();
        }

        <span class="comment">// send back</span>
        <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>* responseMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>();
        responseMsg-&gt;<a class="code" href="classDHTPutResponse.html#a39abc13f444f85a12feff708a91edf09">setSuccess</a>(<span class="keyword">true</span>);
        responseMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#a845afd31387cf944fd8f6c173b69507f">PUTRESPONSE_L</a>(responseMsg));
        <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++; <a class="code" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">numBytesNormal</a> += responseMsg-&gt;getByteLength());

        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(dhtMsg, responseMsg);

        <span class="keywordflow">return</span>;
    }

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (!(<a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a4ddcc8ac2516fc7db403fd4a27069a75" title="Returns a boolean telling if this data if modifiable.">isModifiable</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(),
                                    dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>()))) {
        <span class="comment">// check if the put request came from the right node</span>
        <a class="code" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> sourceNode = <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#aa99008f59fd5b3beb8f2cfccfaf54fc3" title="Returns the source node of a stored data item with a given key.">getSourceNode</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(),
                                    dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>());
        <span class="keywordflow">if</span> (((!sourceNode.<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>())
                &amp;&amp; (!dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>().<a class="code" href="classNodeHandle.html#ab5136375a4548ced7c2014a73c8743c9" title="indicates if this NodeHandle is specified">isUnspecified</a>()) &amp;&amp; (sourceNode
                != dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>())) || ((dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a813b96e27699123d6f50fd20b4973248">getMaintenance</a>())
                &amp;&amp; (dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#af5825ceb2c816c26f4f9e0f66db298bd">getOwnerNode</a>() == sourceNode))) {
            <span class="comment">// TODO: set owner</span>
            <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>* responseMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>();
            responseMsg-&gt;<a class="code" href="classDHTPutResponse.html#a39abc13f444f85a12feff708a91edf09">setSuccess</a>(<span class="keyword">false</span>);
            responseMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#a845afd31387cf944fd8f6c173b69507f">PUTRESPONSE_L</a>(responseMsg));
            <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++;
                         numBytesNormal += responseMsg-&gt;getByteLength());
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(dhtMsg, responseMsg);
            <span class="keywordflow">return</span>;
        }

    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="comment">// remove data item from local data storage</span>
    <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#af64b6e6563f5934443182986ab7b9f63" title="Removes a certain data item from the map.">removeData</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(),
                            dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>());

    <span class="keywordflow">if</span> (dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a07c6946f5546b7b64c4df52374bba55c">getValue</a>().size() &gt; 0) {
        <span class="comment">// add ttl timer</span>
        <a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a> *timerMsg = <span class="keyword">new</span> <a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a>(<span class="stringliteral">&quot;ttl_timer&quot;</span>);
        timerMsg-&gt;<a class="code" href="classDHTTtlTimer.html#abd0c245f818e4a67033275d5058d9fed">setKey</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>());
        timerMsg-&gt;<a class="code" href="classDHTTtlTimer.html#aa627ca85709b20db15a5e862a9560669">setKind</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>());
        timerMsg-&gt;<a class="code" href="classDHTTtlTimer.html#a0fd41184fb52479bed7d24a848e4c2a3">setId</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>());
        scheduleAt(simTime() + dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#ad33da3c1f52a586e4175e407e5f98fc7">getTtl</a>(), timerMsg);
        <span class="comment">// storage data item in local data storage</span>
        <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a1fab63fa3bb75248a4118fdbb50c95f5" title="Store a new data item in the map.">addData</a>(dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aec43ff8025f9f6fc799dfac0b577bf12">getKey</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a0cddf999480b9bdfa882d104b659501f">getKind</a>(),
                                     dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a49414c1f2aa157836e29c4cac00fa9e8">getId</a>(), dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a07c6946f5546b7b64c4df52374bba55c">getValue</a>(), timerMsg,
                             dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a96a50b9f789b3834b2d2cf97b488658d">getIsModifiable</a>(), dhtMsg-&gt;<a class="code" href="classBaseRpcMessage.html#ada3e122125cfb5acc7350277ca69c45a">getSrcNode</a>(),
                             isSibling);
    }

    <span class="comment">// send back</span>
    <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>* responseMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutResponse.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutResponse</a>();
    responseMsg-&gt;<a class="code" href="classDHTPutResponse.html#a39abc13f444f85a12feff708a91edf09">setSuccess</a>(<span class="keyword">true</span>);
    responseMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#a845afd31387cf944fd8f6c173b69507f">PUTRESPONSE_L</a>(responseMsg));
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++; numBytesNormal += responseMsg-&gt;getByteLength());

    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(dhtMsg, responseMsg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af1537f9c596e0d55c35ca8dcb7c17ba6"></a><!-- doxytag: member="DHT::handlePutResponse" ref="af1537f9c596e0d55c35ca8dcb7c17ba6" args="(DHTPutResponse *dhtMsg, int rpcId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handlePutResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTPutResponse.html">DHTPutResponse</a> *&#160;</td>
          <td class="paramname"><em>dhtMsg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00531">531</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    PendingRpcs::iterator it = <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.find(rpcId);

    <span class="keywordflow">if</span> (it == <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.end()) <span class="comment">// unknown request</span>
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (dhtMsg-&gt;<a class="code" href="classDHTPutResponse.html#a81b52a68e7782d7a9a7417b59e922afd">getSuccess</a>()) {
        it-&gt;second.numResponses++;
    } <span class="keywordflow">else</span> {
        it-&gt;second.numFailed++;
    }


<span class="comment">//    if ((it-&gt;second.numFailed + it-&gt;second.numResponses) == it-&gt;second.numSent) {</span>
    <span class="keywordflow">if</span> (it-&gt;second.numResponses / (<span class="keywordtype">double</span>)it-&gt;second.numSent &gt; 0.5) {

        <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>* capiPutRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>();
        capiPutRespMsg-&gt;<a class="code" href="classDHTputCAPIResponse.html#a2ad17ddcf6ecc8a47d5a8e3b7083cbce">setIsSuccess</a>(<span class="keyword">true</span>);
        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it-&gt;second.putCallMsg, capiPutRespMsg);
        <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.erase(rpcId);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1be3042a36d8f9bd6986effd9599da70"></a><!-- doxytag: member="DHT::handleRpcCall" ref="a1be3042a36d8f9bd6986effd9599da70" args="(BaseCallMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DHT::handleRpcCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Processes Remote-Procedure-Call invocation messages. </p>
<p><br/>
</p>
<p>This method should be overloaded when the overlay provides RPC functionality.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true, if rpc has been handled </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseRpc.html#a20e77c3e0c203762a5b582ffebe3ba4b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00105">105</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
        <span class="comment">// RPCs between nodes</span>
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>(DHTPut, <a class="code" href="classDHT.html#aa6b15162da48bb0c982ee87aa1ae1c8a">handlePutRequest</a>);
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>(DHTGet, <a class="code" href="classDHT.html#a3d75f9feb24018644f778d5b34af6b48">handleGetRequest</a>);
        <span class="comment">// internal RPCs</span>
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>(DHTputCAPI, <a class="code" href="classDHT.html#a700a39d93f2e46ecf7e1e26e43a137bd">handlePutCAPIRequest</a>);
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>(DHTgetCAPI, <a class="code" href="classDHT.html#adcb133efa64eda79fe4f0d569c124e8f">handleGetCAPIRequest</a>);
        <a class="code" href="RpcMacros_8h.html#ad81d44e9bc59d2fb2cfcacc4d5ecda35" title="Declares a RPC method delegation.">RPC_DELEGATE</a>(DHTdump, <a class="code" href="classDHT.html#aa52a4a6fa8dd6604d5be1cec488ec434">handleDumpDhtRequest</a>);
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( )

    return <a class="code" href="RpcMacros_8h.html#aa5e964b7c7129c0943237a786e455e9a">RPC_HANDLED</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a372f6f5fd02b9fa01cce1d9a158dcc4b"></a><!-- doxytag: member="DHT::handleRpcResponse" ref="a372f6f5fd02b9fa01cce1d9a158dcc4b" args="(BaseResponseMessage *msg, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handleRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>rtt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC response has been received. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The response message. </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classDHT.html#a372f6f5fd02b9fa01cce1d9a158dcc4b" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">rtt</td><td>The Round-Trip-Time of this RPC </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#a6229090a446fb649cfec3c1fb61e7167">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00120">120</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
        <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(DHTPut){
        <a class="code" href="classDHT.html#af1537f9c596e0d55c35ca8dcb7c17ba6">handlePutResponse</a>(_DHTPutResponse, rpcId);
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHT Put RPC Response received: id=&quot;</span> &lt;&lt; rpcId
           &lt;&lt; <span class="stringliteral">&quot; msg=&quot;</span> &lt;&lt; *_DHTPutResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(DHTGet) {
        <a class="code" href="classDHT.html#ad799b7d64e238b4224409d6fe3a18b14">handleGetResponse</a>(_DHTGetResponse, rpcId);
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHT Get RPC Response received: id=&quot;</span> &lt;&lt; rpcId
           &lt;&lt; <span class="stringliteral">&quot; msg=&quot;</span> &lt;&lt; *_DHTGetResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(<a class="code" href="classLookup.html">Lookup</a>) {
        <a class="code" href="classDHT.html#a33ea03bbf62bf2c7c0278e3da90e4576">handleLookupResponse</a>(_LookupResponse, rpcId);
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    Lookup RPC Response received: id=&quot;</span> &lt;&lt; rpcId
           &lt;&lt; <span class="stringliteral">&quot; msg=&quot;</span> &lt;&lt; *_LookupResponse &lt;&lt; <span class="stringliteral">&quot; rtt=&quot;</span> &lt;&lt; rtt
           &lt;&lt; endl;
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>()
}
</pre></div>
</div>
</div>
<a class="anchor" id="a909b3678f0097e4b33811c7a30042e8d"></a><!-- doxytag: member="DHT::handleRpcTimeout" ref="a909b3678f0097e4b33811c7a30042e8d" args="(BaseCallMessage *msg, const TransportAddress &amp;dest, cPolymorphic *context, int rpcId, const OverlayKey &amp;destKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handleRpcTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>destKey</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This method is called if an RPC timeout has been reached. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The original RPC message. </td></tr>
    <tr><td class="paramname">dest</td><td>The destination node </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to an optional state object. The object has to be handled/deleted by the <a class="el" href="classDHT.html#a372f6f5fd02b9fa01cce1d9a158dcc4b" title="This method is called if an RPC response has been received.">handleRpcResponse()</a> code </td></tr>
    <tr><td class="paramname">rpcId</td><td>The RPC id. </td></tr>
    <tr><td class="paramname">destKey</td><td>the destination <a class="el" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classRpcListener.html#aaaf9cd362481527ed995dd159aa96b73">RpcListener</a>.</p>

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00151">151</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg)
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(DHTPut){
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHTPut Timeout&quot;</span>
           &lt;&lt; endl;

        PendingRpcs::iterator it = <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.find(rpcId);

        <span class="keywordflow">if</span> (it == <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.end()) <span class="comment">// unknown request</span>
            <span class="keywordflow">return</span>;

        it-&gt;second.numFailed++;

        <span class="keywordflow">if</span> (it-&gt;second.numFailed / (<span class="keywordtype">double</span>)it-&gt;second.numSent &gt;= 0.5) {
            <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>* capiPutRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTputCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTputCAPIResponse</a>();
            capiPutRespMsg-&gt;<a class="code" href="classDHTputCAPIResponse.html#a2ad17ddcf6ecc8a47d5a8e3b7083cbce">setIsSuccess</a>(<span class="keyword">false</span>);
            <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it-&gt;second.putCallMsg, capiPutRespMsg);
            <span class="comment">//cout &lt;&lt; &quot;timeout 1&quot; &lt;&lt; endl;</span>
            <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.erase(rpcId);
        }

        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(DHTGet) {
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleRpcResponse()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    DHTGet Timeout&quot;</span>
           &lt;&lt; endl;

        PendingRpcs::iterator it = <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.find(rpcId);

        <span class="keywordflow">if</span> (it == <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.end()) { <span class="comment">// unknown request</span>
            <span class="keywordflow">return</span>;
        }

        <span class="keywordflow">if</span> (it-&gt;second.state == <a class="code" href="classDHT.html#a63fbad6b0540beae9d4bd8b3cce7abb7a473a1789e01de139a5504ffa3ed03031">GET_VALUE_SENT</a>) {
            <span class="comment">// we have sent a &#39;real&#39; get request</span>
            <span class="comment">// ask anyone else, if possible</span>
            <span class="keywordflow">if</span> ((it-&gt;second.hashVector != NULL)
                &amp;&amp; (it-&gt;second.hashVector-&gt;size() &gt; 0)) {

                <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>* getCall = <span class="keyword">new</span> <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>();
                getCall-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(_DHTGetCall-&gt;getKey());
                getCall-&gt;<a class="code" href="classDHTGetCall.html#a1f1372d79e99d1b20a5b3e5bddecefba">setKind</a>(_DHTGetCall-&gt;getKind());
                getCall-&gt;<a class="code" href="classDHTGetCall.html#af169c73b1cd80f669a2f20aace5e8ed0">setId</a>(_DHTGetCall-&gt;getId());
                getCall-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">false</span>);
                getCall-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(getCall));
                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++;
                             <a class="code" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">numBytesNormal</a> += getCall-&gt;getByteLength());

                <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, it-&gt;second.hashVector-&gt;back(),
                                 getCall, NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1, 0, rpcId);
                it-&gt;second.hashVector-&gt;pop_back();
            } <span class="keywordflow">else</span> {
                <span class="comment">// no one else</span>
                <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
                capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#ab11c85724ad974880150524aa8ecd777">setIsSuccess</a>(<span class="keyword">false</span>);
                <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it-&gt;second.getCallMsg,
                                capiGetRespMsg);
                <span class="comment">//cout &lt;&lt; &quot;DHT: GET failed: timeout (no one else)&quot; &lt;&lt; endl;</span>
                <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.erase(rpcId);
                <span class="keywordflow">return</span>;
            }
        } <span class="keywordflow">else</span> {
            <span class="comment">// timeout while waiting for hashes</span>
            <span class="comment">// try to ask another one of the replica list for the hash</span>
            <span class="keywordflow">if</span> (it-&gt;second.replica.size() &gt; 0) {
                <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>* getCall = <span class="keyword">new</span> <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>();
                getCall-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(_DHTGetCall-&gt;getKey());
                getCall-&gt;<a class="code" href="classDHTGetCall.html#a1f1372d79e99d1b20a5b3e5bddecefba">setKind</a>(_DHTGetCall-&gt;getKind());
                getCall-&gt;<a class="code" href="classDHTGetCall.html#af169c73b1cd80f669a2f20aace5e8ed0">setId</a>(_DHTGetCall-&gt;getId());
                getCall-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">true</span>);
                getCall-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(getCall));

                <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++;
                             numBytesNormal += getCall-&gt;getByteLength());

                <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, it-&gt;second.replica.back(),
                                 getCall, NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1, 0,
                                 rpcId);
                it-&gt;second.replica.pop_back();
            } <span class="keywordflow">else</span> {
                <span class="comment">// no one else to ask, see what we can do with what we have</span>
                <span class="keywordflow">if</span> (it-&gt;second.numResponses &gt; 0) {
                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxCount = 0;
                    <a class="code" href="classBaseKeySortedVector.html">NodeVector</a>* hashVector = NULL;
                    std::map&lt;BinaryValue, NodeVector&gt;::iterator itHashes;
                    <span class="keywordflow">for</span> (itHashes = it-&gt;second.hashes.begin();
                         itHashes != it-&gt;second.hashes.end(); itHashes++) {

                        <span class="keywordflow">if</span> (itHashes-&gt;second.size() &gt; maxCount) {
                            maxCount = itHashes-&gt;second.size();
                            hashVector = &amp;(itHashes-&gt;second);
                        }
                    }

                    <span class="comment">// since it makes no difference for us, if we</span>
                    <span class="comment">// return a invalid result or return nothing,</span>
                    <span class="comment">// we simply return the value with the highest probability</span>
                    it-&gt;second.hashVector = hashVector;
<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span>                    <span class="keywordflow">if</span> ((<span class="keywordtype">double</span>)maxCount/(double)it-&gt;second.numResponses &gt;=
                                                             <a class="code" href="classDHT.html#a28445696afa54db8a4794b797c424036">ratioIdentical</a>) {
                        it-&gt;second.hashVector = hashVector;
                    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                }

                <span class="keywordflow">if</span> ((it-&gt;second.hashVector != NULL)
                     &amp;&amp; (it-&gt;second.hashVector-&gt;size() &gt; 0)) {

                    <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>* getCall = <span class="keyword">new</span> <a class="code" href="classDHTGetCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTGetCall</a>();
                    getCall-&gt;<a class="code" href="classDHTGetCall.html#a7f40bb653455a8c7c587414e4517f352">setKey</a>(_DHTGetCall-&gt;getKey());
                    getCall-&gt;<a class="code" href="classDHTGetCall.html#a1f1372d79e99d1b20a5b3e5bddecefba">setKind</a>(_DHTGetCall-&gt;getKind());
                    getCall-&gt;<a class="code" href="classDHTGetCall.html#af169c73b1cd80f669a2f20aace5e8ed0">setId</a>(_DHTGetCall-&gt;getId());
                    getCall-&gt;<a class="code" href="classDHTGetCall.html#a6e8352e9b93abd283ea1a90f4da1719e">setIsHash</a>(<span class="keyword">false</span>);
                    getCall-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#ae52c9263850458a4b01c7fdca7a79e1d">GETCALL_L</a>(getCall));
                    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>++;
                                 numBytesNormal += getCall-&gt;getByteLength());
                    <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, it-&gt;second.hashVector-&gt;back(),
                                     getCall, NULL, <a class="code" href="CommonMessages__m_8h.html#a5bbe67ba1134d38bbb89c7c242ba6551a931137cd67090e50ef2ea3ccfb9e8d90">DEFAULT_ROUTING</a>, -1,
                                     0, rpcId);
                    it-&gt;second.hashVector-&gt;pop_back();
                } <span class="keywordflow">else</span> {
                    <span class="comment">// no more nodes to ask -&gt; get failed</span>
                    <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>* capiGetRespMsg = <span class="keyword">new</span> <a class="code" href="classDHTgetCAPIResponse.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">DHTgetCAPIResponse</a>();
                    capiGetRespMsg-&gt;<a class="code" href="classDHTgetCAPIResponse.html#ab11c85724ad974880150524aa8ecd777">setIsSuccess</a>(<span class="keyword">false</span>);
                    <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(it-&gt;second.getCallMsg, capiGetRespMsg);
                    <span class="comment">//cout &lt;&lt; &quot;DHT: GET failed: timeout2 (no one else)&quot; &lt;&lt; endl;</span>
                    <a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>.erase(rpcId);
                }
            }
        }
        <span class="keywordflow">break</span>;
    }
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>( )
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6ae0227d1adcc58e0cc6a8a08222d39f"></a><!-- doxytag: member="DHT::handleTimerEvent" ref="a6ae0227d1adcc58e0cc6a8a08222d39f" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="el" href="classBaseRpc.html#ab893c156412e38caa62fe058b229899b">BaseRpc</a>.</p>

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00088">88</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a>* msg_timer = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classDHTTtlTimer.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTTtlTimer</a>*<span class="keyword">&gt;</span> (msg);

    <span class="keywordflow">if</span> (msg_timer) {
        EV &lt;&lt; <span class="stringliteral">&quot;[DHT::handleTimerEvent()]\n&quot;</span>
           &lt;&lt; <span class="stringliteral">&quot;    received timer ttl, key: &quot;</span>
           &lt;&lt; msg_timer-&gt;<a class="code" href="classDHTTtlTimer.html#a15eb83bf8f2e1def81c28b4f9d212982">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16)
           &lt;&lt; <span class="stringliteral">&quot;\n (overlay-&gt;getThisNode().getKey() = &quot;</span>
           &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>
           &lt;&lt; endl;

        <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#af64b6e6563f5934443182986ab7b9f63" title="Removes a certain data item from the map.">removeData</a>(msg_timer-&gt;<a class="code" href="classDHTTtlTimer.html#a15eb83bf8f2e1def81c28b4f9d212982">getKey</a>(), msg_timer-&gt;<a class="code" href="classDHTTtlTimer.html#a67f6b49b590a2a011a8eaa12e6d6bcb3">getKind</a>(),
                                msg_timer-&gt;<a class="code" href="classDHTTtlTimer.html#a4661d8eee16ade14ab082f12e7336c3d">getId</a>());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4f00d82a6ffb8c07887443d9f713e93e"></a><!-- doxytag: member="DHT::initializeApp" ref="a4f00d82a6ffb8c07887443d9f713e93e" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::initializeApp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initializes derived class-attributes </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stage</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#ac9a059a2cfb67f4c38f462bb1383e795">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00057">57</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532ad9afa81d0184c5f0649fa111f7a821bc" title="deprecated">MIN_STAGE_APP</a>)
        <span class="keywordflow">return</span>;

    <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a> = check_and_cast&lt;<a class="code" href="classDHTDataStorage.html">DHTDataStorage</a>*&gt;
                      (getParentModule()-&gt;getSubmodule(<span class="stringliteral">&quot;dhtDataStorage&quot;</span>));

    <a class="code" href="classDHT.html#a21217d399a3e2f94569c794da5004421">numReplica</a> = par(<span class="stringliteral">&quot;numReplica&quot;</span>);
    <a class="code" href="classDHT.html#ab7bfedf297279702d3f5c4a936eb0f72">numGetRequests</a> = par(<span class="stringliteral">&quot;numGetRequests&quot;</span>);
    <a class="code" href="classDHT.html#a28445696afa54db8a4794b797c424036">ratioIdentical</a> = par(<span class="stringliteral">&quot;ratioIdentical&quot;</span>);
    <a class="code" href="classDHT.html#a6591add2e5cbc7ec8d203013cb110d04" title="use a secure maintenance algorithm based on majority decisions">secureMaintenance</a> = par(<span class="stringliteral">&quot;secureMaintenance&quot;</span>);
    <a class="code" href="classDHT.html#aa4de4acb0b1da732f694a264a0d39f0f" title="if node is malicious, it tries a invalidData attack">invalidDataAttack</a> = par(<span class="stringliteral">&quot;invalidDataAttack&quot;</span>);
    <a class="code" href="classDHT.html#a00089eecdb5a795e06d659fec0b80e28" title="if node is malicious, it tries a maintenanceData attack">maintenanceAttack</a> = par(<span class="stringliteral">&quot;maintenanceAttack&quot;</span>);

    <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)numReplica &gt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#acd3058ad15b470e024500dd4872e2f09" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>()) {
        opp_error(<span class="stringliteral">&quot;DHT::initialize(): numReplica bigger than what this &quot;</span>
                  <span class="stringliteral">&quot;overlay can handle (%d)&quot;</span>, <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#acd3058ad15b470e024500dd4872e2f09" title="Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay proto...">getMaxNumSiblings</a>());
    }

    <a class="code" href="classDHT.html#ad595de501119a833c0c4bbeb9c487f3e">maintenanceMessages</a> = 0;
    <a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a> = 0;
    <a class="code" href="classDHT.html#af9266b896acc3c51884ba59ae9d70ddd">numBytesMaintenance</a> = 0;
    <a class="code" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">numBytesNormal</a> = 0;
    WATCH(<a class="code" href="classDHT.html#ad595de501119a833c0c4bbeb9c487f3e">maintenanceMessages</a>);
    WATCH(<a class="code" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">normalMessages</a>);
    WATCH(<a class="code" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">numBytesNormal</a>);
    WATCH(<a class="code" href="classDHT.html#af9266b896acc3c51884ba59ae9d70ddd">numBytesMaintenance</a>);
    WATCH_MAP(<a class="code" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e" title="a map of all pending RPC operations">pendingRpcs</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae3ad9322668ae87b0c194d9c63d08ff6"></a><!-- doxytag: member="DHT::resultValuesBitLength" ref="ae3ad9322668ae87b0c194d9c63d08ff6" args="(DHTGetResponse *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DHT::resultValuesBitLength </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classDHTGetResponse.html">DHTGetResponse</a> *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00943">943</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                  {
    <span class="keywordtype">int</span> bitSize = 0;
    <span class="keywordflow">for</span> (uint i = 0; i &lt; msg-&gt;<a class="code" href="classDHTGetResponse.html#a81808e33769d67b6ae7e6d99ae77d87f">getResultArraySize</a>(); i++) {
        bitSize += msg-&gt;<a class="code" href="classDHTGetResponse.html#a96e395ff8f99931e27815f6d6c33ce00">getResult</a>(i).<a class="code" href="classDhtDumpEntry.html#a690fe434ac3281d8e31670fb944e1771">getValue</a>().size();

    }
    <span class="keywordflow">return</span> bitSize;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a054905e16db8c3d5d0b1d8176596c08c"></a><!-- doxytag: member="DHT::sendMaintenancePutCall" ref="a054905e16db8c3d5d0b1d8176596c08c" args="(const TransportAddress &amp;dest, const OverlayKey &amp;key, const DhtDataEntry &amp;entry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::sendMaintenancePutCall </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structDhtDataEntry.html">DhtDataEntry</a> &amp;&#160;</td>
          <td class="paramname"><em>entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00778">778</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                            {

    <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>* dhtMsg = <span class="keyword">new</span> <a class="code" href="classDHTPutCall.html" title="Class generated from applications/dht/DHTMessage.msg by opp_msgc.">DHTPutCall</a>();

    dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#abccc8395b7208b7ac33ba1f03f78ddfe">setKey</a>(key);
    dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a627e5cb4626dd10d21b4e9ab6e044ec1">setKind</a>(entry.<a class="code" href="structDhtDataEntry.html#a6f3be99f7b0cdcd215a4ccb813e9f703">kind</a>);
    dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a265b86acab1f9dfb5038e30b0f6f72d7">setId</a>(entry.<a class="code" href="structDhtDataEntry.html#af40de9c1b7d6b4e1136ca6f2b9144a14">id</a>);

    <span class="keywordflow">if</span> (<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#a234b046348574d37d811638f0b27a89e" title="Returns true, if node is malicious.">isMalicious</a>() &amp;&amp; <a class="code" href="classDHT.html#a00089eecdb5a795e06d659fec0b80e28" title="if node is malicious, it tries a maintenanceData attack">maintenanceAttack</a>) {
        dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aaf331ce0bc75e6f4bdd9a4f0453f44ed">setValue</a>(<span class="stringliteral">&quot;Modified Data&quot;</span>);
    } <span class="keywordflow">else</span> {
        dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#aaf331ce0bc75e6f4bdd9a4f0453f44ed">setValue</a>(entry.<a class="code" href="structDhtDataEntry.html#abffbe314f97ae10a9ca461e18102d618">value</a>);
    }

    dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#ad477378656a109b12f08cda5d9ac59c1">setTtl</a>((<span class="keywordtype">int</span>)SIMTIME_DBL(entry.<a class="code" href="structDhtDataEntry.html#af91eb3436a52ad0c6f424047113beee9">ttlMessage</a>-&gt;getArrivalTime()
                                    - simTime()));
    dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a4a7d0ab79090ca61a4afac26dd74b10d">setIsModifiable</a>(entry.<a class="code" href="structDhtDataEntry.html#a67c185200bbf51575e08bb8f5f646d42">is_modifiable</a>);
    dhtMsg-&gt;<a class="code" href="classDHTPutCall.html#a37f2793eb1f6d4a666a79cbeef8e26ed">setMaintenance</a>(<span class="keyword">true</span>);
    dhtMsg-&gt;setBitLength(<a class="code" href="DHTMessage__m_8h.html#add3d32552f5e0954f907fc1ece9d476d">PUTCALL_L</a>(dhtMsg));
    <a class="code" href="GlobalStatistics_8h.html#af29140ebe8e0a93406a58441f7c5fec8" title="Macro used for recording statistics considering measureNetwIn parameter.">RECORD_STATS</a>(<a class="code" href="classDHT.html#ad595de501119a833c0c4bbeb9c487f3e">maintenanceMessages</a>++;
                 <a class="code" href="classDHT.html#af9266b896acc3c51884ba59ae9d70ddd">numBytesMaintenance</a> += dhtMsg-&gt;getByteLength());

    <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ea098b73cd039f61df8b83f056c12b4d3b">TIER1_COMP</a>, node, dhtMsg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a556af7f1688e60e7bf5bc0116ea0beee"></a><!-- doxytag: member="DHT::update" ref="a556af7f1688e60e7bf5bc0116ea0beee" args="(const NodeHandle &amp;node, bool joined)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DHT::update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>joined</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Common API function: informs application about neighbors and own nodeID. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>new or lost neighbor </td></tr>
    <tr><td class="paramname">joined</td><td>new or lost? </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseApp.html#a129d228137df46b04c8b3272b6a32fcc">BaseApp</a>.</p>

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00690">690</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> key;
    <span class="keywordtype">bool</span> err = <span class="keyword">false</span>;
    <a class="code" href="structDhtDataEntry.html">DhtDataEntry</a> entry;
    std::map&lt;OverlayKey, DhtDataEntry&gt;::iterator it;

    EV &lt;&lt; <span class="stringliteral">&quot;[DHT::update() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
       &lt;&lt; <span class="stringliteral">&quot;    Update called()&quot;</span>
       &lt;&lt; endl;

    <span class="keywordflow">if</span> (<a class="code" href="classDHT.html#a6591add2e5cbc7ec8d203013cb110d04" title="use a secure maintenance algorithm based on majority decisions">secureMaintenance</a>) {
        <span class="keywordflow">for</span> (it = <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a9a5546debdaa4522c63b0b7e0a92545a" title="Returns an iterator to the beginning of the map.">begin</a>(); it != <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#ab874e8a9c0ee339ff20eda9a6226de8f" title="Returns an iterator to the end of the map.">end</a>(); it++) {
            <span class="keywordflow">if</span> (it-&gt;second.responsible) {
                <a class="code" href="classBaseKeySortedVector.html">NodeVector</a>* siblings = <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#a95851770a6ab3a176e1d7b5a7afba3f0" title="finds nodes closest to the given OverlayKey">local_lookup</a>(it-&gt;first,
                                                             <a class="code" href="classDHT.html#a21217d399a3e2f94569c794da5004421">numReplica</a>,
                                                             <span class="keyword">false</span>);
                <span class="keywordflow">if</span> (siblings-&gt;size() == 0) {
                    <span class="keyword">delete</span> siblings;
                    <span class="keywordflow">continue</span>;
                }

                <span class="keywordflow">if</span> (joined) {
                    EV &lt;&lt; <span class="stringliteral">&quot;[DHT::update() @ &quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>()
                       &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>().<a class="code" href="classOverlayKey.html#aabeb4fd284a630a82e982ba34ece4fd9" title="Returns a string representation of this key.">toString</a>(16) &lt;&lt; <span class="stringliteral">&quot;)]\n&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;    Potential new sibling for record &quot;</span> &lt;&lt; it-&gt;first
                       &lt;&lt; endl;

                    <span class="keywordflow">if</span> (<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#aa12314947ef42726ec6c7066dde8d0f9" title="This method should implement the distance between two keys.">distance</a>(node.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(), it-&gt;first) &lt;=
                        <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#aa12314947ef42726ec6c7066dde8d0f9" title="This method should implement the distance between two keys.">distance</a>(siblings-&gt;back().getKey(), it-&gt;first)) {

                        <a class="code" href="classDHT.html#a054905e16db8c3d5d0b1d8176596c08c">sendMaintenancePutCall</a>(node, it-&gt;first, it-&gt;second);
                    }

                    <span class="keywordflow">if</span> (<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#aa12314947ef42726ec6c7066dde8d0f9" title="This method should implement the distance between two keys.">distance</a>(<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>().<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(), it-&gt;first) &gt;
                        <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#aa12314947ef42726ec6c7066dde8d0f9" title="This method should implement the distance between two keys.">distance</a>(siblings-&gt;back().getKey(), it-&gt;first)) {

                        it-&gt;second.responsible = <span class="keyword">false</span>;
                    }
                } <span class="keywordflow">else</span> {
                    <span class="keywordflow">if</span> (<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#aa12314947ef42726ec6c7066dde8d0f9" title="This method should implement the distance between two keys.">distance</a>(node.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>(), it-&gt;first) &lt;
                        <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#aa12314947ef42726ec6c7066dde8d0f9" title="This method should implement the distance between two keys.">distance</a>(siblings-&gt;back().getKey(), it-&gt;first)) {

                        <a class="code" href="classDHT.html#a054905e16db8c3d5d0b1d8176596c08c">sendMaintenancePutCall</a>(siblings-&gt;back(), it-&gt;first,
                                               it-&gt;second);
                    }
                }

                <span class="keyword">delete</span> siblings;
            }
        }

        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">for</span> (it = <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#a9a5546debdaa4522c63b0b7e0a92545a" title="Returns an iterator to the beginning of the map.">begin</a>(); it != <a class="code" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc" title="pointer to the dht data storage">dataStorage</a>-&gt;<a class="code" href="classDHTDataStorage.html#ab874e8a9c0ee339ff20eda9a6226de8f" title="Returns an iterator to the end of the map.">end</a>(); it++) {
        key = it-&gt;first;
        entry = it-&gt;second;
        <span class="keywordflow">if</span> (joined) {
            <span class="keywordflow">if</span> (entry.<a class="code" href="structDhtDataEntry.html#a6fb8dca58f59421a7c02e830d42b7e6f">responsible</a> &amp;&amp; (<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#ab5887b89ba9da5973068e834feb69ce7" title="Query if a node is among the siblings for a given key.">isSiblingFor</a>(node, key,
                                                            <a class="code" href="classDHT.html#a21217d399a3e2f94569c794da5004421">numReplica</a>, &amp;err)
                    || err)) { <span class="comment">// hack for Chord, if we&#39;ve got a new predecessor</span>

                <span class="keywordflow">if</span> (err) {
                    EV &lt;&lt; <span class="stringliteral">&quot;[DHT::update()]\n&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;    Unable to know if key: &quot;</span> &lt;&lt; key
                       &lt;&lt; <span class="stringliteral">&quot; is in range of node: &quot;</span> &lt;&lt; node
                       &lt;&lt; endl;
                    <span class="comment">// For Chord: we&#39;ve got a new predecessor</span>
                    <span class="comment">// TODO: only send record, if we are not responsible any more</span>
                    <span class="comment">// TODO: check all protocols to change routing table first,</span>
                    <span class="comment">//       and than call update.</span>

                    <span class="comment">//if (overlay-&gt;isSiblingFor(overlay-&gt;getThisNode(), key, 1, &amp;err)) {</span>
                    <span class="comment">//    continue;</span>
                    <span class="comment">//}</span>
                }

                <a class="code" href="classDHT.html#a054905e16db8c3d5d0b1d8176596c08c">sendMaintenancePutCall</a>(node, key, entry);
            }
        }
        <span class="comment">//TODO: move this to the inner block above?</span>
        entry.<a class="code" href="structDhtDataEntry.html#a6fb8dca58f59421a7c02e830d42b7e6f">responsible</a> = <a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseOverlay.html#ab5887b89ba9da5973068e834feb69ce7" title="Query if a node is among the siblings for a given key.">isSiblingFor</a>(<a class="code" href="classBaseRpc.html#a9a633ad17071241f981fb76a9678337a">overlay</a>-&gt;<a class="code" href="classBaseRpc.html#ac3f420630d5618e81709c078b06fd9da" title="Returns the NodeHandle of this node.">getThisNode</a>(),
                                                  key, 1, &amp;err);
    }
}
</pre></div>
</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="ab7c8797381ca1362bb552d1535f50d1d"></a><!-- doxytag: member="DHT::operator&lt;&lt;" ref="ab7c8797381ca1362bb552d1535f50d1d" args="(std::ostream &amp;Stream, const PendingRpcsEntry &amp;entry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>Stream</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classDHT_1_1PendingRpcsEntry.html">PendingRpcsEntry</a> &amp;&#160;</td>
          <td class="paramname"><em>entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8cc_source.html#l00952">952</a> of file <a class="el" href="DHT_8cc_source.html">DHT.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (entry.getCallMsg) {
        os &lt;&lt; <span class="stringliteral">&quot;GET&quot;</span>;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entry.putCallMsg) {
        os &lt;&lt; <span class="stringliteral">&quot;PUT&quot;</span>;
    }

    os &lt;&lt; <span class="stringliteral">&quot; state: &quot;</span> &lt;&lt; entry.state
       &lt;&lt; <span class="stringliteral">&quot; numSent: &quot;</span> &lt;&lt; entry.numSent
       &lt;&lt; <span class="stringliteral">&quot; numResponses: &quot;</span> &lt;&lt; entry.numResponses
       &lt;&lt; <span class="stringliteral">&quot; numFailed: &quot;</span> &lt;&lt; entry.numFailed
       &lt;&lt; <span class="stringliteral">&quot; numAvailableReplica: &quot;</span> &lt;&lt; entry.numAvailableReplica;

    <span class="keywordflow">if</span> (entry.replica.size() &gt; 0) {
        os &lt;&lt; <span class="stringliteral">&quot; replicaSize: &quot;</span> &lt;&lt; entry.replica.size();
    }

    <span class="keywordflow">if</span> (entry.hashVector != NULL) {
        os &lt;&lt; <span class="stringliteral">&quot; hashVectorSize: &quot;</span> &lt;&lt; entry.hashVector-&gt;size();
    }

    <span class="keywordflow">if</span> (entry.hashes.size() &gt; 0) {
        os &lt;&lt; <span class="stringliteral">&quot; hashes:&quot;</span>;
        std::map&lt;BinaryValue, NodeVector&gt;::const_iterator it;

        <span class="keywordtype">int</span> i = 0;
        <span class="keywordflow">for</span> (it = entry.hashes.begin(); it != entry.hashes.end(); it++, i++) {
            os &lt;&lt; <span class="stringliteral">&quot; hash&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; it-&gt;second.size();
        }
    }

    <span class="keywordflow">return</span> os;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ab4d69aef76faee2c8f456605e1fac5bc"></a><!-- doxytag: member="DHT::dataStorage" ref="ab4d69aef76faee2c8f456605e1fac5bc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDHTDataStorage.html">DHTDataStorage</a>* <a class="el" href="classDHT.html#ab4d69aef76faee2c8f456605e1fac5bc">DHT::dataStorage</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>pointer to the dht data storage </p>

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00129">129</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa4de4acb0b1da732f694a264a0d39f0f"></a><!-- doxytag: member="DHT::invalidDataAttack" ref="aa4de4acb0b1da732f694a264a0d39f0f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classDHT.html#aa4de4acb0b1da732f694a264a0d39f0f">DHT::invalidDataAttack</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>if node is malicious, it tries a invalidData attack </p>

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00122">122</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a00089eecdb5a795e06d659fec0b80e28"></a><!-- doxytag: member="DHT::maintenanceAttack" ref="a00089eecdb5a795e06d659fec0b80e28" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classDHT.html#a00089eecdb5a795e06d659fec0b80e28">DHT::maintenanceAttack</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>if node is malicious, it tries a maintenanceData attack </p>

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00123">123</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad595de501119a833c0c4bbeb9c487f3e"></a><!-- doxytag: member="DHT::maintenanceMessages" ref="ad595de501119a833c0c4bbeb9c487f3e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classDHT.html#ad595de501119a833c0c4bbeb9c487f3e">DHT::maintenanceMessages</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00116">116</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a926bfb8dbc96675d3dae59d51fd90272"></a><!-- doxytag: member="DHT::normalMessages" ref="a926bfb8dbc96675d3dae59d51fd90272" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classDHT.html#a926bfb8dbc96675d3dae59d51fd90272">DHT::normalMessages</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00117">117</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="af9266b896acc3c51884ba59ae9d70ddd"></a><!-- doxytag: member="DHT::numBytesMaintenance" ref="af9266b896acc3c51884ba59ae9d70ddd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classDHT.html#af9266b896acc3c51884ba59ae9d70ddd">DHT::numBytesMaintenance</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00118">118</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a83ea8d514b0ec9c268c1f9fe4db6813a"></a><!-- doxytag: member="DHT::numBytesNormal" ref="a83ea8d514b0ec9c268c1f9fe4db6813a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classDHT.html#a83ea8d514b0ec9c268c1f9fe4db6813a">DHT::numBytesNormal</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00119">119</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab7bfedf297279702d3f5c4a936eb0f72"></a><!-- doxytag: member="DHT::numGetRequests" ref="ab7bfedf297279702d3f5c4a936eb0f72" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classDHT.html#ab7bfedf297279702d3f5c4a936eb0f72">DHT::numGetRequests</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00114">114</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a21217d399a3e2f94569c794da5004421"></a><!-- doxytag: member="DHT::numReplica" ref="a21217d399a3e2f94569c794da5004421" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint <a class="el" href="classDHT.html#a21217d399a3e2f94569c794da5004421">DHT::numReplica</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00113">113</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4dca98dd57d5bce189c6dc81a9ddb24e"></a><!-- doxytag: member="DHT::pendingRpcs" ref="a4dca98dd57d5bce189c6dc81a9ddb24e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDHT.html#ae5497677deb08feaaad5ccd5ce35e997">PendingRpcs</a> <a class="el" href="classDHT.html#a4dca98dd57d5bce189c6dc81a9ddb24e">DHT::pendingRpcs</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>a map of all pending RPC operations </p>

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00126">126</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a28445696afa54db8a4794b797c424036"></a><!-- doxytag: member="DHT::ratioIdentical" ref="a28445696afa54db8a4794b797c424036" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classDHT.html#a28445696afa54db8a4794b797c424036">DHT::ratioIdentical</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00115">115</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6591add2e5cbc7ec8d203013cb110d04"></a><!-- doxytag: member="DHT::secureMaintenance" ref="a6591add2e5cbc7ec8d203013cb110d04" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classDHT.html#a6591add2e5cbc7ec8d203013cb110d04">DHT::secureMaintenance</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>use a secure maintenance algorithm based on majority decisions </p>

<p>Definition at line <a class="el" href="DHT_8h_source.html#l00121">121</a> of file <a class="el" href="DHT_8h_source.html">DHT.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="DHT_8h_source.html">DHT.h</a></li>
<li><a class="el" href="DHT_8cc_source.html">DHT.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="classDHT.html">DHT</a>      </li>

    <li class="footer">Generated on Thu Mar 6 2014 14:06:45 for OverSim by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
